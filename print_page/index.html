
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AllStarLink Manual">
      
      
        <meta name="author" content="AllStarLink Team">
      
      
        <link rel="canonical" href="https://allstarlink.github.io/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/allstarlink.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Print Site - AllStarLink Manual</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="allstarlink" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AllStarLink Manual" class="md-header__button md-logo" aria-label="AllStarLink Manual" data-md-component="logo">
      
  <img src="../assets/allstar-logo-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AllStarLink Manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../basics/" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../install/" class="md-tabs__link">
          
  
    
  
  Installation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../user-guide/" class="md-tabs__link">
          
  
    
  
  Basic Operation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../adv-topics/" class="md-tabs__link">
          
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../voter/" class="md-tabs__link">
          
  
    
  
  VOTER/RTCM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developers/" class="md-tabs__link">
          
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../mans/" class="md-tabs__link">
          
  
    
  
  Man Pages

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../config/" class="md-tabs__link">
          
  
    
  
  Config Files

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AllStarLink Manual" class="md-nav__button md-logo" aria-label="AllStarLink Manual" data-md-component="logo">
      
  <img src="../assets/allstar-logo-small.png" alt="logo">

    </a>
    AllStarLink Manual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../basics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/gettingstarted/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/portal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AllStarLink Portal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/standardcommands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AllStarLink Standard Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/incompatibles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Incompatibilities, Changes, and Known Issues
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../install/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/whats-new/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Important Considerations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../install/pi-appliance/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 Appliance (Raspberry Pi)</span>
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 Appliance (Raspberry Pi)</span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/pi-appliance/pi-detailed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL3 Appliance Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../install/debian/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 on Debian</span>
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 on Debian</span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/debian/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debian 12 Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/debian/deb-appliance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debian 12 Appliance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/debian/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../allmon3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <span style="color:hsl(86.28, 71.6%, 33.14%)">Allmon3</span>
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            <span style="color:hsl(86.28, 71.6%, 33.14%)">Allmon3</span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allmon3/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allmon3/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allmon3/usermgmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../user-guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Basic Operation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Basic Operation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/menu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing ASL3 Menu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/asl-cmds-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL3 Commands and Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/passwords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logins and Passwords
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/updates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating ASL3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL3 Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Troubleshooting Tips
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-guide/betatest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beta Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pi/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <span style="color:hsl(86.28, 71.6%, 33.14%)">Pi Appliance Specifics (Cockpit)</span>
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            <span style="color:hsl(86.28, 71.6%, 33.14%)">Pi Appliance Specifics (Cockpit)</span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-get-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cockpit Web Admin Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cockpit Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-console/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terminal / Console
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-updates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Updates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Services Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pi/cockpit-firewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managing the Firewall
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../adv-topics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/allowdenylists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allow and Deny Lists
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/aprs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APRS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/tts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL Text-to-Speech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/conftmpl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Asterisk Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/autopatch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autopatch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/audio-level/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calibrating Audio Levels For The AllStarLink System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/daq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAQ Subsystem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/dns-servers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNS Servers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/eurorptr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    European Repeater Operation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/hotspot_hd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hot Spot Un-key Delay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/httpreg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP-Based Registration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/iaxreg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IAX-Based Registration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/litz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Long Tone Zero (LiTZ)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/macros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macros
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/multinodesnetwork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Nodes on the Same Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/nnx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Number Extensions (NNX)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/noderesolution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Resolution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/other-software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Software Products
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/parrotmode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parrot Mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/permanentnode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permanent Node Connection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/parrotmode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parrot Mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/permissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permissions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/privatenodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/remotebase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Base Nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/rxtoneburst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RX Toneburst
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/sa818modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SA818 RF Modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/sip-phone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up a SIP Phone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/sleepmode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sleep Mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/broadcastify/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming Node Audio to Broadcastify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/remotebase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Base Nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/rxtoneburst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RX Toneburst
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/tlb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TheLinkBox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/uefi-secureboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEFI and SecureBoot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adv-topics/usbinterfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB Audio Interfaces
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../voter/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    VOTER/RTCM
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            VOTER/RTCM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/about-voter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is the VOTER?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-protocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Protocol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-chan_voter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER chan_voter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/rtcm-hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTCM Hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-firmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER/RTCM Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-gps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER GPS Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-menus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER/RTCM Hardware Menu System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-audio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-buffers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Buffer Tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-simulcasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Simulcasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-audioanalysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER Audio Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../voter/voter-quantar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VOTER and the Quantar
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../developers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/package-builds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building ASL3-Asterisk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/source-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/source-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source-Based Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developers/aptly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AllStarLink Apt Repos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../mans/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Man Pages
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Man Pages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/allmon3-passwd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    allmon3-passwd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/asl-find-sound/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl-find-sound
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/asl-node-lookup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl-node-lookup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/asl-play-arn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl-play-arn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/asl-say/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl-say
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mans/asl-setup-dkms-mok/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl-setup-dkms-mok
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../config/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Config Files
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Config Files
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/config-structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structure of Config Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/rpt_conf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rpt.conf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/tlb_conf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tlb.conf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/voter_conf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    voter.conf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-welcome-to-allstarlink-3">Welcome to AllStarLink 3</h1>
<p>AllStarLink’s version 3 (ASL3) is the next generation of AllStar repeater and hot spot software. This version of AllStar has been redesigned to run on Asterisk 20 LTS (Long Term Support), the latest Debian Linux operating system, and modern hardware or virtual machines. The update from Asterisk 1.4 to Asterisk 20 implements over 15 years of Asterisk bug fixes, security improvements and enhancements. It brings with it the latest Asterisk applications, channel drivers and additional functionality.</p>
<p><a class="glightbox" href="../img/pi-appl-landing.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="right" alt="AllStarLink Landing Page" src="../img/pi-appl-landing.png" width="40%" /></a></p>
<p>This update required <code>app_rpt</code> (the Asterisk application that is AllStar) and it's various modules to be heavily modified. Many memory leaks have been addressed, modules load or refresh more reliably and many bugs have been squashed. This all adds up to improved stability and uptime.</p>
<p>In addition to the many <code>app_rpt</code> improvements and fixes, the code base is easier to maintain and enhance. The goal being to make <code>app_rpt</code> code accessible to more AllStar developers. Also, the <code>app_rpt</code> code base has been modified to meet Asterisk® coding guidelines.</p>
<p><strong>Supported Hardware &amp; Software</strong></p>
<ul>
<li>Any x86_64/amd64 hardware device</li>
<li>Any emulated x86_64/amd64 virtual machine</li>
<li>Any arm64-based device such as Raspberry Pi</li>
<li>Any emulated arm64 virtual machine</li>
<li>Debian 12</li>
</ul>
<h1 id="index-new-features">New Features</h1>
<p>In addition to the <code>app_rpt</code> code update, we have added many new features to make ASL3 the best AllStar release yet.</p>
<ul>
<li>Asterisk runs as non-root for increased security</li>
<li>Raspberry Pi image with an attractive landing page, system management, service discovery and reduced microSD wear</li>
<li>Packages for Debian 12 Bookworm for any platform running x86_64/amd64 and arm64</li>
<li>Worry free <code>apt</code> updates and upgrades. Linux Kernel updates won't break your node!</li>
<li>HTTP AllStarLink Registration and DNS IP address resolution with fallback to file</li>
<li>USB improvements including live logic view and auto device string discovery</li>
<li>Improved menu includes compatibility with user config file edits</li>
<li>Access lists configurable on a per node basis, with CLI or menu management</li>
<li>Configuration templates to simplify edits and menu updates</li>
<li>EchoLink code has been extensively reworked to improve stability. Added chats and doubling prevention</li>
</ul>
<h1 id="index-allstarlink-manual">AllStarLink Manual</h1>
<p>This is the AllStarLink version 3 Manual. No doubt you're you've noticed this is not a Wiki. The <a href="https://wiki.allstarlink.org">ASL Wiki</a> still exists, largely to document ASL2, while this manual covers ASL3 specifics and is the future home for all ASL documentation.</p>
<h2 id="index-manual-navigation">Manual Navigation</h2>
<p>Did you see the "Next" and "Previous" buttons at the bottom of the page? Those will move you forward and back through the various pages in each manual section.</p>
<p>At the top of the page, you will find the Navigation Bar, to let you jump to a particular section of the manual. </p>
<p>Once you are in a section of the manual, a Table of Contents is provided on the left side of the screen, to let you quickly find the topic you are looking for.</p>
<p>Click the Next button on the bottom of the page to Get Started!</p>
<!--
![AllStarLink Landing Page](assets/AllstarLink-StarBlack.png){ width="100"}
--></section>
                        <h1 class='nav-section-title' id='section-getting-started'>
                            Getting Started <a class='headerlink' href='#section-getting-started' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="basics"><h1 id="basics-getting-started-with-allstarlink">Getting Started With AllStarLink</h1>
<p>If you are new to the AllStarLink network, this section of the manual should help you become familiar with how the system works as well as guide you through the prerequisites to get connected.</p></section><section class="print-page" id="basics-gettingstarted"><h1 id="basics-gettingstarted-basics">Basics</h1>
<h2 id="basics-gettingstarted-what-is-a-node">What is a "Node"?</h2>
<p>A node, in simplest terms, is software (<code>Asterisk/app_rpt</code>) running on a computer (a "server" in AllStarLink terms) that connects to the AllStarLink network. Nodes typically have an RF radio interface as well as an internet connection. Radios can range in size from a repeater radio to a low power radio integrated into a node. A node allows you to connect to other nodes in the AllStarLink network. </p>
<p>The node software can run on a variety of hardware, see <a href="#basics-gettingstarted-what-is-a-server">Servers</a> below.</p>
<p><strong><em>A node must be associated to a "server".</em></strong> You can have multiple nodes assigned to, and configured on, the same server (if desired).</p>
<h2 id="basics-gettingstarted-what-is-a-node-number">What is a "Node Number"?</h2>
<p>A node number is a unique number that is assigned to every node on the network. It is analogous to a telephone number (Asterisk, upon which ASL3 is based is a telephony switch after all). Like you do with your telephone, when you "dial" a node number, that will connect to a specific node on the network, linking those nodes together. You can link many nodes together simultaneously, creating a network of nodes that all participate in conversation together.</p>
<h2 id="basics-gettingstarted-what-is-a-hub">What is a "Hub"?</h2>
<p>A hub is just another name for a node (they are configured the same). Any node can be a "hub", it is up to the owner how they advertise it.</p>
<p>It may, or may not, have a radio attached to it. Hubs are like the hub of a wheel, they are designated nodes that users build that other users can connect their own nodes to (the "spokes" of the wheel). It is easier for everyone that wants to get together to chat to all connect to the same hub node, rather than trying to individually connect to each other.</p>
<p>A hub can exist on a physical computer, it can co-exist with another node on the same computer, or it can be deployed "in the cloud" on a server somewhere.</p>
<p>A hub is also useful for <a href="#adv-topics-permanentnode">permanently linking</a> nodes (repeaters) under your control together, such as a VHF and UHF repeater, and then other users can connect to the hub to be broadcast on both bands (instead of having to connect to the VHF and UHF nodes separately). </p>
<h2 id="basics-gettingstarted-what-is-a-server">What is a "Server"?</h2>
<p>A server is a Linux-based computer that runs the <code>Asterisk/app_rpt</code> (ASL3) software. A variety of hardware is supported, from an inexpensive Raspberry Pi, a PC, or even a virtual machine.</p>
<p>You need to configure at least one server in the <a href="#basics-portal">AllStarLink Portal</a>, and associate at least one node to it.</p>
<p>A server can host many nodes, up to its hardware resource limits.</p>
<h2 id="basics-gettingstarted-getting-on-allstarlink">Getting on AllStarLink</h2>
<ul>
<li>If you wish to create your own node, follow the directions below to create an account. After your account is active, you will need a suitable Raspberry Pi, PC, or virtual machine to install and run ASL3</li>
<li>If you wish to use a local FM repeater that is AllStarLink enabled, you do not need an AllStarLink account. Check out our <a href="https://stats.allstarlink.org/">Active Nodes List</a> to find a repeater near you. If you type your city name in the search box, you will be given a list of active nodes. However, before controlling any node via RF or DTMF, be sure to talk to the operator(s) of that node and receive permission first <ul>
<li>For a list of possible commands, visit the <a href="https://wiki.allstarlink.org/wiki/AllStar_Link_Standard_Commands">AllStarLink Standard Commands</a> page</li>
<li>Some nodes may be local/non-public nodes, so look for information that the node is in fact public</li>
</ul>
</li>
<li>If you wish to purchase a pre-made or complete node, check out our <a href="https://wiki.allstarlink.org/wiki/Radio_Connections">Radio Connections</a> page for a list of vendors</li>
<li>You can also use one of the mobile/PC apps noted below. See their installation instructions to determine whether you need an AllStarLink Portal account (and perhaps a node number)</li>
</ul>
<h2 id="basics-gettingstarted-how-do-i-use-allstarlink">How do I use AllStarLink?</h2>
<p>If you have a local FM repeater that is AllStarLink enabled, you may already be using it! However, before attempting to control a local FM repeater, check with the owner(s) first before doing so -- amateur radio etiquette applies.</p>
<p>AllStarLink is typically used in these ways:</p>
<ul>
<li>Via a FM repeater that is AllStarLink enabled. Controlled through <a href="https://wiki.allstarlink.org/wiki/AllStar_Link_Standard_Commands">DTMF Commands</a>, via the internet, or an autopatch</li>
<li>Via a local "hotspot" node that is purchased by an amateur radio operator to join the AllStarLink network directly</li>
<li>Via a mobile app such as <a href="https://play.google.com/store/apps/details?id=org.dvswitch&amp;hl=en_US&amp;gl=US">DVSwitch Mobile (Android)</a> or <a href="https://apps.apple.com/us/app/repeaterphone/id1637247024">RepeaterPhone (iOS)</a> to connect directly to a node</li>
<li>Via IAXRpt (PC)/Transceive (MacOS) software that allows you to connect directly to a node over the internet. The computer microphone/speaker are used for audio</li>
<li>Via a reverse-autopatch</li>
</ul>
<h2 id="basics-gettingstarted-creating-your-own-node">Creating Your Own Node</h2>
<p>If you need to create your own node to connect to the AllStarLink network, the rest of this manual is for you! Before you get to installing software and connecting up radios, you'll need to get a node number assigned to you. The next section about the <a href="#basics-portal">AllStarLink Portal</a> will guide you through the process of requesting a node number.</p>
<div class="admonition note">
<p class="admonition-title">Private Nodes</p>
<p>In order to connect to other public AllStarLink nodes via the internet, you need a public node number assigned. If you just want take things for a "test drive" to get comfortable first, you can opt to build and deploy a <a href="#adv-topics-privatenodes">Private Node</a> first.  </p>
</div></section><section class="print-page" id="basics-portal"><h1 id="basics-portal-allstarlink-portal">AllStarLink Portal</h1>
<p>The <a href="https://www.allstarlink.org/portal">AllStarLink Portal</a> is where you manage the administration for all the servers and nodes you create to link to the network.</p>
<p>This is where you will apply for a <a href="#basics-gettingstarted-what-is-a-node-number">node number</a> to connect to the AllStarLink network, configure options on how network features interact with your node, and set how your node is described to other nodes and the public facing status pages.</p>
<h2 id="basics-portal-create-an-account">Create an Account</h2>
<p>The first step in getting an AllStarLink node number assigned is to create an account at <a href="https://www.allstarlink.org">www.allstarlink.org</a>. Head over there, and click the <strong>"Login/Sign Up"</strong> link at the top of the page. In the box that opens, click <strong>"Sign Up"</strong> at the bottom of the box.</p>
<p><a class="glightbox" href="../basics/img/1_sign_up.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Sign Up" src="../basics/img/1_sign_up.png" width="400" /></a></p>
<p>Carefully read all the information on the page that opens, then click <strong>"Begin Registration"</strong> to get started.</p>
<p><a class="glightbox" href="../basics/img/2_begin_reg.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Begin Reg" src="../basics/img/2_begin_reg.png" width="400" /></a></p>
<p>Fill out the registration form and submit it with your valid information for verification.</p>
<p>You will then receive an email from the <em>AllStar Helpdesk</em> (helpdesk@allstarlink.org if you need to add it to your spam filters) with a link to confirm your email address. <strong>Be sure to click the link in the email to validate your address, or your account request will not proceeed.</strong></p>
<p>You should then receive another email from from the <em>AllStar Helpdesk</em> within 24 hours, notifying you that your account has been validated (at which point you will be able to log into the Portal).</p>
<h2 id="basics-portal-request-a-node-number">Request a Node Number</h2>
<p>Once you have a validated account for the Portal, you can now proceed with requesting a node number.</p>
<p>Go to <a href="https://allstarlink.org">https://allstarlink.org</a> and click the <strong>Login/Sign Up</strong> link at the top of the page.</p>
<p>Enter your credentials in the login box, and click <strong>Login</strong>.</p>
<p>When you have successfully logged in, the <strong>Login/Sign Up</strong> link at the top of the page will change to your <strong>CALLSIGN</strong>. You will also note a new <strong>Portal</strong> link has appeared to the left of your callsign.</p>
<p><a class="glightbox" href="../basics/img/3_portal.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 Login" src="../basics/img/3_portal.png" width="400" /></a></p>
<p>From the <strong>Portal</strong> menu, click <strong>Server Settings</strong>.</p>
<p><a class="glightbox" href="../basics/img/4_node_settings.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4 Server Settings" src="../basics/img/4_node_settings.png" width="400" /></a></p>
<p>Since this is the first time you've logged in and you don't currently have any nodes assigned to you, click the <strong>Proceed with Server Setup</strong> button to continue.</p>
<p><a class="glightbox" href="../basics/img/5a_add_server.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5a Add Server" src="../basics/img/5a_add_server.png" width="400" /></a></p>
<p>If you inadvertently clicked the <strong>Node Settings</strong> link, it will still ask you to <strong>Add a Server</strong>.</p>
<p><a class="glightbox" href="../basics/img/5_add_server.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5 Add Server" src="../basics/img/5_add_server.png" width="400" /></a></p>
<p>Fill in all the information about where your server will be located, be sure to have the latitude and longitude (or click on the map), then click <strong>Submit</strong>.</p>
<p><a class="glightbox" href="../basics/img/6_test_server.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 6 Server Form" src="../basics/img/6_test_server.png" width="400" /></a></p>
<p>Now you will have a new server created to associate your node number to.</p>
<p><a class="glightbox" href="../basics/img/7_server_complete.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 7 Server Complete" src="../basics/img/7_server_complete.png" width="400" /></a></p>
<p>Go back up to the top menu bar, and under the <strong>Portal</strong> menu select <strong>Node Settings</strong>.</p>
<p><a class="glightbox" href="../basics/img/4_node_settings.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 8 Node Settings" src="../basics/img/4_node_settings.png" width="400" /></a></p>
<p>Now, you can click <strong>Continue</strong> to proceed to the <strong>Request/Extend/Remove</strong> page.</p>
<p><a class="glightbox" href="../basics/img/9_request_node.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 9 Request Node" src="../basics/img/9_request_node.png" width="400" /></a></p>
<p>On the <strong>Request/Extend/Remove</strong> page, <strong>Request</strong> will be in <strong>bold</strong> as this is your initial request. Ensure the server you created is selected in the <strong>Server</strong> box, and then click <strong>Submit</strong>.</p>
<p><a class="glightbox" href="../basics/img/10_request.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 10 Request" src="../basics/img/10_request.png" width="400" /></a></p>
<p>That's it! On the page that opens, you will see your newly assigned node number.</p>
<p><a class="glightbox" href="../basics/img/11_new_node.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 11 Done" src="../basics/img/11_new_node.png" width="400" /></a></p>
<div class="admonition note">
<p class="admonition-title">Additional Node Numbers</p>
<p>Your first node number is automatically approved. If you need additional nodes, you should consider doing the NXX extension (to create up to ten nodes, based off your initial node number). If you need a completely different additional node number, additional node requests are subject to admin approval.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Node Password</p>
<p>Take note that on this screen, you will find the <em>password</em> for your node (hover your mouse over the password field). You can double-click the password, and then type ctrl-c to copy it to your clip board. <strong>You will need this later when setting up the ASL3 software to register with the AllStarLink servers.</strong></p>
</div>
<h2 id="basics-portal-node-number-extension-nxx">Node Number Extension (NXX)</h2>
<p>Node numbers are a limited resource. If you are just starting out, you would be strongly encouraged to click the <strong>Continue</strong> button on your <strong>Node Settings</strong> page, and complete the <a href="#adv-topics-nnx">Node Number Extension (NNX)</a> process. This will add a <em>zero</em> to the end of your primary node number (ie 63001 becomes 630010), and open up an additional nine node numbers (ie 630011-630019) for your use.</p>
<h2 id="basics-portal-editing-node-parameters">Editing Node Parameters</h2>
<p>Each node number you create has individual parameters associated with it. From your <strong>Node Settings</strong> page, click on the node number to edit its parameters.</p>
<p><a class="glightbox" href="../basics/img/16_edit_node.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Node Parameters" src="../basics/img/16_edit_node.png" width="400" /></a></p>
<p>On this page, you will find a number of important settings to modify.</p>
<h3 id="basics-portal-password">Password</h3>
<p>By default, a random password is assigned for the node. You can leave this as-is, or change it to something else. Be sure it follows the guidelines shown.</p>
<h3 id="basics-portal-callsign">Callsign</h3>
<p>This is the callsign that will show up in Allmon3 as well as on the various <a href="https://www.allstarlink.org">Links &amp; Stats</a> pages (including the Bubble Charts). It is <em>normally</em> the repeater callsign, however, it <em>could</em> be something else (such as the name of a hub system).</p>
<h3 id="basics-portal-frequency">Frequency</h3>
<p>This will show up as the frequency in Allmon3 as well as on the various <a href="https://www.allstarlink.org">Links &amp; Stats</a> pages (including the Bubble Charts). For a conventional repeater, it <em>normally</em> would be of the format <code>MMM.kkk(s)</code> where <code>(s)</code> would be the optional "split" (<code>+</code> or <code>-</code> for duplex repeaters). It <em>could</em> be a description of hub node, or an indication that this is a "Radio-less Node" or something similar.</p>
<h3 id="basics-portal-ctcss-tone">CTCSS Tone</h3>
<p>If your repeater requires a CTCSS tone, this should be set. It will show up beside the frequency in Allmon3 as well as on the various <a href="https://www.allstarlink.org">Links &amp; Stats</a> pages (including the Bubble Charts).</p>
<h3 id="basics-portal-server-selection">Server Selection</h3>
<p>From the drop down menu, you can select which of your pre-configured servers this node should be assigned to.</p>
<h3 id="basics-portal-web-transceiver-wt-access">Web Transceiver (WT) Access</h3>
<p>Selecting <code>yes</code> here will allow applications such as <a href="https://apps.apple.com/us/app/repeaterphone/id1637247024">RepeaterPhone for iOS</a>, Transceive for Mac OS, and <a href="https://play.google.com/store/apps/details?id=org.dvswitch&amp;hl=en_US&amp;gl=US">DVSwitch Mobile for Android</a> (in "Node Mode") to connect to this node.</p>
<p>There was originally a "Web Transceiver" Java application that this was used with, but that has since been deprecated.</p>
<h3 id="basics-portal-show-function-list">Show Function List</h3>
<p>The default setting of <code>no</code> here is fine. There was originally a "Web Transceiver" Java application that this was used with, but that has since been deprecated.</p>
<h3 id="basics-portal-allow-reverse-autopatch-access">Allow Reverse Autopatch Access?</h3>
<p>If you want to allow users to call into your node from a landline (reverse of the normal "autopatch"), you would need to set this to <code>yes</code> to allow incoming calls to be processed.</p>
<h3 id="basics-portal-allow-telephone-portal-access">Allow Telephone Portal Access?</h3>
<p>In most cases, you likely want to set this to <code>no</code>. A telephone portal is available to call in to nodes, if users have an AllStarLink account and use the PIN found in their Portal Account Settings.</p>
<h3 id="basics-portal-is-node-a-remote-base">Is Node a Remote Base?</h3>
<p>If this node is specifically configured as a <a href="#adv-topics-remotebase">Remote Base</a>, set this to <code>yes</code>, otherwise, leave it set to <code>no</code>.</p>
<h3 id="basics-portal-is-the-remote-base-frequency-agile">Is the Remote Base Frequency Agile?</h3>
<p>If this node is specifically configured as a <a href="#adv-topics-remotebase">Remote Base</a>, AND it is frequency agile, set this to <code>yes</code>. Otherwise, leave it set to <code>no</code>.</p>
<h2 id="basics-portal-editing-server-parameters">Editing Server Parameters</h2>
<p>Each server you create has individual parameters associated with it. From your <strong>Server Settings</strong> page, click on the server to edit its parameters.</p>
<p><a class="glightbox" href="../basics/img/7_server_complete.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Server List" src="../basics/img/7_server_complete.png" width="400" /></a></p>
<p>On this page, you will find a number of important settings to modify.</p>
<p><a class="glightbox" href="../basics/img/18_edit_server.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Edit Server" src="../basics/img/18_edit_server.png" width="400" /></a></p>
<h3 id="basics-portal-server-name">Server Name</h3>
<p>Use this field to give your server a descriptive name, so that you know which device it is.</p>
<h3 id="basics-portal-server-location">Server Location</h3>
<p>This is displayed as the "Location" on the AllStarLink Node List, as well as in the title of the node in Allmon3. It would typically be the City,State/Province where the server and/or node is located.</p>
<h3 id="basics-portal-site">Site</h3>
<p>This optional field is displayed as the "Site Name" on the AllStarLink Node List.</p>
<h3 id="basics-portal-affiliation">Affiliation</h3>
<p>This optional field is displayed as the "Affiliation" on the AllStarLink Node List. It is often the operator or club that sponsors the node. It allows for all the nodes with the same affiliation to be filtered on in the Node List.</p>
<h3 id="basics-portal-iax-port">IAX Port</h3>
<p><strong>This is a critical setting.</strong> This is the UDP port that the network will try and connect to your server on when a connection request is made. In many cases, the default of <code>4569</code> (the standard IAX port) is fine. You would change this if you have multiple servers behind the same firewall/NAT router.</p>
<div class="admonition note">
<p class="admonition-title">Remember to Configure Your Node</p>
<p>In addition to setting the IAX Port here in the Portal, you also need to configure ASL3 on your hardware to use the matching port (if using something other than the default of <code>4569/UDP</code>).</p>
</div>
<h3 id="basics-portal-proxy-ip">Proxy IP</h3>
<div class="admonition warning">
<p class="admonition-title">Advanced Configurations Only</p>
<p>Do not touch this setting (leave it blank), unless you <strong>specifically</strong> know that you need to change it.</p>
</div>
<p>This is an advanced setup configuration that helps manage a server that may have a frequently changing IP address. See <a href="https://wiki.allstarlink.org/wiki/Proxy">Proxy Configuration</a> for more information.</p>
<h3 id="basics-portal-latitude-and-longitude">Latitude and Longitude</h3>
<p>These should be pretty obvious. They indicate where in the world your server and node(s) are.</p>
<p>They are used to display locations on the <a href="https://stats.allstarlink.org/maps/allstarUSAMap.html">Map of Nodes</a>.</p>
<p>Set the Latitude and Longitude manually in decimal degrees, or drag the pin on the map.</p>
<h2 id="basics-portal-change-callsign">Change Callsign</h2>
<p>Has your callsign changed, and you need to change it on the Portal?</p>
<p>Click on your callsign after you log in, and then select <strong>Change Callsign</strong>.</p>
<p><a class="glightbox" href="../basics/img/19_callsign_change.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Change Callsign" src="../basics/img/19_callsign_change.png" width="400" /></a></p>
<p>Follow the instructions on the screen to send a notification to the Help Desk.</p>
<h2 id="basics-portal-find-my-node-number">Find My Node Number</h2>
<p>How do you know what node number(s) have been assigned to you? Look under you <strong>Node Settings</strong> in the Portal.</p>
<p>From the <strong>Portal</strong> menu, click <strong>Node Settings</strong>.</p>
<p><a class="glightbox" href="../basics/img/4_node_settings.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Server Settings" src="../basics/img/4_node_settings.png" width="400" /></a></p>
<p>Here you will find all your currently assigned node numbers.</p>
<p><a class="glightbox" href="../adv-topics/img/6_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Node List" src="../adv-topics/img/6_NNX_New_Nodes.png" width="400" /></a></p>
<p>Click <strong>Continue</strong> if you want to add or remove nodes.</p>
<h2 id="basics-portal-change-node-password">Change Node Password</h2>
<p>When your node was created, it was assigned a random password. This password is used during the provisioning of your ASL3 installation to allow it to authenticate to the registration servers.</p>
<p>From the <strong>Portal</strong> menu, click <strong>Node Settings</strong>.</p>
<p><a class="glightbox" href="../basics/img/4_node_settings.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Server Settings" src="../basics/img/4_node_settings.png" width="400" /></a></p>
<p>You can find your node's current password by hovering your mouse over the <strong>Password</strong> field.</p>
<p><a class="glightbox" href="../adv-topics/img/6_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Node List" src="../adv-topics/img/6_NNX_New_Nodes.png" width="400" /></a></p>
<p>To change your node's password, click on the <strong>Node Number</strong> that you want to modify.</p>
<p>See <a href="#basics-portal-editing-node-parameters">Editing Node Parameters</a> in this section for the location to update.</p>
<h2 id="basics-portal-reset-portal-password">Reset Portal Password</h2>
<p>If you have forgotten your password to log in to the <a href="https://www.allstarlink.org/portal">AllStarLink Portal</a>, click on the <strong>Login/Sign Up</strong> link at the top of the page, then click on <strong>Forgot Password</strong> to get started.</p>
<p><a class="glightbox" href="../basics/img/20_forgot_password.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Forgot Password" src="../basics/img/20_forgot_password.png" width="400" /></a></p>
<p>You will be prompted to enter your callsign and email address that you registered with. Fill out the form and click <strong>Submit</strong>.</p>
<p><a class="glightbox" href="../basics/img/21_password_form.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Password Form" src="../basics/img/21_password_form.png" width="400" /></a></p>
<p>If your information is valid, further instructions will be sent via email.</p></section><section class="print-page" id="basics-standardcommands"><h1 id="basics-standardcommands-allstarlink-standard-commands">AllStarLink Standard Commands</h1>
<p><strong>This section contains the suggested prefix digits, mandatory command codes, and suggested command codes for AllstarLink.</strong></p>
<h2 id="basics-standardcommands-mandatory-command-codes">Mandatory Command Codes</h2>
<p>These are the mandatory command codes which all AllStarLink nodes must support to provide command code consistency to the users.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*1&lt;node&gt;</code></td>
<td>Disconnect Link</td>
</tr>
<tr>
<td><code>*2&lt;node&gt;</code></td>
<td>Connect link in monitor mode</td>
</tr>
<tr>
<td><code>*3&lt;node&gt;</code></td>
<td>Connect link in transceive mode</td>
</tr>
<tr>
<td><code>*4&lt;node&gt;</code></td>
<td>Enter command mode on a remote node</td>
</tr>
<tr>
<td><code>*70</code></td>
<td>Local connection status</td>
</tr>
<tr>
<td><code>*99</code></td>
<td>DTMF Phone Key (Assert PTT from Phone Portal)</td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul>
<li><code>&lt;node&gt;</code> is an AllStarLink node number</li>
<li>Node number zero (<code>0</code>) is shorthand for the last node operated on by a previous command</li>
<li>Monitor mode means listen to a node, but do not send any audio to it</li>
<li>Command mode means send all received DTMF digits to the node number specified (bypassing the local command decoder). Send # to exit command mode, and restore local command decoding.</li>
</ul>
<h2 id="basics-standardcommands-prefix-digit-suggestions">Prefix Digit Suggestions</h2>
<p>These are the suggested DTMF command prefixes (including the mandatory 1-4).</p>
<table>
<thead>
<tr>
<th>Prefix</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*1</code></td>
<td>Disconnect from link</td>
</tr>
<tr>
<td><code>*2</code></td>
<td>Connect to node in monitor (receive only) mode</td>
</tr>
<tr>
<td><code>*3</code></td>
<td>Connect to node in transceive mode</td>
</tr>
<tr>
<td><code>*4</code></td>
<td>Enter remote command mode</td>
</tr>
<tr>
<td><code>*5</code></td>
<td>User-defined macros</td>
</tr>
<tr>
<td><code>*6</code></td>
<td>User defined functions, such as autopatch</td>
</tr>
<tr>
<td><code>*7</code></td>
<td>Connection status / other functions</td>
</tr>
<tr>
<td><code>*8</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*9</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*0</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*A</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*B</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*C</code></td>
<td>User defined functions</td>
</tr>
<tr>
<td><code>*D</code></td>
<td>User defined functions</td>
</tr>
</tbody>
</table>
<h2 id="basics-standardcommands-optional-command-codes">Optional Command Codes</h2>
<p>These are suggested, but are typically configured by default on ASL3 nodes.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*80</code></td>
<td>Force system ID</td>
</tr>
<tr>
<td><code>*81</code></td>
<td>Say system time</td>
</tr>
<tr>
<td><code>*980</code></td>
<td>Say app_rpt software version</td>
</tr>
<tr>
<td><code>*75</code></td>
<td>Link connect (local monitor only)</td>
</tr>
<tr>
<td><code>*72</code></td>
<td>Last active node (system-wide)</td>
</tr>
<tr>
<td><code>*73</code></td>
<td>System-wide connection status</td>
</tr>
<tr>
<td><code>*71</code></td>
<td>Disconnect all links (macro)</td>
</tr>
<tr>
<td><code>*74</code></td>
<td>Reconnect all links (macro)</td>
</tr>
</tbody>
</table>
<h2 id="basics-standardcommands-complete-list-of-allstarlink-commands">Complete List of AllStarLink Commands</h2>
<p>The default AllStarLink DTMF commands are well commented in the configuration file <a href="#config-rpt_conf"><code>/etc/asterisk/rpt.conf</code></a>. These may be changed if you or someone else edited the file, so take a look at the actual file on your node to be sure.</p>
<p>All of the possible <a href="https://github.com/AllStarLink/app_rpt/blob/master/apps/app_rpt.c">commands are documented</a> at the top of the source. You don't need to be a C programmer to read the comments.</p></section><section class="print-page" id="basics-commands"><h1 id="basics-commands-new-commands">New Commands</h1>
<p>ASL3 is overall very similar to older versions (ASL2). However, due to the upgrade to Asterisk 20 (and newer), there are things that have changed. In addition, some new commands are now available.</p>
<p>New and different commands to interact with ASL3 are documented here. Older ASL2 commands are still documented on the <a href="https://wiki.allstarlink.org">AllStarLink Wiki</a>, and may still be applicable (with some modifications) to ASL3. The Wiki documentation will remain as a reference, until all the documentation can be updated for ASL3, and added to this manual. </p>
<p>All these commands are available when using the Asterisk Command Line Interface (CLI), also known as the Asterisk Console. This can be accessed through the <a href="#pi-cockpit-get-started"><code>Cockpit</code></a> Terminal, from <a href="#user-guide"><code>asl-menu</code></a>, or directly from the Linux terminal with <code>asterisk -rvvv</code> or <code>sudo asterisk -rvvv</code>, depending on your system configuration. </p>
<h2 id="basics-commands-app_rpt-commands"><code>app_rpt</code> commands</h2>
<p>These commands interact with the <code>app_rpt</code> application itself:</p>
<ul>
<li>
<p><code>rpt show channels &lt;node&gt;</code> shows the channel driver information associated with the node</p>
</li>
<li>
<p><code>rpt show variables &lt;node&gt;</code> (replaces <code>rpt showvars</code>) shows the current value of all the <code>app_rpt</code> variables for the node</p>
</li>
<li>
<p><code>rpt show version</code> shows the current version of the <code>app_rpt</code> module specifically</p>
</li>
<li>
<p><code>rpt show registrations</code> is the new command to show HTTP registrations. ASL3 uses a new HTTP registration system. The old IAX registration system and <code>iax2 show registry</code> command still exist, but HTTP registration should be used in its place.</p>
</li>
<li>
<p><code>rpt lookup &lt;node&gt;</code> can be used to lookup the IP address of a node. In addition to the new registration system, ASL3 now implements a DNS lookup of node information. By default, ASL3 will first query the AllStarLink DNS servers to resolve node information. It will fall back to the external <code>rpt_extnodes</code> file, if the node cannot be resolved by DNS.</p>
</li>
</ul>
<p>For example, <code>rpt lookup 2000</code> will show the IP of node 2000. If you have the <code>bind9-host</code> package installed on your system, the equivalent Linux CLI command to query the IP would be <code>host 2000.nodes.allstarlink.org</code>.</p>
<p>The node lookup routines will output debug information showing the node lookups, if the <a href="#user-guide-menu-asterisk-cli-verbosity-and-debug"><code>debug</code></a> level is set to <code>4</code> or higher.</p>
<p>The operation of this ASL3 feature can be controlled by changing the following information in <code>rpt.conf</code>:</p>
<div class="highlight"><pre><span></span><code>[general]
node_lookup_method = both   ;method used to lookup nodes
                            ;both = dns lookup first, followed by external file (default)
                            ;dns = dns lookup only
                            ;file = external file lookup only
</code></pre></div>
<h2 id="basics-commands-chan_simpleusb-commands">chan_simpleusb commands</h2>
<p>The command <code>susb show settings</code> is used to interact with the <code>SimpleUSB</code> channel driver, and will show the current node's settings. This replaces <code>susb tune</code>. The module must be loaded for this command to work.</p>
<h2 id="basics-commands-chan_usbradio-commands">chan_usbradio commands</h2>
<p>The command <code>radio show settings</code> is used to interact with the <code>USBRadio</code> channel driver, and will show the current node's settings. This replaces <code>radio tune</code>. The module must be loaded for this command to work.</p>
<h2 id="basics-commands-simpleusb-and-usbradio-tune-menus">SimpleUSB and USBRadio Tune Menus</h2>
<p>The <code>simpleusb-tune-menu</code> and <code>radio-tune-menu</code> utility programs have been updated with new options. These are accessed from the Linux CLI (not the Asterisk CLI). The new options allow you change the operation of the respective channel driver, in realtime, without having to manually edit the <code>simpleusb.conf</code> or <code>usbradio.conf</code> files.</p>
<p>In addition to the updating settings, you can now view the live status of the COS, CTCSS inputs and PTT output. This allows you to easily view and change their settings.</p>
<h2 id="basics-commands-chan_echolink-commands">chan_echolink commands</h2>
<p>The Echolink channel driver (module) must be loaded for these commands to work. These commands interact directly with the <code>chan_echolink</code> channel driver: </p>
<p><code>echolink show nodes</code>  is used to view the currently connected Echolink users.</p>
<p><code>echolink show stats</code>  is used to view the channel statistics for Echolink. It shows the number of in-bound and out-bound connections. It also shows the cumulative system statistics, along with the statistics for each connected nodes.</p>
<h2 id="basics-commands-app_gps-commands">app_gps commands</h2>
<p>The <code>app_gps</code> module must be loaded for this command to work. This command interacts directly with the <code>app_gps</code> application: </p>
<p><code>gps show status</code> is used to view the status of the GPS device. It will show if the GPS is locked on the satellites and the current position. It also shows the default location configured.</p>
<p>The <code>app_gps</code> module is used with APRStt and for reporting the position of (mobile) nodes to APRS-IS, in conjunction with an attached GPS.</p>
<h2 id="basics-commands-verbosity-and-debug-levels">Verbosity and Debug Levels</h2>
<p>Previously, <code>app_rpt</code>, associated applications, and channel drivers supported setting the debug level with a unique command for those modules. These unique commands have been removed in ASL3, and replaced with the stock Asterisk <code>debug</code> commands.</p>
<p>See how to set <a href="#user-guide-menu-asterisk-cli-verbosity-and-debug">verbosity and debug levels</a> in the CLI for more information.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>core set debug 5 app_rpt
core set debug 3 chan_simpleusb
</code></pre></div>
<h2 id="basics-commands-helper-scripts">Helper Scripts</h2>
<p>There are some new helper utilities that have been introduced with ASL3. See the <a href="#user-guide-asl-cmds-tools">ASL Commands and Tools</a> page for further details.</p>
<h2 id="basics-commands-usb-eeprom-operation">USB EEPROM Operation</h2>
<p>Both <code>chan_simpleusb</code> and <code>chan_usbradio</code> allow users to store configuration information in the EEPROM attached to their interface (if equipped). </p>
<p>The CM119A can have manufacturer information in the same area that stores the user configuration. </p>
<p>The CM119B does not have manufacturer data in the area that stores user configuration. The manufacturer data cannot be overwritten. </p>
<p>The user configuration data has been moved higher in memory to prevent overwriting manufacturer data. </p>
<p>If you use the EEPROM to store configuration data, you will need to save it to the EEPROM after upgrading to ASL3. Use the <code>susb tune save</code> or <code>radio tune save</code> Asterisk CLI commands, as applicable to your installation.</p></section><section class="print-page" id="basics-incompatibles"><h1 id="basics-incompatibles-incompatibilities-changes-and-known-issues">Incompatibilities, Changes, and Known Issues</h1>
<h2 id="basics-incompatibles-incompatibilities-and-changes-fom-legacy-versions">Incompatibilities and Changes Fom Legacy Versions</h2>
<p>With the upgrade to Asterisk 20, and all the associated code changes that had to go along with it, ASL3 has certain incompatible with older versions of the AllStarLink system. There are also some changes in how certain things function.</p>
<h3 id="basics-incompatibles-voterrtcm-default-port">VOTER/RTCM Default Port</h3>
<p>Modern installations of Asterisk runs as the unprivileged <code>asterisk</code> user rather than as <code>root</code>. Linux typically prohibits non-root users from listening on a TCP
port below <code>1024</code>. The default port for VOTERs/RTCMs was preiously port <code>667</code>. This has been changed to port <code>1667</code> to allow Asterisk to access the port, and connect to VOTERs/RTCMs.</p>
<p>If the VOTER/RTCM port cannot be easily changed, then the following configuration change can be made to the underlying operating system:</p>
<div class="highlight"><pre><span></span><code>echo net.ipv4.ip_unprivileged_port_start=667 &gt; /etc/sysctl.d/aslport667.conf
sysctl -p
systemctl restart asterisk
</code></pre></div>
<p>If running the AllStarLink Pi Appliance (or another system with a firewall), inbound to port <code>667/UDP</code> must be permitted. For directions on how to do this with the Pi Appliance see <a href="#pi-cockpit-firewall">Managing the Firewall</a>. <strong>Don't forget to also allow this port through any firewall that may part of your internet connection.</strong></p>
<p><strong>NOTE:</strong> While this workaround is available, its use is strongly discouraged, as it defeats a security measure in Linux. If at all possible, please try and update any of your VOTERs/RTCMs to use port <code>1667</code>. </p>
<h3 id="basics-incompatibles-pi-serial-ports-available-by-default">Pi Serial Port(s) Available by Default</h3>
<p>On the ASL3 Pi Appliance, the system comes pre-configured for <code>/dev/serial0</code> (formerly <code>/dev/ttyAMA0</code>) accessibility.</p>
<p>That means that Bluetooth and the default serial console are disabled. Any directions requiring editing of <code>config.txt</code> or <code>cmdline.txt</code> are unnecessary with the ASL3 appliance.</p>
<h3 id="basics-incompatibles-pi-dev-entry-changes">Pi <code>/dev</code> Entry Changes</h3>
<p>As ASL3 is based on Debian 12, users with Raspberry Pi devices must note that the serial port on the Pi expansion header is now <code>/dev/serial0</code> rather than the historical <code>/dev/ttyAMA0</code>. If you are following directions for Pi serial port operations, such as programming an SA818/DRA818-based radio hat or a SHARI node, use <code>/dev/serial0</code> in place of the <code>/dev/ttyAMA0</code> reference.</p>
<h3 id="basics-incompatibles-usb-udev">USB <code>udev</code></h3>
<p>A <code>udev</code> rule is needed to allow Asterisk running as non-root access to the USB system. ASL3 systems installed from <code>.debs</code> using <code>apt install</code>, or Raspberry Pi images will already have this rule in place, so no additional action is required. This is documented for advanced users and developers.</p>
<div class="highlight"><pre><span></span><code>/etc/udev/rules.d/90-asl3.rules
SUBSYSTEM==&quot;usb&quot;, ATTRS{idVendor}==&quot;0d8c&quot;, GROUP=&quot;plugdev&quot;, TAG+=&quot;uaccess&quot;
</code></pre></div>
<p>The <code>udev</code> subsystem must be reloaded and then the USB device re-inserted into the port. <code>udev</code> is reloaded with the command:</p>
<div class="highlight"><pre><span></span><code>udevadm control --reload
</code></pre></div>
<p>Alternatively, reboot the system.</p>
<h3 id="basics-incompatibles-simpleusb-and-usbradio-config-files">SimpleUSB and USBRadio Config Files</h3>
<p>The way USB audio interfaces are handled, including their config files has changed. See the <a href="#adv-topics-usbinterfaces">USB Audio Interfaces</a> page in this section for detailed information.</p>
<h2 id="basics-incompatibles-known-issues">Known Issues</h2>
<p>The following issues are currently known to exist in ASL3 and, where possible, what the workarounds are.</p>
<h3 id="basics-incompatibles-github-issues-trackers">GitHub Issues Trackers</h3>
<p>Check the following locations to see if your issue has already been reported:</p>
<ul>
<li><a href="https://github.com/AllStarLink/ASL3/issues">ASL3 Issues</a></li>
<li><a href="https://github.com/AllStarLink/app_rpt/issues">Asterisk/app_rpt Issues</a></li>
<li><a href="https://github.com/AllStarLink/asl3-menu/issues">asl3-menu Issues</a></li>
<li><a href="https://github.com/AllStarLink/Allmon3/issues">Allmon3 Issues</a></li>
</ul>
<h3 id="basics-incompatibles-resize2fs_once-error">resize2fs_once "Error"</h3>
<p>There are intermittent cases of errors on the screen or in  the system logs about a failure of a service named <code>resize2fs_once.service</code> after the final first boot upon installation. The error may report that it "Failed to start" or "timed out". If the <code>/</code> partition has been properly resized, which has been the case in every known 
occurrence of the error, then there is no action to take and the issue will not appear on subsequent reboots.</p>
<p>A properly resized <code>/</code> should be a bit smaller than the full size of the SD card or USB drive used with the device.</p>
<p>In Cockpit, look at the Storage tab:</p>
<p><a class="glightbox" href="../user-guide/img/known_issue_resize2fs.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Known issue resize2fs" src="../user-guide/img/known_issue_resize2fs.png" width="600" /></a></p>
<p>In this example, <code>/</code> is a 31G partition on a 32G SD card.</p></section><h1 class='nav-section-title-end'>Ended: Getting Started</h1>
                        <h1 class='nav-section-title' id='section-installation'>
                            Installation <a class='headerlink' href='#section-installation' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="install"><h1 id="install-asl3-installation">ASL3 Installation</h1>
<p>Welcome to the Installation section of the manual! We know you are excited to get on with trying out the new ASL3. </p>
<p>In this section of the manual, you will find instructions on how to create an ASL3 Appliance, using the Raspberry Pi Image, or install ASL3 on Debian 12. </p>
<p>Before you get started with installing the ASL3 software, do you have a node number assigned? See the <a href="#basics">Getting Started</a> section to find out how to request a node number to connect to the AllStarLink network.</p>
<p>Use the Table of Contents on the left to jump to the type of installation you are wishing to perform, but be sure to check out the rest of the topics in this section for other important information. </p>
<p>Once you've got your new ASL3 installed, be sure to check out the <a href="#user-guide">Basic Operation</a> section (see the link at the top of the page).</p></section><section class="print-page" id="install-whats-new"><h1 id="install-whats-new-important-considerations">Important Considerations</h1>
<p>Ready to get on with installation? We thought so, but first consider that ASL3 is very new. You'll probably want to install on removable media or on a non-production system. You probably don't want to install a production system right away. Give yourself some time to test that everything works as you'd expect.</p>
<p><strong>NOTE:</strong> If you have installed an earlier version of ASL, you need to know that ASL3 has many changes and that there's a bit of a learning curve. For those who have used ASL2 or other versions of AllStar you should be aware of a few important details:</p>
<ul>
<li>At the risk of repeating ourselves, ASL3 now runs on Asterisk 20!  We are no longer stuck in the past. We're so proud!!!</li>
<li>There is no update or migration path from ASL2 to ASL3</li>
<li>Many of the ASL3 configuration files are different<ul>
<li>The configuration files now support templates</li>
<li>We now favor node registration using HTTP</li>
<li>The SimpleUSB and USBRadio tune settings have been moved into their respective configuration (.conf) files. We no longer have separate per-node tune setting files.</li>
</ul>
</li>
<li>EchoLink changes<ul>
<li>EchoLink chat has been enabled</li>
<li>EchoLink now honors the <code>app_rpt</code> timeout timer. A text message is sent to the client when they time out</li>
<li>EchoLink no longer allows clients to double. A text message is sent to the client when they are doubling</li>
</ul>
</li>
</ul>
<p>The AllStar two node numbers per user policy remains in effect. Node numbers are a limited resource. Please make a best effort to use new media, a new server, or NNX to build a node for testing. We do make exceptions on a case by case basis but we'd really appreciate it if you could use a resource you already have.</p>
<h2 id="install-whats-new-menu-changes">Menu Changes</h2>
<p>The ASL3 menu utility (<a href="#user-guide"><code>asl-menu</code></a>) has been updated. Our goal is to provide an easy way for you to configure your node and to minimize the need to edit any configuration files.</p>
<p>At the same time, we have removed most of the "OS" configuration options found in earlier implementations. Historically, ASL has been installed on many OS variants and the OS commands that work on one version do not always work on others. For that reason there are no OS related commands in the ASL3 menu.</p>
<p>See <a href="#user-guide">Menu</a> for details.</p>
<h2 id="install-whats-new-configuration-changes">Configuration Changes</h2>
<p>The first thing to know about ASL3 configuration is that <a href="#user-guide"><code>asl-menu</code></a> can be used to make and view common changes. Here are the highlights. You may want to read about <a href="#adv-topics">Advanced Topics</a> and <a href="#basics-commands">New Commands</a> details later.</p>
<ul>
<li>You may edit the <code>.conf</code> files without concern of switching between editing and using the menu. The tune menus are removing leading white space from comments (we're hoping to fix this).</li>
<li>An Asterisk <a href="#adv-topics-conftmpl">template</a> is now used within <code>rpt.conf</code>, <code>simpleusb.conf</code>, and <code>usbradio.conf</code>. Editing is much easier, but it's different than with other versions of AllStar. Node settings are much simpler with only a few lines needed to be added/updated for each node. The ASL3 menu handles the new templated configuration.</li>
<li><a href="#adv-topics-httpreg">AllStar registration</a> is now set in <code>rpt_http_registration.conf</code>, not in <code>iax.conf</code>. <a href="#adv-topics-iaxreg">IAX registration</a> still works but is discouraged. Please do not configure your node for both HTTP and IAX registration. The new Asterisk CLI command to show the registration status of your nodes is <code>rpt show registrations</code>.  This command can be performed from the ASL3 menu.</li>
<li>The USB configuration files now contain the tune settings. There is no tune file for each node as in ASL2. The tune menus and the Asterisk CLI write to the new tune setting locations.</li>
<li>There is no need to edit or use a script to update the access list, formerly known as the blacklist and whitelist. The settings are different because the access list is now per node rather than for all nodes as in other AllStar versions. It's also much easier to use the ASL3 menu to build the access lists.</li>
</ul>
<h2 id="install-whats-new-ap-measurement">A&amp;P Measurement</h2>
<p>Adoption and Performance measurements are to help ASL understand growth and technical aspects of ASL3. No sensitive or private information is collected. For details see <a href="https://github.com/AllStarLink/ASL3-Usage">GitHub/AllStarLink/ASL3-Usage</a>. Reports are available at <a href="https://repo.allstarlink.org/reports/">repo.allstarlink.org/reports/</a>.</p></section>
                        <h2 class='nav-section-title' id='section--span-style-color-hsl-86-28-71-6-33-14-asl3-appliance-raspberry-pi-span-'>
                            <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 Appliance (Raspberry Pi)</span> <a class='headerlink' href='#section--span-style-color-hsl-86-28-71-6-33-14-asl3-appliance-raspberry-pi-span-' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="install-pi-appliance"><h1 id="install-pi-appliance-asl3-appliance-raspberry-pi">ASL3 Appliance (Raspberry Pi)</h1>
<p>The ASL3 "Appliance" is based around the Raspberry Pi platform. It is envisioned as a compact standalone platform that can be used to quickly deploy a node.</p>
<p>The Pi would be the <a href="#basics-gettingstarted-what-is-a-server">Server</a> on which you would deploy your <a href="#basics-gettingstarted-what-is-a-node">Node(s)</a>.</p>
<p>The ASL3 Appliance (Raspberry Pi) image includes the following to make a complete AllStarLink system:</p>
<ul>
<li>Debian 12 operating system</li>
<li>Asterisk 20 LTS + <code>app_rpt</code></li>
<li><code>asl-*</code> commands</li>
<li>ASL3 Menu (<a href="#user-guide"><code>asl-menu</code></a>)</li>
<li>Allmon3</li>
<li>Web-based administration (<code>Cockpit</code>)</li>
<li>A nice landing page</li>
</ul>
<h2 id="install-pi-appliance-asl3-appliance-requirements">ASL3 Appliance Requirements</h2>
<p>The following are the system requirements for the ASL3 Appliance</p>
<table>
<thead>
<tr>
<th></th>
<th>Required</th>
<th>Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hardware</strong></td>
<td>Arm v8 64-bit CPU <br> Raspberry Pi 3, 4, 5, Zero 2 W, 400</td>
<td>Raspberry Pi 4B or 5B</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>Minimum 512M</td>
<td>4G</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>Minimum 4G or larger</td>
<td>8GB Class 10</td>
</tr>
</tbody>
</table>
<p>The ASL3 Appliance been tested on Raspberry Pi 3, 4, 5, and Zero 2W.</p></section><section class="print-page" id="install-pi-appliance-pi-detailed"><h1 id="install-pi-appliance-pi-detailed-asl3-appliance-installation">ASL3 Appliance Installation</h1>
<div class="admonition danger">
<p class="admonition-title">Raspberry Pi Imager</p>
<p><strong>You must use the Raspberry Pi Imager,</strong> even if you prefer another imager, and carefully follow the instructions below. Failure to do so will result in a system that won't boot or that you will not be able to login to.</p>
</div>
<p>You will install an image on a microSD card and go. This is the simplest install. For most nodes, the menus will walk you through the setup. </p>
<div class="admonition note">
<p class="admonition-title">SD Card Size</p>
<p>A minimum SD card size of 4G is required and it is recommended to use at least an 8G SD card.</p>
</div>
<h2 id="install-pi-appliance-pi-detailed-step-by-step-pi-appliance-setup">Step-by-Step Pi Appliance Setup</h2>
<p>These directions are specific for Windows, but in general should work the same for the same tool set on MacOS and Linux. For each screenshot below, click on the image for a larger version.</p>
<p><strong>NOTE:</strong> For this example, the hostname used shall be <code>node63001</code> and the node number is <code>63001</code>. Replace "63001" with your node number as you proceed through these directions.</p>
<ol>
<li>
<p>If you do not already have it installed, install the <a href="https://www.raspberrypi.com/software/">Raspberry Pi Imager</a></p>
</li>
<li>
<p>Download the <a href="https://repo.allstarlink.org/images/pi/">latest release image</a>. This will be named <code>allstar3-arm64-X.Y.Z.img.xz</code> where "X.Y.Z" is the version. The version will
be something like 3.0.17. Save it to your local <code>Downloads</code> directory</p>
</li>
<li>
<p>Launch <strong>Raspberry Pi Imager</strong> from the start menu</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3" src="../install/pi-appliance/img/step-3.png" width="400" /></a></p>
</li>
<li>
<p>Click on <strong>CHOOSE DEVICE</strong> and choose the type of Pi hardware on which AllStarLink 3 Appliance is being installed</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4" src="../install/pi-appliance/img/step-4.png" width="400" /></a></p>
</li>
<li>
<p>Click on <strong>CHOOSE OS</strong>. Scroll to the bottom of the list that appears and select <strong>Use custom</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5" src="../install/pi-appliance/img/step-5.png" width="400" /></a></p>
</li>
<li>
<p>A <strong>Select image</strong> dialog box will appear. Navigate to the <strong>Downloads</strong> folder on your computer and select the image downloaded in Step 2. It will be named something like allstar3-arm64-3.0.17.img.xz. Then click <strong>Open</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-6.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 6" src="../install/pi-appliance/img/step-6.png" width="400" /></a></p>
</li>
<li>
<p>Connect the SD card or the SD card in a USB adapter to the computer. Then click on <strong>CHOOSE STORAGE</strong>. An option will be presented named something such as "Mass Storage Device USB Device - 16.0 GB". Click on that entry</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-7.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 7" src="../install/pi-appliance/img/step-7.png" width="400" /></a></p>
</li>
<li>
<p>Click <strong>NEXT</strong></p>
</li>
<li>
<p>A box labelled "Use OS customisation?" will appear. Click on <strong>EDIT SETTINGS</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-9.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 9" src="../install/pi-appliance/img/step-9.png" width="400" /></a></p>
</li>
<li>
<p>Check the box next to <strong>Set hostname</strong> and enter a hostname for the device to appear as on the network. In this example, <code>node63001</code> is used. Unless you have another naming convention for AllStarLink nodes, use the nodeNNNNN format</p>
</li>
<li>
<p>Check the box next to <strong>Set username and password</strong> and enter a username and password. It is recommended to set the username to <code>asl</code> if you have no strong feeling about the
username. Choose a good password and record the password somewhere safe. <strong>NOTE: There is NO DEFAULT USER for the image. Failure to set an account will require a re-image of the SD card with the proper settings</strong></p>
</li>
<li>
<p>If the device will be connected to WiFi, check the box "Configure wireless LAN" and then enter the name of the wireless network in <strong>SSID</strong> and the password for
that network in <strong>Password</strong>. Change the "Wireless LAN country" to <strong>US</strong> or another country, as appropriate. Wireless configuration is not necessary if the Pi will use a network cable rather than wireless</p>
</li>
<li>
<p>Check the box next to <strong>Set locale settings</strong> and change the "Time zone" to the desired region. The timezone settings will control any time-based announcements and schedule jobs. After completing Steps 10-13, the customization should look something like:</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-13.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 13" src="../install/pi-appliance/img/step-13.png" width="400" /></a></p>
</li>
<li>
<p>Click <strong>SAVE</strong> in "OS Customization"</p>
</li>
<li>
<p>Click <strong>YES</strong> for "Use OS customization?"</p>
</li>
<li>
<p>Click <strong>YES</strong> to continue to write the image to the SD card</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 16" src="../install/pi-appliance/img/step-16.png" width="400" /></a></p>
</li>
<li>
<p>Depending on the speed of the computer and the type of SD card, one will have time for a beverage of their choice. When the write is complete, eject the card, remove the card from computer and insert it into the Pi. If using a USB adapter for the SD card, remove the SD card from the adapter and insert the card into the Pi. The Pi <em>will not</em> use the SD card in the USB adapter</p>
</li>
<li>
<p>Power on the Pi. Wait approximately 2 to 5 minutes for the Pi to boot and perform the various first boot tasks. Depending on the type of a Pi board used, this process could be lengthy. If there is a screen connected to the Pi, it will be noted that Pi will reboot several times. This is normal and expected</p>
</li>
<li>
<p>(Optional) Network connectivity may be tested using the command to ping the hostname set in Step 10. For example, if the hostname set was <code>node63001</code> then do <code>ping -4 node63001.local</code> from a command prompt or PowerShell window. When you get a response, the host is connected to the network</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-19.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 19" src="../install/pi-appliance/img/step-19.png" width="400" /></a></p>
</li>
<li>
<p>Open the browser on your computer and navigate to <code>https://nodeNNNNN.local</code>. In this example the name was <code>node63001</code> then one would enter <code>https://node63001.local</code>. Your Pi and your computer must be on the same LAN for this to work. Use the IP address rather than the hostname if the Pi is on a remote network or the hostname is unreachable. Depending on your network and browser, one may have to enter the name several times until the page is displayed. The first connection will report a message that "Your connection isn't private". For the Pi appliance, this is acceptable. Click on <strong>Advanced</strong> and then <strong>Continue to node63001.local (unsafe)</strong>. This only must be done the first time</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 20" src="../install/pi-appliance/img/step-20.png" width="400" /></a></p>
</li>
<li>
<p>The AllStarLink Launchpad will appear. Clicking on <strong>Web Admin Portal</strong> will take one to the web-based administration portal that includes a web-based SSH client for using <a href="#user-guide"><code>asl-menu</code></a> and other commands. Clicking on <strong>Node Links</strong> will take one to the Allmon3 interface. Clicking on <strong>ASL Manual</strong> will take one
to the top of this manual</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-21.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 21" src="../install/pi-appliance/img/step-21.png" /></a></p>
</li>
<li>
<p>To setup the new node, click on <strong>Web Admin Portal</strong>. Similar to Step 20, click <strong>Advanced</strong> and <strong>Continue to node63001.local (unsafe)</strong> to see the logon box. This only must be done the first time. Enter the <code>username</code> and <code>password</code> configured during the imaging process above. Click <strong>Log in</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-22.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 22" src="../install/pi-appliance/img/step-22.png" /></a></p>
</li>
<li>
<p>The Overview tab is displayed. Using the Web Admin Portal (<code>Cockpit</code>) with AllStarLink is <a href="#pi-cockpit-get-started">covered in the manual</a>. At the top,
 click on <strong>Turn on administrative access</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-23.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 23" src="../install/pi-appliance/img/step-23.png" /></a></p>
<p>Enter the password again when prompted and click <strong>Authenticate</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-23-b.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 23B" src="../install/pi-appliance/img/step-23-b.png" /></a></p>
</li>
<li>
<p>The web-based SSH console appears as <strong>Terminal</strong> at the bottom of the left scrollable menu. Click it and an SSH terminal console will appear:</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-24.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 24" src="../install/pi-appliance/img/step-24.png" /></a></p>
</li>
</ol>
<p>The Terminal window is a complete interface to AllStarLink, Asterisk, and more. No SSH client is required although use of SSH directly is fully supported.</p>
<h2 id="install-pi-appliance-pi-detailed-quick-config-via-asl-menu">Quick Config via ASL-Menu</h2>
<p>The node may now be configured. New users or those wanting a quick start experience should use the <a href="#user-guide"><code>asl-menu</code></a> utility with <code>sudo asl-menu</code>.</p>
<p><a class="glightbox" href="../install/pi-appliance/img/term-asl-menu-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Web ASL Menu 1" src="../install/pi-appliance/img/term-asl-menu-1.png" /></a></p>
<p>The menu will appear:</p>
<p><a class="glightbox" href="../install/pi-appliance/img/term-asl-menu-2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Web ASL Menu 2" src="../install/pi-appliance/img/term-asl-menu-2.png" /></a></p>
<p>Proceed from here with the <strong>Node Settings</strong> option in order to configure your node number and choose/configure your audio interface. </p>
<h2 id="install-pi-appliance-pi-detailed-asterisk-console">Asterisk Console</h2>
<p>To start the asterisk console from the Terminal window enter <code>sudo asterisk -rv</code>.</p>
<p><a class="glightbox" href="../install/pi-appliance/img/term-ast-console.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Web Ast Console" src="../install/pi-appliance/img/term-ast-console.png" /></a></p>
<h2 id="install-pi-appliance-pi-detailed-software-updates">Software Updates</h2>
<p>One should also apply any latest updates and reboot the device as described in <a href="#pi-cockpit-updates">Cockpit Updates</a>.</p>
<h2 id="install-pi-appliance-pi-detailed-allmon3-default-login">Allmon3 Default Login</h2>
<p>The default-configured username and password combination is <code>allmon3 / password</code>.</p>
<p><strong>You <em>must</em> delete this and add a new one:</strong></p>
<ul>
<li>Launch Web Admin Portal (aka <code>Cockpit</code>) by going to <code>https://node63001.local:9090</code></li>
<li>Open the Terminal</li>
<li>Type <code>sudo allmon3-passwd --delete allmon3</code> to remove the default login</li>
<li>Type <code>sudo allmon3-passwd &lt;new user login&gt;</code> to set the new user login. Type the new password when prompted.</li>
<li>Type <code>sudo systemctl restart allmon3</code> to load the new login.</li>
</ul>
<p>Details on updating the login(s) and other Allmon3 settings can be found in the <a href="#allmon3">Allmon3</a> section of the manual.</p>
<h2 id="install-pi-appliance-pi-detailed-logging-out">Logging Out</h2>
<p>When finished with the admin system, click on <strong>Session</strong> in the upper right and then choose <strong>Logout</strong>.</p>
<h2 id="install-pi-appliance-pi-detailed-node-configuration">Node Configuration</h2>
<p>If you haven't already, the next step is to configure your node settings. YouTuber Freddie Mac has a nice ASL3 installation and configuration video. See <a href="https://youtu.be/aeuj-yI8qrU">https://youtu.be/aeuj-yI8qrU</a>. Also see <a href="#user-guide">ASL3 Menu</a> for details.</p></section><h1 class='nav-section-title-end'>Ended: <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 Appliance (Raspberry Pi)</span></h1>
                        <h2 class='nav-section-title' id='section--span-style-color-hsl-86-28-71-6-33-14-asl3-on-debian-span-'>
                            <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 on Debian</span> <a class='headerlink' href='#section--span-style-color-hsl-86-28-71-6-33-14-asl3-on-debian-span-' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="install-debian"><h1 id="install-debian-asl3-on-debian">ASL3 on Debian</h1>
<p>ASL3 is supported for general purpose installations on Debian.</p>
<p>Currently, Debian 12 is the supported version. ASL3 on Debian 12 can be deployed on either a physical computer, or virtual environment. </p>
<p>Installation instructions are the same for both physical and virtual deployments.</p></section><section class="print-page" id="install-debian-install"><h1 id="install-debian-install-debian-12-install">Debian 12 Install</h1>
<p>These instructions are for installing ASL3 on general purpose operating systems manually. For installation on Raspberry Pis, consider using the <a href="#install-pi-appliance">ASL3 Appliance</a>.</p>
<div class="admonition note">
<p class="admonition-title">Architecture Support</p>
<p>Currently, the project does not support armv7l/armhf platforms because all known uses of AllStarLink is on hardware which supports the Bookworm arm64 distribution such as Raspberry Pi 3, 4, 5, and Zero 2 W. If you have a platform that can use armv7l/armhf 32-bit packages only please file an issue at <a href="https://github.com/AllStarLink/ASL3/issues">ASL3 on GitHub</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Previous Issues with Cloud Kernels</p>
<p>As of DAHDI Linux 3.4.0-5, as released from AllStarLink, no longer has conflicts with the Debian "cloud" kernels and is fully supported.</p>
</div>
<h2 id="install-debian-install-system-requirements">System Requirements</h2>
<p>The following are the system requirements for an ASL3 system:</p>
<table>
<thead>
<tr>
<th></th>
<th>Minimum Required</th>
<th>Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CPU/Platform</strong></td>
<td>1 CPU, 64-bit, x86_64 (amd64) or ArmV8 (arm64)</td>
<td>2 - 4 CPUs depending on the number of hardware devices connected to the system</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>512M</td>
<td>2 G</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>8G (for OS + software)</td>
<td>-</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">UEFI / SecureBoot</p>
<p>For x86_64/amd64 platforms, it is recommended to disable SecureBoot if you do not need that feature. While it is a good security feature, given that AllStarLink v3 requires building a kernel module, it adds likely-undesired complexity for most ASL users. If you need or want to use UEFI/SecureBoot see <a href="#adv-topics-uefi-secureboot">the advanced topic document</a>.</p>
</div>
<h2 id="install-debian-install-debian-12-os-install">Debian 12 OS Install</h2>
<p>You’re going to start off by installing a new Debian 12 OS on your PC computer or virtual machine. There are instructions all over the internet that detail how to install Debian 12. Briefly you:</p>
<ul>
<li>Download and boot the Debian 12 netinstall.iso</li>
<li>Take most of the defaults</li>
<li>Do not install a <code>Debian desktop environment</code></li>
<li>Do install <code>web server</code> (if you plan to use Allmon3 or other web management packages)</li>
<li>Do install <code>SSH server</code></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Root Account</p>
<p>When setting up users and passwords you may be prompted to set the password for the <code>root</code> account. If you DO NOT provide a password then the root account will be disabled, and the system's initial user account (that will requested on the <em>next</em> screen) will be given the power to become <code>root</code> using the <code>sudo</code> command.  If you DO provide a password then the <code>sudo</code> command will NOT be installed on your system. Our recommendation is to NOT set the <code>root</code> password and rely on using the <code>sudo</code> command only when needed.</p>
</div>
<h2 id="install-debian-install-allstarlink-package-repo-install">AllStarLink Package Repo Install</h2>
<p>Once your Debian system is up and running, install the ASL package repositories:</p>
<div class="highlight"><pre><span></span><code>cd /tmp
wget https://repo.allstarlink.org/public/asl-apt-repos.deb12_all.deb
sudo dpkg -i asl-apt-repos.deb12_all.deb
sudo apt update
</code></pre></div>
<h2 id="install-debian-install-asl3-packages-install">ASL3 Packages Install</h2>
<p>Now the packages may be installed and updated directly from the AllStarLink package repository:</p>
<div class="highlight"><pre><span></span><code>sudo apt install asl3
</code></pre></div>
<p>This will install the complete ASL3 system including all of the Asterisk <code>app_rpt</code>-enabled packages (<code>asl3-asterisk</code>, <code>asl3-asterisk-config</code>, <code>asl3-asterisk-doc</code>, <code>asl3-asterisk-modules</code>), the Dahdi kernel module (<code>dahdi-dkms</code>, <code>dahdi-linux</code>, <code>dahdi-source</code>), the needed development tools to keep the kernel module updated, and the <a href="#user-guide"><code>asl3-menu</code></a>.</p>
<p>It's important to note that the new packaging format will allow for easy, automated updates of kernels through the standard <code>apt upgrade</code> process. There is no longer any reason to hold back kernel upgrades with the ASL3 packaging.</p>
<p>The following packages are also available and may be installed separately:</p>
<p><strong>Allmon3</strong> - The updated web interface to AllStarLink which includes strong support for mobile devices and screens of all sizes and shapes. See the <a href="#allmon3">Allmon3</a> page for details.</p>
<p><strong>ASL3 Nodelist Updater</strong> - An updated node service to maintain a local copy of the AllStarLink node database (<code>rpt_extnodes</code>). While, in general, the preferred method of node lookup is DNS, some installations with slow Internet or DNS servers that have very long cache timers may benefit from this method of node lookup instead.</p>
<p>Install with <code>sudo apt install asl3-update-nodelist</code>.</p>
<h2 id="install-debian-install-node-configuration">Node Configuration</h2>
<p>The next step is to configure the node settings. It is recommended to use the <a href="#user-guide"><code>asl3-menu</code></a> command to manage the configuration for common use cases. See <a href="#user-guide">ASL3 Menu</a> for details. YouTuber Freddie Mac has a nice <a href="https://youtu.be/aeuj-yI8qrU">ASL3 RPi installation and configuration video</a>. See the part where the <a href="#user-guide"><code>asl3-menu</code></a> is shown. </p>
<p>Proceed from here with the <strong>Node Settings</strong> option in order to configure your node number and choose/configure your audio interface. </p></section><section class="print-page" id="install-debian-deb-appliance"><h1 id="install-debian-deb-appliance-debian-12-appliance">Debian 12 Appliance</h1>
<div class="admonition danger">
<p class="admonition-title">Do This at Your Own Risk</p>
<p>A Debian 12 Appliance, similar to the Raspberry Pi Appliance, is still under development. In the meantime, you can get "close" to the same user experience by installing and configuring some additional packages. This is not generally recommended for most users at this time.</p>
</div>
<p>If you install the following packages, you’ll have everything you need to use the “appliance” configuration:</p>
<div class="highlight"><pre><span></span><code>sudo apt install asl3 asl3-update-nodelist asl3-menu allmon3
</code></pre></div>
<p>You will still need to do certain things like configure <a href="#allmon3">Allmon3</a> by hand.</p>
<p>If you want to turn your configuration you described into the full appliance, you can try installing <code>asl3-pi-appliance</code> which will “take over” your system. </p>
<p>This hasn't been rigorously tested against a non-Pi installation, but it should <em>mostly</em> work (if not completely work) - but YMMV. </p>
<p>If you don’t want to take the risk of that, but still want all the web experience, you can install:</p>
<div class="highlight"><pre><span></span><code>sudo apt install cockpit cockpit-networkmanager cockpit-packagekit \
  cockpit-sosreport cockpit-storaged cockpit-system cockpit-ws \
  python3-serial firewalld
</code></pre></div>
<p>Which should give you an unbranded, uncustomized <code>Cockpit</code> environment.</p>
<p>Again, doing the above is <strong>experimental and not generally recommended</strong>, but you are welcome to give it a try, and perhaps provide feedback on issues and changes to help push the development of a Debian 12 Appliance image along!</p></section><section class="print-page" id="install-debian-docker"><h1 id="install-debian-docker-docker-installation">Docker Installation</h1>
<p>These instructions are for installing ASL3 within a Docker container. The
utility of this is low because of the host-container kernel dependencies.
Use of a <a href="#install-debian-install">normal installation</a> is recommended.</p>
<div class="admonition warning">
<p class="admonition-title">Host / Container Kernel Compatibility</p>
<p>As app_rpt.so requires the DAHDI kernel modules, the container must be
hosted on a Debian 12 system. The container must be able to compile the
kernel module (using DKMS) for the exact kernel version provided to
the container from the Host OS. Currently, the container must be
recomposed after a reboot into a new kernel.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Advanced Concept</p>
<p>Use of Asterisk/app_rpt within a Docker container is not a trivial
undertaking. The Docker structure is provided due to requests from the 
community but it is not the recommended way to install and use
AllStarLink as it requires more configuration, not less, than
a traditional installation.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Limited Support</p>
<p>Installation of Asterisk/app_rpt in a container is not a primary
platform for AllStarLink v3. Updates, fixes, and support will
occur on as "as available" basis. Users of the container are 
requested to help the project.</p>
</div>
<h2 id="install-debian-docker-git-repository">Git Repository</h2>
<p>Create the directory <code>/docker</code> (or use whatever is preferred), <code>cd</code> to it,
and check out the Git repository containing the Docker configuration.
All commands on the rest of this page assume they are being run from
the directory containing the root of the Git repository. </p>
<p>For this manual page, the path used is <code>/docker/ASL3-Docker</code>.</p>
<p>The Git repository is located at <a href="https://github.com/AllstarLink/asl3-docker">https://github.com/AllstarLink/asl3-docker</a>. The following general steps can be used:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/docker
<span class="nb">cd</span><span class="w"> </span>/docker
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AllStarLink/ASL3-Docker.git
<span class="nb">cd</span><span class="w"> </span>ASL3-Docker
</code></pre></div>
<p>If the repository has already been checked out, but simply needs the latest
information, do <code>git pull origin main</code> from the <code>/docker/ASL3-Docker</code> directory.
For example:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/docker/ASL3-Docker
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
</code></pre></div>
<h2 id="install-debian-docker-system-requirements">System Requirements</h2>
<p>The AllStarLink3 container will require about 2G of space available
to <code>/var/lib/docker</code>.</p>
<h2 id="install-debian-docker-container-composition">Container Composition</h2>
<p>Construct the docker container with:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--build<span class="w"> </span>--force-recreate
</code></pre></div>
<p>The script <code>asl3-init.sh</code> is used during the composition process to build the
system. Alterations for composing should be added here when possible
instead of the <code>Dockerfile</code> or <code>docker-compose.yml</code>. Do not delete
the <code>fake-systemctl</code> - that is needed to simulate systemd configurations for
successful package installation.</p>
<h2 id="install-debian-docker-container-configuration">Container Configuration</h2>
<p>Configuration of Asterisk/ASL3 within the container is best done using
the <code>asl-menu</code> program. This is invoked with:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>allstarlink3<span class="w"> </span>asl-menu
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Restarting Asterisk for Config Changes</p>
<p>Due to the workings of containers, the "Restart Asterisk" functions
of asl-menu do not work. Changes make to the configuration
requires a container restart - <code>docker restart allstarlink3</code>.
It is possible to use the Asterisk command <code>rpt restart</code> to reload
app_rpt but that is not always reliable.</p>
</div>
<h2 id="install-debian-docker-interacting-with-asterisk">Interacting with Asterisk</h2>
<p>Interacting with asterisk in the container is done using <code>asterisk-cli.sh</code>:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>allstarlink3<span class="w"> </span>/asl3/asterisk-cli.sh
</code></pre></div>
<h2 id="install-debian-docker-viewing-asterisk-logs">Viewing Asterisk Logs</h2>
<p>Logs are viewed with <code>docker logs allstarlink3</code>.</p>
<h2 id="install-debian-docker-stopping-and-starting-the-container">Stopping and Starting the Container</h2>
<p>After the <code>docker compose</code> command, the container will be running
with the initial configuration of Asterisk and app_rpt. The following
commands may be used to manage the container:</p>
<ul>
<li><code>docker stop allstarlink3</code> - Stops the container</li>
<li><code>docker start allstarlink3</code> - Starts the container</li>
<li><code>docker restart allstarlink3</code> - Restart the container (effectively a stop/start)</li>
</ul>
<p>The container will start on boot of the Host OS unless otherwise configured.</p>
<h2 id="install-debian-docker-container-rebuild-after-host-kernel-upgrade">Container Rebuild After Host Kernel Upgrade</h2>
<p>As stated above, the container must be managed in lock-step with the underlying
kernel of the host operating system. After the kernel of the host has been
upgraded, the container must be upgraded as well. The easiest way to do this
is simply top stop and recompose the container:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>stop<span class="w"> </span>allstarlink3
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--build<span class="w"> </span>--force-recreate
</code></pre></div>
<p>Upon start after the recomposition, DAHDI will be installed and working
for the upgraded kernel.</p></section><h1 class='nav-section-title-end'>Ended: <span style="color:hsl(86.28, 71.6%, 33.14%)">ASL3 on Debian</span></h1>
                        <h2 class='nav-section-title' id='section--span-style-color-hsl-86-28-71-6-33-14-allmon3-span-'>
                            <span style="color:hsl(86.28, 71.6%, 33.14%)">Allmon3</span> <a class='headerlink' href='#section--span-style-color-hsl-86-28-71-6-33-14-allmon3-span-' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="allmon3"><h1 id="allmon3-allmon3">Allmon3</h1>
<p>Allmon is the standard web-based monitoring and management for ASL3.</p>
<p>Allmon3 is the next generation of web dashboards for AllStarLink, rewritten for performance, scalability, and responsiveness.</p>
<h2 id="allmon3-design-goals">Design Goals</h2>
<p>Allmon3 features and functionality shall be governed by the following guidelines:</p>
<ul>
<li>Use of modern web responsive design for usability on all device form factors and screen sizes</li>
<li>Clear separation between long-running tasks and client-based display updates</li>
<li>Permit reduced workload on potentially slow repeater site links by cleanly supporting the ability to run only the pollers on the device controlling the repeater, and run the dashboard in the cloud; easy prevention of unnecessary web traffic, spidering, etc.</li>
<li>Prioritization of the common use cases of AllStarLink for feature enhancements</li>
</ul>
<h2 id="allmon3-community">Community</h2>
<p>All code of Allmon3 not otherwise licensed (e.g., Bootstrap, etc.) is licensed under the <a href="https://www.gnu.org/licenses/why-affero-gpl.html">GNU Affero General Public License v3</a>. The choice of the AGPLv3 promotes giving back to the amateur radio and ASL communities. </p>
<h2 id="allmon3-support">Support</h2>
<p>Source code for Allmon3 is available in the <a href="https://github.com/AllStarLink/Allmon3">AllStarLink GitHub Repository</a>. If you find a bug, you are encouraged to check the <a href="https://github.com/AllStarLink/Allmon3/issues">Allmon3 Issues</a> list to see if it has already been reported, or file a new issue if necessary.</p></section><section class="print-page" id="allmon3-install"><h1 id="allmon3-install-installation">Installation</h1>
<h2 id="allmon3-install-supported-platforms">Supported Platforms</h2>
<p>Allmon3 is only supported on:</p>
<ul>
<li>Debian 12 Bookworm (including Raspoberry Pi OS 12)</li>
<li>Debian 11 Bullseye (including Raspberry Pi OS 11)</li>
</ul>
<p>Allmon3 is installed by default on the Raspberry Pi Image, no installation actions are required, you can proceed directly to <a href="#allmon3-config">configuration</a>.</p>
<h2 id="allmon3-install-asl3-packages-install">ASL3 Packages Install</h2>
<h3 id="allmon3-install-debian-12">Debian 12</h3>
<ul>
<li>Install the AllStarLink repository file:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo -s
cd /tmp
wget https://repo.allstarlink.org/public/asl-apt-repos.deb12_all.deb
sudo dpkg -i asl-apt-repos.deb12_all.deb
sudo apt update
</code></pre></div>
<ul>
<li>Install Allmon3:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo apt install allmon3
</code></pre></div>
<h3 id="allmon3-install-debian-11">Debian 11</h3>
<ul>
<li>Enable the Debian 11 <code>bullseye-backports</code> package repository:</li>
</ul>
<div class="highlight"><pre><span></span><code>gpg --keyserver keyserver.ubuntu.com --recv-keys 0E98404D386FA1D9
gpg --keyserver keyserver.ubuntu.com --recv-keys 6ED0E7B82643E131
gpg --export 0E98404D386FA1D9 | sudo apt-key add -
gpg --export 6ED0E7B82643E131 | sudo apt-key add -
echo &quot;deb https://deb.debian.org/debian bullseye-backports main&quot; &gt; /etc/apt/sources.list.d/bullseye-backports.list
apt update
</code></pre></div>
<ul>
<li>Install the dependencies:</li>
</ul>
<div class="highlight"><pre><span></span><code>apt install -y apache2 python3-argon2 
apt install -y -t bullseye-backports python3-websockets python3-aiohttp python3-aiohttp-session
</code></pre></div>
<ul>
<li>Install Allmon3:</li>
</ul>
<div class="highlight"><pre><span></span><code>wget https://github.com/AllStarLink/Allmon3/releases/download/t_rel_1_2_0/allmon3_1.2.0-1.bullseye_all.deb
dpkg -i allmon3_1.2.0-1.bullseye_all.deb
</code></pre></div>
<h3 id="allmon3-install-debian-10">Debian 10</h3>
<p><strong>NOTE:</strong> Allmon v1.2.1 will be the last version for Debian 10. Please upgrade your AllStarLink system to ASL3 on Debian 12.</p>
<ul>
<li>Enable the Debian 10 <code>buster-backports</code> package repository:</li>
</ul>
<div class="highlight"><pre><span></span><code>gpg --keyserver keyserver.ubuntu.com --recv-keys 04EE7237B7D453EC
gpg --keyserver keyserver.ubuntu.com --recv-keys 648ACFD622F3D138
gpg --keyserver keyserver.ubuntu.com --recv-keys 0E98404D386FA1D9
gpg --keyserver keyserver.ubuntu.com --recv-keys 6ED0E7B82643E131
gpg --export 04EE7237B7D453EC | sudo apt-key add -
gpg --export 648ACFD622F3D138 | sudo apt-key add -
gpg --export 0E98404D386FA1D9 | sudo apt-key add -
gpg --export 6ED0E7B82643E131 | sudo apt-key add -
echo &quot;deb https://deb.debian.org/debian buster-backports main&quot; &gt; /etc/apt/sources.list.d/buster-backports.list
apt update
</code></pre></div>
<ul>
<li>Install the dependencies:</li>
</ul>
<div class="highlight"><pre><span></span><code>apt install -y apache2 python3-argon2 
apt install -y -t buster-backports python3-async-timeout python3-attr python3-multidict python3-yarl python3-pip
</code></pre></div>
<ul>
<li>Install Python modules using <code>pip3</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code>apt remove python3-aiohttp python3-websockets
pip3 install aiohttp
pip3 install aiohttp_session
pip3 install websockets
</code></pre></div>
<ul>
<li>Update the CA Certificate chain since Debian 10 is out of support:</li>
</ul>
<div class="highlight"><pre><span></span><code>apt install ca-certificates
update-ca-certificates --fresh
</code></pre></div>
<ul>
<li>Install Allmon3 (Debian 10 version):</li>
</ul>
<div class="highlight"><pre><span></span><code>wget https://github.com/AllStarLink/Allmon3/releases/download/t_rel_1_2_0/allmon3_1.2.0-1.buster_all.deb
dpkg -i allmon3_1.2.0-1.buster_all.debntu.com --recv-keys 6ED0E7B82643E131
</code></pre></div>
<h2 id="allmon3-install-using-nginx-instead-of-apache">Using Nginx instead of Apache</h2>
<p>Nginx can be used instead of Apache. Instead of using the <code>apache2</code> package, install <code>nginx</code> using the above directions. After configuring Nginx, edit <code>/etc/nginx/sites-available/default</code> (or your preferred site configuration) and add an <code>include</code> directive within the appropriate <code>server { }</code> configuration block. For example:</p>
<div class="highlight"><pre><span></span><code>server {
    listen 80 default_server;

    [... other stuff ...]

    include /etc/allmon3/nginx.conf;

    [... other stuff ...]
}
</code></pre></div>
<h2 id="allmon3-install-install-from-source">Install from Source</h2>
<p>Installation from source is not supported in the general use case. However, <code>make install</code> should yield a working system. Source is available at <a href="https://github.com/AllStarLink/Allmon3">https://github.com/AllStarLink/Allmon3</a></p></section><section class="print-page" id="allmon3-config"><h1 id="allmon3-config-configuration">Configuration</h1>
<p>All configuration resides in <code>/etc/allmon3</code>. The stock configuration files are always available at <code>/usr/share/doc/allmon3/</code> for recovery and documentation.</p>
<p>After changing any configuration file, the service <code>allmon3</code> must be restarted using <code>sudo systemctl restart allmon3</code>.</p>
<h2 id="allmon3-config-node-configuration">Node Configuration</h2>
<p>Allmon3's node connections are configured in <code>/etc/allmon3/allmon3.ini</code>. The <code>allmon3.ini</code> file is a standard INI-formatted file. Each stanza in the file is a node number. Each node stanza then can take the following options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Req'd / Opt</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>host</strong></td>
<td>Req'd</td>
<td>-</td>
<td>DNS name or IP address of the Asterisk/ASL node</td>
</tr>
<tr>
<td><strong>port</strong></td>
<td>Opt</td>
<td>5038</td>
<td>Port of the Asterisk manager</td>
</tr>
<tr>
<td><strong>user</strong></td>
<td>Req'd</td>
<td>-</td>
<td>Username of the Asterisk monitor, most commonly 'admin'</td>
</tr>
<tr>
<td><strong>pass</strong></td>
<td>Req'd</td>
<td>-</td>
<td>Password of the monitor user</td>
</tr>
<tr>
<td><strong>multinodes</strong></td>
<td>Opt</td>
<td>-</td>
<td>This node is a server hosting multiple nodes and this is the "primary" record for the host.</td>
</tr>
<tr>
<td><strong>voters</strong></td>
<td>Opt</td>
<td>n[,n,...]</td>
<td>List voters on this server, comma separate. No value disabled voters</td>
</tr>
<tr>
<td><strong>pollinterval</strong></td>
<td>Opt</td>
<td>1</td>
<td>Polling interval to asterisk in default is 1. this value can be expressed as a decimal fraction of a second - e.g., .5 is 500ms, .375 is 375ms, etc.</td>
</tr>
<tr>
<td><strong>vpollinterval</strong></td>
<td>Opt</td>
<td>1</td>
<td>Broadcast interval of voter data in seconds default is 1. this value can be expressed as a decimal fraction of a second - e.g., .5 is 500ms, .375 is 375ms, etc.</td>
</tr>
<tr>
<td><strong>retryinterval</strong></td>
<td>Opt</td>
<td>15</td>
<td>Seconds between retries if initial connection to asterisk is lost (optional, default 15)</td>
</tr>
<tr>
<td><strong>retrycount</strong></td>
<td>Opt</td>
<td>"Infinite"</td>
<td>number of times to retry a lost asterisk connection before ending (default infinite)</td>
</tr>
</tbody>
</table>
<p>An example minimal node configuration would be:</p>
<div class="highlight"><pre><span></span><code>[1999]
host = 127.0.0.1
user = admin
pass = Passw0rd
</code></pre></div>
<p>An example of a server with multiple nodes on it:</p>
<div class="highlight"><pre><span></span><code>[1999]
host = 127.0.0.1
user = admin
pass = Passw0rd
multinodes = 1999, 1998
</code></pre></div>
<p>Here's an example for monitoring three ASL Nodes (including one off-LAN):</p>
<div class="highlight"><pre><span></span><code>[50815]
host=172.17.16.36
user=admin
pass=password

[460180]
host=172.17.16.217
user=admin
pass=password

[48496]
host=192.2.0.145
user=admin
pass=password
voters=48496
</code></pre></div>
<p><strong>NOTE:</strong> Adding a <code>voters</code> option does not automatically make the VOTER status show up in Allmon3. You will need to manually configure the voter instance in <code>menu.ini</code>, see below.</p>
<h2 id="allmon3-config-server-customization">Server Customization</h2>
<p>Allmon3 has multiple configuration files to consider:</p>
<ul>
<li>
<p><code>/etc/allmon3/web.ini</code> - This is the customization interface for the Allmon3 web interface</p>
</li>
<li>
<p><code>/etc/allmon3/custom.css</code> - Certain CSS customizations to change colors in the application. Follows standard CSS rules and syntax</p>
</li>
<li>
<p><code>/etc/allmon3/menu.ini</code> - Allows for the customization of the Allmon3 web menu. By default, the menu is a list of all nodes found in <code>allmon3.ini</code>. Customized menus can be configured as described in <code>menu.ini.example</code></p>
</li>
</ul>
<h3 id="allmon3-config-webini"><code>web.ini</code></h3>
<p>The <code>web.ini</code> file has four configuration sections - 
<code>[web]</code>, <code>[syscmds]</code>, <code>[node-overrides]</code>, and <code>[voter-titles]</code>. </p>
<h4 id="allmon3-config-web"><code>[web]</code></h4>
<p>The <code>[web]</code> section has the basic customizations for the Allmon3 site. Each item in this section is documented in the file.  </p>
<h4 id="allmon3-config-syscmds"><code>[syscmds]</code></h4>
<p>The <code>[syscmds]</code> section defines the templates in the "system commands" menu. This stanza lists commands that are templates for the systems command modal dialog. The format is:</p>
<div class="highlight"><pre><span></span><code>[syscmds]
  command text = Command Label
  command text = Command Label
  command text = Command Label
  ...
</code></pre></div>
<p>In any command text the @ will be replaced with the node the command modal was selected from. For example:</p>
<div class="highlight"><pre><span></span><code>    rpt status @ = Show Node Status
</code></pre></div>
<p>Will result in the command <code>rpt status 1999</code> assuming this command was selected from Node 1999.</p>
<p>It is possible to create optional stanzas named in the format <code>[syscmds-NODE]</code> (e.g. <code>[syscmds-1999]</code>) and have those command templates appear only for the given node listed. </p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>[syscmds-1999]
rpt cmd @ cop 999 xxx = Execute function 999
</code></pre></div>
<h4 id="allmon3-config-node-overrides"><code>[node-overrides]</code></h4>
<p>The <code>[node-overrides]</code> section can be used to override information from the ASL database. Using this section, the AllStarLink database labels for a node may be replaced with custom text. The format is:</p>
<div class="highlight"><pre><span></span><code>[node-overrides]
    NODE1 = TEXT HERE
    NODE2 = TEXT HERE 2
</code></pre></div>
<p>This section must exist, even if it's empty. For example:</p>
<div class="highlight"><pre><span></span><code>[node-overrides]
    1999 = My special private node
    2010 = Wild Party Node
</code></pre></div>
<h4 id="allmon3-config-voter-titles"><code>[voter-titles]</code></h4>
<p>The <code>[voter-titles]</code> section is used to set display names for VOTERs. This functions identically to <code>[node-overrides]</code>. For any VOTER not named here, they will have an auto-generated name of <code>Voter NODE</code>.</p>
<div class="highlight"><pre><span></span><code>[voter-titles]
    ;1999 = My special private node
    48496 = VHF VOTER System
</code></pre></div>
<h3 id="allmon3-config-menuini"><code>menu.ini</code></h3>
<p>If this file is present in the <code>api/</code> subdirectory of Allmon3's web interface and named <code>menu.ini</code>, this file will override the default behavior of the web interface simply listing the configured nodes in the left navbar.</p>
<p>If this file is not present, all nodes in <code>allmon3.ini/allmon3.ini.php</code> will display singly in configured order.</p>
<p><strong>NOTE:</strong> Not listing a node in the menu <strong>WILL NOT</strong> cause the node to go un-polled if it is already configured in <code>allmon3.ini</code>. This allows the system administrator to have "hidden" nodes. If you want to completely stop polling an Asterisk/ASL node, the node must be removed from <code>allmon3.ini</code>.</p>
<p>The format for this file is as follows:</p>
<div class="highlight"><pre><span></span><code>[ TITLE ]                         :: The stanza header is the label
                                  :: for this menu item
type  = ( menu | single )         :: If type = menu, the item is interpreted as a dropdown
                                  :: menu with each LABEL item displaying. If the
                                  :: type = single, then only a the first LABEL = TARGET
                                  :: will be displayed as a non-dropdown. In the case of
                                  :: type = single, the [ TITLE ] is ignored completely

LABEL = TARGET                    :: Each [ TITLE ] displays one or more LABELS
LABEL = TARGET                    :: with a link to TARGET. When TARGET is all numbers
LABEL = TARGET                    :: then TARGET is assumed to be a ASL node and
                                  :: the link will filter down to the TARGET node
                                  :: specified. Any other pattern will be interpreted
                                  :: as a full or partial URL/URI.
                                  ::
                                  :: Of special node, creating a menu item of
                                  :: multiple nodes to display, TARGET and simply be
                                  :: #NODE,NODE,NODE - e.g. #1999,1998,1997
</code></pre></div>
<p>Note that the order of the nodes within a stanza is irrelevant. They will be displayed as sorted alphabetically ascending according to UTF-8 (e.g. 0-9, A-Z, +).</p>
<p>An example custom menu may look like:</p>
<div class="highlight"><pre><span></span><code>[ W8WKY ]
type = menu
W8WKY = 43211
48496 = 48496
45839 = 45839

[ N8XPK ]
type = menu
N8XPK = 42993
43118 = 43118
47987 = 47987

[ VHF VOTER ]
type = single
VOTER = voter.html#48496

[ Test ]
type = single
AllStarLink = https://www.allstarlink.org
</code></pre></div>
<p>VOTER instances are not automatically displayed. You will need to manually add them to <code>menu.ini</code> in order to create a navigation button to access them.</p>
<p><strong>NOTE:</strong> Adding a VOTER instance will require manually creating a <code>menu.ini</code> (if you haven't already). As noted previously, the presence of this file will mean that the default behaviour of Allmon3 to automatically display all configured nodes will be changed. As a result, in addition to configuring your VOTER instance, you will also need to manually configure all the rest of your nodes, so that they will be displayed.</p>
<p>The format is the same as other buttons, the critical part is the target (right side of the link). That must point to <code>voter.html#NODE</code>, where <code>NODE</code> is the node number you defined in <code>allmon3.ini</code>. The target can also be a FQDN, if you are pointing to a remote system (properly configured).</p>
<div class="highlight"><pre><span></span><code>[ LOCAL VOTER ]       ; ignored for single menu items
type = single
BUTTON_NAME = voter.html#NODE

[ REMOTE VOTER ]
type = single
Remote_VOTER = http://somesite.org/allmon3/voter.html#1999
</code></pre></div></section><section class="print-page" id="allmon3-usermgmt"><h1 id="allmon3-usermgmt-user-management">User Management</h1>
<p>Allmon3 supports a robust multi-user configuration that  permits per-node granular access as desired and that abstracts Allmon3 from the Asterisk AMI Manager configuration.</p>
<p>Usernames and passwords are stored in <code>/etc/allmon3/users</code>.</p>
<p>The default-configured username and password combination is<code>allmon3 / password</code>.</p>
<p><span style="color:red; size=1.2em"><strong>You <em>must</em> change this before exposing a host to the Internet</strong></span></p>
<h2 id="allmon3-usermgmt-user-database">User Database</h2>
<p>Allmon3's user database is managed by <code>allmon3-passwd</code>. Adding a new user or editing an existing user is the same command. If the user does not exist, it will be added. If the user does exist, the password will be updated. </p>
<p>To add or edit a user's password: </p>
<div class="highlight"><pre><span></span><code>$ allmon3-passwd allmon3
Enter the password for allmon3: password
Confirm the password for allmon3: password
</code></pre></div>
<p>That's all there is to it. The <code>/etc/allmon3/users</code> file is readable to see that the Argon2 hash changed for the user.</p>
<p>Deleting a user is simply adding the <code>--delete</code> flag to the command:</p>
<div class="highlight"><pre><span></span><code>$ allmon3-passwd --delete allmon3
</code></pre></div>
<p>After changing a user's password, the Allmon3 daemon must be reloaded with <code>systemctl reload allmon3</code>.</p>
<h2 id="allmon3-usermgmt-per-node-restrictions-for-users">Per-Node Restrictions for Users</h2>
<p>Allmon3 implements a lightweight access control system to restrict commands from certain users to certain nodes. Restrictions are configured in <code>/etc/allmon3/user-restrictions</code>. Given that the average use case is all users have similar access, the access control is implemented in a named-restrictions model for least configuration complexity.</p>
<p>The logic is as follows when checking the restricted access list:</p>
<ol>
<li>
<p>If the user is not listed in <code>user-restrictions</code> at all, then the user is permitted commands on all configured nodes.</p>
</li>
<li>
<p>If the user is listed in <code>user-restrictions</code>, and is listed as restricted to the node being commanded, the user is permitted to issue the command.</p>
</li>
<li>
<p>If the user is listed in <code>user-restrictions</code>, but the node is not listed for that user, the user is prohibited from issuing the command.</p>
</li>
</ol>
<p>The format of the <code>user-restrictions</code> file is:</p>
<div class="highlight"><pre><span></span><code>user1 | NODE[,NODE,NODE...]
user2 | NODE
</code></pre></div>
<p>Lines beginning with # are comments.</p></section><h1 class='nav-section-title-end'>Ended: <span style="color:hsl(86.28, 71.6%, 33.14%)">Allmon3</span></h1><h1 class='nav-section-title-end'>Ended: Installation</h1>
                        <h1 class='nav-section-title' id='section-basic-operation'>
                            Basic Operation <a class='headerlink' href='#section-basic-operation' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="user-guide"><h1 id="user-guide-basic-operation-using-asl3-menu">Basic Operation Using ASL3 Menu</h1>
<p>Once you have installed ASL3 on your system you will want to configure your node.</p>
<p>The ASL3 menu will help you get started with many common configurations including nodes with USB audio interfaces and <a href="#basics-gettingstarted-what-is-a-hub">"hub"</a> nodes.</p>
<p>The ASL3 menu will also help you maintain your system.</p></section><section class="print-page" id="user-guide-menu"><h1 id="user-guide-menu-accessing-asl3-menu">Accessing ASL3 Menu</h1>
<p>Your system may have been setup to automatically start the ASL3 menu as soon as you have logged in. If not, you can access the ASL3 menu by executing the following command from the Linux shell :</p>
<div class="highlight"><pre><span></span><code>asl-menu
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">May Require sudo</p>
<p>If you are not logged in as the "root" user you will need to use:</p>
<div class="highlight"><pre><span></span><code>sudo asl-menu
</code></pre></div>
</div>
<p>When the ASL3 menu is running you will be presented with options to configure a node, access the Asterisk CLI, backup (or restore) your ASL settings, access the Linux CLI, perform some basic diagnostics, and perform some common system actions.</p>
<h2 id="user-guide-menu-node-settings">Node Settings</h2>
<p>For new installs, you will want to select the ASL3 <code>Node Settings</code> menu option. This is where you will configure the basic settings needed to get your new node on the air. You can return to this menu later to review and/or update your node settings.</p>
<p>The <code>Node Settings</code> menu allows you update key node settings including :</p>
<ul>
<li>Node number</li>
<li>Node password</li>
<li>Node Callsign/ID</li>
<li>Radio interface (e.g. USB sound device, HUB node)</li>
<li>Duplex type (e.g. full duplex, half duplex, telemetry)</li>
<li>USB Interface tuning</li>
<li>Enable/disable status posting (to <a href="http://stats.allstarlink.org">http://stats.allstarlink.org</a>)</li>
</ul>
<p>The <code>Node Settings</code> menu also allows you to add (or remove) additional nodes.</p>
<div class="admonition note">
<p class="admonition-title">Direct CLI Access</p>
<p>You can also use the <code>node-setup</code> command to access this menu directly from the Linux CLI.</p>
</div>
<h2 id="user-guide-menu-asterisk-cli">Asterisk CLI</h2>
<p>The Asterisk Command Line Interface (CLI) provides direct access to the heart of what makes an AllStar node.</p>
<p>You might use the CLI for testing, troubleshooting, or for controlling your node. You should know that many of the commands require a more in-depth knowledge of Asterisk. The good news is that many of the commonly used commands can be executed from the <code>Diagnostics Menu</code>, or with one of the web management/monitoring applications (e.g. <a href="#allmon3">Allmon3</a>).</p>
<p>The Asterisk CLI can be accessed directly via <code>asl-menu</code>, from the <a href="#pi-cockpit-console"><code>Cockpit</code> terminal</a>, or directly off the Linux command line using <code>asterisk -rvvv</code> or <code>sudo asterisk -rvvv</code>, depending on your configuration.</p>
<h3 id="user-guide-menu-asterisk-cli-verbosity-and-debug">Asterisk CLI Verbosity and Debug</h3>
<h4 id="user-guide-menu-verbosity-level">Verbosity Level</h4>
<p>"Verbosity" refers to how "chatty" the Asterisk CLI is. The larger the verbosity level, the more detailed the messages on the console will be. A good verbosity level is typically <code>3</code>. It provides a reasonable level of detail as Asterisk is operating.</p>
<p>The verbosity level is set by the number of <code>v</code>'s when the command to connect to the CLI is invoked. As shown above, <code>asterisk -rvvv</code> would connect to the console with a verbosity level of <code>3</code>, due to the <code>vvv</code>.</p>
<p>The <code>asl-menu</code> option to <code>Enter the Asterisk CLI</code> invokes the CLI with a verbosity level of <code>3</code>.</p>
<p>You can see the current verbosity level once you are in the Asterisk CLI by using the <code>core show settings</code> command.</p>
<p>You can change the current verbosity level once you are in the Asterisk CLI by using the <code>core set verbose &lt;level&gt;</code> command.</p>
<p>The Asterisk CLI should be invoked with at least a verbosity level of <code>1</code>, otherwise you will see very few messages.</p>
<h4 id="user-guide-menu-debug-level">Debug Level</h4>
<p>"Debug" messages are additional logging messages that developers specifically add to modules, to aid in troubleshooting. Debug messages are distinct from normal (verbosity) messages, and must be enabled separately. </p>
<p>You can see the current debug level once you are in the Asterisk CLI by using the <code>core show settings</code> command. It will default to level <code>0</code>, unless specifically changed.</p>
<p>You can change the current debug level once you are in the Asterisk CLI by using the <code>core set debug &lt;level&gt;</code> command. Optionally, the debug level can be configured and set for a specific module, by passing the module name in the command. For example, <code>core set debug 4 app_rpt</code> would set the debug level to <code>4</code> specifically for the <code>app_rpt</code> module, instead of the whole system. This could make things easier to read, as all the modules wouldn't be spitting out debug messages, only the <code>app_rpt</code> module.</p>
<h2 id="user-guide-menu-backup-and-restore">Backup and Restore</h2>
<p>The ASL3 <code>Backup and Restore</code> menu option provides a simple option to backup (and restore) your AllStar and Asterisk configuration.</p>
<p>The backup archives are stored locally on your system and optionally in the cloud.</p>
<p>We encourage you to "backup" your configuration, especially before and after you make changes.</p>
<p><strong>NOTE:</strong> you can also use the <code>asl-backup-menu</code> command directly from the Linux CLI to access this menu.</p>
<h2 id="user-guide-menu-diagnostics">Diagnostics</h2>
<p>The ASL3 <code>Diagnostics</code> menu option allows you to perform some simple/rudimentary checks of your system and node.</p>
<p>These diagnostics include basic internet connectivity checks and reporting of your AllStar registrations. We also provide a way to stop, start, and restart some of the AllStar and Asterisk services that run on your system.</p>
<p><strong>NOTE:</strong> You should know that these diagnostics are not exhaustive. With a good connection to the internet and a valid configuration all "should be" OK.</p>
<p>If the provided diagnostics don't flag an issue then you will need to dig deeper.</p>
<ul>
<li>Be aware of changes you make to your system and configuration.</li>
<li>Be aware of software packages that you install.</li>
<li>Be aware of "upgrades".</li>
</ul>
<p>If you need help, reach out to the <a href="https://community.allstarlink.org/">AllStarLink Community</a>.</p>
<h2 id="user-guide-menu-expert-configuration">Expert Configuration</h2>
<p>The ASL3 <code>Expert Configuration Menu</code> option will allow you to make changes to some of the AllStar and Asterisk configuration files (in the <code>/etc/asterisk</code> directory). But, don't worry about that advanced stuff just yet.</p>
<h2 id="user-guide-menu-bash-shell">Bash Shell</h2>
<p>The <code>bash</code> shell provides access to the Linux command line interface, also known as the Linux CLI. This is for experts or if you have been provided with CLI instructions.</p></section><section class="print-page" id="user-guide-asl-cmds-tools"><h1 id="user-guide-asl-cmds-tools-asl3-commands-and-tools">ASL3 Commands and Tools</h1>
<p>The following commands and tools are the primary AllStarLink ecosystem. Each entry contains a description of the command, link to the documentation, and what package provides the command or tool.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Documentation</th>
<th>Package</th>
</tr>
</thead>
<tbody>
<tr>
<td>asterisk</td>
<td>The main console for Asterisk and app_rpt</td>
<td>Normally invoked with <code>asterisk -r</code></td>
<td>asl3-asterisk</td>
</tr>
<tr>
<td><code>asl-menu</code></td>
<td>The main text-based menu for configuring ASL</td>
<td><a href="#user-guide">Menu Use</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl3-update-nodelist</code></td>
<td>Primary engine to update the <code>/var/lib/asterisk/rpt_extnodes</code> database like for the node dictionary.</td>
<td><a href="#adv-topics-noderesolution">Node Resolution</a></td>
<td>asl3-update-nodelist</td>
</tr>
<tr>
<td><code>asl3-update-astdb</code></td>
<td>Universal engine to provide <code>astdb.txt</code> to various applications that require the old node name database. Use this rather than a special version for every third-party app (e.g. Supermon, Node Remote, etc.)</td>
<td><a href="#adv-topics-noderesolution">Node Resolution</a></td>
<td>asl3-update-nodelist</td>
</tr>
<tr>
<td><code>allmon3-passwd</code></td>
<td>Manage the user database and passwords for Allmon3</td>
<td><a href="#allmon3-usermgmt">Allmon3 User Management</a></td>
<td>allmon3</td>
</tr>
<tr>
<td><code>asl-find-sound</code></td>
<td>Utility to help locate compatible sound devices</td>
<td><a href="#mans-asl-find-sound">manpage</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-node-lookup</code></td>
<td>Utility to test node lookup when troubleshooting Asterisk/app_rpt connectivity issues</td>
<td><a href="#mans-asl-node-lookup">manpage</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-play-arn</code></td>
<td>Tool to play Amateur Radio Newsline</td>
<td><a href="#mans-asl-play-arn">manpage</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-repo-switch</code></td>
<td>Utility to change package release streams for AllStarLink</td>
<td><a href="#user-guide-betatest">Beta Testing</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-say</code></td>
<td>Tool for basic statements into Asterisk like the sime</td>
<td><a href="#mans-asl-say">manpage</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-show-version</code></td>
<td>Utility to report the package version of all related ASL3 software. Normally used in bug reports and support requests.</td>
<td>N/A</td>
<td>asl3</td>
</tr>
<tr>
<td><code>asl-tts</code></td>
<td>Text-to-speech engine for AllStarLink</td>
<td><a href="#adv-topics-tts">Text to Speech</a></td>
<td>asl3-tts</td>
</tr>
<tr>
<td><code>sa818</code></td>
<td>CLI tool for configuration SA818/DRA818-based radio modules. Use `sa818-menu in most cases.</td>
<td><a href="#adv-topics-sa818modules">SA818 Page</a></td>
<td>asl3</td>
</tr>
<tr>
<td><code>sa818-menu</code></td>
<td>Menu for configuring SA818/DRA818-based radio modules</td>
<td><a href="#adv-topics-sa818modules">SA818 Page</a></td>
<td>asl3</td>
</tr>
</tbody>
</table></section><section class="print-page" id="user-guide-passwords"><h1 id="user-guide-passwords-logins-and-passwords">Logins and Passwords</h1>
<p>Yes, there are many "different" logins and passwords associated with AllStarLink, the ASL3 software, and the related applications. A typical ASL3 server/node will directly or indirectly use the following login/password pairs:</p>
<ul>
<li><a href="#basics-portal">AllStarLink Portal</a> website login (for "node" information)</li>
<li>Linux login</li>
<li>Asterisk Manager Interface (AMI) user/secret</li>
<li>Web application (<a href="#allmon3">Allmon3</a>) login</li>
</ul>
<h2 id="user-guide-passwords-allstarlink-website-wwwallstarlinkorg">AllStarLink Website (<a href="https://www.allstarlink.org">www.allstarlink.org</a>)</h2>
<p>The AllStarLink website is where you register for an AllStarLink account, add ASL servers, and request ASL nodes.</p>
<ul>
<li>
<p>Your AllStarLink account with have a <code>login</code> and <code>password</code></p>
</li>
<li>
<p>Using the AllStarLink website's "Portal" menu you can:</p>
<ul>
<li>
<p>Add/configure "servers" (computers) that will be running the ASL software. Each "server" specifies the IAX port used to communicate with your node. Most nodes will use the default port (4569). The most common reason to specify an alternate port would be configuring multiple servers that would be running behind a NAT router (e.g. when the servers would be sharing the same public IP).</p>
</li>
<li>
<p>Add/configure "nodes" that will be running on a server. Each ASL "node" will have an associated password. You will use the node number and password pair when configuring your ASL node.</p>
</li>
</ul>
</li>
<li>
<p>Some desktop and mobile applications use "Web Transceiver" to connect to AllStarLink nodes. Many of these applications use your AllStarLink website login and password for authentication.</p>
</li>
</ul>
<p>See the <a href="#basics-portal">AllStarLink Portal</a> page for more details.</p>
<h2 id="user-guide-passwords-linux-login">Linux Login</h2>
<p>Your desktop, laptop, Raspberry Pi, or Virtual Machine will be running the Linux operating system (e.g. Debian). To access the operating system on your OS you will need a login <code>user</code> and <code>password</code>.</p>
<p>You will use the Linux <code>user</code> and <code>password</code> when logging in to your system:</p>
<ul>
<li>with the system's display/keyboard</li>
<li>over the network using SSH</li>
<li>over the network using the <a href="#pi-cockpit-basics">Cockpit</a> web console</li>
</ul>
<p>You may have heard about the Linux "root" account. The root account is also called the super-user; it is a login that bypasses all security protection on your system. The root account should only be used to perform system administration, and only used for as short a time as possible. With ASL3, we are trying to limit our usage of the "root" account.</p>
<h3 id="user-guide-passwords-how-do-i-setup-a-linux-login">How do I setup a Linux login?</h3>
<ul>
<li>For those using the Raspberry Pi Imager, you will use the "OS Customization" to setup a new login account. Here, you will specify your login <code>user</code> and <code>password</code> (or provide an SSH public key for password-less access)</li>
<li>For those installing generic Debian OS, you should be prompted to setup an initial account during the OS installation. This is where you will specify your login <code>user</code> and <code>password</code>. Note, we recommend NOT configuring a <code>root</code> account during Debian 12 installation (skip it), so that the first user account you create will be able to issue root commands using <code>sudo</code></li>
<li>Some Virtual Machines (VM's) will have you use a pre-configured image with a default <code>user</code> and <code>password</code>.  Check the documentation associated with the image, or your VM host/provider for details</li>
</ul>
<p><strong>NOTE:</strong> There is NO DEFAULT USER included in the ASL3 Raspberry Pi Appliance image.</p>
<h2 id="user-guide-passwords-asterisk-manager-interface-ami">Asterisk Manager Interface (AMI)</h2>
<p>Your AllStarLink server system runs as process named <code>asterisk</code> that is the heart of your node(s). The Asterisk Manager Interface (AMI) is the standard management interface into your Asterisk server.</p>
<p>The AMI configuration, stored in <code>/etc/asterisk/manager.conf</code>, includes <code>user</code> stanzas and associated <code>secret</code> passwords. For example:</p>
<div class="highlight"><pre><span></span><code>[admin]
secret = my-AMI-password
...
</code></pre></div>
<p>This <code>user</code> (admin) and <code>secret</code> (my-AMI-password) would need to be specified in the configuration file for any applications (such as <a href="#allmon3">Allmon3</a>) that use the AMI to interact with Asterisk.</p>
<h2 id="user-guide-passwords-web-applications-eg-allmon3">Web Applications (e.g. <a href="#allmon3">Allmon3</a>)</h2>
<p>Many users will install one (or more) web applications that monitor/control their ASL nodes. These applications can provide access to many users on the web, and those users may have no relation to those who setup/administer/use your systems. As such, these applications typically maintain their own list of users and associated passwords.</p>
<p>Please refer to the web application's instructions for information on how to manage who is allowed access to the web pages.</p>
<p>Also, as mentioned above, many of these applications use AMI to interact with your Asterisk and your nodes. The web application instructions should have information on where to specify the AMI credentials.</p></section><section class="print-page" id="user-guide-updates"><h1 id="user-guide-updates-updating-asl3">Updating ASL3</h1>
<p>All of the software components that make up ASL3 are provided by software packages (Debian <code>.deb</code> files) from an centralized Apt repository. This makes upgrades quick and painless for users.</p>
<h2 id="user-guide-updates-standard-debian-upgrades">Standard Debian Upgrades</h2>
<p>Whether ASL3 is installed on a standard Debian 12 installation or you are using the Pi Appliance image, updates follow the standard Debian format:</p>
<div class="highlight"><pre><span></span><code>sudo apt update
sudo apt upgrade -y
</code></pre></div>
<p>This will update all ASL3 software as well as the underlying operating system. AllStarLink will never release any update that is a "breaking change" through the <code>apt</code> system that doesn't have either an automated upgrade process or a well-documented manual step-by-step process.</p>
<p>A reboot is only needed when a new Linux kernel has been installed.</p>
<p>Sometimes an update may ask what to do with a configuration file. It is generally best to answer such questions with <code>N</code> meaning, "keep your currently-installed version". Such a question will look like:</p>
<div class="highlight"><pre><span></span><code>Configuration file &#39;/etc/asterisk/rpt.conf&#39;
 ==&gt; Modified (by you or by a script) since installation.
 ==&gt; Package distributor has shipped an updated version.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer&#39;s version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** rpt.conf (Y/I/N/O/D/Z) [default=N] ? N
</code></pre></div>
<p>AllStarLink will clearly announce when there is a change that may break existing configurations.</p>
<p>If you want updates to install without any questions being asked specify the <code>DEBIAN_FRONTEND=noninteractive</code> variable:</p>
<div class="highlight"><pre><span></span><code>DEBIAN_FRONTEND=noninteractive sudo apt update
DEBIAN_FRONTEND=noninteractive sudo apt upgrade -y
</code></pre></div>
<p>Using this command will automatically choose <code>N</code> to any question about configuration - i.e. it will always keep your installed version.</p>
<h2 id="user-guide-updates-note-on-dahdi">Note on DAHDI</h2>
<p>In the past, managing the DAHDI kernel module needed by <code>app_rpt</code> had been problematic during kernel upgrades. Previously, the recommendation had been to never upgrade
the kernel. <strong>This advice is no longer valid and should not be followed for security and practicality reasons.</strong></p>
<p>ASL3 automatically manages and rebuilds the DAHDI kernel modules during software updates using the DKMS system. After an upgrade, rebooting into a new version of the Linux kernel will "just work".</p>
<p>If, for some strange reason, you need to manually rebuild and install the DAHDI kernel modules, try the following:</p>
<div class="highlight"><pre><span></span><code>sudo apt install -y --reinstall dahdi-linux dahdi-dkms
</code></pre></div></section><section class="print-page" id="user-guide-support"><h1 id="user-guide-support-asl3-support">ASL3 Support</h1>
<h2 id="user-guide-support-support">Support</h2>
<p>Primary support for all versions of ASL (including ASL3) continues to be the <a href="https://community.allstarlink.org/">AllStarLink Community</a>.</p>
<p>Please do not use the ASL Helpdesk for technical help. Support for ASL3 will NOT be handled by the ASL Helpdesk. All Helpdesk tickets will be closed with a referral to the <a href="https://community.allstarlink.org/">AllStarLink Community</a> or the <a href="https://github.com/AllStarLink">AllStarLink GitHub</a>.</p>
<p>See <a href="#user-guide-troubleshooting">Basic Troubleshooting Tips</a> in this section for further information on what information is necessary to effectively get support.</p>
<h2 id="user-guide-support-bug-reporting">Bug Reporting</h2>
<p>Bug reports for ASL3 and surrounding issues are best handled through GitHub "Issues" to the source code projects at <a href="https://github.com/AllStarLink">AllStarLink GitHub</a>.</p>
<p>Check the following locations to see if your issue has already been reported:</p>
<ul>
<li><a href="https://github.com/AllStarLink/ASL3/issues">ASL3 Issues</a></li>
<li><a href="https://github.com/AllStarLink/app_rpt/issues">Asterisk/app_rpt Issues</a></li>
<li><a href="https://github.com/AllStarLink/asl3-menu/issues">asl3-menu Issues</a></li>
<li><a href="https://github.com/AllStarLink/Allmon3/issues">Allmon3 Issues</a></li>
</ul>
<p>There are numerous ASL3 repositories. If you're not sure which repository to use for reporting a given issue then start at <a href="https://github.com/AllStarLink/ASL3">ASL3</a>. You can also ask for guidance in the <a href="https://community.allstarlink.org/">AllStarLink Community</a>.</p>
<p>When reporting an issue we ask that you be comfortable enough with Linux to edit files, restart services, and perhaps copy a potentially fixed file onto your system.</p>
<div class="admonition note">
<p class="admonition-title">GitHub Account Required</p>
<p>To raise issues about ASL3 problems and interact with the developers you must create (or use an existing) GitHub account.</p>
</div>
<h2 id="user-guide-support-enhancement-requests">Enhancement Requests</h2>
<p>Obviously, we cannot promise anything but we do want to hear your ideas. Please file a GitHub "Issue" :-)</p>
<h2 id="user-guide-support-contributing">Contributing</h2>
<p>Have you identified a problem and have a solution? We welcome your help. Please file a GitHub Issue with all the details. Even better, create a GitHub "Pull Request" for us to review.</p></section><section class="print-page" id="user-guide-troubleshooting"><h1 id="user-guide-troubleshooting-basic-troubleshooting-tips">Basic Troubleshooting Tips</h1>
<p>When asking for help on <a href="https://community.allstarlink.org">AllStarLink Community</a> or in a <a href="https://github.com/AllStarLink">GitHub</a> Issue here are some tips on how to ask for help and how to get common troubleshooting information that is often needed to understand your specific issues.</p>
<h2 id="user-guide-troubleshooting-tips-on-asking-for-help">Tips on Asking for Help</h2>
<p>Keep in mind that when asking for help, the pool of people likely able to help have no understanding of your personal setup, situation, skills, etc. In order to get good help, you need to ask a good question. Make sure when asking for help that you hit the following points:</p>
<h4 id="user-guide-troubleshooting-explain-precisely-what-is-not-working-properly">Explain <strong>Precisely</strong> What is not Working Properly</h4>
<p>Requests for help such as "ASL doesn't work" or "my Pi crashes" or "I can't do X" without any further details or information is unable to be diagnosed and assisted.</p>
<p>Examples of <strong>GOOD</strong> ways to ask a question:</p>
<ul>
<li>
<p>I just built a new ASL3 Pi and when I try to connect to the interface I get <strong>this particular</strong> error.</p>
</li>
<li>
<p>After I configured my node, I am trying to do <strong>this particular thing</strong> and it doesn't work because of <strong>this particular error</strong>.</p>
</li>
<li>
<p>I am trying to configure <strong>this particular feature</strong> in <code>rpt.conf</code> and when I do, <strong>this particular thing</strong> happens.</p>
</li>
<li>
<p>I used to be able to do <strong>this thing</strong> and after I change <strong>this other thing</strong> then <strong>this thing</strong> stopped working.</p>
</li>
</ul>
<p>Basically, before submitting your question to Community, make sure your post contains the basics of "what am I trying to do", "what do I think should be happening", and "what is happening instead". If you are filing an issue on GitHub, use the Issue Templates - they ask for information for a reason.</p>
<h4 id="user-guide-troubleshooting-be-ready-to-provide-requested-basic-troubleshooting-info">Be Ready to Provide Requested Basic Troubleshooting Info</h4>
<p>If you are going to ask for help, be ready and willing to provide the basic troubleshooting information that is requested. For example, if you're having a problem linking to another node, be ready to provide - or even better provide in advance - the basic troubleshooting information needed to help with your problem.</p>
<p>Items that may be requested include elements such as:</p>
<ul>
<li>
<p>How is your node connected to the Internet?</p>
</li>
<li>
<p>What IAX2 port is configured?</p>
</li>
<li>
<p>What client are you using?</p>
</li>
<li>
<p>What radio type are you using?</p>
</li>
<li>
<p>What is your IP address?</p>
</li>
<li>
<p>Is the time correct on your system?</p>
</li>
<li>
<p>Can you put a monitor on the device and tell what the screen says</p>
</li>
<li>
<p>What did the log say about...?</p>
</li>
</ul>
<h4 id="user-guide-troubleshooting-allstarlink-does-not-support-certain-other-projectstools">AllStarLink Does Not Support Certain Other Projects/Tools</h4>
<p>Core AllStarLink does not support certain other projects/tools such as HamVOIP, Supermon/Supermon2, SkyWarnPlus, or AllScan. Some of the developers of these tools such as SkyWarnPlus and AllScan are active and answer questions on the Community, and others are not.</p>
<p>If you are told, "that isn't supported but have you tried doing it in this supported way", consider giving it a try. </p>
<h4 id="user-guide-troubleshooting-allstarlink-v3-contains-14-years-of-changes">AllStarLink v3 Contains 14+ Years of Changes</h4>
<p>The release of AllStarLink v3 uses modern Asterisk 20 LTS. Legacy installs use Asterisk 1.4 which was end of life in 2012. Thus, there are literally 14+ years of changes of how Asterisk operates that <code>app_rpt</code> (the main engine behind ASL) had to conform to. Notably, the configuration syntax which changed gradually over time for users staying current with Asterisk, is an "all of a sudden" change in ASL3. One cannot paste old configurations into modern ASL3 and expect it to "just work".</p>
<p>Additionally, Asterisk no longer runs as the root user on Linux which means that its ability to do things to the system such as make OS changes is purposefully restricted. ASL3 and Asterisk are very security conscious as many of our users run ASL3 systems on the open Internet.</p>
<h4 id="user-guide-troubleshooting-give-questioners-the-benefit-of-the-doubt">Give Questioners the Benefit of the Doubt</h4>
<p>In general, if people are asking questions about the details of your problem, they are likely trying to help and not nitpick. In general, if many people are having the problem, it is already known and <a href="#basics-incompatibles-known-issues">likely documented</a>.</p>
<p>If it's not, then likely your issue is unique to your setup and providing the requested troubleshooting is needed to help you further.</p>
<h2 id="user-guide-troubleshooting-basic-troubleshooting">Basic Troubleshooting</h2>
<h3 id="user-guide-troubleshooting-gathering-logs">Gathering Logs</h3>
<p>If you are asked to provide logs, there are two standard ways to provide logs, using <a href="#pi-cockpit-basics"><code>Cockpit</code></a> or using the <code>journalctl</code> tool from the 
Linux CLI.</p>
<h4 id="user-guide-troubleshooting-gathering-logs-with-cockpit">Gathering Logs with Cockpit</h4>
<p>In the <a href="#pi-cockpit-basics">Cockpit interface</a>, click <strong>Services</strong> on the left navbar. The service list will display. Wait for the full list to load and then click
on the blue link name of the service. The common services are:</p>
<ul>
<li>
<p><code>allmon3</code> - Allmon3</p>
</li>
<li>
<p><code>asl3-update-astdb</code> - Maintenance of the <code>astdb.txt</code> file used by third-party apps</p>
</li>
<li>
<p><code>asl3-update-nodelist</code> - Maintenance of the "file" based lookup database, if installed</p>
</li>
<li>
<p><code>asterisk</code> - Core <code>Asterisk/app_rpt</code></p>
</li>
<li>
<p><code>networking</code> - Information about network interfaces</p>
</li>
<li>
<p><code>NetworkManager</code> - Information about network items of all sorts</p>
</li>
<li>
<p><code>systemd-timesyncd</code> - Information about network time synchronization</p>
</li>
</ul>
<p>After clicking on one of the links, wait until <strong>Service logs</strong> fills in and then view the logs. Clicking <strong>View all logs</strong> will show more logs.</p>
<h4 id="user-guide-troubleshooting-gathering-logs-with-clissh">Gathering Logs with CLI/SSH</h4>
<p>Use the <code>journalctl -xeu</code> command to provide logging output. For example:</p>
<div class="highlight"><pre><span></span><code>journalctl -xeu asterisk.service
</code></pre></div>
<p>Common services are:</p>
<ul>
<li>
<p><code>allmon3.service</code> - Allmon3</p>
</li>
<li>
<p><code>asl3-update-astdb.service</code> - Maintenance of the <code>astdb.txt</code> file used by third-party apps</p>
</li>
<li>
<p><code>asl3-update-nodelist.service</code> - Maintenance of the "file" based lookup database, if installed</p>
</li>
<li>
<p><code>asterisk.service</code> - Core <code>Asterisk/app_rpt</code></p>
</li>
<li>
<p><code>networking.service</code> - Information about network interfaces</p>
</li>
<li>
<p><code>NetworkManager.service</code> - Information about network items of all sorts</p>
</li>
<li>
<p><code>systemd-timesyncd.service</code> - Information about network time synchronization</p>
</li>
</ul>
<h3 id="user-guide-troubleshooting-gathering-configs">Gathering Configs</h3>
<p>It is often needed to gather certain configuration details. Use the <a href="#pi-cockpit-console">Cockpit Console</a> or the SSH/CLI interface. People asking for information will likely provide the filename needed in their request. However, here are some easy ways to get the data requested:</p>
<ul>
<li>
<p><code>tail -n50 FILE</code> - Print the last 50 lines of <code>FILE</code></p>
</li>
<li>
<p><code>tail -F FILE</code> - Print the output of <code>FILE</code> as it is written to (useful for watching logs
live). Press Ctrl+c to exit</p>
</li>
<li>
<p><code>more FILE</code> - Print <code>FILE</code> by pages</p>
</li>
<li>
<p><code>less FILE</code> - Less is more than more... Less is an interactive scroller and searching interface. For example typing <code>/SOMETHING</code> will search for the string "SOMETHING" forward from where you are in the file and <code>?SOMETHING</code> will search backwards. Enter CTRL+c to exit</p>
</li>
<li>
<p><code>grep SOMETHING FILE</code> - This is for basic searching within a file. For example, you can use <code>grep</code> to answer the question "what does the line with FOO in FILE say?". This command
would be <code>grep FOO FILE</code>. Note that by default, your <code>grep</code> searches are case-sensitive, use the <code>-i</code> flag for case-insensitive searches, i.e. <code>grep -i FOO FILE</code> will find all instances of "foo", "FOO", "FoO", etc. </p>
</li>
</ul>
<p>When possible, please copy/paste log and search text instead of attaching screenshots into systems for troubleshooting. Text is far easier to deal with (can be quoted in replies), and will make your trouble show up in search engines to help "the next person".</p></section><section class="print-page" id="user-guide-betatest"><h1 id="user-guide-betatest-beta-testing">Beta Testing</h1>
<p>Beta testing is the final phase of software testing before releasing a product to the general public. During this stage, a group of users representing the target audience
validates the product. They explore its features, uncover bugs, and provide feedback.</p>
<p>AllStarLink releases software packages to a beta channel on a periodic basis to address bug fixes and feature enhancements. The beta channel of packages is available to all users. However, please only select to run packages from the beta channel if you meet the following criteria:</p>
<ol>
<li>
<p>If something goes wrong, your can easily recover your node from backups or other saved configuration</p>
</li>
<li>
<p>You have generalized Linux skills such as understanding basic commands, ability to use the shell terminal of Linux, ability to copy/paste output data into bug reports, etc.</p>
</li>
<li>
<p>You acknowledge that a beta release may have other bugs, incomplete fixes, or may in rare cases not work right at all <em>for your configuration</em> and that you can live with this</p>
</li>
<li>
<p>You may need to edit configuration files to fix issues or test things or to roll back to previous versions of software</p>
</li>
</ol>
<p>If you cannot adhere to the above four conditions, you should not use the beta channel software.</p>
<h2 id="user-guide-betatest-enabling-beta-channel-software">Enabling Beta Channel Software</h2>
<p>Enabling beta channel software is done with the <code>asl-repo-switch</code> command as <code>root</code>. Set the channel to "beta" using <code>asl-repo-switch -l beta</code>. For example:</p>
<div class="highlight"><pre><span></span><code>bash
# asl-repo-switch -l beta
Setting level beta... DONE
Run &#39;apt update&#39; to refresh the package repo cache.
</code></pre></div>
<h2 id="user-guide-betatest-disabling-beta-channel-software">Disabling Beta Channel Software</h2>
<p>Disabling beta channel software is done with the <code>asl-repo-switch</code> command as <code>root</code>. Set the channel to "main" using <code>asl-repo-switch -l main</code>.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>bash
# asl-repo-switch -l main
Setting level main... DONE
Run &#39;apt update&#39; to refresh the package repo cache.
</code></pre></div>
<h2 id="user-guide-betatest-installing-updates-using-beta-channel">Installing Updates Using Beta Channel</h2>
<p>The most common case to use the beta channel for software packages is to test a proposed fix to a problem you are having. In those cases, the following commands should be run <strong>one at a time</strong> from a terminal/console as <code>root</code> (using <code>sudo</code> or <code>sudo -s</code>):</p>
<div class="highlight"><pre><span></span><code>sudo asl-repo-switch -l beta
sudo apt update
sudo apt upgrade -y
sudo asl-repo-switch -l main
</code></pre></div>
<p>This will do a one-time installation of the packages in the beta channel and then switch back to main.</p>
<h2 id="user-guide-betatest-resetting-installation-of-asl-back-to-production">Resetting Installation of ASL Back to Production</h2>
<p>To reset your packages for ASL3 back to the production-release main versions:</p>
<p>For Pi Appliances:</p>
<div class="highlight"><pre><span></span><code>sudo asl-repo-switch -r
sudo apt update
sudo apt install -y --reinstall asl3 asl3-asterisk asl3-asterisk-config \
  asl3-asterisk-modules asl3-menu asl3-update-nodelist \
  asl3-pi-appliance allmon3
</code></pre></div>
<p>For Debian 12 general installations:</p>
<div class="highlight"><pre><span></span><code>sudo asl-repo-switch -r
sudo apt update
sudo apt install -y --reinstall asl3 asl3-asterisk asl3-asterisk-config \
  asl3-asterisk-modules asl3-menu asl3-update-nodelist
</code></pre></div>
<p>For DAHDI Kernel packages after doing the above, as necessary:</p>
<div class="highlight"><pre><span></span><code>sudo apt install -y --reinstall dahdi-linux dahdi-dkms
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Issues Rolling Back</p>
<p>You may need to merge or fix configurations when rolling back from beta software to production. This is unusual but possible.</p>
</div></section>
                        <h2 class='nav-section-title' id='section--span-style-color-hsl-86-28-71-6-33-14-pi-appliance-specifics-cockpit-span-'>
                            <span style="color:hsl(86.28, 71.6%, 33.14%)">Pi Appliance Specifics (Cockpit)</span> <a class='headerlink' href='#section--span-style-color-hsl-86-28-71-6-33-14-pi-appliance-specifics-cockpit-span-' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="pi"><h1 id="pi-pi-appliance-specifics-cockpit">Pi Appliance Specifics (Cockpit)</h1>
<p>ASL3 features a modern appliance of AllStarLink while retaining the ubiquitous Raspberry Pi experience that's well-documented and familiar to the amateur radio
community worldwide.</p>
<h2 id="pi-what-is-the-cockpit-web-console">What is the Cockpit Web Console?</h2>
<p>The <code>Cockpit</code> web console is a web-based interface designed for managing and monitoring your AllStarLink Pi Appliance.</p>
<p>The <code>Cockpit</code> web console enables you to perform a wide range of administration tasks, including:</p>
<ul>
<li>Managing AllStarLink, Asterisk, and its related applications</li>
<li>Managing services</li>
<li>Managing user accounts</li>
<li>Managing and monitoring system services</li>
<li>Configuring network interfaces</li>
<li>Reviewing system logs</li>
<li>Updating software  </li>
</ul>
<p>The <code>Cockpit</code> web console uses the same system concepts as you would use in a terminal, and actions performed in a terminal are immediately reflected in the <code>Cockpit</code> web console. That is to say, you can use <code>Cockpit</code> and an SSH connection interchangeably as you desire.</p>
<p>You can monitor the logs of application. In addition, you can change the settings directly in the web console or through the terminal. </p></section><section class="print-page" id="pi-cockpit-get-started"><h1 id="pi-cockpit-get-started-cockpit-web-admin-interface">Cockpit Web Admin Interface</h1>
<p>The AllStarLink Pi Appliance includes the user-friendly <code>Cockpit</code> system for ease of administration. <code>Cockpit</code> is accessed on port <code>9090</code> of the appliance. In these examples the hostname <code>node63001</code> is used and should be replaced with the name you set during setup. If the name <code>node63001</code> was used at setup, then pointing a browser to <code>https://node63001.local:9090/</code> will bring up the <code>Cockpit</code> interface. </p>
<p><strong>NOTE:</strong> The hostname only works when your node and your PC are on the same LAN. Otherwise, use the IP or DNS name you assigned. Login is the <code>username</code> and <code>password</code> that was setup during the Pi imaging process.</p>
<p>The first connection will report a message that "Your connection isn't private". For the Pi appliance, this is acceptable. Click on <strong>Advanced</strong> and then
<strong>Continue to node63001.local (unsafe)</strong>. This only must be done the first time.</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Browser Warning" src="../install/pi-appliance/img/step-20.png" /></a></p>
<p>Enter the <code>username</code> and <code>password</code> configured during the imaging process above. Click <strong>Log in</strong></p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-22.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Cockpit Login" src="../install/pi-appliance/img/step-22.png" /></a></p>
<p><code>Cockpit</code> is fairly intuitive to use, the rest of this section will cover different features of the <code>Cockpit</code> console in further detail.</p></section><section class="print-page" id="pi-cockpit-basics"><h1 id="pi-cockpit-basics-cockpit-basics">Cockpit Basics</h1>
<p>Throughout this documentation a host named <code>node63001.local</code> is used as the example host. Substitute that name with your own node's name as it was set during the imaging process.</p>
<h2 id="pi-cockpit-basics-logging-in-to-the-web-console">Logging In to the Web Console</h2>
<ol>
<li>
<p>In your web browser, enter the following address to access the web console: <code>https://node63001.local:9090</code></p>
</li>
<li>
<p>The browser may display a warning. Accept the security exception to proceed with the login</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Login" src="../install/pi-appliance/img/step-20.png" /></a></p>
</li>
<li>
<p>Enter the username and password set during the imaging process</p>
<p><a class="glightbox" href="../install/pi-appliance/img/step-22.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Login" src="../install/pi-appliance/img/step-22.png" /></a></p>
</li>
<li>
<p>Click <strong>Log In</strong></p>
</li>
</ol>
<h2 id="pi-cockpit-basics-administrative-access">Administrative Access</h2>
<p>The web console has a concept of Administrative access. While it does remember the access level across logins, to access certain functions you may need to enable Administrative access from Limited access.</p>
<p>To do that:</p>
<ol>
<li>
<p>Click on the bar marked <strong>Limited Access</strong> to enable admin-level access.</p>
<p><a class="glightbox" href="../pi/img/limited_access-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Limited Access" src="../pi/img/limited_access-1.png" /></a>
You may be prompted to to enter the password again. Do so and then click <strong>Authenticate</strong>
<a class="glightbox" href="../pi/img/limited_access-2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 23B" src="../pi/img/limited_access-2.png" /></a></p>
</li>
<li>
<p>Click <strong>Close</strong> on the box reporting administrative access has been granted.</p>
</li>
</ol>
<h2 id="pi-cockpit-basics-shutting-down-the-appliance">Shutting Down the Appliance</h2>
<p>You can use the web console to shut down the system.</p>
<ol>
<li>
<p>Log into the web console.</p>
</li>
<li>
<p>(optional) Click on the bar marked <strong>Limited Access</strong> to enable admin-level access.</p>
<p><a class="glightbox" href="../pi/img/limited_access-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Limited Access" src="../pi/img/limited_access-1.png" /></a></p>
</li>
<li>
<p>(optional) Click <strong>Close</strong> on the box reporting administrative access has been granted.</p>
</li>
<li>
<p>Click on the downward arrow next to Reboot and then select <strong>Shutdown</strong></p>
<p><a class="glightbox" href="../pi/img/cockpit_shutdown.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Shutdown" src="../pi/img/cockpit_shutdown.png" /></a></p>
</li>
<li>
<p>Change the <strong>Delay</strong> dropdown to <strong>No delay</strong> and click <strong>Shut down</strong></p>
<p><a class="glightbox" href="../pi/img/cockpit_shutdown2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Shutdown2" src="../pi/img/cockpit_shutdown2.png" /></a></p>
</li>
<li>
<p>A <strong>Disconnected</strong> message will appear. The node will shutdown is about 15-30 seconds, after which power may be removed.</p>
</li>
</ol>
<h2 id="pi-cockpit-basics-rebooting-the-appliance">Rebooting the Appliance</h2>
<ol>
<li>
<p>Log into the web console.</p>
</li>
<li>
<p>(optional) Click on the bar marked <strong>Limited Access</strong> to enable admin-level access.</p>
<p><a class="glightbox" href="../pi/img/limited_access-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Limited Access" src="../pi/img/limited_access-1.png" /></a></p>
</li>
<li>
<p>(optional) Click <strong>Close</strong> on the box reporting administrative access has been granted.</p>
</li>
<li>
<p>Click on Reboot</p>
<p><a class="glightbox" href="../pi/img/cockpit_reboot.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Shutdown" src="../pi/img/cockpit_reboot.png" /></a></p>
</li>
<li>
<p>Change the <strong>Delay</strong> dropdown to <strong>No delay</strong> and click <strong>Reboot</strong></p>
<p><a class="glightbox" href="../pi/img/cockpit_reboot2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Shutdown2" src="../pi/img/cockpit_reboot2.png" /></a></p>
</li>
<li>
<p>A <strong>Disconnected</strong> message will appear. The node will reboot and be available again in about 15-30 seconds. After that, one can click <strong>Reconnect</strong>.</p>
</li>
</ol>
<h2 id="pi-cockpit-basics-configuring-time-on-the-appliance">Configuring Time on the Appliance</h2>
<p>In general, the appliance should be left in the default setting of using the NTP service to automatically set the time. However, you may want to change the timezone. To change the time:</p>
<ol>
<li>
<p>Log into the web console.</p>
</li>
<li>
<p>(optional) Click on the bar marked <strong>Limited Access</strong> to enable admin-level access.</p>
<p><a class="glightbox" href="../pi/img/limited_access-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Limited Access" src="../pi/img/limited_access-1.png" /></a></p>
</li>
<li>
<p>(optional) Click <strong>Close</strong> on the box reporting administrative access has been granted.</p>
</li>
<li>
<p>Click on Overview and scroll down to <strong>Configuration</strong></p>
</li>
<li>
<p>Click on highlighted time next to <strong>System time</strong></p>
</li>
<li>
<p>Change the <strong>Time zone</strong> drop-down to the desired zone.</p>
</li>
<li>
<p>Click <strong>Change</strong>.</p>
</li>
</ol>
<hr />
<p><strong>NOTE:</strong> Some content copied from 
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/index"><strong>Managing systems using the RHEL9 web console</strong></a> which is released under the Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA")</p></section><section class="print-page" id="pi-cockpit-console"><h1 id="pi-cockpit-console-terminal-console">Terminal / Console</h1>
<p>The <code>Cockpit</code> web console provides a feature-complete terminal interface in the web browser without requiring setup and configuration of an SSH client. This allows administration of the node from anywhere!</p>
<p>Use of the web console Terminal and an SSH client is fully interactive and interchangeable.</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Terminal</strong> in the web console menu on the left</p>
</li>
<li>
<p>You will be connected to a terminal of the user that you logged in with</p>
<p><a class="glightbox" href="../pi/img/cockpit_terminal_user.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Terminal User" src="../pi/img/cockpit_terminal_user.png" /></a></p>
</li>
<li>
<p>To execute commands as root, either prefix the command with <code>sudo</code>:</p>
<p><a class="glightbox" href="../pi/img/cockpit_terminal_sudo.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Terminal User" src="../pi/img/cockpit_terminal_sudo.png" /></a></p>
</li>
<li>
<p>One can enter a root session completely by issuing the command <code>sudo -s</code>:</p>
<p><a class="glightbox" href="../pi/img/cockpit_terminal_sudo-s.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Terminal User" src="../pi/img/cockpit_terminal_sudo-s.png" /></a></p>
</li>
</ol>
<hr />
<p><strong>NOTE:</strong> Some content copied from 
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/index"><strong>Managing systems using the RHEL9 web console</strong></a> which is released under the Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA")</p></section><section class="print-page" id="pi-cockpit-network"><h1 id="pi-cockpit-network-network-configuration">Network Configuration</h1>
<p>The Networking system tool in the web console permits viewing the status of the network as well as making network configuration changes to the appliance.</p>
<h2 id="pi-cockpit-network-observing-network-status-and-configuration">Observing Network Status and Configuration</h2>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Networking</strong> in the web console menu on the left</p>
</li>
<li>
<p>At the top of the screen will be the network data statistics for transmitted and receiving network traffic. This information can be helpful if there are questions about network bandwidth utilization:</p>
<p><a class="glightbox" href="../pi/img/cockpit_network_utilize.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Network utilization" src="../pi/img/cockpit_network_utilize.png" /></a></p>
</li>
<li>
<p>The next panel down shows the current configuration of the present network adapters:</p>
<p><a class="glightbox" href="../pi/img/cockpit_network_adapters.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Adapter configuration" src="../pi/img/cockpit_network_adapters.png" /></a></p>
</li>
<li>
<p>Finally, at the bottom is the logs about the current state of the network:</p>
<p><a class="glightbox" href="../pi/img/cockpit_network_logs.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Adapter configuration" src="../pi/img/cockpit_network_logs.png" /></a></p>
</li>
</ol>
<h2 id="pi-cockpit-network-changing-adapter-settings">Changing Adapter Settings</h2>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Networking</strong> in the web console menu on the left</p>
</li>
<li>
<p>Scroll down to the <strong>Interfaces</strong> section</p>
</li>
<li>
<p>Click on the <strong>Name</strong> of the interface</p>
</li>
<li>
<p>Make desired changes</p>
</li>
<li>
<p>Changes take place immediately. Be cautious when changing IP addressing because you may accidentally remove your ability to access to the console.</p>
</li>
</ol>
<h2 id="pi-cockpit-network-changing-wifi-settings">Changing WiFi Settings</h2>
<p>Unfortunately, <code>Cockpit</code> does not have an interface for managing WiFi networks with in it. Currently WiFi network changes must be made from the web console Terminal screen.</p>
<h3 id="pi-cockpit-network-listing-existing-wifi-networks">Listing Existing WiFi Networks</h3>
<p>List the existing WiFi network(s) with <code>nmcli device wifi list</code>:</p>
<p><a class="glightbox" href="../pi/img/cockpit_wifi1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Display Wifi" src="../pi/img/cockpit_wifi1.png" /></a></p>
<h3 id="pi-cockpit-network-add-a-wifi-network">Add a WiFi Network</h3>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Terminal</strong> in the web console menu on the left</p>
</li>
<li>
<p>At the prompt enter the command:</p>
<div class="highlight"><pre><span></span><code>nmcli device wifi connect MYNETWORK password MYPASSWORD
</code></pre></div>
<p>where <code>MYNETWORK</code> is the name ("SSID") and <code>MYPASSWORD</code> is the password ("Key"). To join the network <code>RadioSite</code> with the password <code>RF1234</code>:</p>
<div class="highlight"><pre><span></span><code>nmcli device wifi connect RadioSite password RF1234
</code></pre></div>
<p>If there is a space in the name or password, you must use quotes around the element with the space in it.</p>
</li>
<li>
<p>If the network is not currently active (i.e. adding a network where the appliance will be in the future) or the SSID is hidden, adding is slightly more complicated. Again, substitute <code>MYNETWORK</code> and <code>MYPASSWORD</code> with as appropriate.</p>
<div class="highlight"><pre><span></span><code>nmcli conn add type wifi con-name MYNETWORK ifname wlan0 ssid MYPASSWORD
nmcli conn modify MYNETWORK wifi-sec.key-mgmt wpa-psk wifi-sec.psk MYPASSWORD
</code></pre></div>
</li>
</ol>
<p><strong>NOTE:</strong> DO NOT use the <code>raspi-config</code> tool to attempt to set the Wifi network and
password. This will break the appliance's networking.</p>
<hr />
<p><strong>NOTE:</strong> Some content copied from 
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/index"><strong>Managing systems using the RHEL9 web console</strong></a> which is released under the Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA")</p></section><section class="print-page" id="pi-cockpit-updates"><h1 id="pi-cockpit-updates-software-updates">Software Updates</h1>
<p>The Software updates tool in the web console is how to install package updates to the AlLStarLink Pi appliance. This includes updating AllStarLink software and its associated
items.</p>
<h1 id="pi-cockpit-updates-checking-for-and-installing-updates">Checking For and Installing Updates</h1>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Software Updates</strong> in the web console menu on the left</p>
</li>
<li>
<p>Click on the cycle icon in the upper right of the panel</p>
<p><a class="glightbox" href="../pi/img/cockpit_softups1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Software updates 1" src="../pi/img/cockpit_softups1.png" /></a></p>
</li>
<li>
<p>Available updates will be displayed. Click on <strong>Install all updates</strong></p>
<p><a class="glightbox" href="../pi/img/cockpit_softups2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Software updates 2" src="../pi/img/cockpit_softups2.png" /></a></p>
</li>
<li>
<p>The updates will start. Depending on the quantity of updates, the speed of the Pi hardware, and how long certain installs take, this may take quite a while to complete. For example, if there is a Linux kernel update, then the DAHDI package will be recompiled for the new kernel which can take up to 10 minutes. Be patient while updates run. You can observe the updates by clicking on <strong>View update log</strong></p>
<p><a class="glightbox" href="../pi/img/cockpit_softups3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Software updates 2" src="../pi/img/cockpit_softups3.png" /></a></p>
</li>
<li>
<p>When the updates are complete, you will be prompted to reboot the system. In general, it is advised to reboot the system after updates, however that is not necessarily required for most updates. Kernel updates and DAHDI updates DO require a reboot</p>
<p><a class="glightbox" href="../pi/img/cockpit_softups4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Software updates 2" src="../pi/img/cockpit_softups4.png" /></a></p>
</li>
<li>
<p>After the updates are completed, returning to the <strong>Software Updates</strong> screen should show that the software is up to date</p>
<p><a class="glightbox" href="../pi/img/cockpit_softups5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Software updates 2" src="../pi/img/cockpit_softups5.png" /></a></p>
</li>
</ol></section><section class="print-page" id="pi-cockpit-services"><h1 id="pi-cockpit-services-services-management">Services Management</h1>
<p>The <code>Cockpit</code> web console allows the management of all of the running services. You can activate or deactivate services, restart or reload them, or manage their automatic startup.</p>
<h2 id="pi-cockpit-services-start-stop-and-restart-services">Start, Stop, and Restart Services</h2>
<p>This procedure stops or starts system services using the web console interface. You can filter the services by name or description and also by Enabled, Disabled, or Static automatic startup. The interface shows the current state of the service and its recent logs.</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Services</strong> in the web console menu on the left. The default tab for <strong>Services</strong> is <strong>System Services</strong>. If you want to manage targets, sockets, timers, or paths, switch to the respective tab in the menu on top. To open service settings, click on a selected service from the list. You can tell which services are active or inactive by checking the <strong>State</strong> column</p>
</li>
<li>
<p>To start an inactive service, click the <strong>Start</strong> button</p>
<p><a class="glightbox" href="../pi/img/cockpit_service_start.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Service Enable" src="../pi/img/cockpit_service_start.png" /></a></p>
</li>
<li>
<p>To deactivate an active service, click the <strong>Stop</strong> button</p>
<p><a class="glightbox" href="../pi/img/cockpit_service_stop.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Service Enable" src="../pi/img/cockpit_service_stop.png" /></a></p>
</li>
<li>
<p>To restart a service, click the <strong>Restart</strong> button</p>
<p><a class="glightbox" href="../pi/img/cockpit_service_restart.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Service Enable" src="../pi/img/cockpit_service_restart.png" /></a></p>
</li>
</ol>
<h2 id="pi-cockpit-services-seeing-status-and-recent-logs-of-a-service">Seeing Status and Recent Logs of a Service</h2>
<p>This procedure stops or starts system services using the web console interface. You can filter the services by name or description and also by Enabled, Disabled, or Static automatic startup. The interface shows the current state of the service and its recent logs.</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Services</strong> in the web console menu on the left. The default tab for <strong>Services</strong> is <strong>System Services</strong>. If you want to manage targets, sockets, timers, or paths, switch to the respective tab in the menu on top. To open service settings, click on a selected service from the list. You can tell which services are active or inactive by checking the <strong>State</strong> column</p>
</li>
<li>
<p>Scroll down to see <strong>Service logs</strong>. The button <strong>View All Logs</strong> can be clicked to review an extensive output of the service's logs</p>
<p><a class="glightbox" href="../pi/img/cockpit_service_logs.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Service Enable" src="../pi/img/cockpit_service_logs.png" /></a></p>
</li>
</ol>
<hr />
<p><strong>NOTE:</strong> Some content copied from 
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/index"><strong>Managing systems using the RHEL9 web console</strong></a> which is released under the Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA")</p></section><section class="print-page" id="pi-cockpit-firewall"><h1 id="pi-cockpit-firewall-managing-the-firewall">Managing the Firewall</h1>
<p>A firewall is a way to protect nodes from any unwanted traffic. It enables users to control incoming network traffic on host machines by defining a set of firewall rules. These rules are used to sort the incoming traffic and either block it or allow it through. </p>
<p>In the AllStarLink Pi Appliance, the <code>firewalld</code> service with the <code>nftables</code> backend functions as the firewall. Through the web console, you can configure <code>firewalld</code>. </p>
<h1 id="pi-cockpit-firewall-adding-an-inbound-port">Adding an Inbound Port</h1>
<p>The firewall is enabled by default with a reasonable set of default rules. The most common reasons to edit the port list would be to change the IAX2 port to be outside the range of <code>4560-4580</code> (default is <code>4569</code>) or to change the VOTER port (default <code>1667</code> in ASL3, you might need <code>667</code> for <a href="#basics-incompatibles-voterrtcm-default-port">legacy reasons</a>).</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Networking</strong> in the web console menu on the left</p>
</li>
<li>
<p>Click <strong>Edit rules and zones</strong> in the <strong>Firewall</strong> panel</p>
</li>
<li>
<p>Click <strong>Custom ports</strong></p>
</li>
<li>
<p>Enter the TCP or UDP port or ports to be permitted in the <strong>TCP</strong> or <strong>UDP</strong> fields respectively. Multiple ports can be separated with commands and a range of ports can be specified with a hyphen. It is highly suggested to include a Description for the port. For example, if adding an alternative IAX2 port on <code>14569</code>:</p>
<p><a class="glightbox" href="../pi/img/cockpit_firewall_customport.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Custom Port" src="../pi/img/cockpit_firewall_customport.png" /></a></p>
</li>
<li>
<p>Click <strong>Add ports</strong></p>
</li>
<li>
<p>The change is immediate.</p>
</li>
</ol>
<h1 id="pi-cockpit-firewall-removing-an-inbound-port">Removing an Inbound Port</h1>
<p>The firewall is enabled by default with a reasonable set of default rules. If you need to remove a port from the rules list:</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Networking</strong> in the web console menu on the left</p>
</li>
<li>
<p>Click <strong>Edit rules and zones</strong> in the <strong>Firewall</strong> panel</p>
</li>
<li>
<p>Next to the service to delete, click on the three vertical dots and select <strong>Delete</strong> </p>
<p><a class="glightbox" href="../pi/img/cockpit_firewall_delport.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Custom Port" src="../pi/img/cockpit_firewall_delport.png" /></a></p>
</li>
<li>
<p>The change is immediate.</p>
</li>
</ol>
<h1 id="pi-cockpit-firewall-enabling-and-disabling">Enabling and Disabling</h1>
<p>The firewall is enabled by default with a reasonable set of default rules. Unless you are familiar with networking, DO NOT disable the firewall or make changes to it. If, for some reason, you need to disable/enable the firewall manually:</p>
<ol>
<li>
<p>Log in to the web console with administrator privileges. For details, see <a href="#pi-cockpit-basics">Cockpit Basics</a></p>
</li>
<li>
<p>Click <strong>Networking</strong> in the web console menu on the left</p>
</li>
<li>
<p>To enable the firewall, slide the toggle to the right. This is the default setting and should not be changes unless you're 100% sure of what you are doing</p>
<p><a class="glightbox" href="../pi/img/cockpit_firewall_enable.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Enable Firewall" src="../pi/img/cockpit_firewall_enable.png" /></a></p>
</li>
<li>
<p>To disable the firewall, slide the toggle to the left. Do not disable the firewall unless you're 100% sure of what you are doing</p>
<p><a class="glightbox" href="../pi/img/cockpit_firewall_disable.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Disable Firewall" src="../pi/img/cockpit_firewall_disable.png" /></a></p>
<hr />
<p><strong>NOTE:</strong> Some content copied from 
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/index"><strong>Managing systems using the RHEL9 web console</strong></a> which is released under the Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA")</p>
</li>
</ol></section><h1 class='nav-section-title-end'>Ended: <span style="color:hsl(86.28, 71.6%, 33.14%)">Pi Appliance Specifics (Cockpit)</span></h1><h1 class='nav-section-title-end'>Ended: Basic Operation</h1>
                        <h1 class='nav-section-title' id='section-advanced-topics'>
                            Advanced Topics <a class='headerlink' href='#section-advanced-topics' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="adv-topics"><h1 id="adv-topics-advanced-topics">Advanced Topics</h1>
<p>Welcome to the Advanced Topics section of the ASL3 Manual.</p>
<p>Here, you will find information on how to configure a number of the different features that ASL3 has to offer. If you are interested, you will also find some information here that provides more in-depth explanations on how things in ASL3 operate "under the hood".</p>
<p>As you may be aware, there are differences in the the way ASL3 operates compared to previous versions. Please be sure to review the <a href="#basics-commands">New Commands</a> amd <a href="#basics-incompatibles">Incompatibilities, Changes, and Known Issues</a> pages to be aware of these changes.</p></section><section class="print-page" id="adv-topics-allowdenylists"><h1 id="adv-topics-allowdenylists-allow-and-deny-lists">Allow and Deny Lists</h1>
<p>ASL3 provides a way to establish either an "allowlist" or a "denylist" to limit access to your node(s). New to ASL3 is the capability for nodes on the same server to have different lists. Unlike ASL2, no modifications or scripts are required to the configuration files and there is no need to restart or reload the server. All changes are made to the Asterisk database. As soon as you make a change it takes effect.</p>
<p>The "allowlist" allows inbound connects and blocks all others. Nodes on the same server are always allowed. If any nodes are on the "allowlist" the "denylist" is ignored.</p>
<p>These lists can easily be updated using the <a href="#user-guide"><code>asl-menu</code></a>. You can also choose to manage the lists using the Asterisk CLI. These lists were previously referred to as "whitelist" and "blacklist".</p>
<h2 id="adv-topics-allowdenylists-updating-the-access-list-with-the-asl3-menu">Updating the access list with the ASL3 Menu</h2>
<p>All changes to the node access lists can be made with the <a href="#user-guide"><code>asl-menu</code></a>.  From <a href="#user-guide"><code>asl-menu</code></a>, select <code>Node Settings</code>, select <code>AllStar Node Setup Menu</code>, select <code>Update node [your-node]</code>, and lastly select <code>Node access list</code>. Here, you will see if any node access limits have been established. You will also have the option to add, update, or remove nodes from the access lists.</p>
<h2 id="adv-topics-allowdenylists-updating-the-access-list-with-the-asterisk-cli">Updating the access list with the Asterisk CLI</h2>
<p>While not recommended, you can also use the Asterisk CLI to manipulate the node access lists.</p>
<p>One important item to note is how the "allowlist" and "denylist" databases are used. Each database entry has a <code>&lt;family&gt;</code>, <code>&lt;key&gt;</code>, and <code>&lt;value&gt;</code>.  For ASL3, the <code>&lt;family&gt;</code> would be <code>allowlist/[your-node]</code> or <code>denylist/[your-node]</code>, the <code>&lt;key&gt;</code> is the node to be allowed or denied access, and we do not use the <code>&lt;value&gt;</code>.</p>
<h3 id="adv-topics-allowdenylists-adding-nodes-to-the-allowlist">Adding nodes to the "allowlist"</h3>
<p>The "allowlist" allows inbound connects and blocks all others. Nodes on the same server are always allowed. If any nodes are on the "allowlist" then the "denylist" is ignored.</p>
<ul>
<li>Add an allowed node at the Asterisk CLI <code>&gt; database put allowlist/[your-node] [allow-node] "Our friend"</code></li>
<li>Add another allowed node with CLI <code>&gt; database put allowlist/[your-node] [another-node] "Another friend"</code></li>
</ul>
<h3 id="adv-topics-allowdenylists-adding-nodes-to-the-denylist">Adding nodes to the "denylist"</h3>
<p>The "denylist" prevents nodes from connecting to your node. A "denylist" works best if you only have a few nodes you want to block.</p>
<ul>
<li>Add a node to deny at the Asterisk CLI <code>&gt; database put denylist/[your-node] [deny-node] "Not our friend"</code></li>
<li>Add another node to deny with CLI <code>&gt; database put denylist/[your-node] [another-node] "Not our other friend"</code></li>
</ul>
<h3 id="adv-topics-allowdenylists-view-the-access-lists">View the access lists</h3>
<p>To see what nodes are in the access lists:</p>
<ul>
<li>Show entire database at the Asterisk CLI <code>&gt; database show</code></li>
<li>Show the "allowlist" for all your nodes with CLI <code>&gt; database show allowlist</code></li>
<li>Show the "allowlist" for one node with CLI <code>&gt; database show allowlist/[your-node]</code></li>
<li>Show whether one of your nodes will allow another with CLI <code>&gt; database show allowlist/[your-node] [other-node]</code></li>
</ul>
<h3 id="adv-topics-allowdenylists-removing-nodes-from-the-access-lists">Removing nodes from the access lists</h3>
<p>To remove a node from the access lists, or delete the lists entirely:</p>
<ul>
<li>Remove an allowed node at the Asterisk CLI <code>&gt; database del allowlist/[your-node] [node]</code></li>
<li>Remove the "allowlist" for your node with CLI <code>&gt; database del allowlist/[your-node]</code></li>
<li>Remove the "allowlist" for all of your nodes with CLI <code>&gt; database del allowlist</code></li>
</ul></section><section class="print-page" id="adv-topics-aprs"><h1 id="adv-topics-aprs-aprs">APRS</h1>
<p><code>app_rpt</code> can post position reports to the APRS&trade; network via the <code>app_gps</code> application. APRS is an acronym for Automatic Packet Reporting System. APRS is the registered trademark of Bob Bruninga, WB4APR (SK). <code>app_gps</code> supports standard position reports and APRStt (touchtone).</p>
<p>For fixed position nodes, like repeaters, reporting your node's position allows visiting operators to easily see the nodes/repeaters in the area. Some radios allow operators to
use the position reports to automatically tune their radios to the node's frequency.</p>
<p>You can see a map of APRS unit locations at <a href="https://aprs.to">https://aprs.to</a> or <a href="https://aprs.fi">https://aprs.fi</a>.</p>
<p>An external GPS device can be configured to receive GPS position information. This is needed for mobile nodes to post their live position. Fixed stations do not require a GPS device. <code>app_gps</code> can be configured with a default latitude, longitude, and elevation.</p>
<p><code>app_gps</code> posts position report to the global APRS-IS servers. An Internet connection is required.</p>
<h2 id="adv-topics-aprs-configuration">Configuration</h2>
<h3 id="adv-topics-aprs-enable-app_gps">Enable <code>app_gps</code></h3>
<p>To enable <code>app_gps</code>, edit <code>/etc/asterisk/modules.conf</code> and change <code>noload =&gt; app_gps.so</code> to <code>load =&gt; app_gps.so</code></p>
<h3 id="adv-topics-aprs-edit-gpsconf">Edit <code>gps.conf</code></h3>
<p>The <code>gps.conf</code> file now uses Asterisk templates. See <a href="#adv-topics-conftmpl">Templates</a> for more information.</p>
<p>Edit <code>/etc/asterisk/gps.conf</code> with your favorite editor. The configuration file is filled with comments to assist you with the configuration.</p>
<p>If you will be using a GPS device, set the <code>comport</code> and <code>baudrate</code> for your connected device. If you don't have a GPS device, <code>comport</code> should not have a value.</p>
<p>Update <code>call</code> with the node's callsign and SSID.  For example, <code>WB6NIL-1</code>. Additional information on the callsign/SSID format can be found at <a href="https://www.aprs-is.net/Connecting.aspx">https://www.aprs-is.net/Connecting.aspx</a>.</p>
<p>Update <code>password</code> with your APRS-IS password. This password is a computed number based on the callsign. You can generate the password on-line at <a href="https://n5dux.com/ham/aprs-passcode">https://n5dux.com/ham/aprs-passcode</a>.</p>
<p><strong>NOTE:</strong> This password must be correct for <code>app_gps</code> to log into the APRS-IS server.</p>
<p>The <code>gps.conf</code> contains a number of settings that configure how your node is displayed on APRS maps. The comments in the configuration file will help you configure your node.</p>
<p>The <code>comment</code> field can be used to describe your node and/or provide information about your local radio club. See the configuration file for more information.</p>
<p>You can configure the map symbol used for your node by changing the <code>icontable</code> and <code>icon</code> values. To display an "R" inside a diamond, set <code>icontable = R</code> and <code>icon = &amp;</code>. See <a href="http://www.aprs.org/symbols.html">http://www.aprs.org/symbols.html</a> for more information.</p>
<p><strong>NOTE:</strong> <code>app_gps</code> supports multiple nodes. To add additional nodes, add another section to the configuration file. For example <code>[1998](general)</code>.</p>
<h3 id="adv-topics-aprs-restart-asterisk">Restart Asterisk</h3>
<p>After making these initial changes to <code>modules.conf</code> and <code>gps.conf</code>, restart Asterisk at the command line type:</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart asterisk
</code></pre></div>
<p>Changes made to <code>gps.conf</code> in the future do not require restarting Asterisk. After making changes to the configuration file, you can enter these commands in the Asterisk CLI. </p>
<div class="highlight"><pre><span></span><code>module unload app_gps  
module load app_gps 
</code></pre></div>
<h3 id="adv-topics-aprs-monitoring-the-gps-device">Monitoring the GPS device</h3>
<p>You can get the status of the connected GPS device by typing the following command in the Asterisk CLI:</p>
<div class="highlight"><pre><span></span><code>gps show status
</code></pre></div>
<p>This command will tell you if the GPS device is locked on the satellite signal and the current position. If you are not using a GPS device, it will show the default latitude, longitude, and elevation.</p>
<h2 id="adv-topics-aprs-aprstt-touchtone">APRStt (touchtone)</h2>
<p>APRStt allows operators with analog radios to report to the APRS system. Specially crafted DTMF sequences can be sent to <code>app_rpt</code> to generate APRS position reports.</p>
<p>To enable this feature, edit <code>/etc/asterisk/rpt.conf</code> and add or enable <code>aprstt = general</code> for your node. The value after <code>aprstt</code> is the section in <code>gps.conf</code> to use for APRStt. This value can be different for each node. <em>It does require a matching section in <code>gps.conf</code>.</em></p>
<p>Callsigns received by APRStt are reported as objects to APRS using the <code>'-12'</code> SSID.</p>
<p>To send WB4APR using APRStt, you would send the DTMF sequence, <code>A9A2B42A7A7C91#</code>. <code>app_rpt</code> will translate the DTMF sequence and send it to <code>app_gps</code> for processing.</p>
<p>For more information on the APRStt DTMF format and how to construct DTMF sequences, see <a href="http://www.aprs.org/aprstt/aprstt-user.txt">http://www.aprs.org/aprstt/aprstt-user.txt</a>.</p>
<p><strong>NOTE:</strong> Some radios natively support APRStt.</p>
<p><strong>NOTE:</strong> At the time of this writing, <code>app_rpt</code> only supports the APRStt A format.</p></section><section class="print-page" id="adv-topics-tts"><h1 id="adv-topics-tts-asl-text-to-speech">ASL Text-to-Speech</h1>
<p>ASL provides the <code>asl-tts</code> command. This is a text to speech speaker for ASL3. It uses the <a href="https://github.com/rhasspy/piper">piper</a> open source TTS system that is not dependant on cloud providers and has opensource voice models for dozens of languages.</p>
<p>If the <code>asl-tts</code> command doesn't exist on your system, you will need to install the <code>asl3-tts</code> package:</p>
<div class="highlight"><pre><span></span><code>sudo apt install asl3-tts
</code></pre></div>
<h2 id="adv-topics-tts-basic-operation">Basic Operation</h2>
<p><code>asl-tts</code> uses the <code>piper-tts</code> text to speech engine to generate ulaw files from text so that <code>Asterisk/apt_rpt</code> can speak any set of arbitrary text without needing to have a sound file installed for the word necessary. By default, <code>asl-tts</code> will cause <code>app_rpt</code> to immediately speak whatever text was specified.</p>
<div class="admonition note">
<p class="admonition-title">asl-tts has a time delay</p>
<p>Running the <code>piper-tts</code> system takes a few seconds to compile the voice into the sound file. Larger text blocks may take tens of seconds to compile. <code>asl-tts</code> is not appropriate for time-sensitive communications such as speaking the current time.</p>
</div>
<p>The command format is as follows:</p>
<div class="highlight"><pre><span></span><code>asl-tts -n NODE -t &#39;TEXT&#39; [ -v VOICE ] [ -f FILE ]
</code></pre></div>
<p>The general use case is to speak to a node immediately. This this case speaking the text "Good morning" to node 63001 would look like this:</p>
<div class="highlight"><pre><span></span><code>sudo asl-tts -n 63001 -t &#39;Good morning&#39;
</code></pre></div>
<p>The TTS engine will start, create the audio, and execute the playback on the node. The playback follows normal <code>app_rpt</code> rules and will be played back as soon as its turn arrives. The command will not preempt or "talk over" other traffic on the node.</p>
<p>Keep in mind the differences between quoting in a shell command. In general, the <code>"</code> and <code>'</code> work the same but the double-quote will allow variable substitution while the single quote will not. This can be useful if you want to create text based on a system condition. For example:</p>
<div class="highlight"><pre><span></span><code>TODAY=$(date +&quot;%A, %B %d, %Y&quot;)
sudo asl-tts -n 63001 -t &quot;Today is ${TODAY}&quot;
</code></pre></div>
<p>Obviously the above example is a bit contrived as the <code>date</code> command doesn't generate nice words such as "first", "seventeenth", etc. However, it demonstrates the flexibility of the tool. A script could be used to populate <code>$TODAY</code> with natural words. For a hypothetical example:</p>
<div class="highlight"><pre><span></span><code>TODAY=$(/path/to/today-script)
sudo asl-tts -n 63001 -t &quot;Today is ${TODAY}&quot;
</code></pre></div>
<p>More complex message can be created with additional shell coding. As an example here's how the current public IP address of the system could be obtained and spoken:</p>
<div class="highlight"><pre><span></span><code>IPADDR=$(wget -q -O - checkip.dyndns.com | grep -Po &quot;[\d\.]+&quot; | sed &#39;s/\./ dot /g&#39;)
MSG=&quot;The node public IP is ${IPADDR}&quot;
sudo asl-tts -n 63001 -t ${MSG}
</code></pre></div>
<p>A <code>bash</code> shell variable can generally hold up to a 2 Mb-sized string so any reasonably-formatted text can be stored in a variable and then played with the <code>-t</code> command. Keep in mind that the text or the variable contents must not contain the same quote type used in the command without escaping it with a backslash. For example <code>"Nested \" mark"</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Temporary File Cleanups</p>
<p>Note that temporary files are written to directories named <code>/tmp/asl-tts*</code> and are not automatically cleaned up because it's impossible to know when Asterisk will actually need/speak the file contents. If this becomes a space problem, put in a <code>systemd</code> timer unit or a <code>cron</code> job to delete old files in <code>/tmp/asl-tts*</code>. The command can simply be <code>rm -rf /tmp/asl-tts*</code>.</p>
</div>
<h2 id="adv-topics-tts-creating-a-sound-file-for-later">Creating a Sound File for Later</h2>
<p>To create the text for other usage, such as cron jobs, use the <code>-f FILE</code> option to specify where the file should be created. Do not use an extension, the file will be automatically appended with the <code>.ul</code> suffix.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>AUD_TEXT=&quot;The club net will begin in five minutes!&quot;
asl-tts -n 460181 -t &quot;${AUD_TEXT}&quot; -f /tmp/netstartsin5
</code></pre></div>
<p>This will create a sound file <code>/tmp/netstartsin5.ul</code> that can be used later with an asterisk playback such as:</p>
<div class="highlight"><pre><span></span><code>asterisk -rx &#39;rpt playback 63001 /tmp/netstartsin5
</code></pre></div>
<p>Note that <code>-n</code> is required but irrelevant to this use case.</p>
<h2 id="adv-topics-tts-voices">Voices</h2>
<p>By default, the package provides the voice "Amy" from <a href="https://github.com/rhasspy/piper/blob/master/VOICES.md">https://github.com/rhasspy/piper/blob/master/VOICES.md</a>. This voice is the closest voice to the default Asterisk and <code>app_rpt</code> sounds ("Allison"). It is possible to download other voices, for any language, and store the <code>.onnx</code> and
<code>.onxx.json</code> files in <code>/var/lib/piper-tts</code> and then use them with the <code>-v</code> option. For example, to add the English (en_GB) voice "Alan" from the voices repository:</p>
<ol>
<li>
<p>Download the <code>.onnx</code> and <code>.onnx.json</code> file to <code>/var/lib/piper-tts</code></p>
</li>
<li>
<p>Specify <code>-v en_GB-alan-low.onnx</code> on the command line to <code>asl-tts</code>. As an example:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>asl-tts -n 63001 -v en_GB-alan-low.onnx -t &quot;Good morning&quot;
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">File Quality</p>
<p>Since all files are squashed down to 8K uLaw format, there is no value in the "medium" or "high" quality models. Always use the "low" quality model.</p>
</div>
<h2 id="adv-topics-tts-reporting-bugs">Reporting Bugs</h2>
<p>Report bugs to <a href="https://github.com/AllStarLink/asl3-tts/issues">https://github.com/AllStarLink/asl3-tts/issues</a></p></section><section class="print-page" id="adv-topics-conftmpl"><h1 id="adv-topics-conftmpl-asterisk-templates">Asterisk Templates</h1>
<p>ASL3 now uses templates for configuration files. This can make editing Asterisk config files less tedious. So far, ASL3 is using templated configurations in the <code>rpt.conf</code>, <code>simpleusb.conf</code>, <code>usbradio.conf</code>, and <code>gps.conf</code> files.</p>
<h2 id="adv-topics-conftmpl-etcasteriskrptconf"><code>/etc/asterisk/rpt.conf</code></h2>
<p>The <code>rpt.conf</code> file remains basically the same as it was in ASL2. However, the organization has changed to make it easier to maintain, particularly for multi-node systems.</p>
<p>The template for a node in <code>rpt.conf</code> is named <code>[node-main]</code>, it contains all the "default" settings for all nodes on your system. Every node tagged with <code>(node-main)</code> inherits all the template settings. Settings changed in the node-specific stanza will override the same settings in the <code>[node-main]</code> template.</p>
<p>As you will see, adding a new node requires the addition of just a few lines.  For example, adding three nodes to your system may need nothing more than:</p>
<div class="highlight"><pre><span></span><code>[node-main](!)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;; Template for all your nodes ;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Set the defaults for your node(s) here.
; Add your nodes below the line that says
; Add you nodes below.

...

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;; Configure your nodes here ;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Note: there is no need to duplicate entire settings. Only
;       place settings that are different than the template.
;
[1999](node-main)
rxchannel = SimpleUSB/1999
idrecording = |iWB6NIL
startup_macro = *32000

[1998](node-main)
;this node would use the ID in the template
rxchannel = Radio/1998
morse = morse_1998

[1997](node-main)
;This might be a hub node if &quot;rxchannel = dahdi/pseudo&quot; is in the template
</code></pre></div>
<p>In the above example, node 1997 will use all the settings configured in the <code>[node-main]</code> template. </p>
<p>Node 1998 would use all the settings in the <code>[node-main]</code> template, but it would change the channel driver to <code>rxchannel = Radio/1998</code>, and that node will use a custom morse stanza, defined by <code>morse = morse_1998</code>. </p>
<p>Node 1999 would use all the settings in the <code>[node-main]</code> template, but it would change the channel driver to <code>rxchannel = SimpleUSB/1999</code>, change the normal ID to <code>idrecording = |iWB6NIL</code>, and set the startup macro to <code>startup_macro = *32000</code>.</p>
<h2 id="adv-topics-conftmpl-etcasterisksimpleusbconf-and-etcasteriskusbradioconf"><code>/etc/asterisk/simpleusb.conf</code> and <code>/etc/asterisk/usbradio.conf</code></h2>
<p>The <code>/etc/asterisk/simpleusb.conf</code> and <code>/etc/asterisk/usbradio.conf</code> files have also adopted a templated configuration. Again, the template for a node is named <code>[node-main]</code>. Every node tagged with <code>(node-main)</code> inherits all the template settings. Settings changed in the node-specific stanza will override the same settings in the <code>[node-main]</code> template.</p>
<h2 id="adv-topics-conftmpl-etcasteriskgpsconf"><code>/etc/asterisk/gps.conf</code></h2>
<p>The <code>/etc/asterisk/gps.conf</code> file has also adopted a templated configuration. The template for a node is named <code>[general]</code>. Every node tagged with <code>(general)</code> inherits all the template settings. Template settings are overwritten by nodes with <code>(general)</code> attached.</p>
<h2 id="adv-topics-conftmpl-asl-menu-support">ASL Menu Support</h2>
<p>The new <a href="#user-guide"><code>asl-menu</code></a> is fully aware of the templated configuration and handles adding, updating, and removing nodes.</p></section><section class="print-page" id="adv-topics-autopatch"><h1 id="adv-topics-autopatch-autopatch">Autopatch</h1>
<p>The autopatch feature in <code>app_rpt</code> allows users on the radio to interconnect with the public switched telephone network (PSTN). This means an amateur radio operator can dial a phone number from the radio and be connected to a phone. The reverse is also possible with someone being able to dial a phone number and be connected to the node. This is achieved using an account with a VOIP service provider and connecting the AllStar node.</p>
<div class="admonition note">
<p class="admonition-title">Regulatory Issues</p>
<p>Some countries do not allow third-party traffic through autopatching or telephone interconnection on amateur radio frequencies. In addition, if a system is linked between one country which allows autopatching and one which doesn't, just the passing of the traffic itself across the link could be considered a violation of the rules in the prohibiting country. In countries which permit autopatching, users need be made aware of this and should take the node off-link before using the autopatch.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Security Issues</p>
<p>The examples provided here do not secure the autopatch against toll fraud. A lot can be done to prevent or reduce toll fraud but the prevention measures vary by where you are located geographically. Most of the prevention measures will be in <code>extensions.conf</code>. You can write contexts (dial plans) to reject certain number sequences. The <a href="http://www.asteriskdocs.org/">Asterisk Book</a> should be consulted to see how to do this and should be done before placing any autopatch in service. Please make sure you have secured your system so that toll fraud does not become an issue.</p>
</div>
<h2 id="adv-topics-autopatch-duplex-and-vox">Duplex and VOX</h2>
<p>Nodes with duplex set to <code>0</code> or <code>1</code> will use VOX automatically. Nodes with duplex set to <code>2</code> or higher can use phone mode. In phone mode, one can key up the radio by dialing <code>*99</code> and un-key by dialing <code>#</code>. One can configure simplex autopatch to not use VOX, but simplex reverse autopatch must use VOX, so it is preferable to use VOX both ways for simplex nodes. Nodes configured for VOX autopatch should advise callers to mute their phone and un-mute only when talking. Additional info can be found in the <a href="#adv-topics-autopatch-simplex-autopatch">Simplex Autopatch</a> section.</p>
<h2 id="adv-topics-autopatch-selecting-a-voip-provider">Selecting a VOIP Provider</h2>
<p>Call termination into the public switched telephone network is a service offered by a Voice Over IP provider (VOIP). This is a highly competitive business, and there are lots of VOIP providers offering termination for Asterisk users. Termination is usually provided using the SIP protocol, while IAX is offered by a few providers.</p>
<p>When selecting an VOIP provider, make sure they provide setup instructions with example configurations including usernames, and passwords. Quite a few VOIP providers will 
automatically generate a custom SIP or IAX stanza for insertion into <code>pjsip.conf</code>, or <code>iax.conf</code> respectively. Not all providers will supply configuration examples. This guide includes example configuration files that may need adjustments to get working with specific providers and ASL versions.</p>
<p>This guide will document the general process for setting up IAX2 and SIP providers with examples for <a href="https://voip.ms">voip.ms</a> IAX and <a href="https://flowroute.com">flowroute.com</a> SIP. Any provider should be setup in a similar fashion.</p>
<h2 id="adv-topics-autopatch-voip-provider-setup">VOIP Provider Setup</h2>
<p>Whatever provider one chooses, the same things must be setup. Different providers will have different names for each item, but the setup will be similar.</p>
<ul>
<li>A phone number or DID must be purchased</li>
<li>E911 service should be setup</li>
<li>CallerID must be setup for the DID</li>
<li>Inbound routing will need to be setup so calls are routed to the node via IAX2 or SIP</li>
<li>Authentication for outbound calls must be configured</li>
</ul>
<h2 id="adv-topics-autopatch-firewall-setup">Firewall Setup</h2>
<p>If using IAX, the firewall will already be configured properly. If using SIP, you will need to update the firewall rules to allow SIP traffic with:</p>
<div class="highlight"><pre><span></span><code>root@localhost:/# firewall-cmd --add-service=SIP --permanent
</code></pre></div>
<p>On your internet router/firewall, forward/open ports as required:</p>
<ul>
<li>For traffic from the Internet (from the SIP provider) you need to allow TCP and UDP port <code>5060</code> to the node</li>
<li>You will also need to allow the UDP port range <code>10000-20000</code> to the node</li>
</ul>
<h2 id="adv-topics-autopatch-configuration-files">Configuration Files</h2>
<p>Four configuration files will be used to setup the autopatch: <code>rpt.conf</code>, <code>extensions.conf</code>, <code>modules.conf</code>, and either <code>iax.conf</code> or <code>pjsip.conf</code>. The VOIP provider should provide a stanza for you to insert in <code>iax.conf</code> or <code>pjsip.conf</code>. The configuration below shows how each of these files are used when an outgoing autopatch or reverse autopatch call is made.</p>
<h3 id="adv-topics-autopatch-modulesconf"><code>modules.conf</code></h3>
<p>In the <code>/etc/asterisk/modules.conf</code> file, add the following lines at the bottom of the file, but above the <code>[global]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>load =&gt; bridge_builtin_features.so
load =&gt; bridge_builtin_interval_features.so
load =&gt; bridge_holding.so
load =&gt; bridge_native_rtp.so
load =&gt; bridge_simple.so
load =&gt; bridge_softmix.so
load =&gt; chan_bridge_media.so
load =&gt; app_verbose.so
load =&gt; app_read.so
</code></pre></div>
<p>If using a SIP trunking provider, add these additional lines at the bottom of <code>modules.conf</code>, above the <code>[global]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>;
; modules for pjsip
;
noload = app_voicemail.so
load = bridge_builtin_features.so
load = bridge_builtin_interval_features.so
load = bridge_holding.so
load = bridge_native_rtp.so
load = bridge_simple.so
load = bridge_softmix.so
load = chan_bridge_media.so
load = chan_pjsip.so
load = func_pjsip_endpoint.so
load = func_sorcery.so
load = func_devstate.so
load = res_pjproject.so
load = res_pjsip_acl.so
load = res_pjsip_authenticator_digest.so
load = res_pjsip_caller_id.so
load = res_pjsip_dialog_info_body_generator.so
load = res_pjsip_diversion.so
load = res_pjsip_dtmf_info.so
load = res_pjsip_endpoint_identifier_anonymous.so
load = res_pjsip_endpoint_identifier_ip.so
load = res_pjsip_endpoint_identifier_user.so
load = res_pjsip_exten_state.so
load = res_pjsip_header_funcs.so
load = res_pjsip_logger.so
load = res_pjsip_messaging.so
load = res_pjsip_mwi_body_generator.so
load = res_pjsip_mwi.so
load = res_pjsip_nat.so
load = res_pjsip_notify.so
load = res_pjsip_one_touch_record_info.so
load = res_pjsip_outbound_authenticator_digest.so
load = res_pjsip_outbound_publish.so
load = res_pjsip_outbound_registration.so
load = res_pjsip_path.so
load = res_pjsip_pidf_body_generator.so
load = res_pjsip_pidf_digium_body_supplement.so
load = res_pjsip_pidf_eyebeam_body_supplement.so
load = res_pjsip_publish_asterisk.so
load = res_pjsip_pubsub.so
load = res_pjsip_refer.so
load = res_pjsip_registrar.so
load = res_pjsip_rfc3326.so
load = res_pjsip_sdp_rtp.so
load = res_pjsip_send_to_voicemail.so
load = res_pjsip_session.so
load = res_pjsip.so
noload = res_pjsip_t38.so
noload = res_pjsip_transport_websocket.so
load = res_pjsip_xpidf_body_generator.so
load = res_rtp_asterisk.so
load = res_sorcery_astdb.so
load = res_sorcery_config.so
load = res_sorcery_memory.so
load = res_sorcery_realtime.so
</code></pre></div>
<h3 id="adv-topics-autopatch-rptconf"><code>rpt.conf</code></h3>
<p>In the <code>/etc/asterisk/rpt.conf</code> configuration file, the stanza for the node needs to specify the context for the autopatch. The name of the context should match the name added to <code>extensions.conf</code>:</p>
<p><div class="highlight"><pre><span></span><code>[1234]
context = autopatch                ; dialing context for phone
callerid = &quot;Repeater&quot; &lt;0000000000&gt; ; callerid for phone calls
accountcode = RADIO                ; account code (optional)
</code></pre></div>
You should also add entries to the <code>[functions]</code> stanza so that users can bring up or take down the autopatch:</p>
<div class="highlight"><pre><span></span><code>[functions]
61 = autopatchup,noct=1,farenddisconnect=1,dialtime=20000,context=autopatch,quiet=1
0 = cmd,/var/lib/asterisk/hangupPhones ; Hangup all phone patches
</code></pre></div>
<h4 id="adv-topics-autopatch-autopatch-options">Autopatch Options</h4>
<p>There are several options that can be passed to the autopatchup command class. This table summarizes what they do:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>context</td>
<td>Override the context specified for the autopatch in <code>rpt.conf</code></td>
</tr>
<tr>
<td>dialtime</td>
<td>The maximum time to wait between DTMF digits when a telephone number is being dialed. The patch will automatically disconnect if this time is exceeded. The value is specified in milliseconds.</td>
</tr>
<tr>
<td>farenddisconnect</td>
<td>When set to 1, the patch will automatically disconnect when the called party hangs up. The default is to send a circuit busy tone until the radio user brings the patch down.</td>
</tr>
<tr>
<td>noct</td>
<td>When set to 1, the courtesy tone during an autopatch call will be disabled. The default is to send the courtesy tone whenever the radio user un-keys.</td>
</tr>
<tr>
<td>quiet</td>
<td>When set to 1, do not send dial tone or voice responses, just try to connect the call.</td>
</tr>
<tr>
<td>voxalways</td>
<td>When set to 1, enables VOX mode.</td>
</tr>
<tr>
<td>exten</td>
<td>Overrides the default autopatch extension.</td>
</tr>
<tr>
<td>nostar</td>
<td>Disables the repeater function prefix</td>
</tr>
</tbody>
</table>
<h4 id="adv-topics-autopatch-create-a-script-to-handle-terminating-calls">Create a Script to Handle Terminating Calls</h4>
<p>Create the following script to handle terminating calls. Without this script, you will be unable to forcefully terminate <strong>incoming</strong> calls:</p>
<div class="highlight"><pre><span></span><code>nano /var/lib/asterisk/hangupPhones
</code></pre></div>
<p>Paste this script into the file:</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash
# Target pattern to match (adjust as needed for different calls)
TARGET_PATTERN=&quot;IAX2/voipms-&quot;
# TARGET_PATTERN=&quot;PJSIP/flowroute-&quot;
# Get the list of channels and their concise details
CHANNELS=$(asterisk -rx &quot;core show channels concise&quot;)
echo &quot;Checking for matching channels...&quot;
echo &quot;--------------------------------&quot;
# Iterate over each line to find the target channel
while IFS= read -r line; do
    if [[ $line == $TARGET_PATTERN* ]]; then
        CHANNEL=$(echo &quot;$line&quot; | awk -F&#39;!&#39; &#39;{print $1}&#39;)
        CALLERID=$(echo &quot;$line&quot; | awk -F&#39;!&#39; &#39;{print $3}&#39;)
        echo &quot;Found matching channel: $CHANNEL with Caller ID: $CALLERID&quot;
        echo &quot;Hanging up channel: $CHANNEL&quot;
        asterisk -rx &quot;channel request hangup $CHANNEL&quot;
    fi
done &lt;&lt;&lt; &quot;$CHANNELS&quot;
</code></pre></div>
<p>Save the file and make it executable:</p>
<div class="highlight"><pre><span></span><code>sudo chmod +x /var/lib/asterisk/hangupPhones
</code></pre></div>
<h3 id="adv-topics-autopatch-extensionsconf"><code>extensions.conf</code></h3>
<p>In the <code>/etc/asterisk/extensions.conf</code> file, a stanza for the autopatch context is added which refers to the peer stanza in <code>iax.conf</code> or <code>pjsip.conf</code>. These examples will likely need to be adjusted to work with a specific provider: </p>
<p>For outbound IAX connections, add an <code>[autopatch]</code> stanza with:</p>
<div class="highlight"><pre><span></span><code>[autopatch] 

; Match any 10-digit number (e.g., North American local format).
exten =&gt; _NXXNXXXXXX,1,Dial(IAX2/voipms/${EXTEN})
; After the call is completed, hang up the line.
exten =&gt; _NXXNXXXXXX,n,Hangup()
</code></pre></div>
<p>For outbound SIP connections (using IP auth), add an <code>[autopatch]</code> stanza with:</p>
<div class="highlight"><pre><span></span><code>[autopatch]

; Match any 10-digit number (e.g., North American local format).
exten =&gt; _NXXNXXXXXX,1,Dial(PJSIP/flowroute-endpoint/sip:[tech-prefix]*+1${EXTEN}@us-east-va.sip.flowroute.com)
; After the call is completed, hang up the line.
exten =&gt; _NXXNXXXXXX,n,Hangup()
</code></pre></div>
<p>To setup the 911 extension, add the following lines to the <code>[autopatch]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>; Match 911
exten =&gt; 911,1,Dial(IAX2/voipms/${EXTEN})
; The Dial command routes the call through the IAX2 channel to the &quot;voipms&quot; trunk,
; passing the dialed number (${EXTEN}) to the provider.

; After the call is completed, hang up the line.
exten =&gt; 911,n,Hangup()

; Optional: Reroute 911 to another number
; Uncomment the following lines to enable this feature:
; Instead of routing 911 directly, reroute it to the specified number (e.g., 1234567890).
; This could be used to route emergency calls to a different service or internal security.
; exten =&gt; 911,1,Dial(IAX2/voipms/1234567890)
; After the rerouted call is completed, hang up the line.
; exten =&gt; 911,n,Hangup()
</code></pre></div>
<p>You will also want to add a <code>[reverse-autopatch]</code> stanza with the following lines:</p>
<div class="highlight"><pre><span></span><code>; REVERSE-AUTOPATCH - REPEATER RECEIVES INCOMING CALLS

[reverse-autopatch]
; Change below to the voip DID number
VOIPDID = 5555554321

exten =&gt; _X.,1,Verbose(1, Caller ${CALLERID(all)} has entered IVR menu)
; wait a bit before answering
exten =&gt; _X.,n,Wait(2)

; Answer the incoming call.
exten =&gt; _X.,n,Answer()

; Wait for 1 second to ensure the line is stable before playing the prompt.
exten =&gt; _X.,n,Wait(1)

; Optional: Bypass PIN for trusted caller
; Uncomment the below line to enable this feature:
; If the incoming call is from a trusted number (5551234567 or 5559876543 in this example),
; skip the PIN code and go directly to the &quot;${VOIPDID}&quot; label.
;exten =&gt; _X.,n,GotoIf($[&quot;${CALLERID(num)}&quot; = &quot;+15555551234&quot;]?5555554321,1)
; Example of how to &quot;trust&quot; two (or more) phone numbers
; exten =&gt; _X.,n,GotoIf($[&quot;${CALLERID(num)}&quot; = &quot;5551234567&quot; | &quot;${CALLERID(num)}&quot; = &quot;5559876543&quot;]?${VOIPDID},1)

; Initialize an attempt counter
exten =&gt; _X.,n,Set(ATTEMPTS=0)
; Play a message that asks the caller to enter their PIN followed by the pound/hash key, along with other information like mute/unmute procedure, ID with callsign, etc.
exten =&gt; _X.,n(start),Playback(message)

; Wait for the caller to enter a 4-digit PIN.
; - &quot;PIN&quot; is the variable where the entered digits will be stored.
; - &quot;beep&quot; will play a beep sound to prompt the user.
; - &quot;4&quot; specifies the PIN length (4 digits).
; - &quot;,,5&quot; sets a 5-second timeout for the user to start entering the PIN.
exten =&gt; _X.,n,Read(PIN,beep,4,,,5)

; SET YOUR PIN(s) HERE! THESE PIN(s) WILL BE USED TO PATCH INTO THE REPEATER
; Check if the entered PIN is one of the valid PINs.
; - If the PIN is correct, the call will go to the label &quot;wait-for-pound&quot;.
; - If not, it will continue to the next step.
exten =&gt; _X.,n,GotoIf($[&quot;${PIN}&quot; = &quot;1234&quot;]?wait-for-pound)
; Example of how to set up two (or more) PINs:
; exten =&gt; _X.,n,GotoIf($[&quot;${PIN}&quot; = &quot;1234&quot; | &quot;${PIN}&quot; = &quot;5678&quot;]?wait-for-pound)

; Increment the attempt counter
exten =&gt; _X.,n,Set(ATTEMPTS=$[${ATTEMPTS}+1])

; If the PIN is invalid, play a message saying it was incorrect.
; &quot;confbridge-invalid&quot; says: &quot;You have entered an invalid option.&quot;
exten =&gt; _X.,n,Playback(confbridge-invalid)

; Check if the attempt counter has reached 3
exten =&gt; _X.,n,GotoIf($[${ATTEMPTS} &gt;= 3]?too-many-failures)

; Go back to the start and ask the user to enter the PIN again.
; This gives the user another chance to enter a valid PIN.
exten =&gt; _X.,n,Goto(start)

; If the user fails to enter a valid PIN after 3 attempts, play a message saying they have entered too many invalid PINs.
; &quot;confbridge-pin-bad&quot; says: &quot;You have entered too many invalid personal identification numbers.&quot;
exten =&gt; _X.,n(too-many-failures),Playback(confbridge-pin-bad)

; Hang up the call after the failure message.
exten =&gt; _X.,n,Hangup()

; After the valid PIN is entered, wait for the user to press the &quot;#&quot; key.
; - This command waits for the user to press &quot;#&quot; to confirm the PIN entry.
; - The 5-second timeout will give the user time to press &quot;#&quot;.
exten =&gt; _X.,n(wait-for-pound),WaitExten(5)

; If the user presses &quot;#&quot;, go to the &quot;${VOIPDID}&quot; label.
exten =&gt; #,1,Goto(${VOIPDID},1)

; If &quot;#&quot; is not pressed, go to the start label.
exten =&gt; _X.,89,Goto(start)

; If the correct PIN was entered and &quot;#&quot; was pressed, play a message confirming the connection.
; &quot;rpt/connected&quot; could say something like: &quot;You are now connected.&quot;
exten =&gt; ${VOIPDID},1,Playback(rpt/connected)

; Connect the caller to the repeater using the &quot;rpt&quot; command.
; The &quot;|P&quot; option is used to specify &quot;phone&quot; mode in app_rpt.
exten =&gt; ${VOIPDID},n,rpt(${NODE}|Pv)

; Hang up the call after the connection is made.
exten =&gt; ${VOIPDID},n,Hangup()
</code></pre></div>
<h3 id="adv-topics-autopatch-iaxconf"><code>iax.conf</code></h3>
<p>If using an IAX provider, you will need to update the <code>/etc/asterisk/iax.conf</code> file. Items in between brackets should be replaced with specific account info, except the stanza names themselves:</p>
<p>First, add the following lines to the <code>[general]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>; ENTER YOUR VOIP.MS CREDENTIALS AND SERVER HERE
register =&gt; [VOIPMS_ID]:[VOIPMS_PASSWORD]@[VOIPMS_HOST]
; Example: register =&gt; 123456:supersecretpassword@dallas1.voip.ms
</code></pre></div>
<p>Then, add this new stanza:</p>
<div class="highlight"><pre><span></span><code>[voipms]
username=[VOIPMS_ID]; ENTER YOUR 6-DIGIT VOIP.MS USERNAME HERE
type=friend
context=reverse-autopatch
host=[VOIPMS_HOST]; ENTER THE VOIP.MS SERVER ADDRESS YOU SELECTED FOR YOUR DID HERE
secret=[VOIPMS_PASSWORD]; ENTER YOUR VOIP.MS IAX PASSWORD HERE
disallow=all
allow=ulaw
allow=g726aal2
allow=gsm
codecpriority=host
insecure=port,invite
requirecalltoken=yes
</code></pre></div>
<h3 id="adv-topics-autopatch-pjsipconf"><code>pjsip.conf</code></h3>
<p>If using a SIP provider, replace (or create) the <code>/etc/asterisk/pjsip.conf</code> file. The file (below) is based on a node behind NAT and should be updated for specific providers and accounts:</p>
<div class="highlight"><pre><span></span><code>;===============TRANSPORT

[sip-trans]
type=transport
protocol=udp
bind=0.0.0.0
local_net=[LAN Network IP]/24
local_net=127.0.0.1/32
external_media_address=[INET IP]
external_signaling_address=[INET IP]

;===============TRUNK

[flowroute-reg]
type=registration
outbound_auth=flowroute-auth
server_uri=sip:us-east-va.sip.flowroute.com
client_uri=sip:[Tech Prefix]@us-east-va.sip.flowroute.com
retry_interval=60
contact_user=[VOIP DID]@[WAN IP]

[flowroute-auth]
type=auth
auth_type=userpass
password=[password]
username=[Tech Prefix]
;realm=us-west-or.sip.flowroute.com

[flowroute-aor]
type=aor
contact=sip:[WAN IP]:5060

[flowroute-endpoint]
type=endpoint
context=reverse-autopatch
disallow=all
allow=ulaw
allow=g726aal2
allow=alaw
allow=gsm
;outbound_auth=flowroute-auth
aors=flowroute-aor
;outbound_proxy = sip:us-west-or.sip.flowroute.com
from_domain=[WAN IP]

[flowroute-id]
type=identify
endpoint=flowroute-endpoint
match=us-east-va.sip.flowroute.com
</code></pre></div>
<h2 id="adv-topics-autopatch-simplex-autopatch">Simplex Autopatch</h2>
<p>For nodes with duplex set to <code>0</code> or <code>1</code>, simplex autopatch operation is supported. This is accomplished by using a VOX on the audio coming from the telephone call, 
because of the half-duplex nature of the node. To avoid having audio from the telephone call keep the transmitter engaged for extended periods of time (if there 
is some source of continuous audio), there are two time-out values. </p>
<p>VOX timeout, which is the maximum amount of time that the VOX can hold the transmitter engaged, which by default is 10 seconds. The other one is the VOX recovery time, which
is the amount of time that the VOX is disabled during times of continuous audio, after the VOX timeout, which is 2 seconds. During continuous audio, it transmits for 
10 seconds, then stops for 2 seconds (so that you can transmit to it and perhaps disconnect the call), then transmits for another 10 seconds, then stops for 2 seconds.
This repeats until the call is disconnected.</p>
<p>Additionally, to prevent "chop-off" of the first syllable or two of the audio from the telephone call, the audio is delayed to allow for the transmitter to start transmitting 
and any CTCSS tones to be decoded. This delay is typically 500ms, but can be adjusted using the <code>simplexpatchdelay</code> parameter. It is specified in units of 20 milliseconds.</p>
<p>These time-out values may be overridden by using the following configuration parameters located in the [nodenumber] section of <code>rpt.conf</code>:</p>
<div class="highlight"><pre><span></span><code>[1999]
voxtimeout = 10000     ; VOX timeout time in ms
voxrecover = 2000      ; VOX recover time in ms
simplexpatchdelay = 25 ; Delay for transmit while in patch in 20ms increments
simplexphonedelay = 25 ; Delay for phone while in patch for 20ms increments
</code></pre></div></section><section class="print-page" id="adv-topics-audio-level"><h1 id="adv-topics-audio-level-calibrating-audio-levels-for-the-allstarlink-system">Calibrating Audio Levels For The AllStarLink System</h1>
<h2 id="adv-topics-audio-level-introduction">Introduction</h2>
<p>Proper audio level calibration is crucial for ensuring good audio quality, and consistent audio levels from node-to-node. Fortunately, the procedure is not that complicated. To properly perform the audio level calibration, you will need the following items:</p>
<ul>
<li>A service monitor, preferably one capable of simultaneous generation and analysis (e.g. HP8920, HP8921, IFR1200, COM120B, R2600, R8000A, or a separate signal generator and deviation meter), plus associated cabling.</li>
<li>An audio signal generator</li>
<li>Linux CLI access to the node being calibrated.</li>
<li>Tweaking tools if your radio or interface board has physical adjustment pots, or the appropriate service software for your radio.</li>
</ul>
<h2 id="adv-topics-audio-level-assumptions">Assumptions</h2>
<ul>
<li>The system you are calibrating uses 5kHz deviation (standard NBFM) as the maximum peak deviation. For narrow band systems everything is half. So the steps below which say to use 3kHz should use 1.5kHz.</li>
<li>You must know the node number and the channel number of the radio port you wish to test. This can be looked up in <code>rpt.conf</code>.</li>
</ul>
<h2 id="adv-topics-audio-level-procedure">Procedure</h2>
<h3 id="adv-topics-audio-level-checking-the-radios-transmitters-peak-deviation">Checking the Radio's Transmitter's Peak Deviation</h3>
<p>If you intend to drive the transmitter at the microphone input, or at another audio input before pre-emphasis and limiting, you must ensure that the peak deviation of the transmitter is no more than what is required to operate on the channel (typically 5KHz). If you driving the modulator directly from a URI, this section can be skipped.</p>
<ol>
<li>Disable the generation of CTCSS tones in the transmitter. (If you don't encode CTCSS, skip this step and steps 6 and 7)</li>
<li>Hook up the audio signal generator to the transmitter microphone input, set it for a 1kHz sine wave, and the lowest output setting. Hook up the service monitor to the transmitter RF output (with appropriate attenuation for protection of your Service Monitor) and key the transmitter.</li>
<li>On the service monitor, monitor the peak deviation of the transmitter. Gradually increase the output of the audio signal generator until further adjustment does not increase the deviation. Make a note of the peak deviation at this point.</li>
<li>If the peak deviation is more than 5kHz, then adjust the transmitter deviation pot or soft pot so that the peak deviation reading on the service monitor is no more than 5kHz. Check the shape of the audio waveform on the service monitor's scope. It should show evidence of hard limiting (it should look like a square wave with rounded edges)</li>
<li>Reduce the level of the audio signal generator so that the service monitor reads 3kHz of peak deviation. The audio waveform should now be a sine wave with no evidence of limiting.</li>
<li>Re-enable the generation of CTCSS tones in the transmitter</li>
<li>Check that the peak deviation is no more than 3.6 kHz. If it is more than this, adjust the CTCSS level so that a reading of 3.6kHz is attained.</li>
</ol>
<h3 id="adv-topics-audio-level-adjusting-the-transmit-audio-level">Adjusting the Transmit Audio Level</h3>
<ol>
<li>Disable CTCSS tone generation in the transmitter or at the CTCSS encoder.</li>
<li>Enable the test tone generator COP command in <code>rpt.conf</code> and restart Asterisk</li>
<li>Connect the radio interface to the transmitter</li>
<li>Bring up the Asterisk CLI.</li>
<li>From the Asterisk CLI, type <code>rpt fun yournodenumber *904</code> where <code>yournodenumber</code> is the node number assigned to you.</li>
<li>The transmitter should key and you may hear a tone. Adjust the TX level until the service monitor indicates 3kHz of peak deviation.</li>
<li>From the Asterisk CLI, type <code>rpt fun yournodenumber #</code>. This will kill the test tone and un-key the transmitter.</li>
<li>If encoding CTCSS, re-enable the CTCSS encoder in the transmitter, then repeat the previous three steps. You should see no more than 3.6kHz of deviation with the CTCSS tone generator enabled. If it is higher than this, adjust the CTCSS level per your transmitter's service documentation until a 3.6kHz of deviation is seen on the service monitor.</li>
</ol>
<h3 id="adv-topics-audio-level-adjusting-the-receive-audio-level">Adjusting the Receive Audio Level</h3>
<p>The procedure depends on what type of radio you have interfaced. If your radio is a repeater, use the full duplex procedure, if your radio is a remote base or simplex node, use the half-duplex procedure. <strong>NOTE:</strong> If you have a URI, the automated setup procedure should have set the receive level very close to what it needs to be. This section can be used to verify the receive level is correct for a URI, but the URI receive level should always be set using the automated adjustment procedure.</p>
<h3 id="adv-topics-audio-level-full-duplex-radios">Full Duplex Radios</h3>
<p>Adjusting the receive level of a full duplex radio is easy.</p>
<ol>
<li>Disable the transmitter CTCSS encoder. Bypass the receiver CTCSS decoder so that it is in carrier squelch.</li>
<li>Monitor the deviation of the transmitter on the service monitor while simultaneously injecting a 1kHz tone frequency at 3kHz deviation on the receiver.</li>
<li>Adjust the receive level pot until you see 3kHz of deviation on the transmit frequency.</li>
<li>Disable the signal on the receiver. The receive audio level is now set.</li>
</ol>
<h3 id="adv-topics-audio-level-half-duplex-radios">Half Duplex Radios</h3>
<p>Half duplex radios will require the use of a second node which has had the transmit level properly set, and is not transmitting a CTCSS tone. The second node must be receivable by your service monitor or deviation meter but does not need to be co-located with the node undergoing the receive level adjustment. The CODEC used to send audio to the second node must either be uLAW or ADPCM. The GSM codec will give inaccurate results.</p>
<ol>
<li>Using the Asterisk CLI, connect the node to be adjusted to the transmit node: <code>rpt fun yournodenum *3txnodenum</code></li>
<li>Monitor the deviation of the second node's transmitter on the service monitor while simultaneously injecting a 1kHz tone frequency at 3kHz deviation on the receiver on the first node.</li>
<li>Adjust the receive level pot until you see 3kHz of deviation on the transmit frequency.</li>
<li>Disable the signal on the receiver. The receive audio level is now set.</li>
<li>Disconnect the receive node from the transmitter: <code>rpt fun yournodenum *1txnodenum</code></li>
</ol></section><section class="print-page" id="adv-topics-daq"><h1 id="adv-topics-daq-daq-subsystem">DAQ Subsystem</h1>
<p><strong>The DAQ subsystem code is unsupported, and is documented for reference only. Most of the information below comes from interpreting the source code.</strong></p>
<p>There is support in <code>rpt.conf</code> that interfaces with a Digital Acquisition device (DAQ).</p>
<p>It appears that the DAQ subsystem was probably written to interface to the <a href="http://www.starting-point-systems.com/products.html">Starting Point Systems uChameleon(v1) DAQ</a>. It appears that they still sell the <a href="http://www.starting-point-systems.com/specs.html">Version 2</a>, but the Version 1 has been discontinued, and they have no links to the documentation for it. </p>
<p>The user manual for the uChameleon2 has been <a href="https://wiki.allstarlink.org/images/2/21/MuChameleon2_Users_Manual.pdf">archived here</a>, in case the manufacturer's website disappears.</p>
<p>The reasoning for suspecting the code was written for the Version 1 DAQ is that <code>rpt_uchameleon.c</code> expects the device to return an identification of <code>id Chameleon</code>, but according to the manual, the Version 2 DAQ should respond with <code>id μChameleon2</code>. Code inspection also leads to configuration commands that match the User Manual.</p>
<p>A function call to this system would appear to use the following syntax:</p>
<div class="highlight"><pre><span></span><code>dtmfcommand=meter,device,channel,meter-face,[filter]
</code></pre></div>
<p>This is similar to the way you would invoke a <a href="#config-rpt_conf-cop-commands"><code>cop</code></a> or <a href="#config-rpt_conf-link-commands"><code>ilink</code></a> command.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>98 = meter,daq-cham-1,1,batvolts
</code></pre></div>
<p>The above example would query the dac-cham-1 device (defined in the <code>[daq-list]</code> stanza), on channel 1 (an analog input (inadc) channel), and invoke the batvolts <code>[meter-face]</code>, which should then play out over the air, 'The voltage is ? volts.".</p>
<p>The <code>device</code> and i/o pin parameters for the <code>channel</code> are defined in the <a href="#adv-topics-daq-daq-list-stanza"><code>[daq-list]</code></a> stanza.</p>
<p>The <code>meter-face</code> to be called is defined in the <a href="#adv-topics-daq-meter-faces-stanza"><code>[meter-face]</code></a> stanza.</p>
<p>The <code>filter</code> parameter is optional, and can be one of the following:</p>
<ul>
<li>none</li>
<li>max</li>
<li>min</li>
<li>stmin</li>
<li>stmax</li>
<li>stavg</li>
</ul>
<p>The stmin, stmax, and stavg are short-term min, max, and average, respectively.</p>
<p>In addition to being able to read a value and say it over the air with the meter function, it also appears that the DAQ subsystem can be used as a rudimentary <a href="#adv-topics-daq-alarms-stanza">alarm system</a>.</p>
<p><strong>NOTE:</strong> The DAQ only initializes when Asterisk is restarted (NOT on a reload from the console). If you make any config changes in <code>rpt.conf</code>, you will need to restart Asterisk completely to pick up the changes.</p>
<p><strong>NOTE:</strong> Make sure to place the following configuration stanzas in the configuration for your node (either the main configuration, or your node-specific configuration). By default in the current <code>rpt.conf</code>, they exist down near the bottom of the file, and they can never be reached to be parsed (as they exist outside a configured node stanza).</p>
<h2 id="adv-topics-daq-daq-list-stanza">DAQ List Stanza</h2>
<p>The <code>[daq-list]</code> stanza defines the available DAQ devices, and the i/o pin configuration for each channel.</p>
<div class="highlight"><pre><span></span><code>; Data Acquisition configuration
[daq-list]
;device = device_name1
;device = device_name2
;Where: device_name1 and device_name2 are stanzas you define in this file

device = daq-cham-1

; Device name
[daq-cham-1]                    ; Defined in [daq-list]
hwtype = uchameleon         ; DAQ hardware type
devnode = /dev/ttyUSB0  ; DAQ device node (if required)
1 = inadc                       ; Pin definition for an ADC channel
2 = inadc
3 = inadc
4 = inadc
5 = inadc
6 = inadc
7 = inadc
8 = inadc
9 = inp                       ; Pin definition for an input with a weak pullup resistor
10 = inp
11 = inp
12 = inp
13 = in                       ; Pin definition for an input without a weak pullup resistor
14 = out                        ; Pin definition for an output
15 = out
16 = out
17 = out
18 = out
</code></pre></div>
<p><strong>These stanzas may normally appear in <code>rpt.conf</code> by default.</strong></p>
<h2 id="adv-topics-daq-meter-faces-stanza">Meter Faces Stanza</h2>
<p>Meter faces are used in conjunction with the <a href="#adv-topics-daq-daq-subsystem">meter function call</a> to play a message over the air with the value read from the DAQ device.</p>
<p>The meter faces are configured in the <code>[meter-faces]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>[meter-faces]

; face = [scale|range|bit],[parameters],[words],?,[words]
;
;face = scale(scalepre,scalediv,scalepost),word/?,...
;
; scalepre = offset to add before dividing with scalediv
; scalediv = full scale/number of whole units (e.g. 256/20 or 12.8 for 20 volts). MUST be &gt;1.
; scalepost = offset to add after dividing with scalediv
;
;face = range(X-Y:word,X2-Y2:word,...),word/?,...
;
;face = bit(low-word,high-word),word/?,...
;
; word/? is either a word in /var/lib/asterisk/sounds or one of its subdirectories,
; or a question mark which is  a placeholder for the measured value.
;
;
; Battery voltage 0-20 volts
batvolts = scale(0,12.8,0),rpt/thevoltageis,?,ha/volts
; 4 quadrant wind direction
;winddir = range(0-33:north,34-96:west,97-160:south,161-224:east,225-255:north),rpt/thewindis,?
; LM34 temperature sensor with 130 deg. F full scale
;lm34f = scale(0,1.969,0),rpt/thetemperatureis,?,degrees,fahrenheit
; Status poll (non alarmed)
;light = bit(ha/off,ha/on),ha/light,?
</code></pre></div>
<p>The <code>face</code> is any variable name you desire (must match the call from the <code>meter function call</code>).</p>
<p>The meter face type can be any one of <code>scale</code>, <code>range</code>, or <code>bit</code>.</p>
<p>The <code>scale</code> meter face takes the following options:</p>
<ul>
<li>scalepre = offset to add before dividing with scalediv</li>
<li>scalediv = full scale/number of whole units (e.g. 256/20 or 12.8 for 20 volts). MUST be &gt;1.</li>
<li>scalepost = offset to add after dividing with scalediv</li>
</ul>
<p>The <code>bit</code> meter face takes two options:</p>
<ul>
<li>low-word = the sound file to play when the bit is 0</li>
<li>high-word = the sound file to play when the bit is 1</li>
</ul>
<p>All of the meter faces then will play a list of comma-seperated words. Place a ? where you would like the value from the DAQ to be inserted.</p>
<p><strong>This stanza may not normally appear in <code>rpt.conf</code> by default.</strong></p>
<h2 id="adv-topics-daq-alarms-stanza">Alarms Stanza</h2>
<p>The DAQ subsystem can apparently monitor inputs from the DAQ device for a change of state, and then invoke a DTMF function (macro?) on a high to low and/or low to high transition.</p>
<p>The alarms are configured in the <code>[alarm]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>[alarms]
;
;tag = device,pin,ignorefirst,node,func-low,func-hi
;
;tag = a unique name for the alarm
;device = DAQ device to poll
;pin = the device pin to be monitored
;ignorefirstalarm = set to 1 to throwaway first alarm event, or 0 to report it
;node = the node number to execute the function on
;func-low = the DTMF function to execute on a high to low transition
;func-high = the DTMF function to execute on a low to high transition
;
; a  &#39;-&#39; as a function name is shorthand for no-operation
;
door = daq-cham-1,9,1,2017,*7,-
;pwrfail = daq-cham-1,10,0,2017,*911111,-
</code></pre></div>
<p>The above should be self-explanatory. You would need to configure a DAQ device in the <a href="#adv-topics-daq-daq-list-stanza"><code>[daq-list]</code></a> stanza.</p>
<p>In the above example, a door alarm (just a friendly label, not used for anything else) on <code>daq-cham-1</code> pin <code>9</code> would execute macro <code>*7</code> on node <code>2017</code> on a high to low transition of the pin. It would ignore the first occurrence of this alarm, but if it persists the next time the alarm system is polled, it would execute (no idea how often that is). </p>
<p><strong>This stanza may not normally appear in <code>rpt.conf</code> by default.</strong></p></section><section class="print-page" id="adv-topics-dns-servers"><h1 id="adv-topics-dns-servers-dns-servers">DNS Servers</h1>
<p>AllStarLink's DNS-based node lookup issues queries to Amazon's Route53 servers that are synchronized to the node registration database.  This allows clients to retrieve node information such as IP addresses and IAX ports.</p>
<h2 id="adv-topics-dns-servers-dns-node-lookup">DNS Node Lookup</h2>
<p>The <code>nodes.allstarlink.org</code> domain name is populated with <code>SRV</code>, <code>TXT</code> and <code>A</code> records for every active node in the system.</p>
<p><strong>NOTE:</strong> The DNS records for a node will remain available for a period of time after a node is no longer active. </p>
<h3 id="adv-topics-dns-servers-srv-record">SRV Record</h3>
<p>The <code>SRV</code> records return the IAX port of the server.</p>
<p>A query such as:</p>
<div class="highlight"><pre><span></span><code>dig SRV _iax._udp.&lt;nodenumber&gt;.nodes.allstarlink.org
</code></pre></div>
<p>will return a record for a node as follows:</p>
<div class="highlight"><pre><span></span><code>_iax._udp.50000.nodes.allstarlink.org. 30 IN SRV 10 10 4569 50000.nodes.allstarlink.org.
</code></pre></div>
<p>where 4569 is the IAX port.</p>
<p>A remote base node will return a record like:</p>
<div class="highlight"><pre><span></span><code>_iax._udp.50000.nodes.allstarlink.org. 30 IN SRV 10 10 4569 50000.remotebase.nodes.allstarlink.org.
</code></pre></div>
<h3 id="adv-topics-dns-servers-a-record">A Record</h3>
<p>The <code>A</code> records will return the IP address of the IAX server or the proxy IP, if defined.</p>
<p>A query such as:</p>
<div class="highlight"><pre><span></span><code>dig &lt;nodenumber&gt;.nodes.allstarlink.org

and

dig &lt;nodenumber&gt;.remotebase.nodes.allstarlink.org
</code></pre></div>
<p>will return:</p>
<div class="highlight"><pre><span></span><code>2000.nodes.allstarlink.org. 60  IN  A   162.248.93.134
</code></pre></div>
<h3 id="adv-topics-dns-servers-txt-record">TXT Record</h3>
<p>The <code>TXT</code> record is used for debugging purposes with a query below:</p>
<div class="highlight"><pre><span></span><code>dig TXT &lt;nodenumber&gt;.nodes.allstarlink.org
</code></pre></div>
<p>will return:</p>
<div class="highlight"><pre><span></span><code>&quot;NN=50000&quot; &quot;RT=2019-02-28 18:41:29&quot; &quot;RB=0&quot; &quot;IP=44.98.248.144&quot; &quot;PIP=&quot; &quot;PT=4569&quot; &quot;RH=register-west&quot;
</code></pre></div>
<p>Where:</p>
<ul>
<li>NN is the node number</li>
<li>RT is the last update registration time</li>
<li>RB is 1 for node is not a remote base, RB is 0 if it is a remote base</li>
<li>IP is the IP address of the node</li>
<li>PIP is the proxy IP of the node if set</li>
<li>PT is the IAX port</li>
<li>RH is the registration server the node last registered to.</li>
</ul>
<h2 id="adv-topics-dns-servers-asl-node-lookup"><code>asl-node-lookup</code></h2>
<p>On ASL3 systems, the <a href="#mans-asl-node-lookup"><code>asl-node-lookup</code></a> command can also be used to query the DNS servers for information about a node.</p></section><section class="print-page" id="adv-topics-eurorptr"><h1 id="adv-topics-eurorptr-european-repeater-operation">European Repeater Operation</h1>
<p>We realize that there are different requirements for repeater operation in different parts of the world. Until recently, we have not dealt much with these, not out of insensitivity, but out of unfamiliarity.</p>
<p>Two things have been brought to our attention that we have added functionality to support.</p>
<h2 id="adv-topics-eurorptr-id-beaconing">ID Beaconing</h2>
<p>In the UK, it is necessary for a repeater to identify on a periodic basis, regardless of activity. This is controlled with the <a href="#config-rpt_conf-beaconing"><code>beaconing</code></a> setting in <a href="#config-rpt_conf"><code>rpt.conf</code></a>. </p>
<p>To enable this feature, set the <code>beaconing</code> option to <code>1</code> in the <a href="#config-rpt_conf-node-number-stanza">Node Number Stanza</a>:</p>
<div class="highlight"><pre><span></span><code>beaconing = 1                       ; Periodically identify at the idtime interval, regardless of activity
</code></pre></div>
<p>This option, when set to <code>1</code> will send the repeater ID at the <a href="#config-rpt_conf-idtime"><code>idtime</code></a> interval, regardless of whether there was repeater activity or not. By default (if not defined) this option is disabled.</p>
<h2 id="adv-topics-eurorptr-rx-toneburst">RX Toneburst</h2>
<p>Also, many countries still require access to the repeater be with a tone burst (generally 1750 Hz). See the <a href="#adv-topics-rxtoneburst">RX Toneburst</a> page for how to enable that feature.</p></section><section class="print-page" id="adv-topics-hotspot_hd"><h1 id="adv-topics-hotspot_hd-hot-spot-un-key-delay">Hot Spot Un-key Delay</h1>
<p>When setting up a hot spot, select the <code>Duplex 1</code> option in <a href="#user-guide"><code>asl-menu</code></a> to allow the hot spot to function. However, the un-key delay of the radio transmitter will likely be too long.</p>
<p>These steps will shorten the un-key delay and will greatly improve hot spot responsiveness:</p>
<p>From the Linux CLI, launch the <code>asl-menu</code> with <code>sudo asl-menu</code>. Select the following options:</p>
<ul>
<li>Select <code>6. Expert Configuration Menu</code></li>
<li>Select <code>1. Edit rpt.conf</code></li>
<li>Select <code>2. /bin/nano   &lt;---- easiest</code> if asked</li>
<li>Scroll down below the line with <code>[&lt;your node number&gt;](node-main)</code></li>
<li>On a blank line that is above <code>[functions]</code><ul>
<li>Type <code>wait_times = wait-times_hd</code></li>
<li>Press enter and type <code>hangtime=100</code></li>
<li>Save with ctrl-x, enter, yes</li>
</ul>
</li>
<li>On the <code>asl-menu</code> select <code>&lt;Back to Main Menu&gt;</code></li>
<li>Select <code>1. Node Settings</code></li>
<li>Select <code>2. Restart Asterisk</code></li>
<li>Select <code>&lt;Back&gt;</code></li>
<li>Select <code>&lt;Exit Main Menu&gt;</code></li>
<li>Select <code>&lt;Yes&gt;</code></li>
</ul>
<p>This setup will likely be a single menu selection with the next release of ASL3.</p></section><section class="print-page" id="adv-topics-httpreg"><h1 id="adv-topics-httpreg-http-based-registration">HTTP-Based Registration</h1>
<p>AllStarLink is moving from IAX2 to HTTP registration. ASL3 has a new module for HTTP registration, which is used by default.</p>
<p>The associated config file is <code>/etc/asterisk/rpt_http_registrations.conf</code>. The setting values are the same as they were in IAX2 registration.</p>
<p>When you configure your node with <a href="#user-guide"><code>asl-menu</code></a>, no action is required. The <code>asl-menu</code> utility will populate the config file accordingly to enable HTTP registration.</p>
<p>The contents of the <code>rpt_http_registrations.conf</code> file would typically look something like:</p>
<div class="highlight"><pre><span></span><code>[General]

[registrations]
;Change the register =&gt; line to match your assigned node number and password.
register =&gt; 1999:password@register.allstarlink.org    ; This must be changed to your node number, password
</code></pre></div>
<p>While <a href="#adv-topics-iaxreg">IAX registration</a> still works, please <em>do not</em> register with both HTTP and IAX. That would result in unnecessary server load for no gain. </p>
<p>The long term plan is to do away with IAX registration. HTTP registration allows load balancing and other advantages not available with IAX. The ASL2 IAX module has been replaced with the Asterisk LTS IAX2 module for upstream compatibility.</p>
<p>If you feel you absolutely need to use IAX registration, see the <a href="#adv-topics-iaxreg">IAX-Based Registration</a> page in this section for more information.</p></section><section class="print-page" id="adv-topics-iaxreg"><h1 id="adv-topics-iaxreg-iax-based-registration">IAX-Based Registration</h1>
<p>This documents how to use IAX-based registration instead of <a href="#adv-topics-httpreg">HTTP-based</a> registration with ASL3.</p>
<div class="admonition danger">
<p class="admonition-title">Do Not Do This "Just Because"</p>
<p>Only convert your node to using IAX-based registration because you have a known problem using HTTP registration. Use of IAX registration requires significantly higher server use than HTTP registration, and 99+% of all users <strong>DO NOT</strong> have a reason to use it.</p>
</div>
<h2 id="adv-topics-iaxreg-reason-to-use-iax-based-registration">Reason to use IAX-Based Registration</h2>
<p>The following are the <strong><em>only</em></strong> reasons to use IAX-based registration with ASL3:</p>
<ol>
<li>
<p><strong>Outbound</strong> HTTP/HTTPS is blocked, but you have outbound UDP port access available. For example, your node sits behind a proxy or other security or content filtering device that breaks ASLv3 registration. If you can browse web pages on your internet connection, this is <strong>not</strong> your situation.</p>
</li>
<li>
<p>Your node is behind a connection that handles HTTP traffic differently than IAX traffic. Known examples are AT&amp;T and T-Mobile hotspots. These hotspots intercept/direct web (HTTP/HTTPS) traffic and route it differently from IAX traffic. In these cases, the HTTP-based registration will register a proxy/accelerator IP address, rather than the IP being used by the node.</p>
</li>
</ol>
<h2 id="adv-topics-iaxreg-using-iax-registration-instead-of-http-registration">Using IAX Registration Instead of HTTP Registration</h2>
<p>To change from HTTP to IAX registration, do the following <strong>as root</strong> (i.e. use <code>sudo -s</code>):</p>
<ol>
<li>
<p>Edit <code>/etc/asterisk/modules.conf</code> and change the line for <code>res_rpt_http_registrations.so</code> from "load" to "noload":</p>
<div class="highlight"><pre><span></span><code>noload =&gt; res_rpt_http_registrations.so
</code></pre></div>
</li>
<li>
<p>Edit <code>/etc/asterisk/iax.conf</code> and add a <code>register =&gt;</code> line under the <code>[general]</code> stanza. This can be copied from a functional <code>rpt_http_registrations.conf</code> file:</p>
<div class="highlight"><pre><span></span><code>[general]
register =&gt; 63001:VerySecret@register.allstarlink.org
</code></pre></div>
</li>
<li>
<p>Restart Asterisk with <code>systemctl restart asterisk</code></p>
</li>
<li>
<p>Run the Asterisk CLI with <code>asterisk -r</code> and test the IAX registration with the command <code>iax2 show registry</code>:</p>
<div class="highlight"><pre><span></span><code>node63001*CLI&gt; iax2 show registry
Host                  dnsmgr  Username  Perceived                 Refresh  State
34.105.111.212:4569   Y       63001     192.0.2.171:4569          180      Registered
</code></pre></div>
<p>If it lists "State" as "Registered" you're all set.</p>
</li>
</ol></section><section class="print-page" id="adv-topics-litz"><h1 id="adv-topics-litz-long-tone-zero-litz">Long Tone Zero (LiTZ)</h1>
<p>LiTZ is a simple method to indicate to others on an amateur VHF / UHF FM radio frequency that you have an immediate need to communicate with someone, anyone, regarding a priority situation or condition.</p>
<p>LiTZ stands for Long Tone Zero (i-added to make it easier to pronounce). The LiTZ signal consists of transmitting DTMF ZERO for at least 3 seconds. After sending the LiTZ signal, the node executes a pre-programmed DTMF control sequence.</p>
<p>The parameters for setting the command string, for overriding the default DTMF tone for LITZ mode, and the required time for activation are as follows:</p>
<div class="highlight"><pre><span></span><code>litzchar = 0     ; DTMF character required to initiate the LiTZ feature (default is 0)
litzcmd = *6911  ; Command sequence to execute upon LiTZ activation -- Call 911 on autopatch (default is not set)
litztime = 3000  ; Time required to hold down DTMF (default is 3000mS)
</code></pre></div>
<p>The above options would be placed in the node's configuration stanza in <code>rpt.conf</code>.</p>
<p>By default, <code>litzcmd</code> is not set (blank), which disables the feature (as even if a user sends <code>litzchar</code> for <code>litztime</code>, there is nothing to execute).</p></section><section class="print-page" id="adv-topics-macros"><h1 id="adv-topics-macros-macros">Macros</h1>
<h2 id="adv-topics-macros-what-is-a-macro">What is a 'macro'?</h2>
<p>The purpose of a macro is to store a sequence of DTMF command(s). Macros may be called by direct command, by the system scheduler, or even by an external script. They can be a series of commands to make short work of a larger task.</p>
<h2 id="adv-topics-macros-define-function">Define Function</h2>
<p>The first thing to configure when setting up macros is to define the <a href="#config-rpt_conf-functions"><code>[function]</code></a> that will call them.</p>
<p>This will define the DTMF prefix that will be used for calling macros.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>[functions]
5 = macro
</code></pre></div>
<p>This will make <code>5</code> the prefix for calling a macro. Remember that the actual command needs to be prefixed with <a href="#config-rpt_conf-funcchar"><code>funcchar</code></a>, which is typically <code>*</code>. So in this case, <code>*512</code> would call macro 12 (defined in the <code>[macro]</code> stanza). </p>
<h2 id="adv-topics-macros-configuring-macro-stanzas">Configuring Macro Stanzas</h2>
<p>The next part of macro settings is the <a href="#config-rpt_conf-macro"><code>macro=</code></a> setting in <a href="#config-rpt_conf"><code>rpt.conf</code></a>. The example here points to a stanza named <code>[macro]</code>. This is likely already in your config. If the <code>macro=</code> setting does not exist, the default is to use a stanza named <code>[macro]</code>.  </p>
<div class="highlight"><pre><span></span><code>[1999]                              ; Assigned node number
rxchannel = SimpleUSB/1999          ; Rx audio/signaling channel
duplex=2
linktolink=no
controlstates=controlstates         ; System control state list
scheduler=scheduler
events=events
morse=morse
macro=macro                         ; &lt;===== note this in your rpt.conf, if it exists
tonemacro=tonemacro
functions=functions
phone_functions=phone_functions
link_functions=link_functions
wait_times=wait_times
telemetry=telemetry
</code></pre></div>
<p>If you have more than one node on a given server and you want all nodes to have the same macros, then the above <code>macro=macro</code> (or nothing defined) is fine. If you want to assign different macros to different nodes on the server, see the <a href="#config-config-structure-settings-to-name-other-stanzas">Structure of Config Files</a> page which outlines how to redirect names to call other stanzas.</p>
<p>Then, later in <code>rpt.conf</code> you need an actual <code>[macro]</code> stanza:</p>
<div class="highlight"><pre><span></span><code>[macro]
1=*81#                              ; Say time
2=*81 P *31999 P *934#              ; Say time, pause, connect node 1999, pause, and turn off telemetry for net
3=*31999 *934 *512#                 ; Here we connect node 1999, turn off telemetry, then call macro (12). 
12=*949#                            ; Disable incoming connections
</code></pre></div>
<h2 id="adv-topics-macros-macro-definitions">Macro Definitions</h2>
<p>Finally, define each desired macro in the appropriate <code>[macro]</code> stanza.</p>
<p>Each macro command string is on the same line separated by a space, and ending the string with a <code>#</code> (hashtag). </p>
<p>A <code>P</code> can be used to cause a pause of 500mS, or a series of them for more. This would allow time for a script or connection to execute before the next command is issued. The system reads/executes them left to right when called. You should test them after creating them to be sure timing has no interference before you actually need to use them. </p>
<p>Looking at the above example, you can see how multiple DTMF commands can be chained together into a single macro, so that you wouldn't have to execute the commands individually.</p>
<p>And note that use of our macro 2 (executed as <code>*52</code>) might also require us to create a new one to 'undo' any of our changes. Which, in this case, might be manually called at the end of the net.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>4=*11999 P *933#                    ; End of net macro, unlink from node 1999 and turn telemetry back on
</code></pre></div>
<h1 id="adv-topics-macros-scheduler-execution">Scheduler Execution</h1>
<p>With the example configuration shown, macros are called with a <code>*5</code> prefix and followed with the number assigned in the [macro] stanza.</p>
<p>You can also call them from the system schedular by number. Calling a macro number is the only method the scheduler supports. So if you wish to schedule with the system scheduler, you need a macro to execute it.</p></section><section class="print-page" id="adv-topics-multinodesnetwork"><h1 id="adv-topics-multinodesnetwork-multiple-nodes-on-the-same-network">Multiple Nodes on the Same Network</h1>
<p>Multiple AllStarLink nodes on the same IP subnet (i.e. your "local network" or "LAN") when those nodes are behind a NAT device can be a challenge. The reason is that AllStarLink works exclusively with public IP addresses. </p>
<p>When two (or more) nodes are on the same network behind the same NAT/router, they independently need to use a public IP address with the AllStarLink system, and they also need to know about each other's local IPs (rather than their shared public IP). Additionally, both nodes cannot use the same UDP port as they will fight over it with the NAT/router.</p>
<p>For this example, let's consider two nodes on the same subnet (LAN). The nodes are:</p>
<table>
<thead>
<tr>
<th>Node</th>
<th>Local IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>630010</td>
<td>192.168.0.10</td>
</tr>
<tr>
<td>630011</td>
<td>192.168.0.11</td>
</tr>
</tbody>
</table>
<p>These nodes are behind a NAT/router with a public IP address of 203.0.113.186.</p>
<p>When each node connects and registers with AllStarLink, its perceived registration IP address will be 203.0.113.186. If another node asks "where is node 630010" it would get back the answer 203.0.113.186. However, this is also the case for the internal nodes. If node 630011 asks "where is node 630010" it also gets back 203.0.113.186. For various network reasons, this will not work.</p>
<p>One also has to consider the UDP port. By default, each Asterisk system uses the default UDP port of <code>4569</code>. This is a published standard. However, through a NAT device, only one system can use the port at a time. Thus our local nodes 630010 and 630011 will fight over that port.</p>
<p>To make two (or more) nodes on the same network function, the following steps must be taken:</p>
<ol>
<li>Assign each node's server a different IAX port</li>
<li>Tell each node's server about the other node's internal address and port</li>
</ol>
<p>In this example, node 630011 will be assigned a different UDP port. The table then of the nodes is:</p>
<table>
<thead>
<tr>
<th>Node</th>
<th>Local IP</th>
<th>Port</th>
</tr>
</thead>
<tbody>
<tr>
<td>630010</td>
<td>192.168.0.10</td>
<td>UDP 4569</td>
</tr>
<tr>
<td>630011</td>
<td>192.168.0.11</td>
<td>UDP 4570</td>
</tr>
</tbody>
</table>
<p>This document assumes one knows how to forward the port internally for one's router/NAT device and that is has already been done.</p>
<h2 id="adv-topics-multinodesnetwork-assigning-a-different-iax-port">Assigning a Different IAX Port</h2>
<p>There are two places where the IAX port must be changed when using a non-standard port:</p>
<ol>
<li><code>/etc/asterisk/iax.conf</code></li>
<li>The <a href="https://allstarlink.org/portal/">AllStarLink Portal</a> for that node's server</li>
</ol>
<h3 id="adv-topics-multinodesnetwork-changing-iaxconf">Changing <code>iax.conf</code></h3>
<p>The best way to edit the IAX port is to use <a href="#user-guide"><code>asl-menu</code></a>. Run <code>sudo asl-menu</code>. Choose <strong>1 Node Settings</strong> and then <strong>4 Update Asterisk IAX port</strong>. Set the new UDP port in the box and hit <strong>OK</strong>. Then choose <strong>2 Restart Asterisk</strong>. Then close <code>asl-menu</code>.</p>
<p>Alternatively, edit the file directly. As root (i.e. <code>sudo -s</code>), edit the file <code>/etc/asterisk/iax.conf</code>. Find the line:</p>
<div class="highlight"><pre><span></span><code>bindport = 4569
</code></pre></div>
<p>and change it to a different port. The ASL3 appliance comes pre-configured to permit traffic on any port between <code>4560</code> and <code>4580</code>. It is recommended to choose a port in this range for any alternative IAX port. In this example, the node 630011 will be changed to port <code>4570</code>. Edit the file to state:</p>
<div class="highlight"><pre><span></span><code>bindport = 4570
</code></pre></div>
<p>and save and close the file. Restart Asterisk with <code>systemctl restart asterisk</code>.</p>
<h3 id="adv-topics-multinodesnetwork-changing-the-portal">Changing the Portal</h3>
<div class="admonition note">
<p class="admonition-title">Server-Node Relationship</p>
<p>Following the operating model, the base <code>Asterisk/app_rpt</code> installation is the "Server" and a "Server" hosts one or more "Nodes". Make sure that each node is assigned to a  different server if the nodes are configured on different installations.</p>
</div>
<p>Do the following to change a node's server's IAX port.</p>
<ol>
<li>
<p>Logon to <a href="https://allstarlink.org">https://allstarlink.org</a> using your AllStarLink username and password.</p>
</li>
<li>
<p>Click on <strong>Portal</strong> and then <strong>Node Settings</strong>.</p>
</li>
<li>
<p>In the table, find the Server for the node you want to edit. In this example node 630011 is located on server node63011. Remember or jot down the server name.</p>
</li>
<li>
<p>Click on <strong>Portal</strong> and then <strong>Server Settings</strong>.</p>
</li>
<li>
<p>Click on the server from step #4 (in this case "node630011")</p>
</li>
<li>
<p>In the field <strong>IAX Port</strong> change the port number to the port configured in <a href="#adv-topics-multinodesnetwork-changing-iaxconf">Changing <code>iax.conf</code></a> above. In this example, the port will be <code>4570</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong></p>
</li>
</ol>
<p>Propagation of the change takes 1-2 minutes.</p>
<h2 id="adv-topics-multinodesnetwork-telling-local-nodes-about-their-neighbors">Telling Local Nodes About Their Neighbors</h2>
<p>Each node on the same network needs to be hardcoded with information about the other node. In this example, node 630010 needs to be hardcoded for where 630011 is and vice-versa.</p>
<h3 id="adv-topics-multinodesnetwork-configuring-node-630010">Configuring Node 630010</h3>
<p>As root (i.e. <code>sudo -s</code>) edit the file <code>/etc/asterisk/rpt.conf</code>. Locate the line with the node's own definition. For example:</p>
<div class="highlight"><pre><span></span><code>630010 = radio@127.0.0.1/630010,NONE
</code></pre></div>
<p>After this line, add its local neighbor by its IP address <em>and</em> the alternative IAX port. In this example, add 630011 as follows:</p>
<div class="highlight"><pre><span></span><code>630010 = radio@127.0.0.1/630010,NONE
630011 = radio@192.168.0.11:4570/630011,NONE
</code></pre></div>
<p>Note the inclusion of the port as <code>:4570</code>. This pattern can be repeated for multiple nodes on the same network. Save the file and restart asterisk with <code>systemctl restart asterisk</code>.</p>
<h3 id="adv-topics-multinodesnetwork-configuring-node-630011">Configuring Node 630011</h3>
<p>The other node repeats same process but in the opposite direction. As root (i.e. <code>sudo -s</code>) edit the file <code>/etc/asterisk/rpt.conf</code>. Locate the line with the node's own definition. For example:</p>
<div class="highlight"><pre><span></span><code>630011 = radio@127.0.0.1/630011,NONE
</code></pre></div>
<p>After this line, add its local neighbor by its IP address <em>and</em> the standard IAX port since it is unchanged. In this example, add 630010 as follows:</p>
<div class="highlight"><pre><span></span><code>630011 = radio@127.0.0.1/630011,NONE
630010 = radio@192.168.0.10:4569/630010,NONE
</code></pre></div>
<p>Note the inclusion of the port as <code>:4569</code>. This pattern can be repeated for multiple nodes on the same network. Save the file and restart asterisk with <code>systemctl restart asterisk</code>.</p>
<h3 id="adv-topics-multinodesnetwork-testing-linking-locally">Testing Linking Locally</h3>
<p>Test linking the two nodes together to ensure configuration. In this example, node 630010 will connect to node 630011 using the Asterisk CLI:</p>
<div class="highlight"><pre><span></span><code>rpt cmd 630010 ilink 3 630011
</code></pre></div>
<p>Then the link should be shown to 630011 with the command:</p>
<div class="highlight"><pre><span></span><code>rpt nodes 630010
</code></pre></div>
<p>that should display:</p>
<div class="highlight"><pre><span></span><code>node630010*CLI&gt; rpt nodes 630010

************************* CONNECTED NODES *************************

T630011
</code></pre></div>
<p>Disconnect the links with:</p>
<div class="highlight"><pre><span></span><code>rpt cmd 630010 ilink 1 630011
</code></pre></div>
<p>After that, everything should work. The most common issue with this configuration is incorrect router/NAT port forwarding or a typo in <code>rpt.conf</code>.</p></section><section class="print-page" id="adv-topics-nnx"><h1 id="adv-topics-nnx-node-number-extensions-nnx">Node Number Extensions (NNX)</h1>
<p>A Node Number Extension is a method to expand any issued node number to as many as ten node numbers. The reasons for this are to allow users to assign themselves sequential node numbers while preserving and expanding valuable node number space. The concept is very simple, allow users to optionally expand the length of any of their node numbers by one digit.</p>
<h2 id="adv-topics-nnx-nnx-example">NNX Example</h2>
<p>When a user with an existing node number selects to extend the number, they go to the portal and select to <strong>Extend</strong> a node, rather than <strong>Request</strong> a new node. The portal converts node xxxxx to xxxxx0 and adds node xxxx1 to the user’s node list. An additional eight NNX nodes may be added for a total of 10 sequential (xxxxx0 thru xxxxx9) node numbers. The reason xxxxx has to be changed to xxxxx0 is because AllStarLink would connect to node xxxxx when attempting to dial node xxxx1.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>Initial Node:                       63001
NNX Conversion:                     63001 --&gt; 630010
NNX Node Pool:                      630010 to 630019
</code></pre></div>
<p>Once the node user has reconfigured their node computer (if previously registered as xxxxx), both node numbers register, show on the AllStar nodes list, show on stats page, appear in <a href="#allmon3">Allmon3</a> and of course can connect or be connected to.   </p>
<div class="admonition note">
<p class="admonition-title">First Time Registration</p>
<p>New users that have not yet been issued a node number would <strong>Request</strong> their initial node number first. Then you can <strong>Extend</strong> the issued node number to allow up to ten nodes to be created. See the <a href="#basics-gettingstarted">Getting Started</a> section of the manual for information on requesting your initial node number.</p>
</div>
<h2 id="adv-topics-nnx-requirements">Requirements</h2>
<p>Use of NNX node numbers is totally optional, but strongly recommended. The prior node request process still exists. Existing and new users may continue to request new node numbers per current policy.</p>
<p>Users who opt to expand an existing node number will need to make configuration changes to their existing node (if configured). That is (using the example numbers above) all references to node 63001 will need to change to 630010. Fortunately, the <a href="#user-guide"><code>asl-menu</code></a> "Node Settings" menu allows you to change a node number, updating rpt.conf, rpt_http_registrations.conf, simpleusb.conf, usbradio.conf, voter.conf, extensions.conf, and allmon3.ini (if using <a href="#allmon3-config">Allmon3</a>). Reconfiguring all occurrences of the existing node number is critical. Such an oversight may confuse users and put an extra support load on system admins, at least initially.</p>
<div class="admonition note">
<p class="admonition-title">New Node Setup</p>
<p>If you are registering for a node number for the first time, it would be wise to extend your node number before you configure your new node for the first time. That way, you can have your xxxxx0 number ready to deploy, without having to reconfigure it after the fact. It also sets you up to easily deploy additional nodes, as your extended node numbers will already be available.</p>
</div>
<p>Adding NNX nodes xxxxx1 thru xxxxx9 is the same process as adding any additional node.  </p>
<h2 id="adv-topics-nnx-nnx-on-the-allstarlink-portal">NNX on the AllStarLink Portal</h2>
<p>Node Number Extension implementation on the AllStarLink Portal is shown below.</p>
<h3 id="adv-topics-nnx-request-initial-node-number">Request Initial Node Number</h3>
<p>Before you can complete Node Number Extension, you need an Initial Node Number. See the <a href="#basics-gettingstarted">Getting Started</a> page for instructions on how to request your Initial Node Number.</p>
<h3 id="adv-topics-nnx-extend-a-node-number">Extend a Node Number</h3>
<p>Log in to the <a href="https://www.allstarlink.org/portal">AllStarLink Portal</a> with your user credentials. From the <strong>Portal</strong> menu, choose <strong>Node Settings</strong>.</p>
<p><a class="glightbox" href="../adv-topics/img/1_NNX_Node_Settings.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Node Settings" src="../adv-topics/img/1_NNX_Node_Settings.png" width="400" /></a></p>
<p>You will see your current assigned nodes. Click <strong>Continue</strong> to proceed.</p>
<p><a class="glightbox" href="../adv-topics/img/2_NNX_Continue.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Node Settings Continue" src="../adv-topics/img/2_NNX_Continue.png" width="400" /></a></p>
<p>Ensure <strong>Extend</strong> is in bold (the currently selected tab), pick the node you want to extend from the drop down menu, then click <strong>Continue</strong>.</p>
<p><a class="glightbox" href="../adv-topics/img/3_NNX_Extend_Continue.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 Select Node" src="../adv-topics/img/3_NNX_Extend_Continue.png" width="400" /></a></p>
<p>Confirm that you indeed want to proceed with extending your node number.</p>
<p><a class="glightbox" href="../adv-topics/img/4_NNX_Extend_Confirm.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4 Proceed" src="../adv-topics/img/4_NNX_Extend_Confirm.png" width="400" /></a></p>
<p>You should see a <strong>Success</strong> message when your node has successfully been extended. Click <strong>OK</strong> to continue.</p>
<p><a class="glightbox" href="../adv-topics/img/5_NNX_Success.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5 Success" src="../adv-topics/img/5_NNX_Success.png" width="400" /></a></p>
<p>You will be returned to your Nodes page, showing your available node numbers. You should now see that you Initial Node Number has been extended (adding a <code>0</code> on the end), and a new node ending in <code>1</code> has also been created.</p>
<p><a class="glightbox" href="../adv-topics/img/6_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 6 New NNX" src="../adv-topics/img/6_NNX_New_Nodes.png" width="400" /></a></p>
<p>At this point, you can modify each node as desired. You can re-assign them to different servers, as well as modify their individual node parameters by clicking on the node number. You can now proceed with configuring your node on your actual server, using the <a href="#user-guide">ASL3 Menu</a> to complete your <code>Node Setup</code>. </p>
<p>If you wish to create additional nodes, see the next section.</p>
<h3 id="adv-topics-nnx-add-an-additional-nnx-node">Add an Additional NNX Node</h3>
<p>From the <strong>Node Settings</strong> page, click <strong>Continue</strong> to open the <strong>Extend/Request/Remove</strong> page.</p>
<p><a class="glightbox" href="../adv-topics/img/6_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 New NNX" src="../adv-topics/img/6_NNX_New_Nodes.png" width="400" /></a></p>
<p>To add another NNX Node, ensure you are on the <strong>Extend</strong> tab (it will be bold), choose the node you wish to add an additional NNX to from the drop down menu, then click <strong>Continue</strong>.</p>
<p><a class="glightbox" href="../adv-topics/img/7_NNX_Add.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Add New NNX" src="../adv-topics/img/7_NNX_Add.png" width="400" /></a></p>
<p>On the following screen, click <strong>Submit</strong> to add the next NNX in sequence.</p>
<p><a class="glightbox" href="../adv-topics/img/8_NNX_Add_Confirm.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 Add NNX Confirmation" src="../adv-topics/img/8_NNX_Add_Confirm.png" width="400" /></a></p>
<p>You should see a <strong>Success</strong> message when your additional node has been added. Click <strong>OK</strong> to continue.</p>
<p><a class="glightbox" href="../adv-topics/img/9_NNX_Add_Success.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4 Add NNX Success" src="../adv-topics/img/9_NNX_Add_Success.png" width="400" /></a></p>
<p>You will be returned to your Nodes page, your new NNX node number will now appear in your Nodes List.</p>
<p><a class="glightbox" href="../adv-topics/img/10_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5 New NNX Nodes List" src="../adv-topics/img/10_NNX_New_Nodes.png" width="400" /></a></p>
<p>At this point, you can modify each node as desired. You can re-assign them to different servers, as well as modify their individual node parameters by clicking on the node number. You can now proceed with configuring your node on your actual server, using the <a href="#user-guide">ASL3 Menu</a> to complete your <code>Node Setup</code>.</p>
<h3 id="adv-topics-nnx-revert-a-nnx-back-to-an-inn">Revert a NNX Back to an INN</h3>
<p>Should you decide that you no longer want to use extended node numbers, you can revert back from NNX to a base node number (Initial Node Number).</p>
<div class="admonition warning">
<p class="admonition-title">Deletes All NNX Nodes!!</p>
<p>Be warned, proceeding to revert your NNX node back to a base node number <strong>will delete all NNX node numbers</strong>. </p>
</div>
<p>From the <strong>Node Settings</strong> page, click <strong>Continue</strong> to open the <strong>Extend/Request/Remove</strong> page.</p>
<p><a class="glightbox" href="../adv-topics/img/6_NNX_New_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 NNX Node List" src="../adv-topics/img/6_NNX_New_Nodes.png" width="400" /></a></p>
<p>To revert your node, ensure you are on the <strong>Remove</strong> tab (it will be bold), choose the node you wish to revert, then click <strong>Continue</strong>.</p>
<p><a class="glightbox" href="../adv-topics/img/11_NNX_Revert.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 NNX Remove" src="../adv-topics/img/11_NNX_Revert.png" width="400" /></a></p>
<p>Next, you need to confirm that this is indeed what you want to do.</p>
<p><a class="glightbox" href="../adv-topics/img/12_NNX_Revert_Confirm.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 NNX Remove Confirm" src="../adv-topics/img/12_NNX_Revert_Confirm.png" width="400" /></a></p>
<p>You should see a <strong>Success</strong> message when your node has been reverted, and all your NNX nodes have been removed.</p>
<p><a class="glightbox" href="../adv-topics/img/13_NNX_Revert_Success.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 NNX Remove Success" src="../adv-topics/img/13_NNX_Revert_Success.png" width="400" /></a></p>
<p>You will be returned to your Nodes page, and your base node number will now appear in your Nodes List.</p>
<p><a class="glightbox" href="../adv-topics/img/14_NNX_Revert_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4 NNX Remove Nodes" src="../adv-topics/img/14_NNX_Revert_Nodes.png" width="400" /></a></p>
<h3 id="adv-topics-nnx-delete-a-base-node-number">Delete a Base Node Number</h3>
<p>If you wish to delete a node entirely from your account, follow the process below.</p>
<div class="admonition warning">
<p class="admonition-title">This Will Delete Your Node!</p>
<p>This process will delete your node entirely from the AllStarLink database, and return your node number to the pool for re-assignment.</p>
</div>
<p>From the <strong>Node Settings</strong> page, click <strong>Continue</strong> to open the <strong>Extend/Request/Remove</strong> page.</p>
<p><a class="glightbox" href="../adv-topics/img/14_NNX_Revert_Nodes.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1 Remove Node" src="../adv-topics/img/14_NNX_Revert_Nodes.png" width="400" /></a></p>
<p>To delete your node, ensure you are on the <strong>Remove</strong> tab (it will be bold), choose the node you wish to delete, then click <strong>Continue</strong>.</p>
<p><a class="glightbox" href="../adv-topics/img/15_NNX_Delete_Primary.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 2 Remove Node Continue" src="../adv-topics/img/15_NNX_Delete_Primary.png" width="400" /></a></p>
<p>Next, you will need to confirm that this is indeed what you want to do.</p>
<p><a class="glightbox" href="../adv-topics/img/17_Delete_Primary.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3 Confirm Delete" src="../adv-topics/img/17_Delete_Primary.png" width="400" /></a></p>
<p>At this point, you need to ensure that you wipe the configuration from any server that had this node number configured, as it will continue trying to register with AllStarLink, providing unnecessary strain on our resources.</p></section><section class="print-page" id="adv-topics-noderesolution"><h1 id="adv-topics-noderesolution-node-resolution">Node Resolution</h1>
<p><code>app_rpt</code> has three ways to resolve a node number to an IP address:</p>
<ul>
<li>Statically entered in <code>rpt.conf</code></li>
<li>Domain Name Service (DNS)</li>
<li>An external node directory file</li>
</ul>
<p>The above mechanisms are used to translate a node number into its respective public IP address. Connections are made directly between nodes using their public IP addresses.</p>
<p><code>app_rpt</code> first looks to see if the node is statically configured. If it is not found, the setting for <code>node_lookup_method</code> in the <code>[general]</code> stanza of <code>rpt.conf</code> determines the next step. The default setting is to perform a DNS lookup and if not found, attempt a lookup using the external file.</p>
<p>The operation of this ASL3 feature is controlled by the following information in <code>/etc/asterisk/rpt.conf</code>.</p>
<div class="highlight"><pre><span></span><code>[general]
node_lookup_method = both           ; method used to lookup nodes
                                    ; both = dns lookup first, followed by external file (default)
                                    ; dns = dns lookup only
                                    ; file = external file lookup only

; The domain name used for DNS lookups when the node lookup method is &quot;dns&quot; or
; &quot;both&quot;.  The default domain is &quot;nodes.allstarlink.org&quot; and does not need to
; be defined here.  Only set &quot;dns_node_domain&quot; if a) You really know what you&#39;re
; doing and b) you need to use an alternate DNS domain for node resolution.
;dns_node_domain = nodes.allstarlink.org

; When using DNS, &quot;app_rpt&quot; must know the length of the longest node number.
; The current maximum is 6 digits and does not need to be defined here. The
; &quot;max_dns_node_length&quot; variable can be used to limit queries to shorter (or
; longer) node numbers.
;max_dns_node_length = 6
</code></pre></div>
<p>The node lookup routines will output debug information showing the node lookups if the <a href="#user-guide-menu-debug-level">debug level</a> is set to <code>4</code> or higher.</p>
<p><strong>NOTE:</strong> The AllStarLink network maintains security by requiring node owners to register with AllStarLink. Before a node is published to our directory it must successfully authenticate and register with our server. See <a href="#adv-topics-httpreg">HTTP Registration</a> for more information.</p>
<h2 id="adv-topics-noderesolution-external-node-directory-file">External Node Directory File</h2>
<p><code>app_rpt</code> can use an external node directory file to perform node resolution. The <a href="https://github.com/AllStarLink/asl3-update-nodelist">asl3-update-nodeList</a> service is used to periodically download the current list of authenticated nodes.</p>
<p>You may need to install the necessary software package for this function to be available, that can be installed via <code>apt</code> using:</p>
<div class="highlight"><pre><span></span><code>sudo apt install asl3-update-nodelist
</code></pre></div>
<p>The name of this file is configured in <code>rpt.conf</code> using the <code>extnodefile=</code> key and value. By default the name of this file is <code>/var/lib/asterisk/rpt_extnodes</code>. Multiple files can be specified based on your requirements. The file names are separated with a comma.</p>
<p>When a file based lookup is performed, <code>app_rpt</code> reloads the external file before searching for a match. This allows external scripts the opportunity to keep the file updated.</p>
<p>Here is an example of the external file format:</p>
<div class="highlight"><pre><span></span><code>[extnodes]

2000=radio@162.248.93.134:4569/2000,162.248.93.134
2001=radio@162.248.93.134:4569/2001,162.248.93.134
</code></pre></div>
<h2 id="adv-topics-noderesolution-domain-name-service-dns">Domain Name Service (DNS)</h2>
<p>AllStarLink now provides a DNS service for performing node resolution. DNS is an Internet standard and is more efficient than using a file base solution.</p>
<p>When using DNS, <code>app_rpt</code> will query for node information from DNS records in the <code>nodes.allstarlink.org</code> domain.  The domain name can be overridden by adding a <code>node_dns_domain=</code> key and value (the query domain) to the <code>[general] stanza of the</code>rpt.conf` configuration file.</p>
<p>When using DNS, <code>app_rpt</code> must know the length of the longest node number. The current maximum is 6 digits. This number can be overridden by adding the <code>max_dns_node_length=</code> key and value to the <code>[general]</code> stanza of the <code>rpt.conf</code> configuration file.</p>
<p>For more information on DNS see <a href="#adv-topics-dns-servers">AllStarLink DNS Servers</a>.</p>
<h2 id="adv-topics-noderesolution-statically-configured-node">Statically Configured Node</h2>
<p>In some cases, it is desirable to statically define the node information. This is commonly used for private nodes or private networks.</p>
<p>To configure a static node, enter the information for the node in <code>rpt.conf</code> under the <code>[nodes]</code> stanza. Here is an example configuration:</p>
<div class="highlight"><pre><span></span><code>[nodes]
1001 = radio@192.168.0.1/1001,NONE
1998 = radio@127.0.0.1:4568/1998,NONE
1999 = radio@192.168.0.2:4569/1999,NONE
</code></pre></div></section><section class="print-page" id="adv-topics-other-software"><h1 id="adv-topics-other-software-other-software-products">Other Software Products</h1>
<p>The following information relates to software components related to AllStarLink.</p>
<h2 id="adv-topics-other-software-web-dashboards">Web Dashboards</h2>
<p>The primary web dashboard supported by AllStarLink is <a href="#allmon3">Allmon3</a>.</p>
<p>However, we know there are other dashboards available and everyone has their own personal favorite. We also know that some of the other dashboards make use of the database file, <code>astdb.txt</code>. Typically, this database has been downloaded by a PHP script (<code>astdb.php</code>) and updated with the help of boot scripts and cron jobs.</p>
<p>To support these other dashboards, we have included a <code>systemd</code> service to download and update the <code>astdb.txt</code> database. By default, this service and its associated timer are disabled. If you have installed a dashboard that is dependent on this database, you will need to execute the following commands:</p>
<div class="highlight"><pre><span></span><code>sudo systemctl enable asl3-update-astdb.service
sudo systemctl enable asl3-update-astdb.timer
sudo systemctl start asl3-update-astdb.timer
</code></pre></div></section><section class="print-page" id="adv-topics-parrotmode"><h1 id="adv-topics-parrotmode-parrot-mode">Parrot Mode</h1>
<p>Parrot Mode echos back the audio you transmit to the node. When a user keys up after parroting is enabled, the node's receive audio (your transmit) will be recorded and then played back a selectable amount of time later (<code>parrottime</code>) after the user un-keys.</p>
<h2 id="adv-topics-parrotmode-associated-cop-methods">Associated COP Methods</h2>
<p>The associated <a href="#config-rpt_conf-cop-commands">Control OPerator</a> commands/methods associated with Parrot Mode are:</p>
<table>
<thead>
<tr>
<th>COP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>21</td>
<td>Enable Parrot Mode</td>
</tr>
<tr>
<td>22</td>
<td>Disable Parrot Mode</td>
</tr>
<tr>
<td>23</td>
<td>"Birdbath" (cancel/flush parrot audio stream)</td>
</tr>
<tr>
<td>55</td>
<td>Parrot Once By Command</td>
</tr>
</tbody>
</table>
<h2 id="adv-topics-parrotmode-rptconf-settings"><code>rpt.conf</code> Settings</h2>
<p>In order for some of the Parrot Mode COP commands to function, <a href="#config-rpt_conf-parrot"><code>parrot</code></a> must be set to a zero value in <a href="#config-rpt_conf"><code>rpt.conf</code></a>.</p>
<h3 id="adv-topics-parrotmode-parrot"><code>parrot=</code></h3>
<p>Parrot Mode can be configured as follows:</p>
<table>
<thead>
<tr>
<th>parrot</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Parrot Mode Disabled</td>
</tr>
<tr>
<td>1</td>
<td>Parrot Mode Enabled</td>
</tr>
</tbody>
</table>
<h4 id="adv-topics-parrotmode-parrot-mode-disabled">Parrot Mode Disabled</h4>
<p>Parroting is disabled by default (<code>parrot = 0</code>).  When disabled in <code>rpt.conf</code>, parroting can be still be controlled using the <a href="#adv-topics-parrotmode-parrot-mode-with-cop-commands">Parrot Mode With COP Commands</a> and <a href="#adv-topics-parrotmode-parrot-mode-once-with-cop-command">Parrot Mode Once With COP Command</a>.</p>
<div class="highlight"><pre><span></span><code>parrot = 0                      ; Parrot mode off or enabled with COP commands (default = 0)
</code></pre></div>
<h4 id="adv-topics-parrotmode-parrot-mode-with-cop-commands">Parrot Mode With COP Commands</h4>
<p>This mode allows two COP commands (<code>cop,21</code>, <code>cop,22</code>) to be used to enable and disable Parrot Mode, respectively. Once Parrot Mode is enabled then all received signals will be echoed back until Parrot Mode is disabled. To select this mode, the value for <code>parrot</code> should be set to <code>0</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<h4 id="adv-topics-parrotmode-parrot-mode-once-with-cop-command">Parrot Mode Once With COP Command</h4>
<p>This mode, initiated with the <code>cop,55</code> COP command, allows Parrot Mode to be enabled for one transmission only. To select this mode, the value for <code>parrot</code> should be set to <code>0</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<p>Recording will commence as soon as the command is decoded, so the DTMF command to enable <code>cop,55</code> should be terminated with <a href="#config-rpt_conf-endchar"><code>endchar</code></a> and the user should <strong>not</strong> un-key (the recording starts immediately).</p>
<h4 id="adv-topics-parrotmode-parrot-mode-enabled-always">Parrot Mode Enabled (Always)</h4>
<p>This mode <strong>permanently</strong> places the node in Parrot Mode. This is useful when you want to make a simplex repeater, or a dedicated node for audio testing that echos everything it hears. The parrot enable and parrot disable COP commands will have <strong>no effect</strong> when operating in this mode. To select this mode, the value for <code>parrot</code> should be set to <code>1</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<div class="highlight"><pre><span></span><code>parrot = 1                          ; Parrot all audio, all the time
</code></pre></div>
<h3 id="adv-topics-parrotmode-parrottime"><code>parrottime</code></h3>
<p>The other setting associated with the above <code>parrot</code> modes is <code>parrottime</code>. <code>parrottime</code> set the time, in mS, that the system waits after the user un-keys, before playing back the recorded audio buffer.</p>
<div class="highlight"><pre><span></span><code>parrottime = 1000                   ; Wait 1s (1000ms) before playback
</code></pre></div>
<h2 id="adv-topics-parrotmode-functions">Functions</h2>
<p>The four COP methods should be mapped to DTMF sequences in the <a href="#config-rpt_conf-functions-stanza"><code>[functions]</code></a> stanza to enable them, as desired.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>921 = cop,21                        ; Enable Parrot Mode
922 = cop,22                        ; Disable Parrot Mode
923 = cop,23                        ; Birdbath (Current Parrot Cleanup/Flush)
955 = cop,55                        ; Parrot Once if parrot mode is disabled
</code></pre></div></section><section class="print-page" id="adv-topics-permanentnode"><h1 id="adv-topics-permanentnode-permanent-node-connection">Permanent Node Connection</h1>
<p>As opposed to a "normal" connection to a remote note, a "permanent" connection will attempt to create a <em>persistent</em> connection that will try and keep the nodes connected together as much as possible.</p>
<p>Specifically, permanent connections:</p>
<ul>
<li>Will continuously attempt to reconnect</li>
<li>Survive network outages and <strong>far end</strong> reboots</li>
<li><strong>Near end</strong> reboots will <strong>NOT</strong> reconnect (use <a href="#config-rpt_conf-startup_macro"><code>startup_macro</code></a> for that)</li>
<li>Must be disconnected by a "permanent disconnect" (<code>ilink,11</code>) command</li>
<li>Either end may initiate the disconnect</li>
<li>Does not block nodes from subsequently connecting again (use <a href="#adv-topics-allowdenylists">Allow and Deny Lists</a> for that)</li>
</ul>
<p>You could, for example, utilize this to keep your VHF and UHF repeaters (nodes) linked together "permanently", or keep a node connected to a (private) node that might be a UHF link to another system. </p>
<h1 id="adv-topics-permanentnode-configuration">Configuration</h1>
<p>The following commands should already exist in <a href="#config-rpt_conf"><code>rpt.conf</code></a>, but may need to be uncommented under your <a href="#config-rpt_conf-functions-stanza"><code>[functions]</code></a> stanza:</p>
<div class="highlight"><pre><span></span><code>811 = ilink,11                      ; Disconnect a previously permanently connected link
812 = ilink,12                      ; Permanently connect specified link -- monitor only
813 = ilink,13                      ; Permanently connect specified link -- transceive
818 = ilink,18                      ; Permanently Connect specified link -- local monitor only
</code></pre></div>
<p>In other words a <code>*813nnnnn</code> DTMF command will permanent connect your node to the node number represented by nnnnn.</p>
<p>If you would like a permanent connection automatically when your node boots you need a <a href="#config-rpt_conf-startup_macro"><code>startup_macro</code></a> to initiate the initial connection. </p>
<p>For example, under your <a href="#config-rpt_conf-node-number-stanza">Node Number Stanza</a> add:</p>
<div class="highlight"><pre><span></span><code>startup_macro = *8131999            ; Permanently connect (transceive) to node 1999 when Asterisk starts            
</code></pre></div>
<p>Reload/restart your system and it will auto connect to the node you specified above.</p></section><section class="print-page" id="adv-topics-parrotmode"><h1 id="adv-topics-parrotmode-parrot-mode">Parrot Mode</h1>
<p>Parrot Mode echos back the audio you transmit to the node. When a user keys up after parroting is enabled, the node's receive audio (your transmit) will be recorded and then played back a selectable amount of time later (<code>parrottime</code>) after the user un-keys.</p>
<h2 id="adv-topics-parrotmode-associated-cop-methods">Associated COP Methods</h2>
<p>The associated <a href="#config-rpt_conf-cop-commands">Control OPerator</a> commands/methods associated with Parrot Mode are:</p>
<table>
<thead>
<tr>
<th>COP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>21</td>
<td>Enable Parrot Mode</td>
</tr>
<tr>
<td>22</td>
<td>Disable Parrot Mode</td>
</tr>
<tr>
<td>23</td>
<td>"Birdbath" (cancel/flush parrot audio stream)</td>
</tr>
<tr>
<td>55</td>
<td>Parrot Once By Command</td>
</tr>
</tbody>
</table>
<h2 id="adv-topics-parrotmode-rptconf-settings"><code>rpt.conf</code> Settings</h2>
<p>In order for some of the Parrot Mode COP commands to function, <a href="#config-rpt_conf-parrot"><code>parrot</code></a> must be set to a zero value in <a href="#config-rpt_conf"><code>rpt.conf</code></a>.</p>
<h3 id="adv-topics-parrotmode-parrot"><code>parrot=</code></h3>
<p>Parrot Mode can be configured as follows:</p>
<table>
<thead>
<tr>
<th>parrot</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Parrot Mode Disabled</td>
</tr>
<tr>
<td>1</td>
<td>Parrot Mode Enabled</td>
</tr>
</tbody>
</table>
<h4 id="adv-topics-parrotmode-parrot-mode-disabled">Parrot Mode Disabled</h4>
<p>Parroting is disabled by default (<code>parrot = 0</code>).  When disabled in <code>rpt.conf</code>, parroting can be still be controlled using the <a href="#adv-topics-parrotmode-parrot-mode-with-cop-commands">Parrot Mode With COP Commands</a> and <a href="#adv-topics-parrotmode-parrot-mode-once-with-cop-command">Parrot Mode Once With COP Command</a>.</p>
<div class="highlight"><pre><span></span><code>parrot = 0                      ; Parrot mode off or enabled with COP commands (default = 0)
</code></pre></div>
<h4 id="adv-topics-parrotmode-parrot-mode-with-cop-commands">Parrot Mode With COP Commands</h4>
<p>This mode allows two COP commands (<code>cop,21</code>, <code>cop,22</code>) to be used to enable and disable Parrot Mode, respectively. Once Parrot Mode is enabled then all received signals will be echoed back until Parrot Mode is disabled. To select this mode, the value for <code>parrot</code> should be set to <code>0</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<h4 id="adv-topics-parrotmode-parrot-mode-once-with-cop-command">Parrot Mode Once With COP Command</h4>
<p>This mode, initiated with the <code>cop,55</code> COP command, allows Parrot Mode to be enabled for one transmission only. To select this mode, the value for <code>parrot</code> should be set to <code>0</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<p>Recording will commence as soon as the command is decoded, so the DTMF command to enable <code>cop,55</code> should be terminated with <a href="#config-rpt_conf-endchar"><code>endchar</code></a> and the user should <strong>not</strong> un-key (the recording starts immediately).</p>
<h4 id="adv-topics-parrotmode-parrot-mode-enabled-always">Parrot Mode Enabled (Always)</h4>
<p>This mode <strong>permanently</strong> places the node in Parrot Mode. This is useful when you want to make a simplex repeater, or a dedicated node for audio testing that echos everything it hears. The parrot enable and parrot disable COP commands will have <strong>no effect</strong> when operating in this mode. To select this mode, the value for <code>parrot</code> should be set to <code>1</code> in the <a href="#config-rpt_conf-node-number-stanza"><code>Node Number Stanza</code></a>:</p>
<div class="highlight"><pre><span></span><code>parrot = 1                          ; Parrot all audio, all the time
</code></pre></div>
<h3 id="adv-topics-parrotmode-parrottime"><code>parrottime</code></h3>
<p>The other setting associated with the above <code>parrot</code> modes is <code>parrottime</code>. <code>parrottime</code> set the time, in mS, that the system waits after the user un-keys, before playing back the recorded audio buffer.</p>
<div class="highlight"><pre><span></span><code>parrottime = 1000                   ; Wait 1s (1000ms) before playback
</code></pre></div>
<h2 id="adv-topics-parrotmode-functions">Functions</h2>
<p>The four COP methods should be mapped to DTMF sequences in the <a href="#config-rpt_conf-functions-stanza"><code>[functions]</code></a> stanza to enable them, as desired.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>921 = cop,21                        ; Enable Parrot Mode
922 = cop,22                        ; Disable Parrot Mode
923 = cop,23                        ; Birdbath (Current Parrot Cleanup/Flush)
955 = cop,55                        ; Parrot Once if parrot mode is disabled
</code></pre></div></section><section class="print-page" id="adv-topics-permissions"><h1 id="adv-topics-permissions-permissions">Permissions</h1>
<h2 id="adv-topics-permissions-asterisk-vs-root"><code>asterisk</code> vs <code>root</code></h2>
<p>One of the new features with ASL3 is that the Asterisk process now runs as the <code>asterisk</code> user (not as the super-user, <code>root</code>). While sometimes handy, this was potentially very dangerous. This change was made for increased security. It's a good thing!</p>
<p>We acknowledge that there are some applications, commands, and scripts that you may want to bring over from older (and other) versions of ASL and that these may be impacted by ASL3's heightened security. Porting these over to ASL3 may require some simple changes to filesystem permissions.</p>
<p>Other issues may need other solutions (e.g. you can't execute a command that requires <code>root</code> privileges when you are not the <code>root</code> user).</p>
<p>For guidance, reach out to the <a href="https://community.allstarlink.org/">AllStarLink Community</a>.</p>
<p>In short, in ASL3 the Asterisk process now runs as the <code>asterisk</code> user. If you modify the <code>/etc/asterisk/rpt.conf</code> file to execute a command (or script) it will NOT have super-user (<code>root</code>) privileges. The command itself and any file it references must be readable by the <code>asterisk</code> user. Any files that the command needs to modify must be writable by the <code>asterisk</code> user. Lastly, the parent directory of any file being created must also be writable.</p>
<div class="admonition warning">
<p class="admonition-title">Asterisk User and Sudo</p>
<p>Do not give general access to <code>sudo</code> to the <code>asterisk</code> user. This is very <strong>dangerous</strong> and poor practice. While people will state, "I've always done it this way" it is, in fact, a serious security risk. As AllStarLink is run on the public internet for many repeater sites, the development team prioritizes security of the system. For common uses of this, namely restarting services and shutting down a node, see <a href="#adv-topics-permissions-managing-services-and-os-shutdownsreboots">Managing Services and OS Shutdowns/Reboots</a>.</p>
</div>
<h2 id="adv-topics-permissions-filesystem-permissions">Filesystem Permissions</h2>
<p>The following is a very brief overview of Linux filesystem permissions. More in-depth information is available on the internet (search for “linux file permissions”).</p>
<p>On a Linux system, each file (and directory) has permissions that effect access by the “owner”, permissions that effect access to those logins in the same “group”, and permissions that effect access to “other” logins. The permissions determine whether you (or some other process) can read, write, or execute the files (or search in directories). There are commands to change the ownership (<code>chown</code>) and permissions (<code>chmod</code>) for each file/directory.</p>
<h3 id="adv-topics-permissions-file-permissions">File permissions</h3>
<p>You can use the <code>ls -l [FILE]</code> command to view file permissions. The permissions determine whether the calling process can read (<code>r</code>), write (<code>w</code>), or execute (<code>x</code>) the file.</p>
<p>Here are some examples:</p>
<div class="highlight"><pre><span></span><code>node63001:~/examples $ ls -l *file*
-rw------- 1 root root     0 Aug  5 08:28 1-file-owner-root-can-read-write
-rw-r----- 1 root asterisk 0 Aug  5 08:28 2-file-add-group-asterisk-can-read
-rw-r--r-- 1 root asterisk 0 Aug  5 08:27 3-file-add-everyone-can-read

node63001:~/examples $ ls -l *script*
-rwx------ 1 root root     0 Aug  5 08:28 1-script-owner-root-can-read-write-execute
-rwxr-x--- 1 root asterisk 0 Aug  5 08:28 2-script-add-group-asterisk-can-read-execute
-rwxr-xr-x 1 root asterisk 0 Aug  5 08:27 3-script-add-everyone-can-read-execute
</code></pre></div>
<p>In each case, the file permissions progress from the most restrictive (only the file owner can read/execute) to most available (all users can read/execute).</p>
<h3 id="adv-topics-permissions-directory-permissions">Directory permissions</h3>
<p>You can use the <code>ls -ld &lt;directory&gt;</code> command to view the permissions on a directory (vs. the contents of a directory). The permissions determine whether the calling process can read (<code>r</code>), write (<code>w</code>), or search (<code>x</code>) the directory.</p>
<p>Here are some examples:</p>
<div class="highlight"><pre><span></span><code>node63001:~/examples $ ls -ld *dir*
drwx------ 2 root root     4096 Aug  5 09:56 1-dir-owner-root-can-read-write-search
drwxr-x--- 2 root asterisk 4096 Aug  5 09:56 2-dir-add-group-asterisk-can-read-search
drwxr-xr-x 2 root asterisk 4096 Aug  5 09:56 3-dir-add-everyone-can-read-search
</code></pre></div>
<p>In each case, the directory permissions progress from the most restrictive (only the directory owner can read/write/search) to most available (all users can read/search).</p>
<h3 id="adv-topics-permissions-changing-permissions">Changing permissions</h3>
<p>The following commands can be used to change the permissions of files and directories:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Sample Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>chown</td>
<td>change file owner and group</td>
<td><code># chown root /var/asl-backups/asl-backup-files</code></td>
</tr>
<tr>
<td>chgrp</td>
<td>change group ownership</td>
<td><code># chgrp asterisk /var/spool/asterisk/monitor</code></td>
</tr>
<tr>
<td>chmod</td>
<td>change file mode bits</td>
<td><code># chmod 640 /etc/asterisk/manager.conf</code></td>
</tr>
</tbody>
</table>
<p>Any process with "write" permission to a file can update (including completely overwrite) the file. A process with "write" permission to a directory can add/remove/rename files in that directory. If a command/script is writable then it can be changed to "do something different" when it is next executed.</p>
<p>When updating filesystem permissions, please remember that doing so can potentially expose the contents of files (and directories) to others.</p>
<p>Be cautious!</p>
<h3 id="adv-topics-permissions-managing-services-and-os-shutdownsreboots">Managing Services and OS Shutdowns/Reboots</h3>
<p>ASL3 comes with a PolicyKit ruleset to permit the <code>asterisk</code> user to execute a limited number of commands without the need for <code>sudo</code> or prompting for a password. Those commands are:</p>
<ul>
<li><code>systemctl stop asterisk</code></li>
<li><code>systemctl restart asterisk</code></li>
<li><code>systemctl start asterisk</code></li>
<li><code>systemctl stop allmon3</code></li>
<li><code>systemctl restart allmon3</code></li>
<li><code>systemctl start allmon3</code></li>
<li><code>/usr/sbin/poweroff</code></li>
<li><code>/usr/sbin/reboot</code></li>
</ul>
<p>Using a combination of wrapper scripts and appropriate function configuration, Asterisk can restart itself, Allmon3, shutdown the system, or reboot the system. Use of the wrapper scripts for <code>systemctl</code> commands is essential for a clean execution of the scripts under the
polkit rules. The provided wrappers are:</p>
<ul>
<li><code>/etc/asterisk/scripts/allmon3-restart</code></li>
<li><code>/etc/asterisk/scripts/allmon3-start</code></li>
<li><code>/etc/asterisk/scripts/allmon3-stop</code></li>
<li><code>/etc/asterisk/scripts/asterisk-restart</code></li>
<li><code>/etc/asterisk/scripts/asterisk-start</code></li>
<li><code>/etc/asterisk/scripts/asterisk-stop</code></li>
</ul>
<p>These privileges can be used inside <code>/etc/asterisk/rpt.conf</code> within the <code>[functions]</code> stanza as follows:</p>
<div class="highlight"><pre><span></span><code>9001 = cmd,/etc/asterisk/scripts/asterisk-restart
9002 = cmd,/etc/asterisk/scripts/asterisk-stop
9003 = cmd,/etc/asterisk/scripts/allmon3-restart
9004 = cmd,/etc/asterisk/scripts/allmon3-stop
9005 = cmd,/usr/sbin/shutdown
9006 = cmd,/usr/sbin/reboot
</code></pre></div>
<p>The command <code>*9001</code> would restart asterisk, <code>*9006</code> would reboot the system, etc.</p></section><section class="print-page" id="adv-topics-privatenodes"><h1 id="adv-topics-privatenodes-private-nodes">Private Nodes</h1>
<p>Private nodes are nodes you create that do not directly connect to the AllStarLink (ASL) Network. In addition, you cannot directly connect to a private node from the ASL Network.</p>
<p>They can co-exist on an existing server along with a public node, or they can run on independent hardware exclusively.</p>
<h2 id="adv-topics-privatenodes-private-node-numbering">Private Node Numbering</h2>
<p>The numbering system for private nodes is limited to node numbers under 2000 (ie 0000-1999). However, in practice it would be best advised to use 4 digit number to not confuse other parts of the dial plan in present or future expansion (thus using 1000-1999).</p>
<p>If a private node is going to be connected to an ASL Public Network node, you may want to consider using a node number outside of the normal node numbers used by examples in most how-to's, such as 1998 and 1999. This is due to "loopback protection" in the <code>app_rpt</code> code that prevents connection of the same node (detected as a loop) when you connect to other networks.</p>
<p>For example, if you have a private node 1999 connected to your public node 29999, and you proceed to connect 29999 with some other system like 2135 that also has someone connected that has a private node 1999 connected, it will be refused. <strong><em>This has been the source of many hairs being pulled out when folks do not realize why they can not connect.</em></strong></p>
<p>Of course, there is a more modern solution to fix this issue, using a Node Number Extension with an assigned public Node Number. In this case, you would have a unique node number that can be set-up and just not registered to the ASL network (just comment out the appropriate registration line in <code>rpt_http_registrations.conf</code>). You could later change that to a public node just by un-commenting the registration line and reviewing your settings to be sure they are public friendly.</p>
<h2 id="adv-topics-privatenodes-node-setup">Node Setup</h2>
<p>The easiest way to create a private node is to use the <a href="#user-guide">ASL3 Menu</a> and use <code>Node Settings</code> to create a new node.</p>
<p>This will create a new <a href="#adv-topics-conftmpl">template</a> in <a href="#config-rpt_conf"><code>rpt.conf</code></a> for you to customize the settings for your new node.</p>
<h2 id="adv-topics-privatenodes-advanced-configuration">Advanced Configuration</h2>
<p>When a new node is created, a <a href="#adv-topics-conftmpl">template</a> for the node settings will be created in <a href="#config-rpt_conf"><code>rpt.conf</code></a>, such as:</p>
<div class="highlight"><pre><span></span><code>;;;;;;;;;;;;;;;;;;; Your node settings here ;;;;;;;;;;;;;;;;;;;
[1999](node-main)
rxchannel = SimpleUSB/1999      ; SimpleUSB
;startup_macro = *8132000
</code></pre></div>
<p>It will also create an entry in the <a href="#config-rpt_conf-nodes-stanza"><code>[nodes]</code></a> stanza to define how to connect/route calls to the node. Be sure to check that the options are correct for the <code>[nodes]</code> entry, based on what you are tying to do. If this is just another "normal" node on the same host, it will probably be okay with the defaults. If however, you were adding a <a href="#adv-topics-remotebase-remote-base-node-definition">remote base</a> node, you're probably going to need to edit the entry.</p>
<h3 id="adv-topics-privatenodes-connecting-to-other-private-nodes">Connecting to Other Private Nodes</h3>
<p>Remember, private nodes are just that, a node that you manage separately and independently from the ASL network. As such, the public ASL network knows very little (if anything) about the existence of your private node. As such, other public <strong>or</strong> private nodes have no idea how to connect to your private node, since they aren't registered in the public database (that stores all the IPs and ports on how to interconnect public nodes).</p>
<p>As such, if you want to connect to another private node on your LAN, the public internet, or anywhere other than on the current device, you need to tell Asterisk how to reach that node.</p>
<p>This is handled by making an entry in the <code>[nodes]</code> context in <a href="#config-rpt_conf-nodes-stanza"><code>rpt.conf</code></a>.</p>
<p>If you want private nodes to be able to connect to each other, they both need to have corresponding entries in their <code>[nodes]</code> contexts, pointing at each other.</p>
<p>Sample <code>rpt.conf</code> entries:</p>
<div class="highlight"><pre><span></span><code>; Server 1 (at bar.domain.com)
[nodes]
1000 = radio@127.0.0.1/1000,NONE               ; Private node on this server 
1001 = radio@foo.domain.com/1001,NONE          ; Private node on a server at foo.domain.com (on default port 4569)
1002 = radio@foo.domain.com:4570/1002,NONE     ; Private node on a different server at foo.domain.com (via NAT on WAN port 4570)
2501 = radio@127.0.0.1/2501,NONE               ; Public node on this server

; Server 2 (at foo.domain.com)
[nodes]
1000 = radio@bar.domain.com/1000,NONE          ; Private node on a server at bar.domain.com (on default port 4569) 
1001 = radio@127.0.0.1/1001,NONE               ; Private node on this server
1002 = radio@192.168.1.10:4570/1002,NONE       ; Private node on a different server on our LAN (listening on port 4570)
2502 = radio@127.0.0.1/2501,NONE               ; Public node on this server

; Server 3 (at foo.domain.com on port 4570)
1000 = radio@bar.domain.com/1000,NONE          ; Private node on a server at bar.domain.com (on default port 4569)
1001 = radio@192.168.1.20/1001,NONE            ; Private node on a different server on our LAN (listening on port 4569)
1002 = radio@127.0.0.1:4570/1002,NONE          ; Private node on this server (listening on port 4570)
2503 = radio@127.0.0.1:4570/2501,NONE          ; Public node on this server
</code></pre></div>
<p>As you can see, all three servers have entries in their <code>[nodes]</code> context that identify the node number, the IP address (or domain name), and port (if not default) of the each other's private nodes. This will allow all of them to be able to connect to each other.</p>
<p>See the section on <a href="#adv-topics-multinodesnetwork">Multiple Nodes on the Same Network</a> for other considerations and tips on testing.</p>
<p>Remember, a private node can do practically anything you can do with a public node. So, for example, one of those private nodes in the example above could be configured as an Echolink node, but only the nodes you have control of can access it (instead of any public node). Likewise, one of those private nodes could be connected to a UHF link to some other analog system, and this would let you "link in" to that system from your ASL node, but the public can't.</p>
<p>You basically have a "multi-port" repeater controller that is pretty much as flexible as you desire.</p></section><section class="print-page" id="adv-topics-remotebase"><h1 id="adv-topics-remotebase-remote-base-nodes">Remote Base Nodes</h1>
<p>The primary purpose of a remote base node is to make outgoing RF connections using a frequency agile radio to allow access to frequencies which are not part of your Internet connected radio system.</p>
<p>Remote base nodes are configured differently than a standard node. A completely different set of internal functions in <code>Asterisk/app_rpt</code> is used when operating a node as a remote base. Usually, the only reason to set up a node as a remote base is when you wish to change the operating parameters of the the attached radio remotely, or if you only want the radio to be used by a single user at a time.</p>
<p>If you want a <em>public</em> node number for a remote base, it must specifically be requested in the <a href="https://allstarlink.org/portal">AllStarLink Portal</a>. You must be sure to answer yes to <code>Is node a remote base station?</code>, and then optionally <code>If remote base, is it frequency agile?</code> questions. Alternatively, you can configure a private node.</p>
<h2 id="adv-topics-remotebase-security-issues">Security Issues</h2>
<p>Unfettered access to remote bases can be a <strong>security issue</strong>. If the remote base has no login protection it could be used by unscrupulous individuals to violate amateur radio rules and regulations. We <strong>strongly</strong> advise that all remote bases be protected by requiring a login code (see <a href="#adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</a> below). </p>
<h2 id="adv-topics-remotebase-behavior-of-standard-nodes-versus-remote-base-nodes">Behavior of Standard Nodes Versus Remote Base Nodes</h2>
<table>
<thead>
<tr>
<th>Behavior</th>
<th>Standard Node</th>
<th>Remote Base Node</th>
</tr>
</thead>
<tbody>
<tr>
<td>Command Decoding</td>
<td>Remote or Local. DTMF can be optionally decoded on the receive audio input</td>
<td>Remote only. No DTMF will be decoded on the receive audio input</td>
</tr>
<tr>
<td>Duplexing</td>
<td>Configurable: duplex or half-duplex</td>
<td>Half-duplex only</td>
</tr>
<tr>
<td></td>
<td>Frequency and Mode Agility</td>
<td>Fixed frequency operation, and channelized operation only using arguments passed in to app_rpt from extensions.conf</td>
</tr>
<tr>
<td>Multiple connections</td>
<td>Multiple nodes can connect. Operates as a conference bridge</td>
<td>Only one node can connect at a time</td>
</tr>
<tr>
<td>Login Protection</td>
<td>No</td>
<td>Optional</td>
</tr>
</tbody>
</table>
<h2 id="adv-topics-remotebase-whats-required">What's Required</h2>
<p>In order to configure a remote base you will need the following:</p>
<h3 id="adv-topics-remotebase-node-number">Node Number</h3>
<p>Either request a public node number or choose a private node number.</p>
<h3 id="adv-topics-remotebase-radio-interface-audio">Radio Interface (Audio)</h3>
<p>A free port on a radio interface such a URI adapter must be made available for use by the remote base. This is needed for the audio transport and keying.</p>
<h3 id="adv-topics-remotebase-radio-interface-cable-control">Radio Interface Cable (Control)</h3>
<p>A radio interface cable must be constructed or purchased to interface the radio to the node for control. Depending on the radio, this could be a USB to serial cable for CAT commands, or similar. </p>
<h3 id="adv-topics-remotebase-supported-radios">Supported Radios</h3>
<p>See the <a href="#adv-topics-remotebase-remote"><code>remote=</code></a> setting below for a list of supported or partially supported radios.</p>
<h2 id="adv-topics-remotebase-remote-base-operation">Remote Base Operation</h2>
<p>The following is an example of how you would use a remote base:</p>
<ul>
<li>Send node *3&lt;node&gt; to connect to the remote base node</li>
<li>Use <a href="#adv-topics-remotebase-functions"><code>[functions_remote]</code></a> commands to operate the remote base</li>
<li>
<ul>
<li>Send *4&lt;node&gt;*000# to set the remote base to memory channel 00</li>
</ul>
</li>
<li>
<ul>
<li>Send *4&lt;node&gt;*1146*940*1# to set the VFO to 146.940-</li>
</ul>
</li>
<li>Send *1&lt;node&gt; to disconnect from the remote base node</li>
</ul>
<h2 id="adv-topics-remotebase-remote-base-node-definition">Remote Base Node Definition</h2>
<p>A remote base needs to be defined as such in the <code>[nodes]</code> context. Specifically, the node definition would need to have the last option changed from "NONE" to "Y".</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>1998 = radio@127.0.0.1/1998,Y                  ; Remote base node on this server
</code></pre></div>
<h2 id="adv-topics-remotebase-remote-base-node-number-stanza">Remote Base Node Number Stanza</h2>
<p>The node number stanza is a critical stanza in <code>rpt.conf</code>. It is the same concept as for a "normal node". </p>
<div class="highlight"><pre><span></span><code>[1998]    ; Replace with your assigned or private node number
</code></pre></div>
<p>The node number stanza is set to the <strong>assigned node number</strong> <em>or</em> a <strong>private node number</strong> (if a private node is being configured). The <a href="#user-guide">asl-menu</a> utility, via the <strong>Node Setup</strong> menu, should normally be used to create node stanzas for both public and private nodes.</p>
<p>The node number stanza contains all the configurable options for that specific node using a <code>key=value</code> pair syntax. The following configurable options are available to use:</p>
<h3 id="adv-topics-remotebase-authlevel">authlevel=</h3>
<p>The <code>authlevel=</code> option is used to enable or disable login requirements for a remote base.</p>
<ul>
<li>authlevel = 0 Disables all access control (not recommended, unsecured)</li>
<li>authlevel = 1 Enables access control, and waits for key up before prompting for the access code</li>
<li>authlevel = 2 Enables access control, and prompts for the access code at the time of connection</li>
</ul>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>authlevel = 0   ; allow everyone 
</code></pre></div>
<p>See <a href="#adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</a> and <a href="#adv-topics-remotebase-remote-base-txlimits-stanza">Remote Base TX Limits</a> for additional details.</p>
<h3 id="adv-topics-remotebase-civaddr">civaddr=</h3>
<p>ICOM radios use the ICOM Communications Interface V (CI-V) for remote control. The <code>civaddr=</code> is used to set the CI-V address. The value is a 2 digit hexadecimal number. If this option is not specified, then the CI-V address will be set to the default of 88.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>civaddr = 88  ; set CIV to 88
</code></pre></div>
<h3 id="adv-topics-remotebase-dusbabek">dusbabek=</h3>
<p>This option is a "Jim Special", and documentation around it is sparse. It accepts parameters of <code>yes</code> or <code>no</code>, and MAY be required for the radio you are interfacing to. Try it, you may or may not need it.</p>
<p>Specifically, it may be required for the Syntor-X (using <code>remote=xcat</code>).</p>
<h3 id="adv-topics-remotebase-functions">functions=</h3>
<p>The <code>functions=</code> option is a pointer to a remote base function stanza. It operates the same as the normal <a href="#config-rpt_conf-functions"><code>functions=</code></a> option. You will likely want to define a functions stanza that is unique for your remote base, so that you can tailor what functions are available to use. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>functions = functions-remote   ; name the functions stanza &#39;functions-remote&#39;

[functions-remote]
0=remote,1                              ; Retrieve Memory
1=remote,2                              ; Set freq.
2=remote,3                              ; Set tx PL tone
3=remote,4                              ; Set rx PL tone
40=remote,100                           ; Rx PL off
41=remote,101                           ; Rx PL on
42=remote,102                           ; Tx PL off
43=remote,103                           ; Tx PL on
44=remote,104                           ; Low Power
45=remote,105                           ; Medium Power
46=remote,106                           ; High Power
51=remote,5                             ; Long status query
52=remote,140                           ; Short status query
61=remote,61                            ; Set mode to FM
62=remote,62                            ; Set mode to USB
63=remote,63                            ; Set mode to LSB
64=remote,64                            ; Set mode to AM
67=remote,210                           ; Send a *
69=remote,211                           ; Send a #
711=remote,107                          ; Bump down ­20Hz
714=remote,108                          ; Bump ­down 100Hz
717=remote,109                          ; Bump ­down 500Hz
713=remote,110                          ; Bump up 20Hz
716=remote,111                          ; Bump up 100Hz
719=remote,112                          ; Bump up 500Hz
721=remote,113                          ; Scan -­ slow
724=remote,114                          ; Scan ­- quick
727=remote,115                          ; Scan ­- fast
723=remote,116                          ; Scan + slow
726=remote,117                          ; Scan + quick
729=remote,118                          ; Scan + fast
79=remote,119                           ; Tune 
91=remote,99,CALLSIGN,[LICENSETAG]      ; Remote base login.
                                        ; Define a different dtmf sequence for each user which is 
                                        ; authorized to use the remote base to control access to it.
                                        ; For example: 
9139583=remote,99,WB6NIL,G              ; would grant access 
                                        ; to the remote base and announce WB6NIL as being logged in.
                                        ; For example:
9148351=remote,99,WA6ZFT,E              ; would grant access 
                                        ; to the remote base and announce WA6ZFT as being logged in.
                                        ; When the remote base is disconnected from the originating 
                                        ; node, the user will be logged out. The LICENSETAG parameter 
                                        ; can be optionally specified to enforce TX band limits.
98=cop,6                                ; Remote base telephone key
</code></pre></div>
<p>In the above example the digits to the left of the = are the DTMF code to dial (don't forget to prefix with <a href="#config-rpt_conf-funcchar"><code>[funcchar]</code></a>, usually *).</p>
<div class="admonition note">
<p class="admonition-title">Command Mode</p>
<p>When sending DTMF commands to a remote base, you need to send them in "command mode", usually *4 (ilink,4). So, if your remote base was defined as node 1998 and you are already connected to the node, you would set the remote base to high power by sending *41998*46.</p>
</div>
<p>See <a href="#adv-topics-remotebase-remote-base-commands">Remote Base Commands</a> for functions that are specifically available for remote base nodes.</p>
<h3 id="adv-topics-remotebase-ioaddr">ioaddr=</h3>
<p>The <code>ioaddr=</code> option sets a parallel port control I/O address. It is specified as a hexadecimal number with a 0x prefix. The parallel port is used when the Doug Hall RBI-1 interface is employed.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>ioaddr = 0x378   ; set RBI-1 /Parallel Port I/O address on LPT1
</code></pre></div>
<h3 id="adv-topics-remotebase-ioport">ioport=</h3>
<p>The <code>ioport=</code> option sets the serial port for the control interface to the remote base radio. On Linux Systems, these are typically path names to special files in the <code>/dev</code> directory.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>ioport = /dev/ttyS1   ; Linux com1
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>ioport = /dev/ttyUSB0 ; USB to serial adapter
</code></pre></div>
<h3 id="adv-topics-remotebase-iospeed">iospeed=</h3>
<p>The <code>iospeed=</code> option sets the serial port baud rate for the control interface to the remote base radio.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>iospeed = 4800         ; Use 4800 baud
</code></pre></div>
<p>Valid <code>iospeed</code> values are:</p>
<ul>
<li>2400</li>
<li>4800</li>
<li>9600 (default if <code>iospeed</code> is not specified)</li>
<li>19200</li>
<li>38400</li>
<li>57600</li>
</ul>
<h3 id="adv-topics-remotebase-mars">mars=</h3>
<p>The <code>mars=</code> option is only used with the IC-706MKIIG remote. When set to <code>1</code>, it enables access to additional bands via remote, as shown below.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>mars = 0        ; set to 1 to enable MARS bands
</code></pre></div>
<p>MARS bands available:</p>
<table>
<thead>
<tr>
<th>Band</th>
<th>Frequency Range</th>
<th>Allowed Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>LMR UHF</td>
<td>450-470MHz</td>
<td>FM</td>
</tr>
<tr>
<td>LMR VHF</td>
<td>148-174MHz</td>
<td>FM</td>
</tr>
<tr>
<td>VHF-AM</td>
<td>108-144MHz</td>
<td>AM</td>
</tr>
<tr>
<td>AM BCB</td>
<td>550-1750kHz</td>
<td>AM</td>
</tr>
<tr>
<td>HF SWL</td>
<td>1750kHz-30MHz</td>
<td>AM</td>
</tr>
</tbody>
</table>
<h3 id="adv-topics-remotebase-phone_functions">phone_functions=</h3>
<p>The <code>phone_functions=</code> is a pointer to a remote base phone function stanza. It operates the same as the normal <a href="#config-rpt_conf-phone_functions"><code>phone_functions=</code></a> option. You will likely want to define a phone functions stanza that is unique for your remote base, so that you can tailor what functions are available to use. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>phone_functions = functions-remote

[functions-remote]
...
</code></pre></div>
<h3 id="adv-topics-remotebase-remote">remote=</h3>
<p>The <code>remote=</code> option sets the type of radio. It <strong>must</strong> be defined, as it ensures that the node will be defined as a remote base node and not a standard node, and determines the protocol for communicating with the radio over the <code>ioport</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote = xcat   ; set xcat interface
</code></pre></div>
<table>
<thead>
<tr>
<th>Vendor</th>
<th>Model</th>
<th>remote= Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>N/A</td>
<td>Dumb</td>
<td>y</td>
<td>Use for any single channel remote base radios, with no remote tuning capability</td>
</tr>
<tr>
<td>N/A</td>
<td>Parallel Port</td>
<td>pp16</td>
<td>Parallel port programmable 16 channels? Perhaps parallel port BCD bit-banging, such for Motorola radios that can be driven from their accessory port? Interface information not available</td>
</tr>
<tr>
<td>Doug Hall</td>
<td>Remote Base Interface</td>
<td>rbi</td>
<td>Requires Parallel Port Address https://wiki.allstarlink.org/wiki/Remote_Base:_Doug_Hall_RBI-1</td>
</tr>
<tr>
<td>ICOM</td>
<td>IC-706MKIIG</td>
<td>ic706</td>
<td><strong>IC-706MKIIG only</strong>. Must specify serial port using <code>ioport=</code>. Must specify CIV address using <code>civaddr=</code>. Also note <code>mars=</code> option. Earlier versions return data format is different and will lock up the software</td>
</tr>
<tr>
<td>Kenwood</td>
<td>Various</td>
<td>kenwood</td>
<td>Should work for many/most Kenwood radios, unless otherwise specified</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TM-D700</td>
<td>tmd700</td>
<td></td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-440</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-450</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-950</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TM-271</td>
<td>tm271</td>
<td>Must specify serial port using <code>ioport=</code></td>
</tr>
<tr>
<td>Kenwood</td>
<td>TMG-707</td>
<td>kenwood</td>
<td>Must specify serial port using <code>ioport=</code></td>
</tr>
<tr>
<td>Motorola</td>
<td>Syntor Xcat</td>
<td>xcat</td>
<td>Must specify serial port using <code>ioport=</code>. Must specify CIV address using <code>civaddr=</code></td>
</tr>
<tr>
<td>Ritron Patriot</td>
<td>RTX-150</td>
<td>rtx150</td>
<td>Interface information not available</td>
</tr>
<tr>
<td>Ritron Partiot</td>
<td>RTX-450</td>
<td>rtx450</td>
<td></td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-100</td>
<td>ft100</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-897GXII</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work.</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-857</td>
<td>ft897</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-897</td>
<td>ft897</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-890</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-900</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-950</td>
<td>ft950</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 38400</td>
</tr>
</tbody>
</table>
<p>Many Yaesu models should work for the most part with one of the above, back to 747/757 vintage for frequency and mode anyway. The FT-817 has completely different commands, so it won't work.</p>
<h3 id="adv-topics-remotebase-remote_inact_timeout">remote_inact_timeout=</h3>
<p>This option specifies the amount of time without keying from the link, before the link is determined to be inactive. Set to <code>0</code> to disable timeout.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_inact_timeout = 0   ; do not time out
</code></pre></div>
<h3 id="adv-topics-remotebase-remote_timeout">remote_timeout=</h3>
<p>This option specifies the session time out for the remote base. Set to <code>0</code> to disable. This option does not appear to be implemented in code.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_timeout = 0   ; do not timeout
</code></pre></div>
<p>Default is 3600 (seconds?).</p>
<h3 id="adv-topics-remotebase-remote_timeout_warning">remote_timeout_warning=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 180 (seconds?).</p>
<h3 id="adv-topics-remotebase-remote_timeout_warning_freq">remote_timeout_warning_freq=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 30 (seconds?).</p>
<h3 id="adv-topics-remotebase-rxchannel">rxchannel=</h3>
<p>This option contains the type of channel driver which is being used for the audio and control (COR/PTT) interface to the remote base.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxchannel = SimpleUSB/1998
</code></pre></div>
<p>See the <a href="#config-rpt_conf-rxchannel"><code>rxchannel=</code></a> option for available channel drivers.</p>
<h3 id="adv-topics-remotebase-split2m">split2m=</h3>
<p>This option defines the offset in kHz to use for 2m <a href="#adv-topics-remotebase-remote-base-memory-stanza">memory chanels</a>. The default if not defined is 600 (kHz).</p>
<h3 id="adv-topics-remotebase-split70cm">split70cm=</h3>
<p>This option defines the offset in kHz to use to 70cm <a href="#adv-topics-remotebase-remote-base-memory-stanza">memory channels</a>. The default if not defined is 5000 (kHz), aka 5MHz.</p>
<h2 id="adv-topics-remotebase-remote-base-commands">Remote Base Commands</h2>
<p>Remote base commands (<code>functionclass</code> of <code>remote</code>) provide DTMF functions for remote base control. The <code>remote</code> commands are only applicable to remote base node configurations.</p>
<table>
<thead>
<tr>
<th>remote</th>
<th>Description</th>
<th>Parameter(s) Accepted</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Retrieve Memory</td>
<td>00 to 99</td>
</tr>
<tr>
<td>2</td>
<td>Set VFO Frequency</td>
<td>MMM*kkk*o# where MMM is frequency in MHz, kkk is kHz portion of the frequency, o is offset (1=minus, 2=simplex, 3=positive)</td>
</tr>
<tr>
<td>3</td>
<td>Set TX PL Tone</td>
<td>XXX*X ie 067*0 to set 67.0Hz</td>
</tr>
<tr>
<td>4</td>
<td>Set RX PL Tone</td>
<td>XXX*X ie 067*0 to set 67.0Hz</td>
</tr>
<tr>
<td>5</td>
<td>Link Status Query (long)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>Set Operating Mode</td>
<td>m, where m is 1 (FM), 2 (USB), 3, (LSB), or 4 (AM)</td>
</tr>
<tr>
<td>99</td>
<td>Remote Base login</td>
<td>CALLSIGN,LICENSETAG</td>
</tr>
<tr>
<td>100</td>
<td>RX PL Off</td>
<td>Default</td>
</tr>
<tr>
<td>101</td>
<td>RX PL On</td>
<td></td>
</tr>
<tr>
<td>102</td>
<td>TX PL Off</td>
<td>Default</td>
</tr>
<tr>
<td>103</td>
<td>TX PL On</td>
<td></td>
</tr>
<tr>
<td>104</td>
<td>Low Power</td>
<td></td>
</tr>
<tr>
<td>105</td>
<td>Medium Power</td>
<td></td>
</tr>
<tr>
<td>106</td>
<td>High Power</td>
<td></td>
</tr>
<tr>
<td>107</td>
<td>Bump -20Hz</td>
<td></td>
</tr>
<tr>
<td>108</td>
<td>Bump -100Hz</td>
<td></td>
</tr>
<tr>
<td>109</td>
<td>Bump -500Hz</td>
<td></td>
</tr>
<tr>
<td>110</td>
<td>Bump +20Hz</td>
<td></td>
</tr>
<tr>
<td>111</td>
<td>Bump +100Hz</td>
<td></td>
</tr>
<tr>
<td>112</td>
<td>Bump +500Hz</td>
<td></td>
</tr>
<tr>
<td>113</td>
<td>Scan - Slow</td>
<td></td>
</tr>
<tr>
<td>114</td>
<td>Scan - Quick</td>
<td></td>
</tr>
<tr>
<td>115</td>
<td>Scan - Fast</td>
<td></td>
</tr>
<tr>
<td>116</td>
<td>Scan + Slow</td>
<td></td>
</tr>
<tr>
<td>117</td>
<td>Scan + Quick</td>
<td></td>
</tr>
<tr>
<td>118</td>
<td>Scan + Fast</td>
<td></td>
</tr>
<tr>
<td>119</td>
<td>Tune (brief AM transmission for automatic tuners)</td>
<td></td>
</tr>
<tr>
<td>140</td>
<td>Link Status Query (brief)</td>
<td></td>
</tr>
<tr>
<td>210</td>
<td>Send a *</td>
<td></td>
</tr>
<tr>
<td>211</td>
<td>Send a #</td>
<td></td>
</tr>
</tbody>
</table>
<p>Not all commands above are supported by all radios. For example, radios which don't support SSB, would not be able to be placed in LSB or USB mode.</p>
<p>See the <a href="#adv-topics-remotebase-functions">Remote Base Functions</a> on how to define the DTMF commands for remote base functions.</p>
<h2 id="adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</h2>
<p>When <a href="#adv-topics-remotebase-authlevel"><code>authlevel=</code></a> is greater than zero, the <a href="#adv-topics-remotebase-remote-base-commands"><code>remote,99</code></a> command is used to define a different DTMF sequence (password) for each user authorized to use the remote base. The remote base will announce the callsign as access is granted.</p>
<p>If using an <code>authlevel</code> greater than zero, be sure to define users in your <code>[functions]</code> stanza to authenticate against.</p>
<p>The format of the function is: <code>DTMF_Password = remote,99,CALLSIGN,LICENSETAG</code>.</p>
<p>The <code>LICENSETAG</code> is the corresponding entry in the <a href="#adv-topics-remotebase-remote-base-txlimits-stanza"><code>[txlmiits]</code></a> stanza. The <code>LICENSETAG</code> is used for enforce TX frequency limits.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[1998]           ; node number for the remote base
; authlevel = 0  ; Anyone can use it
; authlevel = 1  ; Requires log in, Waits for Tx key to ask for it
authlevel = 2  ; Requires log in, asks for it automously

[remote-functions]
8xx=remote,99,OK,E ; where xx is the password
</code></pre></div>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>9139583 = remote,99,WB6NIL,G   ; grant access to Jim (general)
9148351 = remote,99,WA6ZFT,E   ; grant access to Steve (extra)
</code></pre></div>
<p>In the above example, DTMF "*9139583" would log in to the remote base as WB6NIL, with the TX Limits of the "G" class as defined in the <a href="#adv-topics-remotebase-remote-base-txlimits-stanza"><code>[txlimits]</code></a> staza.</p>
<p>When the remote base is disconnected from the originating node, the
user will be logged out. </p>
<h2 id="adv-topics-remotebase-remote-base-memory-stanza">Remote Base Memory Stanza</h2>
<p>Up to 100 (00 to 99) preset memory channels can be defined, to be recalled by the <code>remote,1</code> function command.</p>
<p>If the <code>init</code> memory channel is optionally specified, the remote base will attempt to tune to this channel when a user connects.</p>
<p>Remote base memories are in the format of:</p>
<p>Remote base memory syntax: <code>CC=RRR.RRR,PPP.P,AAAAA</code> or <code>CC=RRR.RRR,PPP.P,OFFSET,AAAAA</code></p>
<ul>
<li>C = Memory (Channel) number</li>
<li>R = RX Frequency (must be defined down to kHz)</li>
<li>P = PL Frequency</li>
<li>A = One or more Attributes</li>
</ul>
<p>Attributes are specified as a <em>non-delimited</em> string. The available Attributes are: </p>
<ul>
<li>a = AM, b = LSB, f = FM, u = USB</li>
<li>l = Low Power, m = Medium Power, h = High Power</li>
<li>
<ul>
<li>= Minus TX Offset, s = Simplex, + = Plus TX Offset</li>
</ul>
</li>
<li>t = TX PL on, r = RX PL on</li>
</ul>
<p>To use a non-standard offset on the memory channel, it can be defined (in kHz), be sure to also specify either <code>-</code> or <code>+</code>, as necessary.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[memory]
init = 146.520,000.0,fm ; set to this channel on start
00 = 146.580,100.0,m
01 = 147.030,103.5,m+t
02 = 147.240,103.5,m+t
03 = 147.765,79.7,m-t
04 = 146.460,100.0,m
05 = 146.550,100.0,m
06 = 147.540,000.0,fs
07 = 147.540,123.0,shrt
08 = 147.435,103.5,1035,h-t ; This would be for W6NUT in Los Angeles with input of 146.400, and a PL of 103.5Hz.
</code></pre></div>
<p><strong>NOTE:</strong> Not all attributes may be supported by all radios.</p>
<h2 id="adv-topics-remotebase-remote-base-txlimits-stanza">Remote Base Txlimits Stanza</h2>
<p>The <code>[txlimits]</code> stanza defines TX privileges to be assigned to a particular license class (<code>LICENSETAG</code>).</p>
<p>The <code>LICENSETAG</code> is used when configuring the <a href="#adv-topics-remotebase-remote-base-authentication"><code>authentication</code></a> parameters for remote base users.</p>
<div class="highlight"><pre><span></span><code>[txlimits]
; In the example below, voice privileges are assigned for US ham
; licensees for 40 meters through 10 meters.
; Each line contains a LICENSETAG defined in a user login command,
; then a set of band limit ranges. Up to 40 ranges per entry may be defined.
;
T = 28.300-28.500
G = 7.175-7.300,14.225-14.300,18.110-18.168,21.275-21.450,24.930-24.990,28.300-29.700
A = 7.125-7.300,14.175-14.300,18.110-18.168,21.225-21.450,24.930-24.990,28.300-29.700
E = 7.125-7.300,14.150-14.300,18.110-18.168,21.200-21.450,24.930-24.990,28.300-29.700
</code></pre></div>
<h2 id="adv-topics-remotebase-sample-remote-configuration">Sample Remote Configuration</h2>
<div class="highlight"><pre><span></span><code>[1998]
; Rx audio/signaling channel                                                                                   
rxchannel = Radio/usb

; Serial port for control
ioport = /dev/ttyS1

; Radio Type                
remote = ft897 

; Function list from link                                          
functions = functions-remote  

; Function list from phone         
phone_functions = functions-remote

; Authorization level                                         
authlevel = 0      
</code></pre></div>
<h2 id="adv-topics-remotebase-doug-hall-rbi-1-remote-base">Doug Hall (RBI-1) Remote Base</h2>
<p><strong>The Doug Hall RBI-1 is long obsolete, but is documented here for reference.</strong></p>
<p>The Doug Hall Electronics Model RBI-1 is frequency agile, multi port, remote base. It is possible to interface the RBI-1 to AllStar, but only on a PC.</p>
<h3 id="adv-topics-remotebase-rbi-1-connections">RBI-1 Connections</h3>
<p>The RBI-1 uses the first three pins of the parallel port and can not be changed. There is no other interface method built into the <code>app_rpt</code> software. If you have been using the pins for anything else, you will need to migrate them to higher pins than the first three. See Parallel Port GPIO.</p>
<p>Parallel port pinout is as follows:
<div class="highlight"><pre><span></span><code>PP1 = data
PP2 = clock
PP3 = reset
</code></pre></div></p>
<p>No buffering is required. Attach directly to the RBI-1's DB9 interface on the correct parallel port pins.</p>
<h3 id="adv-topics-remotebase-rbi-1-rptconf-settings">RBI-1 rpt.conf Settings</h3>
<p>In <code>rpt.conf</code> you will need to set lines in the node's stanza:</p>
<div class="highlight"><pre><span></span><code>[1998]                              ; your node number 
iobase=0x378                        ; (for lpt1)
remote=rbi                          ; Doug Hall RBI-1
functions=funtions-remote1998       ; Function list from link (a list of agile working commands) - use your node number
memory=memory1998                   ; &#39;system stored&#39; radio presets, not required - use your node number

[funtions-remote1998]               ;for RBI-1   use your node number

0=remote,1                          ; Retrieve Radio Stored Memory Channel
1=remote,2                          ; Set freq. VFO MMMMM*KKK*O   (Mhz digits, Khz digits, Offset)
2=remote,3                          ; Set tx PL tone PL Tone HHH*D*
3=remote,4                          ; Set rx PL tone         HHH*D*

40=remote,100                       ; Rx PL off
41=remote,101                       ; Rx PL on
42=remote,102                       ; Tx PL off
43=remote,103                       ; Tx PL on
44=remote,104                       ; Low Power
45=remote,105                       ; Medium Power
46=remote,106                       ; High Power

51=remote,5                         ; Long status query
52=remote,140                       ; Short status query
67=remote,210                       ; Send a *
69=remote,211                       ; Send a #


; Not Required but noted:

[memory1998]                        ;Stored presets for radio, 
                                    ;Format: (recall# xx) = (Freq 6 digits and decimal) (TX PL Tone )  ( CTCSS Tone )  (ofset + - S ) ( power l m h )
init=224.660,100.0,-l               ;initial freq/mode on start-up/boot - choose something safe in case of error. Not required. Can be remarked out.
00=224.560,100.0,-l
01=224.460,114.8,-l
02=224.580,131.8,-l
03=223.980,100.0,-l
04=146.940,114.8,-lt
10=442.175,162.2,+l
11=444.475,114.8,+l
12=444.150,100.0,+l
;13=446.500,100.0,sl
</code></pre></div></section><section class="print-page" id="adv-topics-rxtoneburst"><h1 id="adv-topics-rxtoneburst-rx-toneburst">RX Toneburst</h1>
<p>RX toneburst is a repeater access method (similar to CTCSS/PL or DCS) where the repeater will not become active until it receives the proper access tone.</p>
<p>It is/was a common access method used almost exclusively in Europe. The typical tone used was 1750Hz. A user would send an initial burst of 1750Hz, usually less than 500mS, which would "wake up" the repeater. Once the repeater was "active", it would usually revert to carrier access for the duration of the conversation. After a period of quiet time, the repeater would revert to being "inactive", until it received another wake-up toneburst.</p>
<h2 id="adv-topics-rxtoneburst-configuring-receive-toneburst-access">Configuring Receive Toneburst Access</h2>
<p>If you wish to set up a node to require receive toneburst, you must at least specify the toneburst frequency. The following parameters would need to be added to <a href="#config-rpt_conf"><code>/etc/asterisk/rpt.conf</code></a> in the node configuration section of the desired node.</p>
<div class="highlight"><pre><span></span><code>rxburstfreq = 1750          ; set the desired toneburst frequency, in Hz
rxbursttime = 500           ; minimum duration required for the tone to be present, in mS
rxburstthreshold=10         ; minimum signal to noise radio, in dB, to detect a valid tone
</code></pre></div></section><section class="print-page" id="adv-topics-sa818modules"><h1 id="adv-topics-sa818modules-sa818-rf-modules">SA818 RF Modules</h1>
<p>SA818 RF modules are inexpensive RF transceiver modules, often used to build a personal RF "hot spot" AllStarLink node.</p>
<p>Setting up an SA818 RF module is much easier on ASL3.</p>
<p>Two new commands were added to ASL3 Pi Appliance systems to program the module. We believe that most will prefer using <code>sa818-menu</code>, a visual interface to the RF module settings. For those who prefer a command line interface, we have also included <code>sa818</code>.</p>
<h2 id="adv-topics-sa818modules-sa818-menu">sa818-menu</h2>
<p>To program your SA818 with the menu utility, use the following command from the Linux CLI:</p>
<div class="highlight"><pre><span></span><code>sudo sa818-menu
</code></pre></div>
<p>Here, you will be able to view the last saved (or default) settings.</p>
<p><strong>NOTE:</strong> The "last saved" settings are those saved by the <code>sa818-menu</code> command on your system. There is no way to "read" settings from the SA818 RF module.</p>
<p>The settings include :</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Band</td>
<td>Specify the module type (VHF, UHF)</td>
</tr>
<tr>
<td>Bandwidth</td>
<td>Narrow (12.5KHz) or <strong>Wide (25.0KHz)</strong></td>
</tr>
<tr>
<td>Receive Frequency</td>
<td></td>
</tr>
<tr>
<td>Transmit Frequency</td>
<td></td>
</tr>
<tr>
<td>Squelch Value</td>
<td>Default = <strong>1</strong></td>
</tr>
<tr>
<td>Volume</td>
<td>Default = <strong>1</strong></td>
</tr>
<tr>
<td>Sub-audible tone</td>
<td><strong>None</strong>, CTCSS, DCS</td>
</tr>
<tr>
<td>Pre-Emphasis/De-emphasis</td>
<td>Default = <strong>Disabled</strong></td>
</tr>
<tr>
<td>High pass Filter</td>
<td>Default = <strong>Disabled</strong></td>
</tr>
<tr>
<td>Low pass Filter</td>
<td>Default = <strong>Disabled</strong></td>
</tr>
<tr>
<td>Serial Port</td>
<td>Default = <strong>/dev/serial0</strong> or <strong>/dev/ttyUSB0</strong></td>
</tr>
<tr>
<td>Connection Speed</td>
<td>Default = <strong>9600</strong></td>
</tr>
</tbody>
</table>
<p>If you change the sub-audible tone setting to CTCSS or DCS you will be presented with a list of possible tone frequencies. When using CTCSS tones, you will also have a setting for the CTCSS Reverse Burst (tail tone).</p>
<p>The RF module will be programmed when you exit the menu.</p>
<p><strong>NOTE:</strong> If you make changes that you do not wish to have stored, then use the ESC key to exit the menu.</p>
<h2 id="adv-topics-sa818modules-sa818">sa818</h2>
<p>To program your SA818 using the command line you can execute the <code>sa818</code> command. For command usage information, use <code>sa818 --help</code>.</p></section><section class="print-page" id="adv-topics-sip-phone"><h1 id="adv-topics-sip-phone-setting-up-a-sip-phone">Setting up a SIP Phone</h1>
<p>This section describes the steps necessary to set up a SIP phone in ASL3. The setup procedure has changed due to the deprecation of <code>chan_sip</code>. Users are now required to use <code>chan_pjsip</code>. <code>chan_pjsip</code> brings new features to the SIP stack, and is the supported SIP channel for the future.</p>
<h2 id="adv-topics-sip-phone-update-modulesconf">Update <code>modules.conf</code></h2>
<p><code>chan_pjsip</code> requires a number of modules to be loaded. You should start by editing <code>/etc/asterisk/modules.conf</code> and add the following to the [modules] stanza (generally near the bottom of the file just above the [global] stanza):</p>
<div class="highlight"><pre><span></span><code>;
; modules for pjsip
;
noload = app_voicemail.so
load = bridge_builtin_features.so
load = bridge_builtin_interval_features.so
load = bridge_holding.so
load = bridge_native_rtp.so
load = bridge_simple.so
load = bridge_softmix.so
load = chan_bridge_media.so
load = chan_pjsip.so
load = func_pjsip_endpoint.so
load = func_sorcery.so
load = func_devstate.so
load = res_pjproject.so
load = res_pjsip_acl.so
load = res_pjsip_authenticator_digest.so
load = res_pjsip_caller_id.so
load = res_pjsip_dialog_info_body_generator.so
load = res_pjsip_diversion.so
load = res_pjsip_dtmf_info.so
load = res_pjsip_endpoint_identifier_anonymous.so
load = res_pjsip_endpoint_identifier_ip.so
load = res_pjsip_endpoint_identifier_user.so
load = res_pjsip_exten_state.so
load = res_pjsip_header_funcs.so
load = res_pjsip_logger.so
load = res_pjsip_messaging.so
load = res_pjsip_mwi_body_generator.so
load = res_pjsip_mwi.so
load = res_pjsip_nat.so
load = res_pjsip_notify.so
load = res_pjsip_one_touch_record_info.so
load = res_pjsip_outbound_authenticator_digest.so
load = res_pjsip_outbound_publish.so
load = res_pjsip_outbound_registration.so
load = res_pjsip_path.so
load = res_pjsip_pidf_body_generator.so
load = res_pjsip_pidf_digium_body_supplement.so
load = res_pjsip_pidf_eyebeam_body_supplement.so
load = res_pjsip_publish_asterisk.so
load = res_pjsip_pubsub.so
load = res_pjsip_refer.so
load = res_pjsip_registrar.so
load = res_pjsip_rfc3326.so
load = res_pjsip_sdp_rtp.so
load = res_pjsip_send_to_voicemail.so
load = res_pjsip_session.so
load = res_pjsip.so
noload = res_pjsip_t38.so
noload = res_pjsip_transport_websocket.so
load = res_pjsip_xpidf_body_generator.so
load = res_rtp_asterisk.so
load = res_sorcery_astdb.so
load = res_sorcery_config.so
load = res_sorcery_memory.so
load = res_sorcery_realtime.so
</code></pre></div>
<h2 id="adv-topics-sip-phone-update-extensionsconf">Update <code>extensions.conf</code></h2>
<p>The next step is to update <code>extension.conf</code>. This creates a dial plan that controls access to your node by SIP phones. Edit <code>/etc/asterisk/extensions.conf</code> and add the following to the bottom of the file. This example will set up extension <strong>1001</strong> as your local phone and the dialing plan for your node.</p>
<div class="highlight"><pre><span></span><code>[sip-phones]
exten =&gt; 1001,1,Dial(PJSIP/${EXTEN},60,rT)

exten =&gt; ${NODE},1,Ringing
exten =&gt; ${NODE},n,Answer(3000)
exten =&gt; ${NODE},n,Set(NODENUM=${CALLERID(number)})
exten =&gt; ${NODE},n,Playback(extension)
exten =&gt; ${NODE},n,SayDigits(${NODENUM})
exten =&gt; ${NODE},n,Playback(rpt/connected)
exten =&gt; ${NODE},n,Playback(rpt/node)
exten =&gt; ${NODE},n,SayDigits(${EXTEN})
exten =&gt; ${NODE},n,rpt(${EXTEN}|P)
exten =&gt; ${NODE},n,Hangup
</code></pre></div>
<p>The above dial plan will allow your SIP phone to dial your node number. In this example, one should use <code>*99</code> to enable PTT and <code>#</code> to disable PTT from the SIP phone. VOX is also an option for phone connections. When using VOX, one may want to mute the mic on the phone when not transmitting and un-mute to transmit. VOX is enabled by adding a <code>v</code> to the <code>rpt</code> line like this:</p>
<div class="highlight"><pre><span></span><code>exten =&gt; ${NODE},n,rpt(${EXTEN}|Pv)
</code></pre></div>
<p>This dial plan announces the extension number and the connecting node number. The lines with <code>SayDigits</code> and <code>Playback</code> can be removed if you do not want the announcement.</p>
<p>The <code>${NODE}</code> variable is defined at the top of <code>extensions.conf</code> and should be your assigned node number. See the following:</p>
<div class="highlight"><pre><span></span><code>[globals]
HOMENPA = 999 ; change this to your Area Code
NODE = 1999   ; change this to your node number
</code></pre></div>
<p><strong>NOTE:</strong> If you have multiple node numbers configured, you may need to adjust the <code>${NODE}</code> variable to the appropriate node number, or replace the <code>${NODE}</code> variable in your <code>extensions.conf</code> stanza with the specific node number desired.</p>
<p>The entry <strong>1001</strong> in <code>extensions.conf</code> is the extension number for your SIP phone. If you want to use a different extension number, change <strong>1001</strong> to your desired extension number.</p>
<p><strong>NOTE:</strong> If you attempt to copy <code>extensions.conf</code> from a previous release of AllStarLink, it will fail. ASL3 requires comma delimiters instead of pipe symbols for standard Asterisk functions. The <code>rpt</code> function continues to use a pipe delimiter. This is subject to change in a future release.</p>
<h2 id="adv-topics-sip-phone-update-pjsipconf">Update <code>pjsip.conf</code></h2>
<p>You are now ready to configure <code>pjsip</code>.  Edit <code>/etc/asterisk/pjsip.conf</code>. Don’t get overwhelmed by all of the text in the sample configuration. <code>pjsip</code> supports several configurations. This document focuses on the necessary entries to get a SIP phone operational.</p>
<p>Scroll down to the <strong>Basic UDP transport</strong> section. It should be updated to look like the following:</p>
<div class="highlight"><pre><span></span><code>; Basic UDP transport
;
[transport-udp]
type=transport
protocol=udp    ;udp,tcp,tls,ws,wss,flow
bind=0.0.0.0:5060
</code></pre></div>
<p><strong>NOTE:</strong> After the bind port address (0.0.0.0) is the incoming port number (5060). This UDP port must NOT be blocked by your network firewall. If you are using a Pi Applicance, you will likely need to add the port to the built-in <a href="#pi-cockpit-firewall">firewall</a>.</p>
<p>Scroll down to the section titled <strong>Endpoint Configured For Use With A Sip Phone</strong>. For each extension, you will need to enter three sections. Here is an example for extension <strong>1001</strong>:</p>
<div class="highlight"><pre><span></span><code>[1001]
type=endpoint
transport=transport-udp
context=sip-phones
disallow=all
allow=ulaw
allow=alaw
allow=gsm
auth=1001
aors=1001
callerid=&quot;My CallerID&quot;
;
; A few more transports to pick from, and some related options below them.
;
;transport=transport-tls
;media_encryption=sdes
;transport=transport-udp-ipv6
;transport=transport-udp-nat
;direct_media=no
;
; MWI related options

;aggregate_mwi=yes
;mailboxes=6001@default,7001@default
;mwi_from_user=6001
;
; Extension and Device state options
;
;device_state_busy_at=1
;allow_subscribe=yes
;sub_min_expiry=30
;
; STIR/SHAKEN support.
;
;stir_shaken=no
;stir_shaken_profile=my_profile

[1001]
type=auth
auth_type=userpass
password=1001
username=1001

[1001]
type=aor
max_contacts=4
;contact=sip:6001@192.0.2.1:5060
</code></pre></div>
<p>If you want to use a different extension number, you will need to change <code>[1001]</code> to your desired number. The item <code>callerid="My CallerID"</code> should also be updated for your preferred caller identifier.</p>
<p>The items <code>password=1001</code> and <code>username=1001</code> should be updated to match the username and password you want for your extension number. You should use a complex password. <strong>Do not use the extension number.</strong> You can use the password generator located <a href="https://www.lastpass.com/features/password-generator#generatorTool">here</a> to generate a complex password.</p>
<p>These three sections can be replicated for each extension that you want to add to the system.</p>
<h2 id="adv-topics-sip-phone-restart-asterisk">Restart Asterisk</h2>
<p>After completing these changes, you must restart Asterisk or reboot your system.</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart asterisk
</code></pre></div>
<h2 id="adv-topics-sip-phone-example-config-with-multiple-sip-phones">Example Config with Multiple SIP Phones</h2>
<p>As noted above you can have more SIP phones. Here is an example of a simple dial plan that has multiple extensions:</p>
<div class="highlight"><pre><span></span><code>[sip-phones]
; Extension 210 - Line 1
; Extension 211 - Line 2
; Extension 212 - Garage
; Extension 213 - Cordless ATA
; Extension 1000 - Voice Mail

exten =&gt; 210,1,Dial(PJSIP/210,60,rT)
exten =&gt; 211,1,Dial(PJSIP/211,60,rT)
exten =&gt; 212,1,Dial(PJSIP/212,60,rT)
exten =&gt; 213,1,Dial(PJSIP/213,60,rT)
exten =&gt; 1000,1,VoiceMailMain(210)
exten =&gt; 1000,2,Hangup

; Allow SIP calls to local nodes
exten =&gt; 1998,1,rpt(1998|P)
exten =&gt; 1999,1,rpt(1999|P)
</code></pre></div>
<p>This example includes voicemail. To use voice mail, you will need to change <code>noload = app_voicemail.so</code>to <code>load = app_voicemail.so.</code></p>
<h2 id="adv-topics-sip-phone-troubleshooting">Troubleshooting</h2>
<p>If you have trouble connecting your SIP phone, start the Asterisk CLI with <code>asterisk -rvvv</code>. Enter the command <code>pjsip set logger on</code>. This will show the communications between the SIP phone and Asterisk. It will also show the actions in your dial plan.</p>
<h2 id="adv-topics-sip-phone-security">Security</h2>
<p>If you will be exposing your system to the outside world, you should consider using <code>fail2ban</code> to add additional protection for the system.</p></section><section class="print-page" id="adv-topics-sleepmode"><h1 id="adv-topics-sleepmode-sleep-mode">Sleep Mode</h1>
<p>Sleep Mode allows the local repeater receiver to be effectively disabled after a set period of inactivity (keeping the associated transmitter quiet). The repeater receiver will be re-enabled if any of the following events occur:</p>
<ul>
<li>An "awaken from sleep" (<a href="#config-rpt_conf-cop-commands"><code>cop,53</code></a>) command is decoded on any command source</li>
<li>There is traffic coming in from a remote node</li>
<li>There is telemetry coming in from a remote node</li>
</ul>
<p>Additionally, the sleep inactivity timer will be reset if there are any signals on the repeater input which are received during the time the system is awake.</p>
<div class="admonition warning">
<p class="admonition-title">Caution</p>
<p>Be aware that enabling Sleep Mode will change how your repeater functions, and may lead to user confusion. Once the repeater enters Sleep Mode, the only way to wake it up locally would be by a <code>cop,53</code> command (whether that is in to the local receiver via DTMF, or some other macro on the CLI). That may lead to users thinking the repeater is "broken" when they try and key it up and nothing happens, if they aren't aware that it may be in Sleep Mode. </p>
</div>
<h2 id="adv-topics-sleepmode-how-it-works">How it Works</h2>
<p>The intended purpose of Sleep Mode is to (temporarily) help combat local interference issues.</p>
<p>While the repeater is in normal use, the inactivity timer (<a href="#config-rpt_conf-sleeptime"><code>sleeptime</code></a>) will be constantly reset.</p>
<p>When activity on the repeater ceases, the inactivity timer counts down. When it reaches zero, the repeater will "go to sleep". The local receiver is still "active" and listening for DTMF, but it won't respond to normal methods of "keying the repeater" (carrier and/or CTCSS). This effectively prevents interference sources from opening the receiver squelch and keying the transmitter (broadcasting the noise).</p>
<p>In order to "wake" the repeater up, you would have to satisfy one of the above criteria. So, traffic or telemetry from a remotely connected node would "wake up" the local receiver and allow its normal access methods to key the repeater. Or, a user would need to send a specified DTMF command linked to <code>cop,53</code> to "wake up" the local receiver. As such, this mode is also known as "touch tone up". </p>
<h2 id="adv-topics-sleepmode-associated-cop-methods">Associated COP Methods</h2>
<p>The associated <a href="#config-rpt_conf-cop-commands">Control OPerator</a> commands/methods associated with Sleep Mode are:</p>
<table>
<thead>
<tr>
<th>COP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>51</td>
<td>Enable Sleep Mode</td>
</tr>
<tr>
<td>52</td>
<td>Disable Sleep Mode</td>
</tr>
<tr>
<td>53</td>
<td>Awaken from Sleep Mode</td>
</tr>
<tr>
<td>54</td>
<td>Go back to sleep when the TX carrier drops</td>
</tr>
</tbody>
</table>
<p>In order to manually "wake" the repeater up, you would want to assign <code>cop,53</code> to a DTMF command in the <a href="#config-rpt_conf-functions-stanza"><code>[functions]</code></a> stanza of <a href="#config-rpt_conf"><code>rpt.conf</code></a>, such as:</p>
<div class="highlight"><pre><span></span><code>953 = cop,53                        ; Wake up from sleep
</code></pre></div>
<p>You would also likely want to define commands to be able to enable and disable Sleep Mode too:</p>
<div class="highlight"><pre><span></span><code>951 = cop,51                        ; Enable sleep mode
952 = cop,52                        ; Disable sleep mode
954 = cop,54                        ; Go to sleep
</code></pre></div>
<h1 id="adv-topics-sleepmode-inactivity-timer">Inactivity Timer</h1>
<p>In addition to defining the commands to control Sleep Mode, you will likely also want to adjust the inactivity timer (<code>sleeptime</code>). This option is set in the <a href="#config-rpt_conf-node-number-stanza">node number stanza</a> in <a href="#config-rpt_conf"><code>rpt.conf</code></a>.</p>
<p>The default value for <code>sleeptime</code> is 900 seconds (15 minutes), if it is not specified (and you were to enable Sleep Mode). Set the value appropriately for your configuration:</p>
<div class="highlight"><pre><span></span><code>sleeptime=300                       ; Set the inactivity timer for 300 seconds (5 minutes)
</code></pre></div></section><section class="print-page" id="adv-topics-broadcastify"><h1 id="adv-topics-broadcastify-streaming-node-audio-to-broadcastify">Streaming Node Audio to Broadcastify</h1>
<p>To broadcast your node's audio on <a href="https://www.broadcastify.com/">Broadcastify</a>, you will need a Broadcastify account. You can then apply for a feed. This <a href="https://support.broadcastify.com/hc/en-us/articles/204740055-Becoming-a-Feed-Provider">link</a> provides information on applying for a feed.</p>
<p>After you have your account and feed credentials, you a ready to setup AllStarLink.</p>
<h2 id="adv-topics-broadcastify-setup-a-feed">Setup a Feed</h2>
<ul>
<li>Log into your node either using <code>Cockpit</code> or SSH and type the following commands:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo apt update
sudo apt install libshout-dev libtagc0-dev lame ezstream
</code></pre></div>
<ul>
<li>Edit <code>/etc/ezstream.xml</code> with your favorite editor, for example <code>sudo nano -w /etc/ezstream.xml</code>. You will be creating a new file. Copy, paste, and edit the following contents
into the file:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;ezstream&gt;</span>
<span class="w">    </span><span class="nt">&lt;servers&gt;</span>
<span class="w">        </span><span class="nt">&lt;server&gt;</span>
<span class="w">            </span><span class="nt">&lt;protocol&gt;</span>HTTP<span class="nt">&lt;/protocol&gt;</span>
<span class="w">            </span><span class="nt">&lt;hostname&gt;</span>Replace<span class="w"> </span>with<span class="w"> </span>Broadcastify<span class="w"> </span>URL<span class="nt">&lt;/hostname&gt;</span>
<span class="w">            </span><span class="nt">&lt;port&gt;</span>80<span class="nt">&lt;/port&gt;</span>
<span class="w">            </span><span class="nt">&lt;password&gt;</span>Replace<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>stream<span class="w"> </span>password<span class="nt">&lt;/password&gt;</span>
<span class="w">            </span><span class="nt">&lt;tls&gt;</span>none<span class="nt">&lt;/tls&gt;</span>
<span class="w">        </span><span class="nt">&lt;/server&gt;</span>
<span class="w">    </span><span class="nt">&lt;/servers&gt;</span>

<span class="w">    </span><span class="nt">&lt;streams&gt;</span>
<span class="w">        </span><span class="nt">&lt;stream&gt;</span>
<span class="w">            </span><span class="nt">&lt;mountpoint&gt;</span>Replace<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>mount<span class="w"> </span>point<span class="w"> </span>path<span class="nt">&lt;/mountpoint&gt;</span>
<span class="w">            </span><span class="nt">&lt;format&gt;</span>MP3<span class="nt">&lt;/format&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_name&gt;</span>Replace<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>feed<span class="w"> </span>name<span class="nt">&lt;/stream_name&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_url&gt;</span>Your<span class="w"> </span>web<span class="w"> </span>page<span class="nt">&lt;/stream_url&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_genre&gt;</span>Amateur<span class="w"> </span>Radio<span class="nt">&lt;/stream_genre&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_description&gt;</span>Replace<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>stream<span class="w"> </span>description<span class="nt">&lt;/stream_description&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_bitrate&gt;</span>16<span class="nt">&lt;/stream_bitrate&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_channels&gt;</span>1<span class="nt">&lt;/stream_channels&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_samplerate&gt;</span>22050<span class="nt">&lt;/stream_samplerate&gt;</span>
<span class="w">                </span><span class="nt">&lt;stream_public&gt;</span>Yes<span class="nt">&lt;/stream_public&gt;</span>
<span class="w">        </span><span class="nt">&lt;/stream&gt;</span>
<span class="w">    </span><span class="nt">&lt;/streams&gt;</span>

<span class="w">    </span><span class="nt">&lt;intakes&gt;</span>
<span class="w">        </span><span class="nt">&lt;intake&gt;</span>
<span class="w">            </span><span class="nt">&lt;type&gt;</span>stdin<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/intake&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intakes&gt;</span>
<span class="nt">&lt;/ezstream&gt;</span>
</code></pre></div>
<ul>
<li>
<p>Save the file</p>
</li>
<li>
<p>Ensure the file is owned and readable only by the Asterisk user:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo chown asterisk:asterisk /etc/ezstream.xml
sudo chmod 660 /etc/ezstream.xml
</code></pre></div>
<ul>
<li>
<p>Edit <code>/etc/asterisk/rpt.conf</code> with your favorite editor, i.e. <code>sudo nano -w /etc/asterisk/rpt.conf</code></p>
</li>
<li>
<p>Locate the node stanza for the node from which to stream to Broadcastify. The stanza is <code>[NNNNN](node-main)</code>. For example, if your node is 63001 then look for <code>[63001](node-main)</code>. Within that configuration stanza, add the following line:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>outstreamcmd = /bin/sh,-c,/usr/bin/lame --preset cbr 16 -r -m m -s 8 --bitwidth 16 - - | /usr/bin/ezstream -qvc /etc/ezstream.xml
</code></pre></div>
<p>The above parameters have these meanings:</p>
<div class="highlight"><pre><span></span><code>-- preset cbr 16` = use constant bit rate 16
-r = Assume the input file is raw pcm
-m m = Mode mono
-s 8 = sample rate 8
--bitwidth 16 = bit width is 16 (default)   
</code></pre></div>
<ul>
<li>After these changes have been made, you will need to restart Asterisk:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo systemctl restart asterisk
</code></pre></div>
<p>If you experience any problems, look at <code>/var/log/ezstream.log</code> for error messages</p>
<h2 id="adv-topics-broadcastify-migrating-an-existing-feed">Migrating an Existing Feed</h2>
<p>If you have an existing feed, you will need to upgrade your existing <code>xml</code> configuration file to the new format. You can use the following commands:</p>
<div class="highlight"><pre><span></span><code>cd /etc
ezstream-cfgmigrate -0 ezstream.xml &gt; ezstream.xml.new
cp ezstream.xml ~/
mv ezstream.new ezstream.xml
</code></pre></div></section><section class="print-page" id="adv-topics-remotebase"><h1 id="adv-topics-remotebase-remote-base-nodes">Remote Base Nodes</h1>
<p>The primary purpose of a remote base node is to make outgoing RF connections using a frequency agile radio to allow access to frequencies which are not part of your Internet connected radio system.</p>
<p>Remote base nodes are configured differently than a standard node. A completely different set of internal functions in <code>Asterisk/app_rpt</code> is used when operating a node as a remote base. Usually, the only reason to set up a node as a remote base is when you wish to change the operating parameters of the the attached radio remotely, or if you only want the radio to be used by a single user at a time.</p>
<p>If you want a <em>public</em> node number for a remote base, it must specifically be requested in the <a href="https://allstarlink.org/portal">AllStarLink Portal</a>. You must be sure to answer yes to <code>Is node a remote base station?</code>, and then optionally <code>If remote base, is it frequency agile?</code> questions. Alternatively, you can configure a private node.</p>
<h2 id="adv-topics-remotebase-security-issues">Security Issues</h2>
<p>Unfettered access to remote bases can be a <strong>security issue</strong>. If the remote base has no login protection it could be used by unscrupulous individuals to violate amateur radio rules and regulations. We <strong>strongly</strong> advise that all remote bases be protected by requiring a login code (see <a href="#adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</a> below). </p>
<h2 id="adv-topics-remotebase-behavior-of-standard-nodes-versus-remote-base-nodes">Behavior of Standard Nodes Versus Remote Base Nodes</h2>
<table>
<thead>
<tr>
<th>Behavior</th>
<th>Standard Node</th>
<th>Remote Base Node</th>
</tr>
</thead>
<tbody>
<tr>
<td>Command Decoding</td>
<td>Remote or Local. DTMF can be optionally decoded on the receive audio input</td>
<td>Remote only. No DTMF will be decoded on the receive audio input</td>
</tr>
<tr>
<td>Duplexing</td>
<td>Configurable: duplex or half-duplex</td>
<td>Half-duplex only</td>
</tr>
<tr>
<td></td>
<td>Frequency and Mode Agility</td>
<td>Fixed frequency operation, and channelized operation only using arguments passed in to app_rpt from extensions.conf</td>
</tr>
<tr>
<td>Multiple connections</td>
<td>Multiple nodes can connect. Operates as a conference bridge</td>
<td>Only one node can connect at a time</td>
</tr>
<tr>
<td>Login Protection</td>
<td>No</td>
<td>Optional</td>
</tr>
</tbody>
</table>
<h2 id="adv-topics-remotebase-whats-required">What's Required</h2>
<p>In order to configure a remote base you will need the following:</p>
<h3 id="adv-topics-remotebase-node-number">Node Number</h3>
<p>Either request a public node number or choose a private node number.</p>
<h3 id="adv-topics-remotebase-radio-interface-audio">Radio Interface (Audio)</h3>
<p>A free port on a radio interface such a URI adapter must be made available for use by the remote base. This is needed for the audio transport and keying.</p>
<h3 id="adv-topics-remotebase-radio-interface-cable-control">Radio Interface Cable (Control)</h3>
<p>A radio interface cable must be constructed or purchased to interface the radio to the node for control. Depending on the radio, this could be a USB to serial cable for CAT commands, or similar. </p>
<h3 id="adv-topics-remotebase-supported-radios">Supported Radios</h3>
<p>See the <a href="#adv-topics-remotebase-remote"><code>remote=</code></a> setting below for a list of supported or partially supported radios.</p>
<h2 id="adv-topics-remotebase-remote-base-operation">Remote Base Operation</h2>
<p>The following is an example of how you would use a remote base:</p>
<ul>
<li>Send node *3&lt;node&gt; to connect to the remote base node</li>
<li>Use <a href="#adv-topics-remotebase-functions"><code>[functions_remote]</code></a> commands to operate the remote base</li>
<li>
<ul>
<li>Send *4&lt;node&gt;*000# to set the remote base to memory channel 00</li>
</ul>
</li>
<li>
<ul>
<li>Send *4&lt;node&gt;*1146*940*1# to set the VFO to 146.940-</li>
</ul>
</li>
<li>Send *1&lt;node&gt; to disconnect from the remote base node</li>
</ul>
<h2 id="adv-topics-remotebase-remote-base-node-definition">Remote Base Node Definition</h2>
<p>A remote base needs to be defined as such in the <code>[nodes]</code> context. Specifically, the node definition would need to have the last option changed from "NONE" to "Y".</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>1998 = radio@127.0.0.1/1998,Y                  ; Remote base node on this server
</code></pre></div>
<h2 id="adv-topics-remotebase-remote-base-node-number-stanza">Remote Base Node Number Stanza</h2>
<p>The node number stanza is a critical stanza in <code>rpt.conf</code>. It is the same concept as for a "normal node". </p>
<div class="highlight"><pre><span></span><code>[1998]    ; Replace with your assigned or private node number
</code></pre></div>
<p>The node number stanza is set to the <strong>assigned node number</strong> <em>or</em> a <strong>private node number</strong> (if a private node is being configured). The <a href="#user-guide">asl-menu</a> utility, via the <strong>Node Setup</strong> menu, should normally be used to create node stanzas for both public and private nodes.</p>
<p>The node number stanza contains all the configurable options for that specific node using a <code>key=value</code> pair syntax. The following configurable options are available to use:</p>
<h3 id="adv-topics-remotebase-authlevel">authlevel=</h3>
<p>The <code>authlevel=</code> option is used to enable or disable login requirements for a remote base.</p>
<ul>
<li>authlevel = 0 Disables all access control (not recommended, unsecured)</li>
<li>authlevel = 1 Enables access control, and waits for key up before prompting for the access code</li>
<li>authlevel = 2 Enables access control, and prompts for the access code at the time of connection</li>
</ul>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>authlevel = 0   ; allow everyone 
</code></pre></div>
<p>See <a href="#adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</a> and <a href="#adv-topics-remotebase-remote-base-txlimits-stanza">Remote Base TX Limits</a> for additional details.</p>
<h3 id="adv-topics-remotebase-civaddr">civaddr=</h3>
<p>ICOM radios use the ICOM Communications Interface V (CI-V) for remote control. The <code>civaddr=</code> is used to set the CI-V address. The value is a 2 digit hexadecimal number. If this option is not specified, then the CI-V address will be set to the default of 88.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>civaddr = 88  ; set CIV to 88
</code></pre></div>
<h3 id="adv-topics-remotebase-dusbabek">dusbabek=</h3>
<p>This option is a "Jim Special", and documentation around it is sparse. It accepts parameters of <code>yes</code> or <code>no</code>, and MAY be required for the radio you are interfacing to. Try it, you may or may not need it.</p>
<p>Specifically, it may be required for the Syntor-X (using <code>remote=xcat</code>).</p>
<h3 id="adv-topics-remotebase-functions">functions=</h3>
<p>The <code>functions=</code> option is a pointer to a remote base function stanza. It operates the same as the normal <a href="#config-rpt_conf-functions"><code>functions=</code></a> option. You will likely want to define a functions stanza that is unique for your remote base, so that you can tailor what functions are available to use. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>functions = functions-remote   ; name the functions stanza &#39;functions-remote&#39;

[functions-remote]
0=remote,1                              ; Retrieve Memory
1=remote,2                              ; Set freq.
2=remote,3                              ; Set tx PL tone
3=remote,4                              ; Set rx PL tone
40=remote,100                           ; Rx PL off
41=remote,101                           ; Rx PL on
42=remote,102                           ; Tx PL off
43=remote,103                           ; Tx PL on
44=remote,104                           ; Low Power
45=remote,105                           ; Medium Power
46=remote,106                           ; High Power
51=remote,5                             ; Long status query
52=remote,140                           ; Short status query
61=remote,61                            ; Set mode to FM
62=remote,62                            ; Set mode to USB
63=remote,63                            ; Set mode to LSB
64=remote,64                            ; Set mode to AM
67=remote,210                           ; Send a *
69=remote,211                           ; Send a #
711=remote,107                          ; Bump down ­20Hz
714=remote,108                          ; Bump ­down 100Hz
717=remote,109                          ; Bump ­down 500Hz
713=remote,110                          ; Bump up 20Hz
716=remote,111                          ; Bump up 100Hz
719=remote,112                          ; Bump up 500Hz
721=remote,113                          ; Scan -­ slow
724=remote,114                          ; Scan ­- quick
727=remote,115                          ; Scan ­- fast
723=remote,116                          ; Scan + slow
726=remote,117                          ; Scan + quick
729=remote,118                          ; Scan + fast
79=remote,119                           ; Tune 
91=remote,99,CALLSIGN,[LICENSETAG]      ; Remote base login.
                                        ; Define a different dtmf sequence for each user which is 
                                        ; authorized to use the remote base to control access to it.
                                        ; For example: 
9139583=remote,99,WB6NIL,G              ; would grant access 
                                        ; to the remote base and announce WB6NIL as being logged in.
                                        ; For example:
9148351=remote,99,WA6ZFT,E              ; would grant access 
                                        ; to the remote base and announce WA6ZFT as being logged in.
                                        ; When the remote base is disconnected from the originating 
                                        ; node, the user will be logged out. The LICENSETAG parameter 
                                        ; can be optionally specified to enforce TX band limits.
98=cop,6                                ; Remote base telephone key
</code></pre></div>
<p>In the above example the digits to the left of the = are the DTMF code to dial (don't forget to prefix with <a href="#config-rpt_conf-funcchar"><code>[funcchar]</code></a>, usually *).</p>
<div class="admonition note">
<p class="admonition-title">Command Mode</p>
<p>When sending DTMF commands to a remote base, you need to send them in "command mode", usually *4 (ilink,4). So, if your remote base was defined as node 1998 and you are already connected to the node, you would set the remote base to high power by sending *41998*46.</p>
</div>
<p>See <a href="#adv-topics-remotebase-remote-base-commands">Remote Base Commands</a> for functions that are specifically available for remote base nodes.</p>
<h3 id="adv-topics-remotebase-ioaddr">ioaddr=</h3>
<p>The <code>ioaddr=</code> option sets a parallel port control I/O address. It is specified as a hexadecimal number with a 0x prefix. The parallel port is used when the Doug Hall RBI-1 interface is employed.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>ioaddr = 0x378   ; set RBI-1 /Parallel Port I/O address on LPT1
</code></pre></div>
<h3 id="adv-topics-remotebase-ioport">ioport=</h3>
<p>The <code>ioport=</code> option sets the serial port for the control interface to the remote base radio. On Linux Systems, these are typically path names to special files in the <code>/dev</code> directory.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>ioport = /dev/ttyS1   ; Linux com1
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>ioport = /dev/ttyUSB0 ; USB to serial adapter
</code></pre></div>
<h3 id="adv-topics-remotebase-iospeed">iospeed=</h3>
<p>The <code>iospeed=</code> option sets the serial port baud rate for the control interface to the remote base radio.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>iospeed = 4800         ; Use 4800 baud
</code></pre></div>
<p>Valid <code>iospeed</code> values are:</p>
<ul>
<li>2400</li>
<li>4800</li>
<li>9600 (default if <code>iospeed</code> is not specified)</li>
<li>19200</li>
<li>38400</li>
<li>57600</li>
</ul>
<h3 id="adv-topics-remotebase-mars">mars=</h3>
<p>The <code>mars=</code> option is only used with the IC-706MKIIG remote. When set to <code>1</code>, it enables access to additional bands via remote, as shown below.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>mars = 0        ; set to 1 to enable MARS bands
</code></pre></div>
<p>MARS bands available:</p>
<table>
<thead>
<tr>
<th>Band</th>
<th>Frequency Range</th>
<th>Allowed Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>LMR UHF</td>
<td>450-470MHz</td>
<td>FM</td>
</tr>
<tr>
<td>LMR VHF</td>
<td>148-174MHz</td>
<td>FM</td>
</tr>
<tr>
<td>VHF-AM</td>
<td>108-144MHz</td>
<td>AM</td>
</tr>
<tr>
<td>AM BCB</td>
<td>550-1750kHz</td>
<td>AM</td>
</tr>
<tr>
<td>HF SWL</td>
<td>1750kHz-30MHz</td>
<td>AM</td>
</tr>
</tbody>
</table>
<h3 id="adv-topics-remotebase-phone_functions">phone_functions=</h3>
<p>The <code>phone_functions=</code> is a pointer to a remote base phone function stanza. It operates the same as the normal <a href="#config-rpt_conf-phone_functions"><code>phone_functions=</code></a> option. You will likely want to define a phone functions stanza that is unique for your remote base, so that you can tailor what functions are available to use. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>phone_functions = functions-remote

[functions-remote]
...
</code></pre></div>
<h3 id="adv-topics-remotebase-remote">remote=</h3>
<p>The <code>remote=</code> option sets the type of radio. It <strong>must</strong> be defined, as it ensures that the node will be defined as a remote base node and not a standard node, and determines the protocol for communicating with the radio over the <code>ioport</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote = xcat   ; set xcat interface
</code></pre></div>
<table>
<thead>
<tr>
<th>Vendor</th>
<th>Model</th>
<th>remote= Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>N/A</td>
<td>Dumb</td>
<td>y</td>
<td>Use for any single channel remote base radios, with no remote tuning capability</td>
</tr>
<tr>
<td>N/A</td>
<td>Parallel Port</td>
<td>pp16</td>
<td>Parallel port programmable 16 channels? Perhaps parallel port BCD bit-banging, such for Motorola radios that can be driven from their accessory port? Interface information not available</td>
</tr>
<tr>
<td>Doug Hall</td>
<td>Remote Base Interface</td>
<td>rbi</td>
<td>Requires Parallel Port Address https://wiki.allstarlink.org/wiki/Remote_Base:_Doug_Hall_RBI-1</td>
</tr>
<tr>
<td>ICOM</td>
<td>IC-706MKIIG</td>
<td>ic706</td>
<td><strong>IC-706MKIIG only</strong>. Must specify serial port using <code>ioport=</code>. Must specify CIV address using <code>civaddr=</code>. Also note <code>mars=</code> option. Earlier versions return data format is different and will lock up the software</td>
</tr>
<tr>
<td>Kenwood</td>
<td>Various</td>
<td>kenwood</td>
<td>Should work for many/most Kenwood radios, unless otherwise specified</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TM-D700</td>
<td>tmd700</td>
<td></td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-440</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-450</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TS-950</td>
<td>kenwood</td>
<td>Some functions may not work</td>
</tr>
<tr>
<td>Kenwood</td>
<td>TM-271</td>
<td>tm271</td>
<td>Must specify serial port using <code>ioport=</code></td>
</tr>
<tr>
<td>Kenwood</td>
<td>TMG-707</td>
<td>kenwood</td>
<td>Must specify serial port using <code>ioport=</code></td>
</tr>
<tr>
<td>Motorola</td>
<td>Syntor Xcat</td>
<td>xcat</td>
<td>Must specify serial port using <code>ioport=</code>. Must specify CIV address using <code>civaddr=</code></td>
</tr>
<tr>
<td>Ritron Patriot</td>
<td>RTX-150</td>
<td>rtx150</td>
<td>Interface information not available</td>
</tr>
<tr>
<td>Ritron Partiot</td>
<td>RTX-450</td>
<td>rtx450</td>
<td></td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-100</td>
<td>ft100</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-897GXII</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work.</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-857</td>
<td>ft897</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-897</td>
<td>ft897</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 4800</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-890</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-900</td>
<td>ft100</td>
<td>See FT-100. Some commands may not work</td>
</tr>
<tr>
<td>Yaesu</td>
<td>FT-950</td>
<td>ft950</td>
<td>Must specify serial port using <code>ioport=</code>. Default <code>iospeed=</code> is set to 38400</td>
</tr>
</tbody>
</table>
<p>Many Yaesu models should work for the most part with one of the above, back to 747/757 vintage for frequency and mode anyway. The FT-817 has completely different commands, so it won't work.</p>
<h3 id="adv-topics-remotebase-remote_inact_timeout">remote_inact_timeout=</h3>
<p>This option specifies the amount of time without keying from the link, before the link is determined to be inactive. Set to <code>0</code> to disable timeout.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_inact_timeout = 0   ; do not time out
</code></pre></div>
<h3 id="adv-topics-remotebase-remote_timeout">remote_timeout=</h3>
<p>This option specifies the session time out for the remote base. Set to <code>0</code> to disable. This option does not appear to be implemented in code.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_timeout = 0   ; do not timeout
</code></pre></div>
<p>Default is 3600 (seconds?).</p>
<h3 id="adv-topics-remotebase-remote_timeout_warning">remote_timeout_warning=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 180 (seconds?).</p>
<h3 id="adv-topics-remotebase-remote_timeout_warning_freq">remote_timeout_warning_freq=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 30 (seconds?).</p>
<h3 id="adv-topics-remotebase-rxchannel">rxchannel=</h3>
<p>This option contains the type of channel driver which is being used for the audio and control (COR/PTT) interface to the remote base.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxchannel = SimpleUSB/1998
</code></pre></div>
<p>See the <a href="#config-rpt_conf-rxchannel"><code>rxchannel=</code></a> option for available channel drivers.</p>
<h3 id="adv-topics-remotebase-split2m">split2m=</h3>
<p>This option defines the offset in kHz to use for 2m <a href="#adv-topics-remotebase-remote-base-memory-stanza">memory chanels</a>. The default if not defined is 600 (kHz).</p>
<h3 id="adv-topics-remotebase-split70cm">split70cm=</h3>
<p>This option defines the offset in kHz to use to 70cm <a href="#adv-topics-remotebase-remote-base-memory-stanza">memory channels</a>. The default if not defined is 5000 (kHz), aka 5MHz.</p>
<h2 id="adv-topics-remotebase-remote-base-commands">Remote Base Commands</h2>
<p>Remote base commands (<code>functionclass</code> of <code>remote</code>) provide DTMF functions for remote base control. The <code>remote</code> commands are only applicable to remote base node configurations.</p>
<table>
<thead>
<tr>
<th>remote</th>
<th>Description</th>
<th>Parameter(s) Accepted</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Retrieve Memory</td>
<td>00 to 99</td>
</tr>
<tr>
<td>2</td>
<td>Set VFO Frequency</td>
<td>MMM*kkk*o# where MMM is frequency in MHz, kkk is kHz portion of the frequency, o is offset (1=minus, 2=simplex, 3=positive)</td>
</tr>
<tr>
<td>3</td>
<td>Set TX PL Tone</td>
<td>XXX*X ie 067*0 to set 67.0Hz</td>
</tr>
<tr>
<td>4</td>
<td>Set RX PL Tone</td>
<td>XXX*X ie 067*0 to set 67.0Hz</td>
</tr>
<tr>
<td>5</td>
<td>Link Status Query (long)</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>Set Operating Mode</td>
<td>m, where m is 1 (FM), 2 (USB), 3, (LSB), or 4 (AM)</td>
</tr>
<tr>
<td>99</td>
<td>Remote Base login</td>
<td>CALLSIGN,LICENSETAG</td>
</tr>
<tr>
<td>100</td>
<td>RX PL Off</td>
<td>Default</td>
</tr>
<tr>
<td>101</td>
<td>RX PL On</td>
<td></td>
</tr>
<tr>
<td>102</td>
<td>TX PL Off</td>
<td>Default</td>
</tr>
<tr>
<td>103</td>
<td>TX PL On</td>
<td></td>
</tr>
<tr>
<td>104</td>
<td>Low Power</td>
<td></td>
</tr>
<tr>
<td>105</td>
<td>Medium Power</td>
<td></td>
</tr>
<tr>
<td>106</td>
<td>High Power</td>
<td></td>
</tr>
<tr>
<td>107</td>
<td>Bump -20Hz</td>
<td></td>
</tr>
<tr>
<td>108</td>
<td>Bump -100Hz</td>
<td></td>
</tr>
<tr>
<td>109</td>
<td>Bump -500Hz</td>
<td></td>
</tr>
<tr>
<td>110</td>
<td>Bump +20Hz</td>
<td></td>
</tr>
<tr>
<td>111</td>
<td>Bump +100Hz</td>
<td></td>
</tr>
<tr>
<td>112</td>
<td>Bump +500Hz</td>
<td></td>
</tr>
<tr>
<td>113</td>
<td>Scan - Slow</td>
<td></td>
</tr>
<tr>
<td>114</td>
<td>Scan - Quick</td>
<td></td>
</tr>
<tr>
<td>115</td>
<td>Scan - Fast</td>
<td></td>
</tr>
<tr>
<td>116</td>
<td>Scan + Slow</td>
<td></td>
</tr>
<tr>
<td>117</td>
<td>Scan + Quick</td>
<td></td>
</tr>
<tr>
<td>118</td>
<td>Scan + Fast</td>
<td></td>
</tr>
<tr>
<td>119</td>
<td>Tune (brief AM transmission for automatic tuners)</td>
<td></td>
</tr>
<tr>
<td>140</td>
<td>Link Status Query (brief)</td>
<td></td>
</tr>
<tr>
<td>210</td>
<td>Send a *</td>
<td></td>
</tr>
<tr>
<td>211</td>
<td>Send a #</td>
<td></td>
</tr>
</tbody>
</table>
<p>Not all commands above are supported by all radios. For example, radios which don't support SSB, would not be able to be placed in LSB or USB mode.</p>
<p>See the <a href="#adv-topics-remotebase-functions">Remote Base Functions</a> on how to define the DTMF commands for remote base functions.</p>
<h2 id="adv-topics-remotebase-remote-base-authentication">Remote Base Authentication</h2>
<p>When <a href="#adv-topics-remotebase-authlevel"><code>authlevel=</code></a> is greater than zero, the <a href="#adv-topics-remotebase-remote-base-commands"><code>remote,99</code></a> command is used to define a different DTMF sequence (password) for each user authorized to use the remote base. The remote base will announce the callsign as access is granted.</p>
<p>If using an <code>authlevel</code> greater than zero, be sure to define users in your <code>[functions]</code> stanza to authenticate against.</p>
<p>The format of the function is: <code>DTMF_Password = remote,99,CALLSIGN,LICENSETAG</code>.</p>
<p>The <code>LICENSETAG</code> is the corresponding entry in the <a href="#adv-topics-remotebase-remote-base-txlimits-stanza"><code>[txlmiits]</code></a> stanza. The <code>LICENSETAG</code> is used for enforce TX frequency limits.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[1998]           ; node number for the remote base
; authlevel = 0  ; Anyone can use it
; authlevel = 1  ; Requires log in, Waits for Tx key to ask for it
authlevel = 2  ; Requires log in, asks for it automously

[remote-functions]
8xx=remote,99,OK,E ; where xx is the password
</code></pre></div>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>9139583 = remote,99,WB6NIL,G   ; grant access to Jim (general)
9148351 = remote,99,WA6ZFT,E   ; grant access to Steve (extra)
</code></pre></div>
<p>In the above example, DTMF "*9139583" would log in to the remote base as WB6NIL, with the TX Limits of the "G" class as defined in the <a href="#adv-topics-remotebase-remote-base-txlimits-stanza"><code>[txlimits]</code></a> staza.</p>
<p>When the remote base is disconnected from the originating node, the
user will be logged out. </p>
<h2 id="adv-topics-remotebase-remote-base-memory-stanza">Remote Base Memory Stanza</h2>
<p>Up to 100 (00 to 99) preset memory channels can be defined, to be recalled by the <code>remote,1</code> function command.</p>
<p>If the <code>init</code> memory channel is optionally specified, the remote base will attempt to tune to this channel when a user connects.</p>
<p>Remote base memories are in the format of:</p>
<p>Remote base memory syntax: <code>CC=RRR.RRR,PPP.P,AAAAA</code> or <code>CC=RRR.RRR,PPP.P,OFFSET,AAAAA</code></p>
<ul>
<li>C = Memory (Channel) number</li>
<li>R = RX Frequency (must be defined down to kHz)</li>
<li>P = PL Frequency</li>
<li>A = One or more Attributes</li>
</ul>
<p>Attributes are specified as a <em>non-delimited</em> string. The available Attributes are: </p>
<ul>
<li>a = AM, b = LSB, f = FM, u = USB</li>
<li>l = Low Power, m = Medium Power, h = High Power</li>
<li>
<ul>
<li>= Minus TX Offset, s = Simplex, + = Plus TX Offset</li>
</ul>
</li>
<li>t = TX PL on, r = RX PL on</li>
</ul>
<p>To use a non-standard offset on the memory channel, it can be defined (in kHz), be sure to also specify either <code>-</code> or <code>+</code>, as necessary.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[memory]
init = 146.520,000.0,fm ; set to this channel on start
00 = 146.580,100.0,m
01 = 147.030,103.5,m+t
02 = 147.240,103.5,m+t
03 = 147.765,79.7,m-t
04 = 146.460,100.0,m
05 = 146.550,100.0,m
06 = 147.540,000.0,fs
07 = 147.540,123.0,shrt
08 = 147.435,103.5,1035,h-t ; This would be for W6NUT in Los Angeles with input of 146.400, and a PL of 103.5Hz.
</code></pre></div>
<p><strong>NOTE:</strong> Not all attributes may be supported by all radios.</p>
<h2 id="adv-topics-remotebase-remote-base-txlimits-stanza">Remote Base Txlimits Stanza</h2>
<p>The <code>[txlimits]</code> stanza defines TX privileges to be assigned to a particular license class (<code>LICENSETAG</code>).</p>
<p>The <code>LICENSETAG</code> is used when configuring the <a href="#adv-topics-remotebase-remote-base-authentication"><code>authentication</code></a> parameters for remote base users.</p>
<div class="highlight"><pre><span></span><code>[txlimits]
; In the example below, voice privileges are assigned for US ham
; licensees for 40 meters through 10 meters.
; Each line contains a LICENSETAG defined in a user login command,
; then a set of band limit ranges. Up to 40 ranges per entry may be defined.
;
T = 28.300-28.500
G = 7.175-7.300,14.225-14.300,18.110-18.168,21.275-21.450,24.930-24.990,28.300-29.700
A = 7.125-7.300,14.175-14.300,18.110-18.168,21.225-21.450,24.930-24.990,28.300-29.700
E = 7.125-7.300,14.150-14.300,18.110-18.168,21.200-21.450,24.930-24.990,28.300-29.700
</code></pre></div>
<h2 id="adv-topics-remotebase-sample-remote-configuration">Sample Remote Configuration</h2>
<div class="highlight"><pre><span></span><code>[1998]
; Rx audio/signaling channel                                                                                   
rxchannel = Radio/usb

; Serial port for control
ioport = /dev/ttyS1

; Radio Type                
remote = ft897 

; Function list from link                                          
functions = functions-remote  

; Function list from phone         
phone_functions = functions-remote

; Authorization level                                         
authlevel = 0      
</code></pre></div>
<h2 id="adv-topics-remotebase-doug-hall-rbi-1-remote-base">Doug Hall (RBI-1) Remote Base</h2>
<p><strong>The Doug Hall RBI-1 is long obsolete, but is documented here for reference.</strong></p>
<p>The Doug Hall Electronics Model RBI-1 is frequency agile, multi port, remote base. It is possible to interface the RBI-1 to AllStar, but only on a PC.</p>
<h3 id="adv-topics-remotebase-rbi-1-connections">RBI-1 Connections</h3>
<p>The RBI-1 uses the first three pins of the parallel port and can not be changed. There is no other interface method built into the <code>app_rpt</code> software. If you have been using the pins for anything else, you will need to migrate them to higher pins than the first three. See Parallel Port GPIO.</p>
<p>Parallel port pinout is as follows:
<div class="highlight"><pre><span></span><code>PP1 = data
PP2 = clock
PP3 = reset
</code></pre></div></p>
<p>No buffering is required. Attach directly to the RBI-1's DB9 interface on the correct parallel port pins.</p>
<h3 id="adv-topics-remotebase-rbi-1-rptconf-settings">RBI-1 rpt.conf Settings</h3>
<p>In <code>rpt.conf</code> you will need to set lines in the node's stanza:</p>
<div class="highlight"><pre><span></span><code>[1998]                              ; your node number 
iobase=0x378                        ; (for lpt1)
remote=rbi                          ; Doug Hall RBI-1
functions=funtions-remote1998       ; Function list from link (a list of agile working commands) - use your node number
memory=memory1998                   ; &#39;system stored&#39; radio presets, not required - use your node number

[funtions-remote1998]               ;for RBI-1   use your node number

0=remote,1                          ; Retrieve Radio Stored Memory Channel
1=remote,2                          ; Set freq. VFO MMMMM*KKK*O   (Mhz digits, Khz digits, Offset)
2=remote,3                          ; Set tx PL tone PL Tone HHH*D*
3=remote,4                          ; Set rx PL tone         HHH*D*

40=remote,100                       ; Rx PL off
41=remote,101                       ; Rx PL on
42=remote,102                       ; Tx PL off
43=remote,103                       ; Tx PL on
44=remote,104                       ; Low Power
45=remote,105                       ; Medium Power
46=remote,106                       ; High Power

51=remote,5                         ; Long status query
52=remote,140                       ; Short status query
67=remote,210                       ; Send a *
69=remote,211                       ; Send a #


; Not Required but noted:

[memory1998]                        ;Stored presets for radio, 
                                    ;Format: (recall# xx) = (Freq 6 digits and decimal) (TX PL Tone )  ( CTCSS Tone )  (ofset + - S ) ( power l m h )
init=224.660,100.0,-l               ;initial freq/mode on start-up/boot - choose something safe in case of error. Not required. Can be remarked out.
00=224.560,100.0,-l
01=224.460,114.8,-l
02=224.580,131.8,-l
03=223.980,100.0,-l
04=146.940,114.8,-lt
10=442.175,162.2,+l
11=444.475,114.8,+l
12=444.150,100.0,+l
;13=446.500,100.0,sl
</code></pre></div></section><section class="print-page" id="adv-topics-rxtoneburst"><h1 id="adv-topics-rxtoneburst-rx-toneburst">RX Toneburst</h1>
<p>RX toneburst is a repeater access method (similar to CTCSS/PL or DCS) where the repeater will not become active until it receives the proper access tone.</p>
<p>It is/was a common access method used almost exclusively in Europe. The typical tone used was 1750Hz. A user would send an initial burst of 1750Hz, usually less than 500mS, which would "wake up" the repeater. Once the repeater was "active", it would usually revert to carrier access for the duration of the conversation. After a period of quiet time, the repeater would revert to being "inactive", until it received another wake-up toneburst.</p>
<h2 id="adv-topics-rxtoneburst-configuring-receive-toneburst-access">Configuring Receive Toneburst Access</h2>
<p>If you wish to set up a node to require receive toneburst, you must at least specify the toneburst frequency. The following parameters would need to be added to <a href="#config-rpt_conf"><code>/etc/asterisk/rpt.conf</code></a> in the node configuration section of the desired node.</p>
<div class="highlight"><pre><span></span><code>rxburstfreq = 1750          ; set the desired toneburst frequency, in Hz
rxbursttime = 500           ; minimum duration required for the tone to be present, in mS
rxburstthreshold=10         ; minimum signal to noise radio, in dB, to detect a valid tone
</code></pre></div></section><section class="print-page" id="adv-topics-tlb"><h1 id="adv-topics-tlb-thelinkbox">TheLinkBox</h1>
<p>It is possible to interface an <code>Asterisk/app_rpt</code> installation with <a href="https://github.com/skiphansen/thelinkbox">TheLinkBox</a> program (by Skip, WB6YMH), using the <code>chan_tlb</code> channel driver.</p>
<p>The connection(s) are accessed and referred to by a locally-assigned (private) node number, starting with "1" (generally 1000-1999, private node numbering space). </p>
<p>Since the interface is unique to the <code>app_rpt</code> installation, other AllStarLink nodes must first connect to the node(s) configured to connect with the desired TheLinkBox station(s).</p>
<p>Both TheLinkBox and <code>app_rpt</code> sides of the connection must choose a <strong><em>consecutive</em></strong> pair of UDP port numbers on which to communicate (ports <code>44966/44967</code> by default) and also must both be on <strong>static</strong> IP addresses.</p>
<p>TheLinkBox supports uLAW, G726 and GSM codecs. The <code>app_rpt</code> side of the connection dictates which codec is to be used.</p>
<p>To enable TheLinkBox connectivity, there must be a <a href="#config-tlb_conf"><code>tlb.conf</code></a> on the AllStarLink node, the <code>chan_tlb</code> channel driver module must be loaded, and <a href="#config-rpt_conf"><code>rpt.conf</code></a> must be configured to use the appropriate <a href="#config-rpt_conf-rxchannel"><code>rxchannel</code></a>.</p>
<h2 id="adv-topics-tlb-tlbconf"><code>tlb.conf</code></h2>
<p>See the <a href="#config-tlb_conf"><code>tlb.conf</code></a> page for more information on the configuration options for the <code>chan_tlb</code> channel driver.</p>
<h2 id="adv-topics-tlb-rptconf"><code>rpt.conf</code></h2>
<p>You need to define the appropriate <a href="#config-rpt_conf-rxchannel"><code>rxchannel</code></a> option to use <code>chan_tlb</code>, and pointing to a valid context in your <code>tlb.conf</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>In rpt.conf:

rxchannel = tlb/tlb0

In tlb.conf:
[tlb0]
...
</code></pre></div>
<h2 id="adv-topics-tlb-modulesconf"><code>modules.conf</code></h2>
<p>Ensure <code>/etc/asterisk/modules.conf</code> loads <code>chan_tlb.so</code>:</p>
<div class="highlight"><pre><span></span><code>load =&gt; chan_tlb.so                 ;TheLinkBox Channel Driver 
</code></pre></div>
<h2 id="adv-topics-tlb-thelinkbox-configuration">TheLinkBox Configuration</h2>
<p>On TheLinkBox side, you must specify the following in the main configuration file (typically <code>tlb.conf</code>):</p>
<div class="highlight"><pre><span></span><code>RTP_Port = 44966
</code></pre></div>
<p>And you must have an entry if your TheLinkBox ACL file (generally <code>tlb.acl</code>) for each <code>app_rpt</code> node as follows:</p>
<div class="highlight"><pre><span></span><code>allow   WB6NIL   99.88.77.66     -       -R
</code></pre></div>
<p>This example would allow station WB6NIL-R access from ip 99.88.77.66. Note that WB6NIL-R is the <code>call</code> defined in the <code>app_rpt</code> node's <code>tlb.conf</code>.</p></section><section class="print-page" id="adv-topics-uefi-secureboot"><h1 id="adv-topics-uefi-secureboot-uefi-and-secureboot">UEFI and SecureBoot</h1>
<p>UEFI (Unified Extensible Firmware Interface) is a modern firmware interface that replaces the older BIOS system, providing a more flexible and powerful environment for booting and managing hardware. It supports larger hard drives, faster boot times, and a more user-friendly interface.</p>
<p>Secure Boot is a feature of UEFI that ensures only trusted software is loaded during the boot process, protecting the system from malware and unauthorized software. It works by verifying the digital signatures of boot loaders and operating system files against a database of trusted certificates.</p>
<p>Together, UEFI and Secure Boot enhance the security and efficiency of modern computing systems.</p>
<p>Given a quirk of how Asterisk and <code>app_rpt</code> needs a kernel module (driver) not already contained in the core system provided by Debian, installing AllStarLink on a system requiring UEFI/SecureBoot requires additional steps to create what's called a Machine Owner Key (MOK).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Raspberry Pi does not use or support UEFI or SecureBoot</p>
</div>
<h2 id="adv-topics-uefi-secureboot-generating-a-machine-owner-key">Generating a Machine Owner Key</h2>
<p>Generation of a Machine Owner Key (MOK) is done with the <a href="#mans-asl-setup-dkms-mok"><code>asl-setup-dkms-mok</code></a> utility. This tool appeared in the package asl3-3.3.0-1.</p>
<ol>
<li>
<p>Run the command <code>sudo asl-setup-dkms-mok</code>. This will prompt for several items of information. An example run will look like:</p>
<div class="highlight"><pre><span></span><code>$ sudo asl-setup-dkms-mok
!!!
!!! WARNING - RUNNING THIS SCRIPT WILL REGENERATE THE
!!! DEFAULT MACHINE OWNER KEY (MOK) FOR SECURE BOOT. IN GENERAL YOU
!!! ARE RUNNING THIS SCRIPT BECAUSE YOU NEED TO AND YOU KNOW WHY
!!! YOU ARE DOING IT. HOWEVER BE WARNED!
!!!
ENTER &quot;galaxy&quot; TO CONTINUE&gt;&gt; galaxy

Generating an MOK requires a name for the certificate. This can be
anything, however your name or your callsign is recommended.

Name or callsign&gt;&gt; N8EI

Generating the MOK...
......+...+...+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*................+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+.........+......+...+.+...........+...+.+...+..+.+...+..............+.......+...........+.........+................+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.....+............+.........+.+.....+....+...+...+..............+.+..+...............+.+..+...+.+........+.+......+........+...............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+...+............+..+....+............+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.....+...+...........................+......+.......+...............+.....+......+..........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-----

Enter a one-time password for this key. This password will be prompted
for at the next reboot to properly install the key in the UEFI
bootloader keyring. This does not need to be an incredibly complex
password and you may write it down until it&#39;s used.

input password:
input password again:

Setup /etc/dkms/framework.conf.d/asl.conf
Generate /etc/dkms/asl_sign_helper.sh

You must reboot the system and enter the OTP to load the key into SecureBoot
This will appear on your directly-connected monitor or your cloud console
</code></pre></div>
</li>
<li>
<p>Prepare to reboot the system. Make sure a monitor is attached to the system or, if using a cloud virtual machine / VPS, make sure that a remote virtual console is connected. Then, reboot the system.</p>
<div class="admonition warning">
<p class="admonition-title">MOK Load Staging is One-Time Only</p>
<p>Note that the MOK is only staged for load one time. If the MOK load prompt
is not responded to at the first/next reboot, the MOK staged for load
is wiped and Step #1 will have to be run again.</p>
</div>
</li>
<li>
<p>Complete the steps to review, unlock, and load the MOK</p>
<div class="admonition tip">
<p class="admonition-title">The next step varies by vendor</p>
<p>The next step uses screenshots from a Linux/QEMU virtual
environment. Every device manufacturer or cloud provider will
have a slightly different process or look.</p>
</div>
<p><a class="glightbox" href="../adv-topics/img/mok-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 1" src="../adv-topics/img/mok-1.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 3" src="../adv-topics/img/mok-3.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 4" src="../adv-topics/img/mok-4.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 5" src="../adv-topics/img/mok-5.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-6.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 6" src="../adv-topics/img/mok-6.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-7.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 7" src="../adv-topics/img/mok-7.png" width="400" /></a></p>
<p><a class="glightbox" href="../adv-topics/img/mok-8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Step 8" src="../adv-topics/img/mok-8.png" width="400" /></a></p>
</li>
<li>
<p>Reboot the system back into Linux and log in.</p>
</li>
<li>
<p>Check that the MOK created is now loaded by looking for the "name" you provided the certificate in Step 1. In this example, the MOK was named "N8EI".</p>
<div class="highlight"><pre><span></span><code>sudo dmesg | grep -i N8EI
</code></pre></div>
<p>The output will look like:
<div class="highlight"><pre><span></span><code>$ sudo dmesg | grep -i N8EI
[    0.674788] integrity: Loaded X.509 cert &#39;N8EI: 92ed492eeb11594eb25af5cc70ff0587115f2577&#39;
</code></pre></div></p>
</li>
<li>
<p>Rebuild the <code>dahdi-dkms</code> package so that the modules are signed by the MOK so that the kernel will load them.</p>
<div class="highlight"><pre><span></span><code>apt install --reinstall -y dahdi-dkms
</code></pre></div>
</li>
<li>
<p>Test the module loads successfully:</p>
<div class="highlight"><pre><span></span><code> $ sudo modprobe dahdi dahd_dummy dahdi_transcode
$ lsmod | grep dahdi
dahdi_dummy            16384  0
dahdi_transcode        16384  0
dahdi                 258048  2 dahdi_dummy,dahdi_transcode
</code></pre></div>
</li>
</ol></section><section class="print-page" id="adv-topics-usbinterfaces"><h1 id="adv-topics-usbinterfaces-usb-audio-interfaces">USB Audio Interfaces</h1>
<p>Setting up USB audio interfaces is much easier with ASL3.</p>
<ul>
<li>The USB audio interface "tune" settings have been moved into their respective configuration files, <code>simpleusb.conf</code> and <code>usbradio.conf</code>. The separate tune files (e.g. <code>simple-tune-usb1999.conf</code>) no longer exist</li>
<li>The device string is automatically found when the USB setting <code>devstr =</code> is empty</li>
<li><code>rxchannel=SimpleUSB/USB1999</code> has been changed to <code>rxchannel=SimpleUSB/1999</code>. Same for <code>rxchannel=Radio/1999</code> for consistency with other <code>rxchannel=</code> settings</li>
<li>A new <a href="#mans-asl-find-sound"><code>asl-find-sound</code></a> utility can be used to help identify the compatible device strings for attached interfaces</li>
<li>We now support the ability to specify vendor and product identifiers (VID and PID) for non-natively supported audio interface chips</li>
</ul>
<p>The <a href="#user-guide"><code>asl-menu</code></a> and Asterisk CLI USB config commands handle these changes.</p>
<h2 id="adv-topics-usbinterfaces-usb-interface-ic-support">USB Interface IC Support</h2>
<p>Nearly all USB Interface products that are used with ASL nodes use C-Media CM108 and CM119 USB interface ICs (or their variants). These ICs provide the following features:</p>
<ul>
<li>Two 16-bit DAC audio outputs, capable of driving line level or headphone outputs</li>
<li>One 16-bit ADC mic/audio input with switchable mic preamp</li>
<li>Internal hardware mixers allowing ADC input and DAC output levels to be adjusted within a range of approximately 40dB, making it easy to optimally match input and output audio levels within the ASL tune utility settings, as well as a mixer allowing input audio to be mixed into output audio with zero latency</li>
<li>GPIO lines that support a PTT output, a Status LED, a Clip LED, COS and CTCSS inputs, and one or more additional general-purpose I/O (GPIO) lines that can be controlled by ASL in response to events or DTMF commands</li>
<li>Support for an attached EEPROM IC to store user configuration and manufacturer information.</li>
</ul>
<p>The CM119 provides an additional 4 GPIO lines (GPIOs 5-8) versus the CM108. The original CM108 and CM119 ICs were replaced in the early 2010's with the CM108AH and CM119A. These ICs are still used in many USB Radio Interfaces (URIs). Newer versions of the CM1xx ICs, the CM108B and CM119B, are now available and have some minor differences in gain settings and other specifications, but are fully compatible with the earlier IC versions and with ASL.</p>
<h3 id="adv-topics-usbinterfaces-supported-c-media-chips">Supported C-Media Chips</h3>
<p>ASL3 natively supports C-Media chips with the vendor identifer <strong>(VID)</strong> <code>0x0d8c</code> with the following list of product identifiers <strong>(PID)</strong> .</p>
<table>
<thead>
<tr>
<th>Chip</th>
<th>Product Identifier (PID)</th>
</tr>
</thead>
<tbody>
<tr>
<td>CM-108</td>
<td>0x000c, 0x000d, 0x000e, 0x000f</td>
</tr>
<tr>
<td>CM-108B</td>
<td>0x0012</td>
</tr>
<tr>
<td>CM-108AH</td>
<td>0x013c</td>
</tr>
<tr>
<td>CM-119</td>
<td>0x0008</td>
</tr>
<tr>
<td>CM-119A</td>
<td>0x013a</td>
</tr>
<tr>
<td>CM-119B</td>
<td>0x0013</td>
</tr>
<tr>
<td>N1KDO</td>
<td>0x6a00</td>
</tr>
</tbody>
</table>
<p>There are more variants of the C-Media chips that can be used with ASL3. If your sound card is not natively supported, you can configure ASL3 to recognize your card's vendor id <strong>(VID)</strong> and product id <strong>(PID)</strong>. To determine the vendor id and product id of your sound card, use the <code>lsusb</code> command at the Linux CLI prompt.</p>
<p>You will see something similar to the following:</p>
<div class="highlight"><pre><span></span><code>Bus 001 Device 003: ID 0d8c:013b C-Media Electronics, Inc. USB PnP Sound Device
</code></pre></div>
<p>The vendor identifier <strong>(VID)</strong> is <code>0d8c</code> with a product identifier <strong>(PID)</strong> of <code>013b</code>.  This chip does not appear in the list of natively supported chips. You can enter this non-natively supported chip in <code>res_usbradio.conf</code>.  </p>
<p><strong>NOTE:</strong> You can enter multiple VID:PID pairs by separating the pairs with a comma.</p>
<p>Edit <code>/etc/asterisk/res_usbradio.conf</code> with your favorite editor. You will see the following:</p>
<div class="highlight"><pre><span></span><code>;usb_devices = 1209:7388    ;comma delimited list of usb
                            ;descriptors to allow.
                            ;format vvvv:pppp in hexadecimal
                            ;vvvv=vendor id, pppp=product id
                            ;
                            ;1209:7388 = AIOC (all in one cable)
</code></pre></div>
<p><strong>NOTE:</strong> The All-In-One-Cable (AIOC) emulates the C-Media CM-108 chip. The sample above shows the VID:PID for the AIOC. If you will be using the AIOC, just remove the <code>;</code> before <code>usb_devices</code>.</p>
<p>Replace <code>;usb_devices = 1209:7388</code> with <code>usb_devices = vvvv:dddd</code> for your specific C-Media chip. Save your changes and restart Asterisk. The added VID:PID will now be available to the <code>SimpleUSB</code> and <code>USBRadio</code> channel drivers.</p>
<p><strong>NOTE:</strong> The <a href="#mans-asl-find-sound"><code>asl-find-sound</code></a> utility will include the VID:PID pairs entered in <code>res_usbradio.conf</code>.</p>
<h3 id="adv-topics-usbinterfaces-setting-audio-levels">Setting Audio Levels</h3>
<p>When setting up a new node, or if any changes have been made such as use of a different radio, microphone, other audio hardware, or gain settings, checking and setting audio levels is <strong>very important</strong>. </p>
<p>If you have a radio attached to your node, you are <strong>stongly encouraged</strong> to tune your audio settings (and this your transmit deviation) using a communications service monitor. Failure to do so can easily result in you modulating distorted audio, as well as potentially causing adjacent channel interference due to excessive deviation or splatter. </p>
<p>Radio equipment such as HTs or mobile radios, and many electronics products such as VOIP phones often restrict end-user audio adjustment capabilities to ensure consistent audio levels. AllStarLink nodes and USB interfaces however, generally allow greater flexibility and thus extra attention is required to be sure your audio interface gains are properly matched to the external audio input and output levels. Failure to calibrate your audio levels could mean your node is much quieter or louder than it should be when linked to other nodes, which could be disruptive to other users and systems. It can also mean that the signal from your RF transmitter may cause interference with other radio systems, which carries serious consequences from spectrum regulators.</p>
<p>Most nodes use the <code>SimpleUSB</code> channel driver (<code>chan_simpleusb</code>). Nodes that require more advanced features such as DSP squelch detection, CTCSS tone encode/decode, or additional audio filtering options may use the <code>USBRadio</code> channel driver (<code>chan_usbradio</code>). These channel drivers both have tune utilities for setting audio levels and other functions. Once a node has been configured in the <a href="#user-guide"><code>asl-menu</code></a> <strong>Node Settings</strong>, you will end up in the appropriate tune application. The following options should then be used to check and optimize audio level settings:</p>
<p><strong>NOTE:</strong> Be sure you are not connected to any other nodes when doing any of the following tests and adjustments.</p>
<ul>
<li><code>Set Rx Voice Level (using display)</code> provides a level meter. Talk at a normal and steady volume into the microphone and be sure that the average level does not go past the "3KHz" point, and that peak levels do not go significantly past the "5KHz" point. Note that for proper mic technique you should talk no closer than 2 to 3 inches (5 - 10 cm) from the microphone, and it should be held at an angle to minimize pops/plosives. Once you see where the audio levels are, hit the Enter key and you'll then be prompted to change the setting. If for example the current setting is 500 and your levels were too high, try entering 400 for a new value and then repeat the test. Continue to iteratively adjust the settings until the average audio levels stay around the "3KHz" mark. For a more precise calibration with radio nodes a 1KHz test tone can be input into another radio at a level that results in 3KHz FM deviation, then calibrate the node to the 3KHz mark, however this can be more complicated to set up and may not account for other differences such as different mics or mic gain settings.</li>
<li><code>Set Transmit A Level</code>, <code>Set Transmit B Level</code> (or <code>Set Transmit Voice Level</code> for USBRadio) allow the node audio output levels to be set. For nodes connected to a radio transceiver the level should be set such that the transmitted FM deviation is no higher than 3KHz, and the audio does not sound distorted or overly loud. When listening on another radio it can also be helpful to confirm the audio levels from your node sound about the same as levels on FM repeaters in your area.</li>
<li><code>Toggle RX Boost</code> enables a preamp in the CM1xx for use with very low mic-level input signals. This should be disabled in almost all cases.</li>
<li><code>View Rx Audio Statistics</code> shows precise audio level information. If when running this option and talking at a normal to loud volume into your mic, you see <code>Pk</code> levels of any higher than -3.0 dBFS, <code>Avg Pwr</code> levels of higher than -12 dBFS, or any <code>ClipCnt</code> value greater than 0, you should reduce your rxmix setting (using the <code>Set Rx Voice Level</code> menu option), and then repeat this step. "dBFS" is a logarithmic unit of measurement, where 0dBFS equals the Full-Scale (largest possible) value of a digital signal. Digital signals cannot exceed 0dBFS. If an Analog-to-Digital Converter (ADC) is over driven, clipping, distortion and greatly reduced audio quality results.</li>
<li><code>Toggle Echo Mode</code> will record each of your transmissions and echo ("parrot") back to you. After setting your levels with the above menu options first, echo tests are the final step to confirm your audio is clear and intelligible. If anything does not sound right or you have any questions be sure to visit the AllStarLink Community for additional help. When done with Echo Mode testing don't forget to disable it. DTMF commands can be enabled to make it easy to do echo testing any time. To enable <code>parrot mode</code> DTMF commands uncomment the 3 lines in <code>/etc/asterisk/rpt.conf</code> that start with <code>921 =</code>, <code>922 =</code>, and <code>923 =</code>. Then, restart Asterisk or reboot the node. Entering <code>*921</code> on a DTMF keypad will then enable parrot mode and <code>*922</code> will disable it.</li>
<li><code>Print Current Parameter Values</code> shows the current audio level settings.</li>
<li><code>Write (Save) Current Parameter Values</code> saves any changed settings to disk. Be sure to execute this option before exiting the menu if you have changed any settings and want those to be the new defaults.</li>
</ul>
<p>The tune utilities can also be run from the command line without needing to use <a href="#user-guide"><code>asl-menu</code></a>. For SimpleUSB run <code>sudo /usr/sbin/simpleusb-tune-menu</code> or for USBRadio run <code>sudo /usr/sbin/radio-tune-menu</code>.</p>
<h3 id="adv-topics-usbinterfaces-eeprom-operation">EEPROM Operation</h3>
<p>The SimpleUSB and USBRadio channel drivers allow users to store configuration information in an EEPROM IC attached to the C-Media CM1xx USB Interface IC. The CM119A can have manufacturer information in the same area that stores the user configuration. The CM119B does not have manufacturer data in the area that stores user configuration. The manufacturer data cannot be overwritten. The user configuration data has been moved higher in memory to prevent overwriting the manufacturer data. If you use the EEPROM to store configuration data, you'll need to save it to the EEPROM after upgrading. Use <code>susb tune save</code> or <code>radio tune save</code> in the Asterisk CLI.</p></section><h1 class='nav-section-title-end'>Ended: Advanced Topics</h1>
                        <h1 class='nav-section-title' id='section-voter-rtcm'>
                            VOTER/RTCM <a class='headerlink' href='#section-voter-rtcm' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="voter"><h1 id="voter-voterrtcm">VOTER/RTCM</h1>
<p>Welcome to the VOTER/RTCM section of the ASL3 manual.</p>
<p>AllStarLink supports both multi-site voting receivers, as well as simulcast transmitters, with the appropriate hardware and software configurations.</p>
<p>This section of the manual details how the voting system works, hardware requirements, and software configuration.</p></section><section class="print-page" id="voter-about-voter"><h1 id="voter-about-voter-what-is-the-voter">What is the VOTER?</h1>
<p>The VOTER (<strong>V</strong>oice <strong>O</strong>bserving <strong>T</strong>ime <strong>E</strong>xtension for <strong>R</strong>adio) system was originally created by Jim Dixon, WB6NIL (SK).</p>
<p>In many two-way radio applications, both for repeater systems and simplex base-stations, it is often difficult to have reliable reception when there is signal impairment due to terrain or other obstacles.</p>
<p>One common way to solve this problem is by use of a voting multi-receiver system. Such a system is comprised of a number of receivers, located at diverse locations. The location of these receivers are chosen so that the combined coverage of all the receivers more or less fill-in the entire desired coverage area, even though it may take a number of receivers to accomplish this. All such receivers are connected ("linked") to a central location (generally the transmitter site), and a device compares each receiver's signal strength and selects the one with the best signal. This is called <strong>voting</strong>.</p>
<p>Often in such a system, there is one single high-powered transmitter located at a central site that all mobile/portable stations would be able to receive. Sometimes, one single transmitter can not be located where coverage of the entire desired area is possible. In such cases, multiple transmitters are deployed in several locations. Since all these transmitters are on the same frequency, they must be <em>very precisely</em> locked to the same frequency <strong>and</strong> be transmitting the <em>exact same audio</em> at the <strong>exact same time</strong>. Not doing so would severely degrade their reception. This is called <strong>simulcast</strong> (transmitters).</p>
<p>Traditionally, receivers that comprise a voting system are each connected to the central site via either a UHF or microwave link. Since this requires a receiver, link transmitter and link receiver for every receive site, implementation and continued cost of such a system typically becomes quite significant and in most cases prohibitive, and requires a high complexity of implementation.</p>
<p>There are, however, many advantages of implementation of such a system that warrant the cost and effort required.</p>
<p>With the advent of VoIP-based interconnections for radio systems, it is now possible to implement a voting system using VoIP to link the receivers to the central site, and therefore reduce the system requirements and complexity and cost by eliminating the radio links between the receivers and the central site.</p>
<p>There are a few commercial vendors of VoIP-based voting systems that offer a functional and reliable, yet proprietary and extremely high-cost solution.</p>
<p>Although using VoIP-based technology significantly reduces the cost and complexity of implementation of a voting system, the cost of the commercial VoIP-based devices is still quite prohibitive for all but large commercial and/or government applications. Therefore, it seemed appropriate to offer a completely open-source, open-hardware solution that makes the cost and complexity of a VoIP-based voting system nearly trivial and gives almost anyone the ability to implement this type of a system that wishes to do so.</p>
<h2 id="voter-about-voter-history">History</h2>
<p>By: Jim Dixon, WB6NIL (SK)</p>
<p>The <a href="https://github.com/AllStarLink/Voter/blob/master/docs/votersystem.pdf">Original Documentation Package</a> (NO LONGER CURRENT) for the original VOTER system is still available. For current documentation, see the rest of the sections in this part of the manual, or the documentation of the commercially-available <a href="../voter/assets/rtcm_manual.pdf">RTCM</a> product.</p>
<p>For a number of years, I have been asked about, and have been considering the possibility of the implementation of a multiple site remote receiver voting system that runs with VOIP on <code>Asterisk/app_rpt</code>. The more I looked into it, the more I realized that it was a <strong>FAR</strong> from a trivial task.</p>
<p>The main problem to overcome is that when you have multiple streams of audio information from multiple receivers, you need a concise and accurate way of synchronizing all of the audio, so that if switching of streams occurs, there will be no inconsistencies in the audio. This is far more easily done on conventional, RF-linked voting systems, being that the delay between the receiver and the transmitter site is very minimal (basically the speed of light) and is painfully consistent. Not so on the Internet. The packet delays can be extremely long and varied, and it makes the task of synchronization far more difficult.</p>
<p>The first challenge is to obtain and convey ultra-accurate time information along with the audio data, so that the transmitter site will know what time the signal was received (which may not have much to do with the time it was received at the transmitter site from the Internet). In order to accomplish this, ultra-accurate time information must be made available, and it must be processed in reasonable and consistent time for it to be meaningful.</p>
<p>GPS is the simplest and most cost-effective solution to obtain ultra-accurate time information. For little money, a Garmin GPS LVC18 module (there are many others, too) may be purchased. It provides an accurate 1 pulse-per-second signal that can be used to synchronize a timing device.</p>
<p>A "host" type computer running Linux (or UNIX, etc.) <strong>is not</strong> appropriate to be used as such a device, since it has absolutely <strong>no way</strong> of processing external inputs (or anything else, for that matter) in a <em>consistent</em> and <em>predictable</em> time. For applications that need to be accurate to hundreds of milliseconds, its fine, but for this purpose, where timing down to <strong><em>individual 125 microsecond</em></strong> audio samples is necessary, it just wont do.</p>
<p>The only reasonable solution is to design hardware to accomplish this. Since hardware design is necessary, I figured that I might as well design a stand-alone board that does all the necessary functions to interface a receiver and a GPS device to an Ethernet with Internet connectivity. Certainly, a peripheral device that attaches to a "host" type computer would also be a reasonable solution, but for the same or less cost, it seems reasonable to eliminate the need for a "host" computer at receiver sites all together.</p>
<p>The second challenge is determining signal strength (RSSI) information from an attached receiver. Thanks to wonderful technology designed by Steve Rodgers, WA6ZFT, which is a small board that implements a VERY high-quality squelch processor, I was able to take the code and front-end design, include it in my design, and not only is it very good squelch processor, but it also is able to provide information from which the signal strength of the received signal may be calculated.</p>
<p>The third challenge is at the transmitter site end (where the <code>app_rpt</code> system is located) taking all of the streams of audio from the various receivers and synchronizing them via included time information, and making a reasonable decision on which stream to "use", based upon signal strength and quality. The synchronization is done with basically a "multi-dimensional jitter buffer" and is implemented in the Asterisk channel driver that I wrote for this application, <code>chan_voter</code>.</p>
<p>The fourth challenge is to facilitate a method of testing the protocol and its implementation within <code>app_rpt</code>. Obviously, there is no way to have a "real" environment available, where there are multiple receivers, mobiles, etc., so a simulator has to be created.</p>
<p>I'm <strong>VERY</strong> sorry and embarrassed to say so, but I wrote it in Java (yuck!). It seemed the most reasonable way to accomplish what was necessary. It simulates up to 10 channels of audio, and has "sliders" so that you have full control of "RSSI" and "TIME DELAY" for each channel, in addition to selecting which, if any channels are being sent to the host. You can run it, if you desire. This is the <a href="https://github.com/AllStarLink/Voter/tree/master/archive/votersim">VoterSim</a> tool.</p>
<p>I also made a new UDP-based protocol for this technology, (called "VOTER"), which may be <a href="#voter-voter-protocol">viewed here</a>, if desired.</p>
<h2 id="voter-about-voter-description">Description</h2>
<p>In order to successfully implement a VoIP-based solution for this purpose, it is necessary to have a precise time reference in order to be able to re-assemble (time-wise) the audio streams at the central site, since VoIP has inherent inconsistencies in time delay (jitter and such). Clearly, the best and most reasonable and economic source of such precise timing data is GPS. Therefore, a GPS receiver (with a 1 pulse per second output) <strong>must</strong> be made available at each receiver location (along with the central site).</p>
<p>Since precise timing is necessary, it precludes the use of any implementation which relies on a traditionally host-based operating system, such as Linux or UNIX, because of limitations of timing and scheduling precision and latency.</p>
<p>Therefore, a dedicated hardware device with a simple embedded micro-controller was necessary to accomplish the necessary precise timing requirements. In addition, low cost (in comparison with a host-based solution) makes placing such a simple dedicated hardware device at each receiver location a great advantage.</p>
<p>Such a dedicated hardware solution significantly increases reliability, has a far lower power consumption, and is physically smaller (in comparison with a host-based solution).</p>
<p>The "central site" functionality (the device which receives all of the VoIP-based audio streams from the receivers and selects which receiver's audio to use) is implemented as a channel driver (<code>chan_voter</code>) along with <code>app_rpt</code> under Asterisk PBX. The host-based system on which this runs, along with a dedicated hardware device (which gives access to the precise GPS-derived time data) is typically located with the system's transmitter (or at least one of them).</p>
<p>Each dedicated hardware device is also capable of simultaneously generating time-synchronized audio out to drive a transmitter (or multiple transmitters in a simulcast system). The audio out of all the dedicated hardware devices at all locations will be identical at the same time.</p>
<p>There are facilities available for online monitoring of the voting system (audio and signal strengths), in addition to recording (logging) facilities.</p>
<h2 id="voter-about-voter-why-a-96mhz-clock">Why a 9.6MHz Clock?</h2>
<p>A question that often gets asked (in relation to doing simulcast) is, "why not just clock the dsPIC at 10MHz, instead of 9.6MHz". Well, there is a very good reason that Jim picked that oscillator frequency, and a very good reason why you cannot use 10MHz.</p>
<p>It comes down to timers and interrupts. In particular, the ADC servicing subroutine. </p>
<p>With the way the dsPIC is configured with the 9.6Mhz oscillator, this subroutine is automatically called every 62.5uSec, as it is controlled by Timer 3 (TMR3).</p>
<p>This subroutine is responsible for encoding the RX Audio Packets, and doing all the AtoD on the other analog inputs, RX Noise (for RSSI), Squelch Pot position, and Diode Voltage (temperature compensation).</p>
<p>Every <strong>ODD</strong> time this subroutine is run, it encodes a RX Audio packet. Since this happens every <strong>OTHER</strong> time the ISR runs, that means it runs every <strong>125uSec</strong>. Well, the reciprocal of 125uSec is 8kHz, so this is how we encode 8000 samples/sec of RX Audio! By default, encoding is ulaw, unless you <strong>SPECIFICALLY</strong> configure this client for ADPCM in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>Every <strong>EVEN</strong> time this ISR runs, it alternates measuring RX Noise, Squelch Pot Position, and Diode Voltage. So, each of those is measured every <em>sixth</em> time in, or every 375uSec. </p>
<p><strong>EVERY</strong> time this ISR runs, we bump some counters.</p>
<p>Every time TMR3 expires, we service this routine and do an ADC conversion. We alternate between reading the RX Audio, and one of the other three channels (Squelch Noise, Squelch Pot position, and Diode (temp comp) voltage).</p>
<p>So, as you can see, in order to encode ulaw/ADPCM audio at 8kHz, we need precise timing to take the ADC samples of the audio and encode them. Because of this precise timing, and the restrictions in the clock dividers in the dsPIC, it works out that 9.6MHz is the most suitable (common) crystal/clock to use.</p>
<p>That said, some investigation has been done to see if there are any other suitable clocks. As it turns out, there may indeed be. Old CDMA wireless systems had GPSDO's that had a 9.8304MHz (CDMA 8x Chip) output that was locked to GPS (and there are lots of those still surplus). It would appear that there is a valid clock configuration for the dsPIC that <em>could</em> allow this clock signal to be used, and still maintain the 62.5uSec timer for the ISR. </p>
<p>However, there is another problem presented with this approach, the bootloader. The bootloader is expecting a 9.6MHz clock to run, so it isn't going to like it if you feed it 9.8304MHz. We don't have the source code for the bootloader, so that is a more difficult change to implement. However, peeking in to the <code>.cof</code> file with a hex editor, one can find what seems to be the opcodes to set up the clock on the dsPIC when it boots. It <em>may</em> be possible to hack the bootloader to run at 9.8304Mhz. Further testing is required.</p>
<p>Of course, this is only really of consequence if you are wanting to do simulcast, where everything needs to be precisely timed. For normal voting use, the standard 9.6MHz clock works just fine. If you are planning on doing simulcast transmitters, the crystal stability of the 9.6MHz oscillator is insufficient, you <strong>will</strong> need to provide an OCXO or GPS-derived 9.6MHz clock source to replace the crystal.</p>
<h2 id="voter-about-voter-implementation">Implementation</h2>
<p>A UDP-based VoIP protocol was created specifically for this technology. See the <a href="#voter-voter-protocol">VOTER Protocol</a> page for further details on the underlying communication protocol between client devices and the host.</p>
<p>More information on how the <code>chan_voter</code> channel driver works is available on the <a href="#voter-voter-chan_voter"><code>chan_voter</code></a> page.</p>
<p>There are currently two hardware implementations that use the VOTER protocol, and interface to AllStarLink.</p>
<h3 id="voter-about-voter-voter">VOTER</h3>
<p>The dedicated hardware device (the VOTER) was initially implemented as an approximately 160 by 100mm circuit board utilizing thru-hole mounted components allowing user-assemble-able blank boards to be made available quite inexpensively. </p>
<p>It uses a dsPIC33FJ128GP802 processor and a few other integrated circuits, including some operational amplifiers (which implement filters, amps, etc). </p>
<p>The schematics, board design, artwork, and PIC firmware are available on a completely free open-source basis, the original project information is available in the <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER-pcb">AllStarLink GitHub Repository</a>.</p>
<div class="grid">
<p><a class="glightbox" href="../voter/img/1599px-Voter-assy-trim.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER PCB" src="../voter/img/1599px-Voter-assy-trim.png" /></a></p>
<p><a class="glightbox" href="../voter/img/Voterr-reva.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER ASSY" src="../voter/img/Voterr-reva.jpg" /></a></p>
</div>
<p>In addition, the schematics of the original VOTER have been redrawn in KiCAD, and are <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER-pcb/KiCAD-schematic">available here</a>. </p>
<p>Firmware in the <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER_RTCM-firmware">AllStarLink GitHub Repository</a> is produced to support both the VOTER and RTCM devices.</p>
<p>Documentation to support the VOTER is available on the <a href="#voter-voter-hardware">VOTER Hardware</a> page.</p>
<p>For specific information about the console menus and options available in the firmware, see the <a href="#voter-voter-menus">VOTER Menus</a> page.</p>
<h3 id="voter-about-voter-rtcm">RTCM</h3>
<p>The VOTER was then implemented commercially by <a href="http://micro-node.com">Micro-Node International</a> and marketed as their <a href="http://www.micro-node.com/thin-m1.shtml">Radio Thin Client Module (RTCM)</a>. The RTCM is effectively a VOTER, but built with SMT components. It runs the same (similar) firmware as the VOTER, with differences being in the dsPIC that it uses, as well as some of the peripheral mapping. </p>
<div class="grid">
<p><a class="glightbox" href="../voter/img/Rtcm2-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM 2" src="../voter/img/Rtcm2-750.jpg" /></a></p>
<p><a class="glightbox" href="../voter/img/Rtcm1-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM Front" src="../voter/img/Rtcm1-750.jpg" /></a></p>
<p><a class="glightbox" href="../voter/img/Rtcm3-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM 3" src="../voter/img/Rtcm3-750.jpg" /></a></p>
</div>
<p>Firmware in the <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER_RTCM-firmware">AllStarLink GitHub Repository</a> is produced to support both the VOTER and RTCM devices.</p>
<p>As it runs the same (similar) firmware as the VOTER, for specific information about the console menus and options available, see the <a href="#voter-voter-menus">VOTER Menus</a> page.</p>
<p>Unless specifically noted, references to the VOTER hardware apply equally to the RTCM, and both terms may be used interchangeably. </p>
<p>There is a <a href="../voter/assets/rtcm_manual.pdf">User Manual</a> available for the RTCM, but it has not been updated in a long time. You may wish to supplement with information from our online <a href="#voter-voter-hardware">VOTER Hardware</a> (for the through-hole board) or the <a href="#voter-rtcm-hardware">RTCM Hardware</a> pages.</p>
<h3 id="voter-about-voter-firmware-upgrading">Firmware Upgrading</h3>
<p>See the <a href="#voter-voter-firmware">VOTER firmware</a> page on the procedure to upgrade the firmware.</p>
<h2 id="voter-about-voter-provisioning-and-configuration">Provisioning and Configuration</h2>
<h3 id="voter-about-voter-general-system-provisioning">General System Provisioning</h3>
<p>There needs to be:</p>
<ul>
<li>Some number (&gt; 1) of receiver sites that contain 1 of identical model receivers (or at least ones with identical characteristics), one VOTER (embedded hardware) card, one GPS receiver and some sort of Internet connection (can be a private LAN).</li>
<li>Some number of transmitter sites (typically one, but not necessarily) that contain a transmitter, one VOTER/RTCM (embedded hardware) card, one GPS receiver, and some sort of Internet connection (can be a private LAN). A site <em>may</em> have both a receiver and transmitter sharing the same VOTER card, GPS receiver, and Internet connection.</li>
<li>A Linux host running Asterisk (AllStarLink) with <code>app_rpt</code> and <code>chan_voter</code>, along with a VOTER/RTCM (embedded hardware) card, a GPS receiver, and an Internet connection (may be a private LAN in some cases) with sufficient bandwidth to accommodate all the packet traffic from/to all the receiver and/or transmitter sites. This location may also have a receiver and/or transmitter connected to the VOTER/RTCM card.</li>
<li><em>Optionally</em>, system monitoring access (both audio and signal strength at all receive sites) may be made available through the use of a JAVA applet (deprecated) and a process running on a server at a location with high availability and high bandwidth internet connection. Typically, this is not at the same location as the above system, but may be, if appropriate. </li>
</ul>
<div class="admonition note">
<p class="admonition-title">System Monitoring</p>
<p>The original system monitoring was accomplished with <code>votemond</code> and <code>votermon</code>. Both those utilities have been deprecated. In their place, Allmon/Supermon can display the status of voting sites.</p>
</div>
<p>The system layout is envisioned as:</p>
<p><a class="glightbox" href="../voter/img/VOTER_System_Layout.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER System Layout" src="../voter/img/VOTER_System_Layout.png" /></a></p>
<h3 id="voter-about-voter-ip-internet-network-planning-and-provisioning">IP (Internet) Network Planning and Provisioning</h3>
<p>The receiver/transmitter sites may be connected to the "master" site (the one containing the Linux system running <code>chan_voter</code>, <code>app_rpt</code>, and Asterisk (AllStarLink)) via either a LAN (either physical or extended Local Area Network), a public Internet connection, or some combination thereof.</p>
<p>See the <a href="#voter-voter-protocol">VOTER Protocol</a> page for further details on the underlying communication protocol between client devices and the host.</p>
<p>Regardless of the interconnection method, the following criteria must be met: </p>
<ul>
<li>Sufficient bandwidth must be available at all times between each receiver/transmitter site and the "master" site. The latency of such connections must be within <em>reasonable</em> limits, and <strong><em>certainly</em></strong> must be within the limits configured in both the VOTER board devices and <a href="#config-voter_conf"><code>voter.conf</code></a>.</li>
<li>The "master site" really <em>should</em> be on a static IP address. Although not 100% necessary, it could really make for an unreliable installation.</li>
<li>Any of the devices (including the "master" site) may be behind NAT and/or a firewall. There is no specific requirement for the VOTER board to have any sort of non-NATed access, since the actual IP address and UDP port that is public really makes no difference. All authentication is based upon CHAP-type tokens, and not upon IP address in any way. The "master" site may be behind NAT and/or a firewall, as long as its listening UDP port (generally 1667) is exposed to the public (unless entire system is on an entirely private network). If the implementer wishes, TELNET access may be configured for the VOTER board, and in that case, the port selected for TELNET must be made publicly accessible (since the VOTER firmware supports dynamic DNS, it certainly may be on a dynamically-assigned public IP address when the TELNET option is used, and its actual IP address really doesn't matter if TELNET is not configured).</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Do This at Your Own Risk</p>
<p>It is a <strong>VERY BAD</strong> idea to expose TELNET to the public Internet, you accept all responsibility if you choose not to heed this warning!</p>
</div>
<h3 id="voter-about-voter-bandwidth-considerations">Bandwidth Considerations</h3>
<p>Typically, the IP bandwidth usage in each direction, when a signal is present is approximately 100kbps (including UDP/IP overhead, one direction only if just a receive or just a transmitter site, or both directions if a receive/transmit site).</p>
<p>On a public Internet connection, its a good rule-of-thumb to use a connection capable of three to four times the required bandwidth in the slowest direction (often, such connections are asymmetrical as far as their speeds are concerned).</p>
<p>If possible, avoid wireless connections (ie "cellular", "MiFi", etc.). DSL/Fiber/Cable is your friend. It tends to be more reliable and consistent (less latency and jitter) then other forms of broadband connections.</p>
<p>If a wireless connection is <em>really</em> required (ie mountain-top microwave link), use a high reliability solution, such as the devices from Ubiquiti or Microtik. The VOTER hardware DOES support ToS marking of packets, but your link <em>shouldn't</em> be congested to the point where that would be required anyways!</p>
<h3 id="voter-about-voter-port-forwarding">Port Forwarding</h3>
<p>Since token-based authentication and identification is utilized, having the UDP port open to the public should not be a significant security risk. There <strong>must</strong> be a VOTER board on the <strong>same physical LAN (ie switch)</strong> (very low latency) as the Asterisk server implementing the “master site”, which acts as the Master Timing Source. This allows <code>chan_voter</code> to have a consistent, reliable, accurate timing source with which the timing information from all other inbound packets are compared and appropriately processed, and from which to generate accurate timing information for time-consistent transmission purposes.</p>
<p>The AllStarLink server at the “master site” (in addition to all the ports that are canonically made public to operate a standard <code>app_rpt</code> installation) <strong>must</strong> have the port specified in the <code>port</code> parameter in the <code>[general]</code> stanza in the <a href="#config-voter_conf"><code>voter.conf</code></a> file made publicly available, or at least available to all possible IP addresses from which its associated VOTER clients could possibly be operating.</p>
<h3 id="voter-about-voter-network-qos">Network QoS</h3>
<p>Your IP Network quality is important. You may wish to add a rule in your routers to prioritize traffic on UDP port 1667 so that VOTER audio is given priority over other 
traffic. Also see the below for notes on how to tag your packets with ToS.</p>
<p>By default in firmware &gt;2.00, packets <strong>from</strong> the VOTER/RTCM <strong>to</strong> the host are tagged. You can use <a href="#voter-voter-hardware-debug-options">Debug Options</a> to disable that for testing. You still need to have the appropriate <code>utos=y</code> line in the <code>[general]</code> stanza of your <a href="#config-voter_conf"><code>voter.conf</code></a> to tag packets <strong>from</strong> the host <strong>to</strong> the VOTER/RTCM clients.</p>
<p>Specifically to Ubiquity devices, see <a href="https://help.uisp.com/hc/en-us/articles/22590834519959-airMAX-Frequently-Asked-Questions-FAQs">airMAX FAQs</a>.</p>
<p>So, if we set ToS/DSCP in the header to <code>C0</code>, then Ubiquity (and other gear watching ToS) <em>should</em> prioritize the packets. This sets the DSCP to <code>110 000</code> aka <code>48</code>. UBNT shows this as 802.1p Class 6 (Voice &lt;10mS latency). Other sources show this as a Network Control TOS.</p>
<h2 id="voter-about-voter-receiver-andor-transmitter-site">Receiver (and/or Transmitter) Site</h2>
<p>A receiver and/or transmitter site consists of a receiver capable of providing direct access to the output of the FM discriminator (and output of CTCSS/CDCSS tone decoder, if applicable) and/or a transmitter, a VOTER (embedded hardware) board, a GPS receiver capable of providing a precise 1 pulse per second signal (such as the Garmin LVC18) and NMEA or TSIP information packets, and an Ethernet-based Internet connection.</p>
<p>Since there may very well be several versions of the VOTER board hardware available, this document will not cover specific details of the shown hardware device here. The full details for each hardware device, including construction (if applicable), programming, and specific configuration options are available from the vendor of the particular device. Only generic configuration concepts and options will be covered here.</p>
<h3 id="voter-about-voter-voter-hardware-configuration-settings">VOTER Hardware Configuration Settings</h3>
<p>There are several categories of configuration parameters that apply to all version of the VOTER hardware.</p>
<ul>
<li>IP SETTINGS – Standard IP setup parameters (IP Address, Netmask, Gateway, DHCP, etc.).</li>
<li>VOTER SERVER – VOTER server address, specified as a Fully-Qualified Domain Name (FQDN), UDP port on VOTER server, and (optionally) local UDP port (generally left at default), and client and server passwords. </li>
</ul>
<div class="admonition note">
<p class="admonition-title">VOTER DNS Resolution</p>
<p>The firmware in the VOTER board does a DNS resolution once per minute and resolves the IP address for the VOTER server, based upon the FQDN specified in this configuration. Therefore, the actual IP address of the VOTER server may be changed (and its associated DNS entry), and the VOTER board firmware will continue to be aware of its current IP address (thus not requiring re-configuration of the VOTER board firmware if the IP address of the VOTER server changes).</p>
</div>
<ul>
<li>The “client password” is the password, as configured in the server, that identifies the VOTER hardware (client), and the “server password” is the common server password as configured in the server (which allows verification of the server's identity by the VOTER hardware firmware).</li>
<li>TX BUFFER PARAMETER – Transmit buffer length. This allows for simultaneous time-consistent audio output at all VOTER clients in a system. Buffer length is set to allow for maximum network latency between “master (host) site” and receive/transmit sites.</li>
<li>GPS RECEIVER PARAMETERS – Data Protocol (NMEA or TSIP), Baud Rate, Data Polarity and PPS Signal Polarity (and time offset, don't ask, just leave it at 0, hopefully) for GPS receiver.</li>
<li>TELNET PARAMETERS – Port Number, User name, and Password for console TELNET access.</li>
<li>DYNDNS PARAMETERS – Setup parameters necessary to make dynamic DNS work (if desired).</li>
<li>EXTERNAL TONE DECODE – Sets mode for external tone decode (CTCSS) input (enable/polarity).</li>
</ul>
<p>The serial console of the VOTER gives access to a menu allowing setting of the above mentioned parameters in addition to various system-related functions, reboot, save parameters, status, etc. In addition, the console displays important system status messages as various events occur (such as changes in GPS status, changes in DNS resolution, etc.). More information on all the menus and options is available on the <a href="#voter-voter-menus">VOTER Menus</a> page.</p>
<h3 id="voter-about-voter-voter-hardware-setup-and-installation">VOTER Hardware Setup and Installation</h3>
<p>For more information on the VOTER Hardware connections, see the <a href="#voter-voter-hardware">VOTER Hardware</a> page. For the RTCM, see the <a href="../voter/assets/rtcm_manual.pdf">user manual</a> and/or the <a href="#voter-rtcm-hardware">RTCM Hardware</a> pages.</p>
<p>Appropriate connections need to be made between the receiver's discriminator, and optionally its tone decode output, and/or the transmitter and its external (auxilliary) audio input (or microphone input, attenuated), and PTT signals. </p>
<div class="admonition warning">
<p class="admonition-title">Transmit Audio Connections</p>
<p>In most applications, transmit audio must be routed through the external (auxilliary) audio input so that it gets pre-emphasized, limited, and splatter filtered. <strong>DO NOT</strong> directly connect to a modulator input, data input, or other direct transmitter connection (UNLESS you are generating CTCSS with the VOTER, see below). </p>
</div>
<p><strong>Discriminator audio is required</strong> to do noise (RSSI) and squelch analysis on the incoming audio, prior to the actual voice audio (baseband) being de-emphasized and sent to the host (unless it is specifically overridden, then it is a custom application). As such, the audio sent from the host to the transmitter(s) needs to be pre-emphasized before being sent over the air. </p>
<p>The GPS receiver needs to be connected (see notes on the <a href="#voter-voter-gps">VOTER GPS</a> page), and the VOTER hardware needs to be connected via Ethernet to an Internet connection, and, of course, power needs to be applied to the board.</p>
<p>With no antenna connected to the receiver, the board needs to have its “squelch calibration” procedure performed (see the documentation for the specific hardware).</p>
<p>The receive level needs to be set, either by putting the board in “level setting” mode, or with use of the console (see the documentation for the specific hardware). </p>
<p>The transmit level also needs to be set at transmitter site(s). See the <a href="#voter-voter-audio">VOTER Audio</a> page for further instructions on configuring audio and setting levels.</p>
<p>Once the above procedures are performed, the board is ready to have its operating parameters configured and then it will be ready for use. Configuration is done via serial console or TELNET. Serial console may be required for initial configuration, if you cannot determine the IP address given to the VOTER hardware via DHCP when first connected to your network.</p>
<p>Set the IP Settings, TX Buffer Parameters, GPS Parameters (if necessary), TELNET Parameters, DYNDNS Parameters, and External Tone Decode appropriately for the installation.</p>
<p>The VOTER/RTCM hardware device needs to be on an Ethernet network (typically a router or switch or wireless bridging device of some sort) that has connectivity to the “master/host” site, either via public Internet or via private LAN (extended, perhaps). </p>
<p>It may be on a network that allocates IP addresses (LAN and/or public IP address) dynamically. The <a href="#voter-voter-protocol">VOTER Protocol</a> and the VOTER hardware firmware are designed specifically to allow for not needing the IP address of any VOTER board to be long-term consistent, or even important, for that matter. All authentication and identification is based upon tokens, not IP address or port.</p>
<p>If TELNET access is desired, the VOTER hardware needs to at least have its TELNET port accessible (through a NAT/Firewall if used), otherwise it is not necessary. Even if TELNET access is used, a dynamically-assigned public IP address will work, because dynamic DNS (dyndns.org) is supported in the VOTER hardware firmware.</p>
<div class="admonition danger">
<p class="admonition-title">Do This at Your Own Risk</p>
<p>It is a <strong>VERY BAD</strong> idea to expose TELNET to the public Internet, you accept all responsibility if you choose not to heed this warning!</p>
</div>
<p>This document assumes sufficient familiarity with IP and general networking concepts, and therefore will not go into specific details of network provisioning.</p>
<p>The VOTER Server Settings on the VOTER hardware will be covered in the next section.</p>
<h3 id="voter-about-voter-overall-system-main-site-configuration">Overall System / Main Site Configuration</h3>
<p><code>app_rpt</code> (Asterisk) uses a channel driver <code>chan_voter</code>, which implements the “master site” or "host" functionality, providing an Asterisk channel which <code>app_rpt</code> may open as a radio interface (like a <code>usbradio</code> or <code>pseudo</code> channel in a non-voting AllStarLink system). This driver receives (and/or sends) UDP packets (typically on UDP port 1667) from/to all associated VOTER clients at receive and/or transmit sites.</p>
<p>For each VOTER channel instance, both voting (GPS-based) and non-voting “general-purpose” (non-GPS-based) clients may be used. The channel driver essentially “mixes” the resultant audio from the voting subsystem along with the audio from all of the “general-purpose” clients (if any).</p>
<p>In addition, the channel driver (optionally) may be configured to send a stream of UDP packets to a predetermined IP address and UDP port. This stream is meant to be redistributed by the <code>votmond</code> program (deprecated) running on a high-availability, high-bandwidth Linux Server, and give users access to monitoring of the VOTER audio and signal strength information in real time.</p>
<p><code>chan_voter</code> uses a configuration file, <a href="#config-voter_conf"><code>voter.conf</code></a>, which contains typically several stanzas. See the <a href="#config-voter_conf"><code>voter.conf</code></a> page for more information on the contents of this file, and the available options.</p>
<h3 id="voter-about-voter-voting-selection-algorithm-and-associated-parameters">Voting Selection Algorithm and Associated Parameters</h3>
<p>Voting selection (the choice of client from which to take the audio stream) is based upon the RSSI (relative signal strength/quality) value associated with each particular client's received signal.</p>
<p>The parameters associated with voting selection are the <code>thresholds</code> and <code>linger</code> parameters specified for each VOTER instance.</p>
<p>If neither of these parameters are specified, the voting selection algorithm will default to choosing the client with the highest RSSI number (<em>and the last-most one listed in the <code>voter.conf</code> file</em>, if a tie exists) each and every received audio frame (every 20 milliseconds). </p>
<p>Although this is a functional option, this is probably <strong>NOT</strong> what you really want. Doing so will cause the received signal to have an audible “squelch-tail” at the end of a transmission if there is a receiver receiving the signal strongly in addition to a receiver receiving the signal at a low, noisy level. </p>
<p>This, however, might be appropriate in very rare instances where receivers are placed in locations that require very agile following of the strongest signal. It is very unlikely, however, that this is the case.</p>
<p>It is far more likely that it is appropriate to set up a set of <code>thresholds</code> and optionally a <code>linger</code> time that is different then the default (which is 6 frame periods of 20 milliseconds).</p>
<p>The <code>linger</code> parameter allows specification of a default <code>linger</code> value (<strong>in multiples of 20 millisecond frames</strong>) of other then the system default value (6).</p>
<p>The <code>thresholds</code> parameter is a comma-separated list of RSSI threshold values each specified as follows:</p>
<div class="highlight"><pre><span></span><code>MIN_RSSI[=REASSESS_FRAMES[:LINGER_FRAMES]]
</code></pre></div>
<ul>
<li><code>MIN_RSSI</code> is the minimum RSSI value for this threshold (1-255)</li>
<li><code>REASSESS_FRAMES</code> is the number of 20ms frames for the client to remain selected at this threshold level before being re-assessed (may be specified as 0, meaning “re-assess at next frame”)</li>
<li><code>LINGER_FRAMES</code> is the number of 20ms frames for the client to remain selected after no longer being at this threshold (or any other) (may be specified as 0, meaning “do not linger”)</li>
</ul>
<p>If <code>MIN_RSSI</code> is specified without the other values, its <code>REASSESS_FRAMES</code> is considered to be infinite (it will not get re-assessed if its RSSI value remains at this threshold), and <code>LINGER_FRAMES</code> will be its default value (6).</p>
<p>If <code>MIN_RSSI</code> and <code>REASSESS_FRAMES</code> are specified, <code>LINGER_FRAMES</code> will be at its default value(6).</p>
<p>A specification for <code>REASSESS_FRAMES</code> <strong>must</strong> be present if there is a specification for <code>LINGER_FRAMES</code>.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>thresholds = 255,110=5
</code></pre></div>
<p>Meaning:</p>
<p>If the RSSI level is 255, stay selected on that client as long as it still has an RSSI of 255, else if the RSSI level is at least 110, stay selected there for no more then 5 frames. If the RSSI drops below 110, re-assess every frame (since no value below 110 was specified).</p>
<p>Also, since there were threshold values specified and the <code>linger</code> value remained default, any client that meets any specified threshold, stays selected for 6 frames when no clients meet any thresholds any longer.</p>
<p>If, instead the example was:</p>
<div class="highlight"><pre><span></span><code>thresholds = 255,110=5:10
</code></pre></div>
<p>Then:</p>
<p>The same would be true except that if a client meets the “110” threshold (and not the “255” threshold), and then no more clients meet any more thresholds, the client that met the “110” threshold would stay selected for 10 frames rather then the default 6.</p>
<p>This whole methodology is rather strange, but it seems to be appropriate and effective. In the future, it may be improved or modified in some way, but for now it is more than sufficient.</p>
<h3 id="voter-about-voter-buffer-tuning">Buffer Tuning</h3>
<p>See the <a href="#voter-voter-buffers">VOTER Buffers</a> page for information on how the buffers work, and how to tune them for proper operation.</p>
<h3 id="voter-about-voter-simulcasting">Simulcasting</h3>
<p>The RTCM/VOTER boards do support simulcasting, however, there are a bunch of quirks that one needs to be aware of.</p>
<p>See the <a href="#voter-voter-simulcasting">VOTER Simulcasting</a> page for further information.</p>
<h3 id="voter-about-voter-general-purposemixed-mode-configurations">General-Purpose/Mixed Mode Configurations</h3>
<p>The primary use of the VOTER/RTCM is to implement multi-site receiver voting repeater systems. That leads itself then to also adding simulcast transmitters (if you already have the sites for receivers).</p>
<p>However, this is not the only use case.</p>
<p>The VOTER/RTCM also works very well as a repeater interface to a stand-alone repeater. In fact, in a few key areas, it is a superior choice for interfacing a repeater to AllStarLink:</p>
<ul>
<li>Hardened hardware (no SD card to corrupt with power failures)</li>
<li>No operating system crashes</li>
<li>No USB configuration issues</li>
<li>No USB audio level configurations to get corrupted</li>
<li>Supports CTCSS transmit tone generation</li>
<li>Easily transits NAT networks with minimal network configuration</li>
</ul>
<p>Remember, the VOTER/RTCM is basically a custom Radio over IP (RoIP) adapter. It was just designed from the ground up by a very smart amateur radio operator.</p>
<p>When used in "General-purpose"/"Mixed Mode" (for a stand-alone repeater), you do <strong>not</strong> require a GPS for timing. Although, there is nothing stopping you from using one. Setting the PPS Polarity setting to <code>2</code> (ignore) will force the VOTER/RTCM in to "General-purpose" mode. </p>
<p>As the name "Mixed Mode" implies, you could have a "General-purpose" client that is mixed with voting clients, and <code>chan_voter</code> will "mix" the audio from non-voting clients with the voted audio.  </p>
<p>A simple <a href="#config-voter_conf"><code>voter.conf</code></a> for Mixed Mode would look like this:</p>
<div class="highlight"><pre><span></span><code>[general]
port = 1667
password = BLAH

[1999]
Site1 = pswrd1,master,transmit
Site2 = pswrd2,transmit
</code></pre></div>
<h4 id="voter-about-voter-mixed-client-error">Mixed Client Error</h4>
<p>"I am getting this error in Asterisk":</p>
<div class="highlight"><pre><span></span><code>WARNING[2368]: chan_voter.c:4511 voter_reader: Voter client master timing source mobile1 attempting to authenticate as mix client!!
</code></pre></div>
<p>A mixed client error means the <a href="#config-voter_conf"><code>voter.conf</code></a> file is expecting a VOTER/RTCM to try and connect with a GPS IP packet (ie. has <code>master</code> in it's definition in <a href="#config-voter_conf"><code>voter.conf</code></a>), but the VOTER/RTCM isn't sending a GPS IP packet. So it is a mismatch between <a href="#config-voter_conf"><code>voter.conf</code></a> and the PPS setting in the VOTER/RTCM. </p>
<p>If you want to use a mix client (non-voted), make sure that receiver's configuration line in <a href="#config-voter_conf"><code>voter.conf</code></a> <strong>does not</strong> have the <code>master</code> option set.</p>
<h4 id="voter-about-voter-mix-clients-with-voted-client-issues">Mix Clients with Voted Client Issues</h4>
<p>Situation...
"I have a private node with 6 voted receivers using RTCMs. I'd like to add a 7th RTCM to this node that is always mixed in rather than voted. I'm able to make this RTCM work as a 7th voted receiver with no problem. Everything I've read seems to indicate that if I change GPS PPS polarity to "none" this will achieve my desired results, however I am unable to get audio out of my transmit RTCM from this 7th site. It does change color to cyan in Allmon indicating it is non voted input but I do not get any indication or audio when that units COR goes active."</p>
<p>"Setting <code>voter debug level 3</code> in Asterisk and I'm seeing the following message repeatedly scrolling by in a blur when the mix client detects COR (COR is active). Sequence numbers are continually incrementing by 1. I'm running software version 1.47 on all my clients:"</p>
<div class="highlight"><pre><span></span><code>mix client (Mulaw) my_client index:0 their seq:629 our seq:629
mix client my_client outa bounds, resetting!!
</code></pre></div>
<p>If you have a similar situation to the above... check your <code>buflen</code> in <a href="#config-voter_conf"><code>voter.conf</code></a>. Make sure it is at &gt;=160 and see if that fixes it. You may also want to review <a href="#voter-voter-buffers">buffer tuning</a>.</p>
<h2 id="voter-about-voter-summary">Summary</h2>
<p>This technology/project is a great asset to the two-way radio community in general, particularly Amateur Radio and other pubic-service related radio services, allowing inexpensive, general, and open access to what previously would have been impossible or otherwise unattainable. </p>
<p>Systems of this type can greatly improve ability to provide efficient and reliable communications, not to mention promoting usage of frequencies and modes that otherwise may have been underutilized or ignored.</p></section><section class="print-page" id="voter-voter-protocol"><h1 id="voter-voter-protocol-voter-protocol">VOTER Protocol</h1>
<p><strong>V</strong>oice <strong>O</strong>bserving <strong>T</strong>ime <strong>E</strong>xtension (for) <strong>R</strong>adio</p>
<p>Jim Dixon, WB6NIL (SK)</p>
<p>Version 1.0 – August 11, 2013</p>
<h2 id="voter-voter-protocol-introduction">Introduction</h2>
<p>VOTER is a completely connection-less UDP-based protocol (using IANA-assigned well-known port 667<a href="#basics-incompatibles">*</a> (now using port 1667), originally assigned to me for a project I was doing for the United States Federal Election Commission, which, of course, deals mainly with an entirely different kind of voting). It provides for transmission of audio signals from remote radio receivers, along with ultra-precise (GPS-based) timing information and signal quality, allowing synchronization of multiple signals at the "head" end (hereinafter referred to as the "host") of the system and selection of which signal to use based upon the signal quality information and the consistency thereof. Audio and timing information may also optionally be sent back the remote location (hereinafter referred to as the "client") by the host to facilitate a multiple-site simulcast transmission system. In addition, it may serve as a simple, low overhead audio stream protocol for general-purpose (non-GPS-based timed) purposes.</p>
<p>Security is provided by a Challenge/Response authentication technique using CRC-32 based digest information. Although it is by no means a terribly secure method (it is not even close to cryptographically-strong), it at least it provides somewhat of a deterrent for those attempting to circumvent the security.</p>
<p>This document applies to both GPS-based and general-purpose uses. All further references to these different modes of use shall be “GPS-based” (meaning that the time data actually contains GPS-based accurate real time information) or “general-purpose” (which means the time data contains audio packet sequence numbers, along with as accurate as possible (if any) representation of real time with whole-second accuracy).</p>
<p>Both the client and the host use the same exact messages as shown below.</p>
<p>Further information on what happens on the Asterisk side is available on the <a href="#voter-voter-chan_voter"><code>chan_voter</code></a> page.</p>
<h2 id="voter-voter-protocol-packet-structure">Packet Structure</h2>
<p>The VOTER protocol packet consists of a 24 octet header and optionally a payload, which currently can either be 160 samples (20ms) of Mu-law encoded audio, 320 samples (40ms) of ADPCM encoded audio, or GPS location and elevation information (typically sent once per second).</p>
<p>All date and time information is in GMT.</p>
<p>All multi-byte numeric fields are sent standard network-order (most significant byte first).</p>
<h3 id="voter-voter-protocol-header-structure">Header Structure</h3>
<p>The VOTER protocol packet header consists of 24 octets as follows:</p>
<ul>
<li>Octets 0-3: Current accurate (or as accurate as possible for “general-purpose” use) time in whole seconds, 32 bits (network order).</li>
<li>Octets 4-7: Current accurate fractional time in nanoseconds (or audio packet sequence number for “general-purpose” use), 32 bits (network order).</li>
<li>Octets 8-17: Authentication challenge, ASCII string, null-terminated (up to 9 chars long + null).</li>
<li>Octets 18-21: Authentication response (digest), 32 bits (network order).</li>
<li>Octets 22-23: Payload type, 16 bits (network order).</li>
</ul>
<h3 id="voter-voter-protocol-payload-types">Payload Types</h3>
<p>Payload types are as follows (header Octets 22-23):</p>
<h4 id="voter-voter-protocol-payload-type-0-authentication-plus-flags">Payload Type 0 - Authentication Plus Flags</h4>
<p>Flags <strong>must</strong> be sent by the host. Flags <strong>may</strong> be sent by the client.</p>
<p>Octet 24: Flag bits, as follows (specified in decimal bit value):</p>
<ul>
<li>1 – Flat Audio (NOT de-emphasized) if flag set. Processed audio (de-emphasized) if not set. (sent by host only)</li>
<li>2 - Send audio always, regardless of whether or not signal is detected if set. Do not send audio unless signal is detected if not set. (sent by host only)</li>
<li>4 – Do Not filter Sub-Audible tones from audio stream, if set. Filter Sub-Audible (&lt;200Hz) tones from audio stream if set. (sent by host only)</li>
<li>8 – Master Timing Source Mode. If not set, payload 1, 2 and 3 packets are delayed (approx 6mS) to guarantee that the packets from the device designated as "Master Timing Source" are received by the host previous to packets from any other device. If set, no delay is performed, and the packets are sent immediately. <strong>This must be set on only one device in the network.</strong> (sent by host only)</li>
<li>16 – Send audio in 320 sample (40ms) packet IMA ADPCM (Intel/DVI block format) rather than 160 sample (20ms) packet Mu-law. (sent by host only)</li>
<li>32 – Operate in “general-purpose” mode (non-GPS-based). (sent by client, responded to by host) </li>
<li>64-128 – Reserved for Future Use</li>
</ul>
<h4 id="voter-voter-protocol-payload-type-1-rssi-information-mu-law-audio">Payload Type 1 – RSSI information + Mu-law Audio</h4>
<p>Octet 24 is RSSI value 0-255</p>
<p>Octets 25-184 are 160 samples of Mu-law encoded audio (20ms @ 8K samples/s).</p>
<p>Packets of this payload type are sent only when the receiver is receiving a valid signal (or the host is indicating that a signal is to be transmitted).</p>
<h4 id="voter-voter-protocol-payload-type-2-gps-information-optional">Payload Type 2 – GPS Information (optional)</h4>
<p>Octets 24-32: Longitude value, in the format XXXX.DDY (eg 4807.038N), ASCII string, null-terminated.</p>
<p>Octets 33-42: Latitude value, in the format XXXXX.DDY (eg 01131.000E), ASCII string, null-terminated.</p>
<p>Octets 43-49: Elevation value in Meters (eg 545.4), ASCII string, null-terminated.</p>
<p>If Octets 24-49 are omitted, it is considered to be a “keep alive” packet (for maintaining NAT traversals and similar) and is done only by a “general-purpose” mode client without GPS information to send (since a GPS-based client or a “general-purpose” client with GPS would have GPS information to send which accomplishes the “keep alive” functionality as a side-affect).</p>
<h4 id="voter-voter-protocol-payload-type-3-rssi-information-ima-adpcm-audio-in-inteldvi-block-format">Payload Type 3 – RSSI information + IMA ADPCM Audio in Intel/DVI Block Format</h4>
<p>Octet 24 is RSSI value 0-255</p>
<p>Octets 25-187 are 163 octets (320 samples) of IMA ADPCM (Intel/DVI block format) encoded audio (40ms @ 8K samples/s)</p>
<p>Packets of this payload type are sent only when the receiver is receiving a valid signal (or the host is indicating that a signal is to be transmitted).</p>
<h4 id="voter-voter-protocol-payload-type-4-reserved-for-future-use">Payload Type 4 - Reserved for Future Use</h4>
<p>Currently undefined.</p>
<h4 id="voter-voter-protocol-payload-type-5-ping-connectivity-test">Payload type 5 - "PING" (Connectivity Test)</h4>
<p>Octets 24 and up contain 200 bytes of payload for evaluation of connectivity quality. When a client receives this packet, it is intended to be transmitted (with the payload information intact) immediately back to the host from which it came. The actual contents of the payload are not specifically defined for the purposes of this protocol, and is entirely determined by the implementation of the applicable function in the host.</p>
<h2 id="voter-voter-protocol-protocol-explanation">Protocol Explanation</h2>
<p>By definition, a digest value of 0 is an indication that the entity generating it has not received a validly recognizable digest from its peer. Therefore, a challenge must not be generated that would result in a digest value of 0.</p>
<p>A “Master Timing Source” must <strong>not</strong> use ADPCM audio, and obviously must <strong>not</strong> be using “general-purpose” mode. In a system where all clients are using "general-purpose” mode a “Master Timing Source” is not necessary.</p>
<p>The intended methodology for the use of the protocol is as follows:</p>
<ul>
<li>When the client starts operating, it starts periodically sending VOTER packets to the host containing a payload value of 0, the client's challenge string and an authentication response (digest) of 0 (to indicate that it has not as of yet gotten a valid response from the host). </li>
<li>When such a packet is received by the host, it responds with a packet containing a payload value of 0, the host's challenge string, an authentication response (digest) based upon the calculated CRC-32 value of the challenge string it received from the client and the host's password, and option flags.</li>
<li>If the client approves of the host's response, it may then start sending packets with a payload type of 1 or 3, the client's challenge string, and an authentication response (digest) based upon the calculated CRC-32 value of the challenge string it received from the host and the client's password, along with the 1 byte of RSSI information and 160 bytes of mu-law audio. It continues doing this every 20ms, as long as there is signal being received by the receiver. </li>
<li>If the host approves of the client's response, it then uses the audio and/or GPS information provided by the client (and the flow continues).</li>
<li>At any point, if either side does not approve of its peers authentication response, it must reply to its peer with a packet with a payload type of 0 (indicating that authentication needs to take place).</li>
</ul>
<p>The connection-less nature and the flexibility of this protocol allow the client to continue operating even if the host stops or changes its challenge string in mid-stream.</p>
<p>Basically, when a client starts up, it just starts sending out packets, whether or not the host is there, or responding or responding positively. Once it receives valid authentication information from the host, it then is to send periodic GPS packets (once every second), and audio packets (once every 20/40ms) when there is audio to be sent (a signal is present on the receiver, or there is a signal to transmit). If, at any point the client gets responses from the host that do not contain valid authentication, it merely goes back to sending authentication packets once again, and the whole process repeats. Similarly, any time the host receives a packet from the client that does not contain valid authentication, it sends an authentication packet to the client.</p>
<p>Therefore, the protocol is completely tolerant of interruptions in network connectivity, restarts of either or both sides of the connection, and accomplishes this quite easily and with very little complication and overhead.</p>
<p>In summary, there are 7 cases of packets:</p>
<ul>
<li>24 octets, payload 0, digest 0 - This is only sent by a client</li>
<li>24 octets, payload 0, digest (calculated) - This is only sent by a client</li>
<li>25 octets, payload 0, digest (calculated), flags</li>
<li>185 octets, payload 1, digest (calculated), 160 samples of Mu-law audio</li>
<li>24 octets, payload 2, digest (calculated) - This is only sent by client</li>
<li>50 octets, payload 2, digest (calculated), GPS data - This is only sent by client</li>
<li>188 octets, payload 3, digest (calculated), 320 samples of ADPCM audio</li>
<li>24-224 octets, payload 5, digest (calculated), up to 200 bytes for connectivity testing/verification</li>
</ul>
<p>A host will not send a packet to a client until the client has sent a packet for the host. Therefore the "24 octets, payload 0, digest 0" packets will only be sent by a client (since a digest of 0 indicates not yet hearing from a peer). A client may send as many payload 0 packets as is appropriate (there really is no limit). A host must respond to each of these packets.</p>
<p>Presence of payload 1 and/or 3 packets indicates valid signal received or to be transmitted.</p>
<p>For a "receive-only" implementation, the host may only send payload 0 packets in response to packets from the client. It need not send any payload 1 or 3 packets if doing so is inappropriate. A client need not keep intrinsic track of date information (such as a real-time clock, etc). The client may, if no other means is available, determine current date (not including time of day) from the time information in the authentication packet last received from the host. Therefore, the host must send time information that has an accurate date (accurate time is not required).</p>
<h2 id="voter-voter-protocol-general-purpose-mode-operation">“General-Purpose” Mode Operation</h2>
<p>For non-GPS-based uses, a client and host may send audio packet sequence numbers in lieu of accurate real-time information. In order to facilitate this operation, the client and host must negotiate “general-purpose” mode operation at authentication time by passing (and responding to) the “general-purpose” mode flag in the authentication packet.</p>
<p>Both the client and host must maintain a “sequence number” counter (the host must have a unique one for each client) which is intended to be initialized to zero upon initial connection to the host (completion of the authentication exchange), and be incremented every 20 milliseconds, synchronous with the transmission of any audio packets that may be sent (it must increment regardless of whether audio packets are actually being transmitted). Therefore, ADPCM (40 millisecond) audio streams will “skip” sequence numbers.</p>
<p>When an audio packet is transmitted, the local device's sequence number is represented as the “nanosecond” part of the real-time field in the packet header (as opposed to actual time). The receiver is intended to keep track of packet sequence numbers it receives from its peer, and “re-assemble” them as a “coherent stream” of audio based upon the sequential packet numbers generated at the sending point. If a device has whole-second real-time information (regardless of accuracy or sanity), it may send that data in the “seconds” part of the real-time field, although it is for informational purposes only and has no effect on any operation.</p>
<p>Since the sequence numbers are being sent as a 32 bit number, and it increments every 20 milliseconds, no session is intended to be up and valid for more than 1 year (365 days) (which is 1,576,800,000 Decimal (5DFC0F00 Hexadecimal) 20 millisecond intervals). If the session exceeds this limit, each peer is intended to re-establish communications (re-authenticate, etc.).</p>
<p>It is important to keep in mind that in “general-purpose” mode, the 20 millisecond time interval is by definition approximate (although kept as accurate and consistent as possible). Unlike GPS-based mode, the timing is based entirely upon local processor clock sources, etc., and can (and probably will) vary. Therefore, accommodation must be made to allow tolerance of this.</p></section><section class="print-page" id="voter-voter-chan_voter"><h1 id="voter-voter-chan_voter-voter-chan_voter">VOTER <code>chan_voter</code></h1>
<p>The <code>chan_voter</code> channel driver is the interface between Asterisk and the <a href="#voter-voter-hardware">VOTER</a> or <a href="#voter-rtcm-hardware">RTCM</a> radio/repeater hardware interfaces. It allows receiver voting, simulcast transmitters, or just a plain repeater interface when used with the appropriate hardware.</p>
<p>This page will document configuring the channel driver, done through <a href="#config-voter_conf"><code>voter.conf</code></a>, as well as some common issues and more obscure features that may not be widely known.</p>
<h2 id="voter-voter-chan_voter-how-chan_voter-works">How chan_voter Works</h2>
<p>Each node has a number of potential "clients" associated with it. In <a href="#config-voter_conf"><code>voter.conf</code></a>, each stanza (category/instance) is named by the <strong>node number</strong> that the clients specified within the stanza are to be associated with. </p>
<p>Each client entry within that stanza (instance) then consists of an arbitrary (relatively meaningless, just included for easy identification purposes within this channel driver, and has nothing to do with its operation) client identifier name equated to a unique password. This password is programmed into the client. <strong>All clients must have unique passwords, as that is what is used by this channel driver to identify them.</strong></p>
<p>Each channel instance (as opened by <code>app_rpt</code> has a main radio channel in <a href="#config-rpt_conf"><code>rpt.conf</code></a>, e.g. <code>rxchannel=Voter/1999</code> in <a href="#config-rpt_conf"><code>rpt.conf</code></a>) and is directly associated with the node that opened it.</p>
<p>Each client has a pair of circular buffers, one for mu-law (mulaw/ulaw) audio data, and one for RSSI value. The allocated buffer length in all clients is determined by the <code>buflen</code> parameter, which is specified in the <code>[global]</code> stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> in milliseconds, and represented in the channel driver as a number of samples (actual buffer length, which is 8 * milliseconds). </p>
<p>Every channel instance has an index ("drainindex"), indicating the next position within the physical buffer(s) where the audio will be taken from the buffers and presented to the Asterisk channel stream as VOICE frames. Therefore, there is an abstraction of a "buffer" that exists starting at <em>drainindex</em> and ending (modulo) at <em>drainindex - 1</em>, with length of <em>buflen</em>.</p>
<p><code>buflen</code> is selected so that there is enough time (delay) for any straggling packets to arrive before it is time to present the data to the Asterisk channel. </p>
<p>The idea is that the current audio being presented to Asterisk is from some time shortly in the past. Therefore, <strong>NOW</strong> is the position in the abstracted buffer of <em>bufdelay</em> (generally <code>buflen - 160</code>, you have to at least leave room for an entire frame) and the data is being presented from the start of the abstracted buffer. As the physical buffer moves along, what was once "now" will eventually become far enough in the "past" to be presented to Asterisk (gosh, doesn't this sound like a scene from "Spaceballs"??.. I too always drink coffee while watching "Mr. Radar").</p>
<p>During the processing of an audio frame to be presented to Asterisk, all client's buffers that are associated with a channel instance (node) are examined by taking an average of the RSSI value for each sample in the associated time period (the first 160 samples of the abstracted buffer (which is the physical buffer from <em>drainindex</em> to <em>drainindex + 159</em>) and whichever one, if any that has the largest RSSI average greater then zero is selected as the audio source for that frame). The corresponding audio buffer's contents (in the corresponding offsets) are presented to Asterisk, then <strong>ALL</strong> the clients corresponding RSSI data are set to 0, <strong>ALL</strong> the clients corresponding audio are set to quiet (0x7f). </p>
<p>The overwriting of the buffers after their use/examination is done so that the next time those positions in the physical buffer are examined, they will not contain any data that was not actually put there, since all client's buffers are significant regardless of whether they were populated or not. This allows for the true "connectionless-ness" of this protocol implementation.</p>
<h2 id="voter-voter-chan_voter-asterisk-cli-commands">Asterisk CLI Commands</h2>
<p>These are the CLI commands that Asterisk and <code>chan_voter</code> supports:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; help voter
            voter display  Display voter (instance) clients
               voter ping  Ping (check connectivity) to client
               voter prio  Specify/Query voter client priority value
             voter record  Enables/Specifies (or disables) voter recording file
               voter test  Specify/Query voter instance test mode
               voter tone  Sets/Queries Tx CTCSS level for specified chan_voter instance
          voter txlockout  Set Tx Lockout status for voter (instance) clients
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Module Reload</p>
<p>Note that the former <code>voter reload</code> command to reload the <code>chan_voter</code> parameters has been replaced with <code>module reload chan_voter</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">VOTER Debugging</p>
<p>Note that the former <code>voter debug level</code> command has been removed. Use the built-in <a href="#user-guide-menu-debug-level">Asterisk Debug Levels</a> to enable debug messages.</p>
</div>
<h3 id="voter-voter-chan_voter-voter-display"><code>voter display</code></h3>
<p>Usage: </p>
<div class="highlight"><pre><span></span><code>voter display [instance]
</code></pre></div>
<p>The <code>instance</code> is usually the node number associated with the channel driver in <a href="#config-rpt_conf"><code>rpt.conf</code></a> (<code>rxchannel=Voter/1999</code>), which is also defined as a stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> as well (<code>[1999]</code>).</p>
<p>Running <code>voter display</code> will present a scrolling list of the real-time RSSI being received from all clients associated with that <code>instance</code>.</p>
<div class="highlight"><pre><span></span><code>VOTER INSTANCE 1999 DISPLAY:

 NORTH      |&gt;                                                       | [  0]
 SOUTH      |&gt;                                                       | [  0]
 EAST       |&gt;                                                       | [  0]
</code></pre></div>
<div class="highlight"><pre><span></span><code>VOTER INSTANCE 1999 DISPLAY:

 NORTH      |==============================================&gt;         | [240]
 SOUTH      |=======================================================&gt;| [255]
 EAST       |======================================================&gt; | [253]
</code></pre></div>
<p>Press <strong>enter</strong> to stop.</p>
<h3 id="voter-voter-chan_voter-voter-ping"><code>voter ping</code></h3>
<p>Usage: </p>
<div class="highlight"><pre><span></span><code>voter ping &lt;client&gt; [# pings]
</code></pre></div>
<p>Used to checking network latency to clients. Use the <code>client_name</code> from <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>Defaults to 8 pings, if no number of pings is specified. Use at least 100 pings when <a href="#voter-voter-buffers">tuning buffer lengths</a>. Send the same command with 0 pings to abort an in-progress ping.</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter ping EAST 10
PING (EAST) Response:   seqno: 1  diff: 43 ms
PING (EAST) Response:   seqno: 2  diff: 42 ms
PING (EAST) Response:   seqno: 3  diff: 44 ms
PING (EAST) Response:   seqno: 4  diff: 42 ms
PING (EAST) Response:   seqno: 5  diff: 43 ms
PING (EAST) Response:   seqno: 6  diff: 43 ms
PING (EAST) Response:   seqno: 7  diff: 42 ms
PING (EAST) Response:   seqno: 8  diff: 42 ms
PING (EAST) Response:   seqno: 9  diff: 42 ms
PING (EAST) Response:   seqno: 10  diff: 43 ms
PING (EAST): Packets tx: 10, rx: 10, oos: 0, Avg.: 42.600 ms
PING (EAST):  Worst: 44 ms, Best: 42 ms, 100.0% Packets successfully received (0.0% loss)
*CLI&gt;
</code></pre></div>
<p>The critical number is the <code>Worst:</code> value. That is the one you will want to pay attention to when tuning buffers.</p>
<p>This ping <strong>does not</strong> use ICMP. It accomplishes it's task over the <a href="#voter-voter-protocol">VOTER Protocol</a>. Ping times are round-trip.</p>
<h3 id="voter-voter-chan_voter-voter-prio"><code>voter prio</code></h3>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code>voter prio instance_id [client_id] [priority value]
</code></pre></div>
<p>Query the existing priorities, or arbitrarily assign (override) a priority value to a particular client. The <code>instance</code> (typically the node number the client is assigned to) and the <code>client_name</code> as specified in <a href="#config-voter_conf"><code>voter.conf</code></a> are required.</p>
<p>With an <code>instance</code> only, and no <code>client</code> specified, queries existing priorities for all clients associated with that instance:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter prio 1999
Voter instance 1999 priority values:

client NORTH: prio: 0 (not overridden)
client SOUTH: prio: 0 (not overridden)
client EAST: prio: 1 (not overridden)
</code></pre></div>
<p><code>Not overridden</code> indicates that the displayed priority is the one configured in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>Specify an <code>instance</code> and <code>client</code> to query the priority for that specific client:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter prio 1999 NORTH
Voter instance 1999, client NORTH: prio: 0 (not overridden)
</code></pre></div>
<p>Assign a specific priority to a specific client:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter prio 1999 SOUTH 2
voter instance 1999 client SOUTH prio (override): previous level: &lt;disabled&gt;, new level: 2

*CLI&gt; voter prio 1999
Voter instance 1999 priority values:

client NORTH: prio: 0 (not overridden)
client SOUTH: eff_prio: 2, prio: 0, override_prio: 2
client EAST: prio: 1 (not overridden)
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A priority of <code>0</code> is "disabled", as in "no priority" assigned, vote equally.</p>
</div>
<p>Revert changes to default/normal by assigning a priority level of <code>-2</code> or <code>off</code> or <code>disable</code> to the client:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter prio 1999 SOUTH -2
voter instance 1999 client SOUTH prio (override) disabled

*CLI&gt; voter prio 1999
Voter instance 1999 priority values:

client NORTH: prio: 0 (not overridden)
client SOUTH: prio: 0 (not overridden)
client EAST: prio: 1 (not overridden)
</code></pre></div>
<p>Disable a client from being voted (effectively disable it's receiver) by assigning a priority of <code>-1</code>:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter prio 1999 SOUTH -1
voter instance 1999 client SOUTH prio (override): previous level: 2, new level: -1

*CLI&gt; voter prio 1999
Voter instance 1999 priority values:

client NORTH: prio: 0 (not overridden)
client SOUTH: eff_prio: -1, prio: 0, override_prio: -1
client EAST: prio: 1 (not overridden)
</code></pre></div>
<p>To recap:</p>
<ul>
<li>A priority of 0 is no priority, everyone is voted equally</li>
<li>A priority of 1-100 is supported, with lower numbers having a higher priority over clients with the same RSSI value and a lower priority</li>
<li>A priority of -1 disables a particular client (disables it from receiving)</li>
<li>A priority of -2 returns a client to normal and the priority assigned in <a href="#config-voter_conf"><code>voter.conf</code></a> or "0" if no priority is specified</li>
</ul>
<h3 id="voter-voter-chan_voter-voter-record"><code>voter record</code></h3>
<p>Usage: </p>
<div class="highlight"><pre><span></span><code>voter record instance_id [record filename]
</code></pre></div>
<p>Enables/specifies (or disables) recording file for <code>chan_voter</code>. See Voter Recording and Playback below for example configuration and usage.</p>
<p>The <code>instance</code> is usually the node number associated with the channel driver in <a href="#config-rpt_conf"><code>rpt.conf</code></a> (<code>rxchannel=Voter/1999</code>), which is also defined as a stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> as well (<code>[1999]</code>).</p>
<p>Specify a filename to record the voter data to. Specify <code>voter record</code> with no file name, or with a new filename to stop recording a file already opened. </p>
<h3 id="voter-voter-chan_voter-voter-test"><code>voter test</code></h3>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code>voter test instance_id [test value]
</code></pre></div>
<p>Puts an <code>instance</code> in to test mode.</p>
<p>The <code>instance</code> is usually the node number associated with the channel driver in <a href="#config-rpt_conf"><code>rpt.conf</code></a> (<code>rxchannel=Voter/1999</code>), which is also defined as a stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> as well (<code>[1999]</code>).</p>
<p>Enter with just the <code>instance</code> value to query the current test state:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter test 1999
voter instance 1999 Test: currently disabled
</code></pre></div>
<p>Applicable <code>test</code> values are:</p>
<ul>
<li>0 - Normal voting operation</li>
<li>1 - Randomly pick which client of all that are receiving at the max RSSI value to use</li>
<li>&gt;1 - Cycle thru all the clients that are receiving at the max RSSI value with a cycle time of (test mode - 1) frames. In other words, if you set it to 2, it will change every single time. If you set it to 11, it will change every 10 times. This is serious torture test</li>
</ul>
<h3 id="voter-voter-chan_voter-voter-tone">voter tone</h3>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code>voter tone instance_id [new_tone_level(0-250)]
</code></pre></div>
<p>Sets/Queries Tx CTCSS level for specified <code>instance</code>.</p>
<p>The <code>instance</code> is usually the node number associated with the channel driver in <a href="#config-rpt_conf"><code>rpt.conf</code></a> (<code>rxchannel=Voter/1999</code>), which is also defined as a stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> as well (<code>[1999]</code>).</p>
<p>Use to assist with setting the <code>txctcsslevel</code>, so you don't have to edit <a href="#config-voter_conf"><code>voter.conf</code></a> and do a <code>voter reload</code> all the time. Once you determine the suitable level for your tone, you can write that to <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<h3 id="voter-voter-chan_voter-voter-txlockout">voter txlockout</h3>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code>voter txlockout [instance] &lt;client_list&gt;
</code></pre></div>
<p>Set Tx Lockout for voter <code>instance</code> <code>clients</code>.</p>
<p>The <code>instance</code> is usually the node number associated with the channel driver in <a href="#config-rpt_conf"><code>rpt.conf</code></a> (<code>rxchannel=Voter/1999</code>), which is also defined as a stanza in <a href="#config-voter_conf"><code>voter.conf</code></a> as well (<code>[1999]</code>).</p>
<p>The <code>clients</code> would be the defined <code>client_name</code> associated with that <code>instance</code>.</p>
<p>Query the current clients that are not allowed to transmit by just specifying the <code>instance</code> name:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter txlockout 1999
Full list of Tx Locked-out clients for voter instance 1999:
No clients are currently locked-out

Full list of normally transmitting clients for voter instance 1999:
Client NORTH is able to transmit
Client SOUTH is able to transmit
Client EAST is able to transmit
</code></pre></div>
<p>Lockout (disable) the transmitter at a particular client:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter txlockout 1999 +NORTH
Client NORTH tx lockout Enabled

Full list of Tx Locked-out clients for voter instance 1999:
Client NORTH tx is locked-out

Full list of normally transmitting clients for voter instance 1999:
Client EAST is able to transmit
Client SOUTH is able to transmit
</code></pre></div>
<p>Unlock (enable) the transmitter at a particular client:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt; voter txlockout 1999 -NORTH
Client NORTH tx lockout Disabled

Full list of Tx Locked-out clients for voter instance 1999:
No clients are currently locked-out

Full list of normally transmitting clients for voter instance 1999:
Client NORTH is able to transmit
Client SOUTH is able to transmit
Client EAST is able to transmit
</code></pre></div>
<h2 id="voter-voter-chan_voter-less-known-factsfeatures">Less Known Facts/Features</h2>
<h3 id="voter-voter-chan_voter-adpcm-functionality">ADPCM Functionality</h3>
<p>The original intent was to change this driver to use signed linear internally, but after some thought, it was determined that it was prudent to continue using mulaw (ulaw) as the "standard" internal audio format (with the understanding of the slight degradation in dynamic range when using ADPCM resulting in doing so). This was done because existing external entities (such as the recording files and the streaming stuff) use mulaw as their transport, and changing all of that to signed linear would be cumbersome, inefficient and undesirable.</p>
<p>ADPCM can be specified as the transport encoding, see <a href="#config-voter_conf"><code>voter.conf</code></a> for information on enabling that.</p>
<h3 id="voter-voter-chan_voter-dynamic-client-functionality">"Dynamic" Client Functionality</h3>
<p><strong>DON'T USE IT!!</strong>. It is intentionally <strong>NOT</strong> documented to encourage non-use of this feature. It is for demo purposes <strong>ONLY</strong>. The <code>chan_voter</code> driver will <strong>NOT</strong> properly perform reliably in a production environment if this option is used.</p>
<h3 id="voter-voter-chan_voter-duplex-mode-3hostdeemp">Duplex Mode 3/<code>hostdeemp</code></h3>
<p>As of VOTER board firmware 1.19 (7/19/2013), there are a set of options in both the firmware ("DUPLEX Mode 3" support), and the <code>hostdeemp</code> option (instance-wide) in the <a href="#config-voter_conf"><code>voter.conf</code></a> file on the host.</p>
<p>Duplex Mode 3 in <code>app_rpt</code> allows for "in-cabinet" repeat audio (where the actual radio hardware supplies the repeated audio directly itself, and <code>app_rpt</code> simply "adds" all of the other audio as appropriate).</p>
<p>The VOTER/RTCM board now has an option to do the same functionality itself, for a case where local repeat audio is desired without the "network audio delay" normally associated with VOTER/RTCM board operation, and for a radio that doesn't have the option of providing "in cabinet" repeat audio (along with externally provided audio) itself.</p>
<p>Because of limitations with the VOTER/RTCM board hardware (being that there is only one audio path into the processor, and it either has de-emphasis in its "hardware path" or not), it is necessary if you:</p>
<ul>
<li>Wish to have the <code>duplex=3</code> functionality in <code>app_rpt</code></li>
<li>Have the <code>DUPLEX3</code> support enabled in the VOTER/RTCM board</li>
<li>Have a transmitter that you are "modulating directly" (with flat audio)</li>
</ul>
<p>If all of the above is true, then you need to use the <code>hostdeemp</code> option in <code>chan_voter</code> (<a href="#config-voter_conf"><code>voter.conf</code></a>), which basically "forces" the VOTER/RTCM <strong>NOT</strong> to do de-emphasis in hardware (it will send the non-de-emphasized audio to the host), and have the host "do" the de-emphasis (in software) instead.</p>
<p>This will allow the VOTER/RTCM to be able to "pass" the non-de-emphasized (discriminator) audio back into the "direct modulation audio" stream, since that is what will be "presented" to the processor in the VOTER/RTCM, as the hardware de-emphasis is disabled in this mode.</p>
<p>If you have a transmitter that you are "feeding" line-level (mic) audio, then this mode is not necessary, as the VOTER/RTCM is fully capable of providing the functionality all by itself.</p>
<p>Obviously, it is not valid to use <strong>ANY</strong> of the <code>duplex=3</code> modes in a voted and/or simulcast system.</p>
<h3 id="voter-voter-chan_voter-redundant-proxy-mode">Redundant "Proxy" Mode</h3>
<p>A "Redundant" (backup) server may be set up, so that if the "primary" server fails, clients can detect this failure, and connect to the designated "backup" (or "secondary") server.</p>
<p>Needless to say, since Internet connectivity is not by any means guaranteed to be consistent, it is possible for some clients to have working connectivity to the "primary" server and not others, even though the "primary" server is functional.</p>
<p>If this was to occur, actual voting and/or simulcast clients would have a "broken" system (being that all the clients need to be on the same server for any sort of functional operation).</p>
<p>To eliminate this possibility, functionality has been added so that a "secondary" server will "proxy" (forward) all of its VOTER packets to the "primary" (if the "primary" is
on line), and the "primary" will generate all of the outbound VOTER packets, which (for clients "connected" to the "secondary" server) get sent to the "secondary" server to distribution to its clients.</p>
<p>This allows for a "unity" of all of the clients on a network, even though they may be connected to different servers.</p>
<p>In addition, it is assumed that "permanent linking" (at least of some sort) will be provided between the channel side of the <code>chan_voter</code> instances (presumably through a "perma-link" provided by <code>app_rpt</code>).</p>
<p>When the "secondary" is "proxying" (to the "primary") it does not provide direct connectivity to/from its locally-connected clients, thus allowing them to "connect" via the "primary" server instead. In "normal" mode, it works "normally".</p>
<p>The operation is performed by more-or-less "encapsulating" the VOTER packets received by the "secondary" server, and forwarding them on to the "primary" server, where they are "un-encapsulated" and appear to that serer to be coming from clients connected directly to it (and keeps track of which ones are connected in this manner, etc.). When it needs to send VOTER packets to a client connected through the "secondary", it "encapsulates" them, and sends them to the "secondary", where they get "un-encapsulated" and sent to their associated connected clients, based upon information in the "encapsulation".</p>
<p>If the "secondary" server loses (or does not make) connection to the "primary", it operates as normal, until such time as it can make the connection.</p>
<p>The server redundancy feature is local to each <code>chan_voter</code> <code>instance</code>.</p>
<p>For each <code>chan_voter</code> <code>instance</code> served by both the "primary" and "secondary" servers, the client list (parameters, etc.) <strong>MUST</strong> be identical.</p>
<p>In addition, the following things <strong>must</strong> be added uniquely on each server:</p>
<ul>
<li>In the "primary" server, there needs to be a "primary connectivity" client specified for each "secondary" server for which it is "primary". Basically, this is a client that does NOTHING other then providing a means by which the "secondary" can determine whether the "primary" is on line<ul>
<li>It is a standard <code>chan_voter</code> client, with nothing else specified other then its password. Again, although it is a "legitimate" client (technically), its only purpose <strong>MUST</strong> be to allow the secondary server to connect to it</li>
</ul>
</li>
<li>The "primary" server also needs to have the following in all of its instances that require redundancy:</li>
</ul>
<div class="highlight"><pre><span></span><code>isprimary = y
</code></pre></div>
<ul>
<li>The "secondary" server needs to have the following in all of its instances that require redundancy:</li>
</ul>
<p><div class="highlight"><pre><span></span><code>primary = 12.34.56.78:1667,mypswd
</code></pre></div>
Where 12.34.56.78:1667 is the IPADDDR:PORT of the "primary" server, and mypswd is the password of the "primary connectivity" client</p>
<div class="admonition note">
<p class="admonition-title">Timing Sources</p>
<p>Master timing sources <strong>MUST</strong> be local to their associated server, and therefore, can not be operated in a redundant configuration. If a radio needs server redundancy, it <strong>CAN NOT</strong> be connected to a master timing source. Also, the master timing source <strong>MUST</strong> be associated with a <code>chan_voter</code> instance that <strong>DOES NOT</strong> have redundancy configured for it, even if a separate instance needs to be created just for this purpose.</p>
</div>
<p>Also, if non-GPS-based operation is all that is needed, just the use of redundancy within the clients is sufficient, and does not require any use of the server redundancy features.</p>
<h3 id="voter-voter-chan_voter-voter-recording-and-playback">Voter Recording and Playback</h3>
<p>The <code>chan_voter</code> channel driver has the ability to record VOTER streams by the channel driver live on the air (using the <code>voter record</code> command in Asterisk console). This also records time-stamped data and the voted receiver at that particular time along with RSSI readings. This can then be played back using the VoterPal GUI JAVA applet.</p>
<h4 id="voter-voter-chan_voter-how-to-setup-playback">How to Setup Playback</h4>
<ul>
<li>Download the files from the <a href="https://github.com/AllStarLink/Voter/tree/master/archive/voterpal">AllStarLink GitHub Repository</a> </li>
<li>Run <code>VoterPal.jar</code>. You may come across issues with running Java such as security permissions. These can be allowed </li>
<li>Once running, you will see the applications GUI. File --&gt; Open to select your voter data files. </li>
</ul>
<p><a class="glightbox" href="../voter/img/Voterpal.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Voterpal" src="../voter/img/Voterpal.png" /></a></p>
<ul>
<li><code>Reset</code> - Resets the file back to start</li>
<li><code>Play</code> - Plays the recorded file</li>
<li><code>Stop</code> - Stops the current playing file in it's current position</li>
<li><code>CTCSS Filter Enable</code> - Removes CTCSS hum from any recorded audio stream</li>
<li><code>File Play Position</code> - Drag this slider to skip</li>
<li><code>Activity</code> - This will show time-stamped information including RSSI of the selected VOTER client within the recorded data stream</li>
<li><code>Voter Clients</code> - This will show the real time voted client. This is also dependent of the Mode setting</li>
<li><code>Mode</code> -Various modes can be selected in VoterPal<ul>
<li><code>0</code> - Normal Voting Mode  </li>
<li><code>1</code> - Randomly pick which client of all that are receiving at the max RSSI value to use</li>
<li><code>&gt;1</code> - Cycle thru all the clients that are receiving at the max RSSI value with a cycle time of (test mode - 1) frames. In other words, if you set it to 2, it will change every single frame. If you set it to 11, it will change every 10 frames. This is a serious torture test</li>
<li><code>&lt;0</code> - Any value less than zero will force select the Voter Client (i.e. -1 is the first client, -2 is the 2nd client)       </li>
</ul>
</li>
</ul>
<h4 id="voter-voter-chan_voter-node-configuration">Node Configuration</h4>
<p>As mentioned above the Asterisk CLI is as follows:</p>
<div class="highlight"><pre><span></span><code>voter record instance_id [record filename] 
</code></pre></div>
<p>This enables/Specifies (or disables) recording file for <code>chan_voter</code>.</p>
<p>Where:</p>
<ul>
<li><code>instance_id</code> - voter number instance</li>
<li><code>record filename</code> - is the filename of the recording to be stored</li>
</ul>
<p>A script can be made and placed in <code>/etc/cron.hourly</code> which will run every hour. Every time the above command is run in Asterisk, it creates a new file. An example of such a script is below:</p>
<div class="highlight"><pre><span></span><code>#!/bin/sh 
asterisk -r -x &quot;voter record &lt;instance_id&gt; /tmp/voter-record&quot;`date +%F-%H-%M` &gt;&gt; /var/log/voterrecordlog
</code></pre></div>
<p>The <code>/tmp/</code> directory can be substituted for mounted USB HDD.</p></section><section class="print-page" id="voter-rtcm-hardware"><h1 id="voter-rtcm-hardware-rtcm-hardware">RTCM Hardware</h1>
<p>This is the documentation page to support the commercial SMD implementation of the VOTER Hardware Client, marketed by <a href="http://www.micro-node.com">Micro-Node</a> as the <a href="http://www.micro-node.com/thin-m1.shtml">Radio Thin Client Module (RTCM)</a>.</p>
<div class="grid">
<p><a class="glightbox" href="../voter/img/Rtcm2-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM 2" src="../voter/img/Rtcm2-750.jpg" /></a></p>
<p><a class="glightbox" href="../voter/img/Rtcm1-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM Front" src="../voter/img/Rtcm1-750.jpg" /></a></p>
<p><a class="glightbox" href="../voter/img/Rtcm3-750.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RTCM 3" src="../voter/img/Rtcm3-750.jpg" /></a></p>
</div>
<p>The Micro-Node RTCM (and <a href="#voter-voter-hardware">VOTER</a>) interfaces are typically used with AllStarLink in voting/simulcast applications. They <strong>may</strong> be used for <strong>ANY</strong> repeater interface application, through the <code>chan_voter</code> channel driver, as they are primarily a Radio over IP (RoIP) adapter. </p>
<p>The <a href="#voter-voter-hardware">VOTER</a> is the original through-hole board designed by Jim Dixon (SK) for this application. It is open-source, and the relevant Gerber files and BoM to build it are available. </p>
<p>The <a href="http://www.micro-node.com/thin-m1.shtml">Micro-Node Radio Thin Client Module (RTCM)</a> is the commercial version of the VOTER. It uses surface mount parts (SMD), but is functionally equivalent to the original VOTER. In general, the two terms (RTCM/VOTER) are used interchangeably, as they operate the same, and use the same firmware (mostly, see below).</p>
<h2 id="voter-rtcm-hardware-firmware">Firmware</h2>
<p>See the <a href="#voter-voter-firmware">VOTER firmware</a> page for information on upgrading the firmware.</p>
<h2 id="voter-rtcm-hardware-board-layout">Board Layout</h2>
<h2 id="voter-rtcm-hardware-connectors-and-switches">Connectors and Switches</h2>
<div class="highlight"><pre><span></span><code>J1    - ICSP Programming Header
P1    - Radio
P2    - Console/GPS
SW1   - Reset (Momentary)
SW2-1 - Init EEPROM
SW2-2 - Calibrate Squelch
SW2-3 - Calibrate Diode
SW2-4 - RX Level LEDs
</code></pre></div>
<h3 id="voter-rtcm-hardware-j1-icsp-programming-header-6-pin-mta-100">J1 - ICSP Programming Header (6 pin MTA-100)</h3>
<div class="highlight"><pre><span></span><code>1 - MCLR
2 - +3.3Vdc
3 - GND
4 - PGD (Program Data)
5 - PGC (Program Clock)
6 – NU
</code></pre></div>
<h3 id="voter-rtcm-hardware-p1-radio-connector-pinout-db9-male">P1 - Radio Connector Pinout (DB9 Male)</h3>
<div class="highlight"><pre><span></span><code>1 - + VIn (7-24 Volts DC).
2 - Transmit Audio Out
3 - Receive (discriminator) Audio In
4 - External CTCSS Input (optional)
5 - Gnd
6 - Gnd
7 - /PTT Out (open-collector, active-low)
8 - Gnd
9 – Gnd
</code></pre></div>
<h3 id="voter-rtcm-hardware-p2-consolegps-connector-pinout-db15-female">P2 - Console/GPS Connector Pinout (DB15 Female)</h3>
<div class="highlight"><pre><span></span><code>1 - NC
2 - Console Transmit Data
3 - Console Receive Data
4 - NC
5 - Gnd
6 - GPS Receive Data
7 - PTT Out
8 - Gnd
9 - NC
10 - Console Request To Send (RTS)
11 - Console Clear To Send (CTS)
12 - NC
13 - GPS Power Output (5Vdc @ 800ma MAX)
14 - GPS Transmit Data
15 – External Reset
</code></pre></div>
<h3 id="voter-rtcm-hardware-sw1-reset">SW1 - Reset</h3>
<p>Depress SW1 momentarily to reset the RTCM.</p>
<h3 id="voter-rtcm-hardware-sw2-dip-switch">SW2 - DIP Switch</h3>
<div class="highlight"><pre><span></span><code>SW2-1 - Init EEPROM
SW2-2 - Calibrate Squelch
SW2-3 - Calibrate Diode
SW2-4 - RX Level LEDs
</code></pre></div>
<h4 id="voter-rtcm-hardware-sw2-1-init-eeprom">SW2-1 - Init EEPROM</h4>
<p>SW2-1 will "Initialize configuration parameters in EEPROM" (factory reset). If <strong>ON</strong> when the firmware starts, the operating parameters in the EEPROM will be set to default values. The system activity LED (LD1, green) will stay off for approximately 4 seconds, then stay on steady to indicate that the initialization process is complete. Afterwards, the switch may be <strong>TURNED OFF</strong> and the system will continue running normally. </p>
<div class="admonition note">
<p class="admonition-title">Diode Calibration</p>
<p>If <code>SW2-3</code> is <strong>ON</strong> during this procedure, the “Diode Calibration” process will also occur.</p>
</div>
<h4 id="voter-rtcm-hardware-sw2-2-calibrate-squelch">SW2-2 - Calibrate Squelch</h4>
<p>SW2-2 will calibrate squelch. With the receiver connected and its antenna removed, switch <strong>ON</strong> SW2-2. In the next few seconds the "Receive Signal Indicator" (LD3, Green) will flash on and off, then (hopefully) on steady. This indicates that the squelch calibration has occurred successfully. If unsuccessful, the LED will flash either <strong>fast</strong> to indicate that the discriminator noise level is too <strong>high</strong>, or <strong>slowly</strong> to indicate that the discriminator noise level is too <strong>low</strong>. </p>
<div class="admonition note">
<p class="admonition-title">Diode Calibration</p>
<p>If <code>SW2-3</code> is <strong>ON</strong> during this procedure, the “Diode Calibration” process will also occur.</p>
</div>
<h4 id="voter-rtcm-hardware-sw2-3-calibrate-diode">SW2-3 - Calibrate Diode</h4>
<p>SW2-3 will perform "Diode Calibration" when turned <strong>ON</strong>. This may only be done in conjunction with a configuration parameter initialization (see SW2-1, above), or a "Squelch Calibration" (see SW2-2, above). This is a form of temperature compensation, where a power supply voltage is sampled that is dependent on the temperature coefficient of a diode.</p>
<h4 id="voter-rtcm-hardware-sw2-4-rx-level-leds">SW2-4 - RX Level LEDs</h4>
<p>SW2-4 temporarily re-purposes LD4 and LD5 to allow for visual indication of RX input level when turned <strong>ON</strong>. With SW2-4 on, LD5 will indicate (by brightness) if the RX level is too low, and LD4 will indicate (by brightness) if the RX level is too high. So the idea is to tune R36 so that there is minimal brightness on both LD4 and LD5 (like a null, more or less). Alternatively, <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a> on the console gives a more graphical method of setting the Rx input level. </p>
<h2 id="voter-rtcm-hardware-led-designations">LED Designations</h2>
<div class="highlight"><pre><span></span><code>LD1 - Heartbeat
LD2 - PTT
LD3 - COS On solid is valid Rx signal, flashing is without CTCSS
LD4 - GPS On solid is GPS received and locked, flashing is GPS received, lock in progress
LD5 - HOST
</code></pre></div>
<p>The COS (RX) LED on the RTCM will flash (same rate as Heartbeat LED) if you have External CTCSS enabled, and the received signal has the wrong (or no) valid PL.</p>
<h2 id="voter-rtcm-hardware-jumpers">Jumpers</h2>
<p>The RTCM has internal jumpers that can be changed to affect the following:</p>
<div class="highlight"><pre><span></span><code>JP1 - Discriminator Level Boost
JP2 - 20dB Pad
JP3 - Output Amp Power Source
JP4 - GPS TX RS-232/TTL Select
JP5 - GPS RX RS-232/TTL Select
JP6 - Not Used
JP7 - Bootloader Programming
</code></pre></div>
<h3 id="voter-rtcm-hardware-jp1-discriminator-level-boost">JP1 - Discriminator Level Boost</h3>
<p>Insert if low discriminator level. If squelch cannot self-calibrate with JP1 removed (too low), try with JP1 inserted.</p>
<div class="admonition note">
<p class="admonition-title">Squelch Calibration Only</p>
<p>This jumper affects the squelch calibration circuit only. Not to be confused with JP2, which is the pad for the receive audio.</p>
</div>
<h3 id="voter-rtcm-hardware-jp2-20db-pad">JP2 - 20dB Pad</h3>
<p>Insert to attenuate discriminator input level by 20db. This pad affects the <strong>receive audio level</strong>. See the <a href="#voter-rtcm-hardware-receive-level-input-calibration">Receive Level Input Calibration</a> section.</p>
<h3 id="voter-rtcm-hardware-jp3-output-amp-power-source">JP3 - Output Amp Power Source</h3>
<p>Selects power source for output audio amplifier. 1-2 is to power it from the 5VDC power supply. 2-3 is to power it directly from Vin. </p>
<h3 id="voter-rtcm-hardware-jp4-gps-tx-rs-232ttl-select">JP4 - GPS TX RS-232/TTL Select</h3>
<p>Selects GPS Serial transmit level. 1-2 RS232 Level, 2-3 TTL (5V) Level.</p>
<h3 id="voter-rtcm-hardware-jp5-gps-rx-rs-232ttl-select">JP5 - GPS RX RS-232/TTL Select</h3>
<p>Selects GPS Serial receive level. 1-2 RS232 Level, 2-3 TTL (5V) Level.</p>
<h3 id="voter-rtcm-hardware-jp6-reserved">JP6 – Reserved</h3>
<p>Not used.</p>
<h3 id="voter-rtcm-hardware-jp7-bootloader-programming">JP7 - Bootloader Programming</h3>
<p>This jumper only needs to be removed when programming the bootloader in the dsPIC using the ICSP header. </p>
<h2 id="voter-rtcm-hardware-potentiometers">Potentiometers</h2>
<div class="highlight"><pre><span></span><code>R22 - Squelch adjustment
R36 - Rx Input Level
R10 - Tx Output Level
</code></pre></div>
<h2 id="voter-rtcm-hardware-initialization">Initialization</h2>
<p>Once you have verified that the firmware is running, turn on SW2-1 and SW2-3. </p>
<p>Be sure to do this at a reasonable human room temperature (like 60-80 deg. F). This is necessary because this procedure initializes the operating parameters in the EEPROM and also does a temperature compensation diode calibration, which <em>needs</em> to happen at room temperature. </p>
<p>Once the switches have been turned on, power-cycle the board and wait for the system activity light to come on <strong>steady</strong> (about 4 seconds or so after the 5 second initial wait time).</p>
<p>Then, turn <strong>off</strong> the switches, and proceed with <a href="#voter-rtcm-hardware-squelch-calibration-and-setting">Squelch Calibration and Setting</a>.</p>
<h2 id="voter-rtcm-hardware-squelch-calibration-and-setting">Squelch Calibration and Setting</h2>
<p>With the receiver connected and its antenna removed, turn on SW2-2. In the next few seconds the "COS Indicator" (LD3, green) will flash on and off, then (hopefully) on steady. </p>
<p>This indicates that the squelch calibration has occurred successfully. </p>
<p>If unsuccessful, the LED will flash either <strong>fast</strong> to indicate that the discriminator noise level is too <strong>high</strong>, or <strong>slowly</strong> to indicate that the discriminator noise level is too <strong>low</strong>. If the discriminator level is too low, try inserting JP1 and try again.</p>
<div class="admonition note">
<p class="admonition-title">Diode Calibration</p>
<p>If SW2-3 is inserted during this procedure, the "Diode Calibration" process will also occur.</p>
</div>
<p>If you still have troubles calibrating the squelch, you may need to try the <a href="#voter-voter-audio-dspbew-firmware-version">Baseband Examination Window (BEW)</a> firmware.</p>
<p>When Squelch Calibration has been completed, turn <strong>off</strong> SW2-2.</p>
<p>Once the Squelch Calibration procedure has been performed, the squelch adjustment (R22) needs to be properly set. Make sure that the "External CTCSS" is set to "ignore" (value: 0).</p>
<div class="highlight"><pre><span></span><code>12 - External CTCSS (0=Ignore, 1=Non-Inverted, 2=Inverted) (0)
</code></pre></div>
<p>Adjust R22 until the COS Indicator (LD3) is lit. Then, advance R22 clockwise until LD3 is no longer lit. That is the minimum squelch setting. You probably will want to crank it up at least another turn clockwise, because if you leave it there it will open on a REALLY low level signal.</p>
<p>After proper setting has been achieved, return the "External CTCSS" configuration to its original setting.</p>
<p><a href="#voter-voter-menus-98-status-display">Menu 98</a> will show the settings of the Squelch Calibration, Diode Calibration, and Squelch Levels:</p>
<div class="highlight"><pre><span></span><code>Squelch Noise Gain Value: 45, Diode Cal. Value: 60, SQL Level 675, Hysteresis 10
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Software Squelch</p>
<p>Firmware &gt;3.00 allows for the option to set the squelch via software, after initially setting it with the hardware potentiometer to get a baseline level. See the <a href="#voter-voter-menus-s-squelch-parameters-menu">Squelch Parameters Menu</a>.</p>
</div>
<h2 id="voter-rtcm-hardware-receive-level-input-calibration">Receive Level Input Calibration</h2>
<p>See the <a href="#voter-voter-audio">VOTER Audio</a> page for additional considerations when it comes to connecting the RTCM to your receiver, and for level setting instructions.</p>
<p>Place a full-quieting saturated signal on the receiver, modulated by 1000 Hertz sine wave at 3kHz deviation. </p>
<p>With SW2-4 <strong>on</strong>, LD5 will indicate (by brightness) if the RX level is too low, and LD4 will indicate (by brightness) if the RX level is too high. So the idea is to tune R36 so that there is minimal brightness on both LD5 and LD4 (like a null, more or less). Turn <strong>off</strong> SW2-4, when complete.</p>
<p>Alternatively, <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a> from the console menu gives a more graphical method of setting the receiver input level:</p>
<div class="highlight"><pre><span></span><code>RX VOICE DISPLAY:
                                  v -- 3KHz        v -- 5KHz
|=================================&gt;                                        
</code></pre></div>
<p>Again, tune R36 until the input level matches 3kHz (since that is the deviation you are feeding in to the receiver).</p>
<h2 id="voter-rtcm-hardware-transmit-level-calibration">Transmit Level Calibration</h2>
<p>Transmit output level is adjusted with R10. Transmit Level Calibration is *<em>not</em> required for satellite receiver sites, obviously.</p>
<p>See the <a href="#voter-voter-audio">VOTER Audio</a> page for considerations when it comes to connecting the transmit audio to your transmitter, and for level setting instructions.</p>
<h2 id="voter-rtcm-hardware-console-connection">Console Connection</h2>
<p>Serial Console access is provided by an RS-232 serial port (J2 pins 2, 3, and 5) at 57600 baud, 8 bits, No parity, 1 Stop Bit. It is also made available remotely (off-board) via TELNET. When TELNET-ing the default user is <code>admin</code> and the password is <code>radios</code>. </p>
<div class="highlight"><pre><span></span><code>VOTER System Serial # 1234 Remote Console Access

Login: admin
Password: radios

Logged in successfully, now joining console session...
</code></pre></div>
<p>When done with the console session, please use the <code>q</code> command to disconnect. The local serial port and the TELNET (remote) user share the same (and only) console session.</p>
<h3 id="voter-rtcm-hardware-console-menus">Console Menus</h3>
<p>For a thorough explanation of the different menus, see the <a href="#voter-voter-menus">VOTER Menus</a> page.</p>
<h3 id="voter-rtcm-hardware-debug-options">Debug Options</h3>
<p>The VOTER/RTCM firmware supports some additional debugging information that can be turned on.</p>
<p>From the source code, the different Debug Options are listed as:</p>
<div class="highlight"><pre><span></span><code>1 - Alt/Main Host change notifications
2 - Ignore HWlock (GGPS only)
4 - GPS/PPS Failure simulation (GGPS only)
8 - POCSAG H/W output disable (GGPS only)
16 - IP TOS Class for Ubiquiti
32 - GPS Debug
64 - Fix GPS 1 second off
</code></pre></div>
<p>Not sure what they all do, but that is what they are. Here are the most common ones used:</p>
<ul>
<li><code>Alt/Main Host change notifications</code> shows when the connection to the Asterisk server changes state (when configured for redundant servers).</li>
<li><code>IP TOS Class for Ubiquity</code> in firmware &gt;2.00, this <strong>disables</strong> marking the IP headers from the RTCM/VOTER <strong>TO</strong> the network with ToS C0/DSCP 48 (UBNT shows this as 802.1p Class 6 (Voice &lt;10mS latency). Other sources show this as a Network Control TOS.) If you are using TOS, you also will want to have <code>utos=y</code> in your <a href="#config-voter_conf"><code>voter.conf</code></a> to mark the packets from the network <strong>TO</strong> the RTCM/VOTER.</li>
<li><code>GPS Debug</code> will print NMEA or TSIP debug strings from the connected GPS.</li>
<li><code>Fix GPS 1 second off</code> this is for NMEA GPS <strong>only</strong>. It will <em>add</em> one second to the time.</li>
</ul>
<p>The way this works is you add together the options you want to enable (it is a bitmask), and set the debug level accordingly.</p>
<p>For example, if you want to enable GPS Debug and disable IP ToS, set debug to 48.</p>
<p>If you just want to turn on GPS Debug, set debug to 32.</p>
<p>If you just want TOS disabled, set debug to 16.</p>
<p>Set debug back to 0 to clear all debug settings.</p>
<h2 id="voter-rtcm-hardware-radio-connections">Radio Connections</h2>
<p>Here are some example connections for various radios.</p>
<h3 id="voter-rtcm-hardware-motorola-quantar">Motorola Quantar</h3>
<p>See <a href="../voter/assets/QUANTAR-RTCM_INTERFACE_CABLE.pdf">here</a> or <a href="../voter/assets/RTCM_2_Quantar.pdf">here</a></p>
<h3 id="voter-rtcm-hardware-motorols-astro-tac-receiver">Motorols Astro-TAC Receiver</h3>
<p>An Astro-TAC receiver utilizes the same receiver as the Quantar. See <a href="../voter/assets/RTCM_to_Astro-TAC_Cable.pdf">here</a> for how to interface the RTCM to the Astro-TAC shelf to use it as a satellite receiver.</p>
<h3 id="voter-rtcm-hardware-vertex-vrx-5000">Vertex VRX-5000</h3>
<p>See <a href="../voter/assets/RTCM_2_VRX-5000.pdf">here</a> for how to connect to a Vertex VRX-5000.</p>
<h3 id="voter-rtcm-hardware-rtcm-to-bg7tbl-gpsdo">RTCM to BG7TBL GPSDO</h3>
<p>See <a href="../voter/assets/RTCM_to_BG7TBL_Cable.pdf">here</a> for how to connect the RTCM to a BG7TBL GPSDO.</p>
<h3 id="voter-rtcm-hardware-dual-rtcms-to-trimble-gpsdo-and-lady-heather">Dual RTCM's to Trimble GPSDO and Lady Heather</h3>
<p>See <a href="../voter/assets/RTCM_321_Cable.graffle.pdf">here</a> for an example of how to connect a Trimble GPSDO to two RTCMs, as well as to a PC running Lady Heather for monitoring.</p>
<p>Or, if you just want to connect a Trimble GPSDO to an RTCM directly, see <a href="../voter/assets/RTCM_2_Trimble.pdf">here</a>.</p></section><section class="print-page" id="voter-voter-hardware"><h1 id="voter-voter-hardware-voter-hardware">VOTER Hardware</h1>
<p>This is the documentation page to support the through-hole implementation of the VOTER Hardware Client.</p>
<div class="grid">
<p><a class="glightbox" href="../voter/img/1599px-Voter-assy-trim.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER PCB" src="../voter/img/1599px-Voter-assy-trim.png" /></a></p>
<p><a class="glightbox" href="../voter/img/Voterr-reva.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER ASSY" src="../voter/img/Voterr-reva.jpg" /></a></p>
</div>
<p>See the <a href="#voter-about-voter">About</a> page for more information on the background/history. If you have bought or built a through-hole VOTER, this page is for you. If you have an <a href="http://www.micro-node.com/thin-m1.shtml">RTCM</a>, then you will want to reference the <a href="../voter/assets/rtcm_manual.pdf">user manual</a> for the RTCM or our <a href="#voter-rtcm-hardware">RTCM Hardware</a> page. That said, most of the information here should be applicable too.</p>
<p>The Micro-Node <a href="#voter-rtcm-hardware">RTCM</a> and VOTER interfaces are typically used with AllStarLink in voting/simulcast applications. They <strong>may</strong> be used for <strong>ANY</strong> repeater interface application, through the <code>chan_voter</code> channel driver, as they are primarily a Radio over IP (RoIP) adapter. </p>
<h2 id="voter-voter-hardware-firmware">Firmware</h2>
<p>See the <a href="#voter-voter-firmware">VOTER Firmware</a> page for information on upgrading the firmware.</p>
<p>If you are building your own VOTER, or for some reason you need to replace U6, you will want to program in the bootloader in to the dsPIC to allow for remote firmware upgrades. See the <a href="#voter-voter-firmware-bootloader-installation">Bootloader section</a> on how to do that.</p>
<h2 id="voter-voter-hardware-board-layout">Board Layout</h2>
<p>The through-hole board typically looks like this:</p>
<div class="grid">
<p><a class="glightbox" href="../voter/img/1599px-Voter-assy-trim.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER PCB" src="../voter/img/1599px-Voter-assy-trim.png" /></a></p>
<p><a class="glightbox" href="../voter/img/Voterr-reva.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VOTER ASSY" src="../voter/img/Voterr-reva.jpg" /></a></p>
</div>
<h2 id="voter-voter-hardware-connectors">Connectors</h2>
<div class="highlight"><pre><span></span><code>J1 - 6 pin MTA-100 connector for PIC programmer (PICKit3 or equivalent). A reset switch may be placed across pins 1 and 3.
J2 - Ethernet (10-Base-T).
J3 - RS-232 (console 57600 bps 8N1, DCE)
J4 - 5 pin MTA-100 connector for GPS (see below for pinout).
P1 - Radio Connector (9 pin D-shell Male) (see below for pinout).
</code></pre></div>
<h3 id="voter-voter-hardware-p1-radio-connector-pinout-db9-male">P1 - Radio Connector Pinout (DB9 Male)</h3>
<div class="highlight"><pre><span></span><code>1 - + VIn (6.5-30 Volts DC).
2 - Transmit Audio Out
3 - Receive (discriminator) Audio In
4 - External CTCSS Input (optional)
5 - Gnd
6 - Gnd
7 - /PTT Out (open-collector, active-low)
8 - Gnd
9 – Gnd
</code></pre></div>
<h3 id="voter-voter-hardware-j4-gps-connector-5-pin-mta-100-male-pinout">J4 - GPS Connector (5 Pin MTA-100 Male) Pinout</h3>
<div class="highlight"><pre><span></span><code>1 - Gnd
2 - 5 Volts DC Out (to power GPS device)
3 - GPS TXD (Gnd, actually)
4 - GPS RXD (in)
5 - GPS PPS (in)
</code></pre></div>
<h2 id="voter-voter-hardware-led-designations">LED Designations</h2>
<p>LED designations (shown from right to left along front of VOTER board, see photo above):</p>
<div class="highlight"><pre><span></span><code>LED1 - (Green) System Activity Indicator (should toggle every 500ms)
LED5 - (Red) Transmit Indicator
LED2 - (Green) Receive Signal Indicator (solid green is valid Rx signal, flashing is signal without CTCSS)
LED3 - (Yellow) GPS Indicator (sold is GPS received and locked, flashing is GPS received, lock in progress)
LED4 - (Yellow) Connection Indicator (indicates that connection was made with VOTER host)
</code></pre></div>
<p>The COS (RX) LED on the VOTER will flash (same rate as Activity LED) if you have External CTCSS enabled, and the received signal has the wrong (or no) valid PL.</p>
<h2 id="voter-voter-hardware-jumpers">Jumpers</h2>
<div class="highlight"><pre><span></span><code>JP1  - Discriminator Level Boost
JP2  - 20dB Pad
JP3  - Output Amp Power Source
JP7  - Bootloader Programming
JP8  - Initialize EEPROM
JP9  - Squelch Calibration
JP10 - Diode Calibration
JP11 - LED3/4 Receiver Level Mode
</code></pre></div>
<h3 id="voter-voter-hardware-jp1-discriminator-level-boost">JP1 - Discriminator Level Boost</h3>
<p>Insert if low discriminator level. If squelch cannot self-calibrate with JP1 removed (too low), try with JP1 inserted.</p>
<div class="admonition note">
<p class="admonition-title">Level Boost</p>
<p>This jumper affects the squelch calibration circuit only. Not to be confused with JP2, which is the pad for the receive audio.</p>
</div>
<h3 id="voter-voter-hardware-jp2-20db-pad">JP2 - 20dB Pad</h3>
<p>Insert to attenuate discriminator input level by 20db. This pad affects the <strong>receive audio level</strong>. See the <a href="#voter-voter-hardware-receive-level-input-calibration">Receive Level Input Calibration</a> section.</p>
<h3 id="voter-voter-hardware-jp3-output-amp-power-source">JP3 - Output Amp Power Source</h3>
<p>Selects power source for output audio amplifier. 1-2 is to power it from the 5VDC power supply. 2-3 is to power it directly from Vin. </p>
<div class="admonition danger">
<p class="admonition-title">Do Not Change With Power On</p>
<p>DO <strong><em>NOT</em></strong> CHANGE THIS JUMPER WITH POWER ON. DAMAGE MAY OCCUR IF YOU DO!</p>
</div>
<h3 id="voter-voter-hardware-jp7-bootloader-programming">JP7 - Bootloader Programming</h3>
<p>This jumper only needs to be removed when programming the bootloader in the dsPIC using the ICSP header.</p>
<h3 id="voter-voter-hardware-jp8-initialize-eeprom">JP8 - Initialize EEPROM</h3>
<p>Initialize the configuration parameters in EEPROM (factory reset). If JP8 is inserted when firmware starts, the operating parameters in the EEPROM will be set to default values. The system activity LED (LED1, Green) will stay off for approximately 4 seconds, then stay on steady to indicate that the initialization process is complete. Afterwards, the jumper may be removed and the system will continue running as usual.</p>
<div class="admonition note">
<p class="admonition-title">Diode Calibration</p>
<p>If JP10 is also inserted during this procedure, the "Diode Calibration" process will also occur.</p>
</div>
<h3 id="voter-voter-hardware-jp9-squelch-calibration">JP9 - Squelch Calibration</h3>
<p>Insert to calibrate squelch. See <a href="#voter-voter-hardware-squelch-calibration-and-setting">Squelch Calibration and Setting</a> below. </p>
<h3 id="voter-voter-hardware-jp10-diode-calibration">JP10 - Diode Calibration</h3>
<p>Insert to perform "Diode Calibration". This is a form of temperature compensation, where a power supply voltage is sampled that is dependent on the temperature coefficient of a diode (D5).</p>
<p>This may only be done in conjunction with an EEPROM Initialization (see JP8, above), or a Squelch Calibration (see JP9, above).</p>
<h3 id="voter-voter-hardware-jp11-led34-receiver-level-mode">JP11 - LED3/4 Receiver Level Mode</h3>
<p>Insert this jumper to temporarily re-purpose LED3 and LED4 to allow for visual indication of RX input level (see <a href="#voter-voter-hardware-receive-level-input-calibration">Receive Level Input Calibration</a> below). Alternatively, you can use <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a>.</p>
<h2 id="voter-voter-hardware-potentiometers">Potentiometers</h2>
<div class="highlight"><pre><span></span><code>R22 - Squelch adjustment
R36 - Rx Input Level
R61 - Tx Output Level
</code></pre></div>
<h2 id="voter-voter-hardware-initialization">Initialization</h2>
<p>Once you have verified that the firmware is running, place a jumper shunt on JP8 and JP10. </p>
<p>Be sure to do this at a reasonable human room temperature (like 60-80 deg. F). This is necessary because this procedure initializes the operating parameters in the EEPROM and also does a temperature compensation diode calibration, which <em>needs</em> to happen at room temperature. </p>
<p>Once the jumper shunts have been installed, power-cycle the board and wait for the system activity light to come on <strong>steady</strong> (about 4 seconds or so after the 5 second initial wait time).</p>
<p>Then, <strong>remove</strong> the jumper shunts, and proceed with <a href="#voter-voter-hardware-squelch-calibration-and-setting">Squelch Calibration and Setting</a>.</p>
<h2 id="voter-voter-hardware-squelch-calibration-and-setting">Squelch Calibration and Setting</h2>
<p>With the receiver connected and its antenna removed, insert JP9. In the next few seconds the "Receive Signal Indicator" (LED2, green) will flash on and off, then (hopefully) on steady. </p>
<p>This indicates that the squelch calibration has occurred successfully. </p>
<p>If unsuccessful, the LED will flash either <strong>fast</strong> to indicate that the discriminator noise level is too <strong>high</strong>, or <strong>slowly</strong> to indicate that the discriminator noise level is too <strong>low</strong>. If the discriminator level is too low, try inserting JP1 and try again.</p>
<div class="admonition note">
<p class="admonition-title">Diode Calibration</p>
<p>If JP10 is inserted during this procedure, the "Diode Calibration" process will also occur.</p>
</div>
<p>If you still have troubles calibrating the squelch, you may need to try the <a href="#voter-voter-audio-dspbew-firmware-version">Baseband Examination Window (BEW)</a> firmware.</p>
<p>When Squelch Calibration has been completed, <strong>remove</strong> JP9.</p>
<p>Once the Squelch Calibration procedure has been performed, the squelch adjustment (R22) needs to be properly set. Make sure that the "External CTCSS" is set to "ignore" (value: 0).</p>
<div class="highlight"><pre><span></span><code>12 - External CTCSS (0=Ignore, 1=Non-Inverted, 2=Inverted) (0)
</code></pre></div>
<p>Adjust R22 until the Receive Signal Indicator (LED2) is lit. Then, advance R22 clockwise until LED2 is no longer lit. That is the minimum squelch setting. You probably will want to crank it up at least another turn clockwise, because if you leave it there it will open on a REALLY low level signal.</p>
<p>After proper setting has been achieved, return the "External CTCSS" configuration to its original setting.</p>
<p><a href="#voter-voter-menus-98-status-display">Menu 98</a> will show the settings of the Squelch Calibration, Diode Calibration, and Squelch Levels:</p>
<div class="highlight"><pre><span></span><code>Squelch Noise Gain Value: 45, Diode Cal. Value: 60, SQL Level 675, Hysteresis 10
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Software Squelch</p>
<p>Firmware &gt;3.00 allows for the option to set the squelch via software, after initially setting it with the hardware potentiometer to get a baseline level. See the <a href="#voter-voter-menus-s-squelch-parameters-menu">Squelch Parameters Menu</a>.</p>
</div>
<h2 id="voter-voter-hardware-receive-level-input-calibration">Receive Level Input Calibration</h2>
<p>See the <a href="#voter-voter-audio">VOTER Audio</a> page for additional considerations when it comes to connecting the VOTER to your receiver, and for level setting instructions.</p>
<p>Place a full-quieting saturated signal on the receiver, modulated by 1000 Hertz sine wave at 3kHz deviation. </p>
<p>With JP11 inserted, LED3 will indicate (by brightness) if the RX level is too low, and LED4 will indicate (by brightness) if the RX level is too high. So the idea is to tune R36 so that there is minimal brightness on both LED3 and LED4 (like a null, more or less). <strong>Remove</strong> JP11, when complete.</p>
<p>Alternatively, <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a> from the console menu gives a more graphical method of setting the receiver input level:</p>
<div class="highlight"><pre><span></span><code>RX VOICE DISPLAY:
                                  v -- 3KHz        v -- 5KHz
|=================================&gt;                                        
</code></pre></div>
<p>Again, tune R36 until the input level matches 3kHz (since that is the deviation you are feeding in to the receiver).</p>
<h2 id="voter-voter-hardware-transmit-level-calibration">Transmit Level Calibration</h2>
<p>Transmit output level is adjusted with R63. Transmit Level Calibration is *<em>not</em> required for satellite receiver sites, obviously.</p>
<p>See the <a href="#voter-voter-audio">VOTER Audio</a> page for considerations when it comes to connecting the transmit audio to your transmitter, and for level setting instructions.</p>
<h2 id="voter-voter-hardware-console-connection">Console Connection</h2>
<p>Serial Console access is provided by an RS-232 serial port (J3) at 57600 baud, 8 bits, No parity, 1 Stop Bit. It is also made available remotely (off-board) via TELNET. When TELNET-ing the default user is <code>admin</code> and the password is <code>radios</code>. </p>
<div class="highlight"><pre><span></span><code>VOTER System Serial # 1234 Remote Console Access

Login: admin
Password: radios

Logged in successfully, now joining console session...
</code></pre></div>
<p>When done with the console session, please use the <code>q</code> command to disconnect. The local serial port and the TELNET (remote) user share the same (and only) console session.</p>
<h3 id="voter-voter-hardware-console-menus">Console Menus</h3>
<p>For a thorough explanation of the different menus, see the <a href="#voter-voter-menus">VOTER Menus</a> page.</p>
<h3 id="voter-voter-hardware-debug-options">Debug Options</h3>
<p>The VOTER/RTCM firmware supports some additional debugging information that can be turned on.</p>
<p>From the source code, the different Debug Options are listed as:</p>
<div class="highlight"><pre><span></span><code>1 - Alt/Main Host change notifications
2 - Ignore HWlock (GGPS only)
4 - GPS/PPS Failure simulation (GGPS only)
8 - POCSAG H/W output disable (GGPS only)
16 - IP TOS Class for Ubiquiti
32 - GPS Debug
64 - Fix GPS 1 second off
</code></pre></div>
<p>Not sure what they all do, but that is what they are. Here are the most common ones used:</p>
<ul>
<li><code>Alt/Main Host change notifications</code> shows when the connection to the Asterisk server changes state (when configured for redundant servers).</li>
<li><code>IP TOS Class for Ubiquity</code> in firmware &gt;2.00, this <strong>disables</strong> marking the IP headers from the RTCM/VOTER <strong>TO</strong> the network with ToS C0/DSCP 48 (UBNT shows this as 802.1p Class 6 (Voice &lt;10mS latency). Other sources show this as a Network Control TOS.) If you are using TOS, you also will want to have <code>utos=y</code> in your <a href="#config-voter_conf"><code>voter.conf</code></a> to mark the packets from the network <strong>TO</strong> the RTCM/VOTER.</li>
<li><code>GPS Debug</code> will print NMEA or TSIP debug strings from the connected GPS.</li>
<li><code>Fix GPS 1 second off</code> this is for NMEA GPS <strong>only</strong>. It will <em>add</em> one second to the time.</li>
</ul>
<p>The way this works is you add together the options you want to enable (it is a bitmask), and set the debug level accordingly.</p>
<p>For example, if you want to enable GPS Debug and disable IP ToS, set debug to 48.</p>
<p>If you just want to turn on GPS Debug, set debug to 32.</p>
<p>If you just want TOS disabled, set debug to 16.</p>
<p>Set debug back to 0 to clear all debug settings.</p></section><section class="print-page" id="voter-voter-firmware"><h1 id="voter-voter-firmware-voterrtcm-firmware">VOTER/RTCM Firmware</h1>
<p>The firmware in the VOTER and RTCM is the same, except it is compiled for the specific dsPIC that is installed in each. As such, the firmware is specific to the VOTER or the RTCM, and is <strong>NOT</strong> interchangeable (it <strong>won't</strong> boot in the wrong device). Firmware specific for the RTCM is denoted by <em>-smt</em> in the filename.</p>
<p>The VOTER uses a dsPIC33FJ128GP80<strong>2</strong> and the RTCM uses a dsPIC33FJ128GP80<strong>4</strong>. There is different peripheral mapping between the two.</p>
<p>There are <strong>two parts</strong> to the firmware, a <em>bootloader</em>, and then the actual <em>firmware</em> file. The bootloader starts when power is applied, and allows you to talk to the dsPIC and load new firmware files over ethernet. If the bootloader is not intercepted by the loading tool, it will continue to boot the current firmware file.</p>
<p>All new boards will need to have the bootloader installed first, followed by a firmware file. You <strong>can</strong> load a firmware file directly (.hex) in to the dsPIC, but then you will not have any of the bootloader remote loading features. Unless you have to change the main processor dsPIC, you should not need to worry about the bootloader.</p>
<h2 id="voter-voter-firmware-firmware-upgrading">Firmware Upgrading</h2>
<p>The VOTER/RTCM tries to update it's firmware every time it boots as part of the bootloader process. The bootloader has it's own IP address which is set by menu <code>14</code> of the <code>(i) IP parameters menu</code>.</p>
<div class="highlight"><pre><span></span><code>IP Parameters Menu

Select the following values to View/Modify:

1  - (Static) IP Address (192.168.1.124)
2  - (Static) Netmask (255.255.255.0)
3  - (Static) Gateway (192.168.1.254)
4  - (Static) Primary DNS Server (8.8.8.8)
5  - (Static) Secondary DNS Server (0.0.0.0)
6  - DHCP Enable (0)
7  - Telnet Port (23)
8  - Telnet Username (admin)
9  - Telnet Password (radios)
10 - DynDNS Enable (0)
11 - DynDNS Username (wb6nil)
12 - DynDNS Password (radios42)
13 - DynDNS Host (voter-test.dyndns.org)
14 - BootLoader IP Address (192.168.1.11) (OK)
15 - Ethernet Duplex (0=Half, 1=Full) (1)
99 - Save Values to EEPROM
x  - Exit IP Parameters Menu (back to main menu)
q  - Disconnect Remote Console Session, r - reboot system
</code></pre></div>
<p>The default bootloader IP address is <code>192.168.1.11</code>. If that address fits in your network you can leave it there for all the VOTERs/RTCMs on your LAN as it is active only during the bootloader process.</p>
<p>If you are updating an VOTER/RTCM which is behind a firewall, you will need to port forward <code>16388/UDP</code> to the bootloader IP address. If you leave all your bootloaders on the same IP address, then you won't have to change the forwarding to update different clients.</p>
<p>The VOTER/RTCM firmware is updated with a Windows program called <code>EBLEX C3 Programmer</code>. Download from <a href="https://github.com/AllStarLink/Voter/tree/master/EBLEX%20C30%20Programmer">here</a>. Put both the <code>exe</code> and the <code>ini</code> file in a folder.</p>
<p>There are multiple "flavors" of firmware available.</p>
<p>The <code>DSPBEW</code> versions have Jim's DSP/BEW feature enabled. Note that due to the size of this feature, the diagnostics menu is <strong>NOT</strong> available in this version.</p>
<p>If you are upgrading an RTCM <em>be sure to use a <code>.cry</code> file that contains <code>smt</code> in the filename</em>. </p>
<p>If you are upgrading a through-hole VOTER, <strong>do not</strong> use the <code>smt</code> files. </p>
<p>Save the <code>.cry</code> file in the folder with the <code>.exe</code> and <code>.ini</code> files.</p>
<p>Download the firmware from the <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER_RTCM-firmware">AllStarLink GitHub Repository</a> that is appropriate for your application. </p>
<p>Run the EBLEX Programmer:</p>
<p><a class="glightbox" href="../voter/img/ENC_Loader.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="ENC Loader" src="../voter/img/ENC_Loader.png" /></a></p>
<ul>
<li>Fill in the target <code>bootloader IP address</code> (or the public IP, if your VOTER/RTCM is behind a firewall) of the device</li>
<li>Click <code>File</code> and load the <code>.cry</code> file you are going to program</li>
</ul>
<p><a class="glightbox" href="../voter/img/ENC_Loader2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="ENC Loader2" src="../voter/img/ENC_Loader2.png" /></a></p>
<ul>
<li>Click the <code>Capture Target</code> button</li>
<li><strong>Reboot</strong> the VOTER/RTCM with TELNET (<code>r</code> option), power cycle, or use the reset button. In a moment you should see text come up on the programmer that it captured the target</li>
<li>Click the <code>Program</code> button</li>
<li>In a few minutes you will see some more messages including a program complete message</li>
<li>Click the <code>Reset LIA</code> button. The VOTER/RTCM will restart with the new firmware</li>
</ul>
<p>TELNET into your VOTER/RTCM and verify the new version is loaded with menu <code>98</code>:</p>
<div class="highlight"><pre><span></span><code>S/W Version: 3.00 3/24/2021
System Uptime: 1992442.4 Secs
IP Address: 192.168.1.124
Netmask: 255.255.255.0
Gateway: 192.168.1.254
Primary DNS: 8.8.8.8
Secondary DNS: 0.0.0.0
DHCP: 0
VOTER Server IP: 192.168.1.100
VOTER Server UDP Port: 667
OUR UDP Port: 667
GPS Lock: 1
PPS BAD or Wrong Polarity: 0
Connected: 1
COR: 0
EXT CTCSS IN: 0
PTT: 0
RSSI: 0
Current Samples / Sec.: 8000
Current Peak Audio Level: 65528
Squelch Noise Gain Value: 45, Diode Cal. Value: 60, SQL Level 675, Hysteresis 10
Current Time: Sat  Jan 29, 2022  22:21:56.160
Last Ntwk Rx Pkt System time: 01/29/2022 22:20:33.540, diff: 82620 msec
Last Ntwk Rx Pkt Timestamp time: 01/29/2022 22:20:33.540, diff: 0 msec
Last Ntwk Rx Pkt index: 320, inbounds: 1

Press The Any Key (Enter) To Continue
</code></pre></div>
<h2 id="voter-voter-firmware-compiling-environment">Compiling Environment</h2>
<p>Do you want to "roll your own" version of the firmware? Well to do so, you will need to build yourself a compiling environment.</p>
<p>If you look in the original <a href="https://github.com/AllStarLink/Voter/blob/master/docs/votersystem.pdf">votersystem.pdf</a>, you will find a procedure to modify and load the bootloader in to the dsPIC of a VOTER board. </p>
<p>Unfortunately, there is an important step *<em>missing</em> in that procedure, which is covered below.</p>
<p>In addition, the old links for the MPLAB software are dead, so let's update this info and get you going.</p>
<p>Currently (Jan 2022), you can get the required software from:</p>
<ul>
<li><a href="https://www.microchip.com/en-us/tools-resources/archives/mplab-ecosystem">https://www.microchip.com/en-us/tools-resources/archives/mplab-ecosystem</a></li>
</ul>
<p>Download MPLAB IDE 32-bit Windows v8.66:</p>
<ul>
<li><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB_IDE_v8_66.zip">http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB_IDE_v8_66.zip</a></li>
<li><a href="http://dvswitch.org/files/AllStarLink/Voter/MPLAB_IDE_v8_66.zip">http://dvswitch.org/files/AllStarLink/Voter/MPLAB_IDE_v8_66.zip</a></li>
</ul>
<p>Download MPLAB C Compiler for PIC24 and dsPIC DSCs v3.31 <strong><em>NOT v.3.25</em></strong>:</p>
<ul>
<li><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/mplabc30-v3_31-windows-installer.exe">http://ww1.microchip.com/downloads/en/DeviceDoc/mplabc30-v3_31-windows-installer.exe</a></li>
<li><a href="http://dvswitch.org/files/AllStarLink/Voter/mplabc30-v3_31-windows-installer.exe">http://dvswitch.org/files/AllStarLink/Voter/mplabc30-v3_31-windows-installer.exe</a></li>
</ul>
<p>Optionally, install Windows Virtual PC and XP Mode. This is getting to be pretty old software, so running it under XP Mode may be a good idea, so we can keep it isolated (install it in a virtual machine). It does run fine in Windows 7. You're on your own with newer versions of Windows... maybe you want to build XP in a virtual machine?</p>
<p>To setup the compile/build environment, follow these steps:</p>
<ul>
<li>Run the MPLAB IDE installer. You don't need to install the HI-TECH C Compiler at the end (click no)</li>
<li>Run the MPLAB C Compiler installer</li>
<li>Select Legacy Directory Name</li>
<li><strong>Select Lite Compiler</strong></li>
<li>Go to: <a href="https://github.com/AllStarLink">https://github.com/AllStarLink</a></li>
<li>Follow the links to: voter --&gt; Clone or Download --&gt; Branch = Master --&gt; Download Zip. That will get you <code>voter-master.zip</code> which is a download of the whole VOTER tree from GitHub</li>
<li>Extract it somewhere (ie. in the XP Mode Virtual PC)</li>
<li>Launch the MPLAB IDE</li>
<li>Go to Configure --&gt; Settings --&gt; Projects and <em>de-select</em> "one-to-one project mode"</li>
</ul>
<h2 id="voter-voter-firmware-bootloader-installation">Bootloader Installation</h2>
<p>Set up your Compiling Environment (above). You will also need a PICKit2 or PICKit3 interface.</p>
<p>The current bootloader (<code>.cof</code> file) is available <a href="https://github.com/AllStarLink/voter/tree/master/voter-bootloader">here</a> (the <code>-smt</code> file is for the RTCM). It needs to be loaded with a PICKit programmer.</p>
<p>If you need to load the bootloader in to a fresh board, you will need to follow these steps:</p>
<ul>
<li>Go to Project --&gt; Open --&gt; voter-bootloader.mcp --&gt; Open (it is in the voter-bootloader folder of the GitHub source)</li>
<li>Go to File --&gt; Import --&gt; voter-bootloader --&gt; ENC_C30.cof --&gt; Open. <strong><em>This step is missing from the original procedure.</em></strong></li>
<li>Remove <code>JP7</code> on the VOTER Board. This is necessary to allow programming by the PICKit2/PICKit3 device</li>
<li>Attach the PICKIT2/PICKit3 device to <code>J1</code> on the VOTER board. Note that Pin 1 is closest to the power supply modules (as indicated on the board)</li>
<li>If you have not already selected a programming device, go to Programmer --&gt; Select Device and choose PICKit3 (or PICKit2, depending on what you are using)</li>
<li>Go to Programmer --&gt; Program. This will program the bootloader firmware into the PIC device on the board</li>
</ul>
<p>If you want to change the default IP address from 192.168.1.11 in the bootloader:</p>
<ul>
<li>Select View --&gt; Program Memory (from the top menu bar)</li>
<li>Hit Control-F (to "find") and search for the digits "00A8C0"</li>
<li>These should be found at memory address "03018"</li>
</ul>
<p>The "A8C0" at 03018 represents the hex digits C0 (192) and A8 (168) which are the first two octets of the IP address. The six digits to enter are 00 then the SECOND octet of the IP address in hex then the FIRST octet of the IP address in hex.</p>
<p>The "0B01" at 0301A represents the hex digits 0B (11) and 01 (1) which are the second two octets of the IP address. The six digits to enter are 00 then the FOURTH octet of the IP address in hex then the THIRD octet of the IP address in hex.</p>
<p>Once you have modified the address to your desired IP, follow the programming procedure (above).</p>
<h2 id="voter-voter-firmware-compiling-firmware">Compiling Firmware</h2>
<p>To compile the firmware (if you want to make custom changes):</p>
<ul>
<li>Go to Project --&gt; Open --&gt; navigate to build-files and open the <code>.mcp</code> file for the flavor of firmware you want to compile. They are in the VOTER_RTCM-firmware folder of the GitHub source.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>.mcp</code> files with the "smt" suffix are for the RTCM (built with SMT parts). The non-smt files are for the ORIGINAL through-hole VOTER boards. The difference is that the VOTER uses a dsPIC33FJ128GP802 and the RTCM uses a dsPIC33FJ128GP804.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to compile the DSP/BEW version, make sure to open the appropriate <code>.mcp</code> file for that project.</p>
</div>
<ul>
<li>Go to Project --&gt; Build Configuration and select "Release". This may not be necessary (I don't believe that option is used in the firmware), but it removes the compiler option of __DEBUG being passed, so theoretically it would build "normal" firmware.</li>
<li>Go to Configure --&gt; Select Device and choose the appropriate device for your board from the Device list. If you don't select the right one, the board will not boot. Select dsPIC33FJ128GP802 for the VOTER, and dsPIC33FJ128GP804 for the RTCM.</li>
<li>Now, if you go to Project --&gt; Build All it should compile everything and show you "Build Succeeded"</li>
</ul>
<p>A <code>.cry</code> file should be in the board-firmware folder. You can load this with the ENC Loader.</p>
<p>There is also a <code>.hex</code> file in there that you could load with a programmer... but that would wipe the bootloader... so don't do that.</p></section><section class="print-page" id="voter-voter-gps"><h1 id="voter-voter-gps-voter-gps-requirements">VOTER GPS Requirements</h1>
<p>This page will outline the requirements and troubleshooting for using a GPS with the RTCM/VOTER.</p>
<h2 id="voter-voter-gps-gps">GPS</h2>
<p>The RTCM/VOTER will work with most GPS available. It requires either NMEA or Trimble TSIP binary data. It only receives data <strong>from</strong> the GPS (GPS TX), it does not send anything <strong>to</strong> the GPS.</p>
<div class="admonition note">
<p class="admonition-title">Voting and Simulcast</p>
<p>If you are planning on doing voting and/or simulcast, your GPS also needs to have a "Pulse-per-second" (PPS) output.</p>
</div>
<p>The RTCM/VOTER firmware is specifically written to talk to Trimble Thunderbolt receivers using Trimble's TSIP binary data interface, however, other Trimbles GPS receivers that talk TSIP are generally compatible. There are some specific <em>hacks</em> that have now been added to the firmware to work with the Thunderbolt to overcome <em>week number rollover</em> issues.</p>
<h2 id="voter-voter-gps-nmea-sentences">NMEA Sentences</h2>
<p>If you are using an NMEA GPS (as opposed to a Trimble using the TSIP binary interface), the RTCM/VOTER is looking for the following NMEA sentences:</p>
<div class="highlight"><pre><span></span><code>$GPGGA
$GPGSV
$GPRMC
</code></pre></div>
<p>It wants <code>$GPGSV</code> to see the number of satellites in view is <code>&gt;0</code> (determines whether we are getting any GPS data).</p>
<p>It uses <code>$GPRMC</code> to get the timestamp.</p>
<p>It uses <code>$GPGGA</code> to determine whether we have a valid GPS fix, and get the latitude/longitude/altitude.</p>
<h2 id="voter-voter-gps-trimble-tsip-packets">Trimble TSIP Packets</h2>
<p>The VOTER/RTCM when in TSIP mode (Trimble), assumes it is a Trimble Thunderbolt and is looking for two packets:</p>
<p><div class="highlight"><pre><span></span><code>0x8F-AB - Primary Timing Packet
0x8F-AC - Supplemental Timing Packet
</code></pre></div>
Grab a copy of the <a href="../voter/assets/Thunderbolt-2012-02.pdf">Thunderbolt User Guide</a>.</p>
<p>Pages 78-83 are the important ones.</p>
<p>Packet 0x8F-AB is what grabs the timing information, and packet 0x8F-AC is what is used for everything else (including debug).</p>
<h2 id="voter-voter-gps-rtcm-gps-connections">RTCM GPS Connections</h2>
<p>There are some quirks specific to the RTCM that are not well documented.</p>
<p>The GPS connections for the RTCM are on the DB15 connector. Note that the labels for <code>GTX</code> and <code>GRX</code> are misleading. <code>GTX</code> is the data <strong>FROM</strong> the GPS <strong>TO</strong> the RTCM (GPS TX/RTCM RX). <code>GRX</code> is data from the RTCM to the GPS, but that is currently not used, so it does not need to be connected.</p>
<p><code>PPS</code> is obvious, that is your PPS signal from your GPS.</p>
<p>Also note, inside the RTCM, there are <a href="#voter-rtcm-hardware-jumpers">jumpers</a> to set for TTL or RS-232 data, depending on the type of GPS you are connecting. Set them accordingly. The RS-232 setting loops the data through a MAX3232 converter on the board.</p>
<p>You will still need to set the data and PPS polarity, and baud rate in the <a href="#voter-voter-menus">configuration menus</a> to get everything to work.</p>
<h2 id="voter-voter-gps-gps-lock">GPS Lock</h2>
<p>The GPS LED will go solid regardless of the connection LED. That <strong>has</strong> to happen or it won't connect to the Asterisk server. </p>
<p>It is not unusual for it to take up to 20 mins to get a GPS lock LED (ie. using a Trimble Thunderbolt) after any reboot. It is highly dependent on how long your GPS takes to lock up, whether it has a current almanac, etc. </p>
<h2 id="voter-voter-gps-gps-issues">GPS Issues</h2>
<h3 id="voter-voter-gps-gps-desense">GPS Desense</h3>
<p>If you are having odd loss of lock issues (or can't get/maintain lock), consider you may have interference to your GPS antenna from strong RF nearby. A note from Jesse Lloyd:</p>
<div class="highlight"><pre><span></span><code>I also had crazy problems with poor signal on my GPS when I set it up sitting in a window, and once installed at site I had the GPS antenna maybe 6 ft from the VHF antenna, and after some troubleshooting found it was getting swamped with RF and loosing lock. 

I found the debug setting of 32 useful in the RTCM, you can see a hex output of the GPS status.  
</code></pre></div>
<p>If you are in a known high-RF environment (lots of co-located transmitters, broadcast, etc.), you will probably be disappointed if you try using a cheap patch antenna. You will need to get a decent active antenna that also has a built-in bandpass filter for the L1 frequency. Most commercial (surplus or otherwise) antennas fit this category.</p>
<h3 id="voter-voter-gps-trimble-thunderbolt">Trimble Thunderbolt</h3>
<p>You may find your Trimble Thunderbolt is showing the incorrect date at the moment. It could be showing the year as 1997. This is due to the date in the Thunderbolt being reported incorrectly.</p>
<p><strong>This can cause some of your voting receivers to not connect, if they are used with other GPS in your system.</strong> If you have <strong>ALL</strong> Thunderbolts, or <strong>NO</strong> Thunderbolts, you are probably fine. If you have <strong>ALL</strong> Thunderbolts, the date/time is probably wrong, but they will ALL be wrong, so they will connect.</p>
<p>GPS Time is a continuous counting time scale beginning at the January 5, 1980 to January 6, 1980 midnight. It is split into two parts: a time of week measured in seconds from midnight Sat/Sun, and a week number. The time of week is transmitted in an unambiguous manner by the satellites, but only the bottom 10 bits of the week number are transmitted. This means that a receiver will see a week number count that goes up steadily until it reaches 1023 after which it will “roll over” back to zero, before steadily going up again. Such a week rollover will occur approx. every 20 years. A GPS week rollover occurred in 1999 and another one happened in 2019.</p>
<p>The Thunderbolt manual states:</p>
<p><em>"The ThunderBolt adjusts for this week rollover by adding 1024 to any week number reported by GPS which is less than week number 936 which began on December 14, 1997. With this technique, the ThunderBolt will provide an accurate translation of GPS week number and TOW to time and date until July 30, 2017."</em></p>
<p>As such, the Trimble Thunderbolt has a firmware issue with the GPS Week rollover that manifested itself on July 30, 2017, causing the date to become incorrect. The Thunderbolt thinks the week changed from 935 to 936 (actual week 1959-1024=935), so it stopped adding 1024 to the week.</p>
<p>We have added a brute-force fix starting in RTCM/VOTER firmware &gt;=1.51. This fix adds 619315200 seconds (1024 weeks) to the time reported by the GPS. It fixes the Thunderbolts, we have not done extensive testing to see how it affects other TSIP receivers.</p>
<p>That was fine until the week in the Thunderbolt hit the next rollover... when it rolled back to week 0, so additional checks were added, and now we have to add 2048 weeks (since the current GPS week is &gt;2048). Hopefully, by the time November 21, 2038 rolls around, all the Thunderbolts will have had their OCXO's drift too far to correct, and will be turned in to pop cans. </p>
<h3 id="voter-voter-gps-garmin">Garmin</h3>
<h4 id="voter-voter-gps-garmin-18x-lvc-wiring-issues">Garmin 18x LVC Wiring Issues</h4>
<p>If you have issues with your GPS 18x LVC not talking to the VOTER/RTCM, it may not be hooked up to the VOTER/RTCM correctly. </p>
<p>The Garmin pin labeling is backwards to what you may think. See below. You probably need to swap pins 6 and 14.</p>
<div class="highlight"><pre><span></span><code>RTCM                     GPS 18x LVC      
6 GRX   &lt;-- Rx Data      6 Green  
7 GPPS  &lt;-- Pulse Output 1 Yellow  
8 GND   Ground           3 Black  
8 GND   Ground           5 Black  
13 +5V  --&gt;Vin           2 Red  
14 GTX  --&gt; TX Data      4 White
</code></pre></div>
<p>Log into the VOTER/RTCM and do <code>98</code> and you should see something like this:</p>
<div class="highlight"><pre><span></span><code>Current Time: Sun  Apr 20, 2014  04:37:02.820
Last Rx Pkt System time: 04/20/2014 03:55:35.580, diff: 2487260 msec
Last Rx Pkt Timestamp time: 04/20/2014 03:55:32.064, diff: 3515 msec
Last Rx Pkt index: 160, inbounds: 1
</code></pre></div>
<h4 id="voter-voter-gps-garmin-and-the-rtcm">Garmin and the RTCM</h4>
<p>Beware when buying newer Garmin GPS's to use with the Micro-Node RTCM.</p>
<p>The RTCM expects a 5V PPS signal.</p>
<p>Newer Garmin's (GPS 18X, 18X LVC, etc.) MAY NOT output 5V, and can cause issues. <strong>Check the Garmin datasheet</strong>.</p>
<p>The VOTER is designed to accept both 3.3V or 5V signals, and <em>should</em> work fine.</p>
<h4 id="voter-voter-gps-garmin-speed-issues">Garmin Speed Issues</h4>
<p>Some of the Garmin GPS's come with 4800 baud set as default. If you are getting a "Warning: GPS Data time period elapsed" error on your RTCM, change both the GPS and RTCM to use 9600 baud. </p>
<p>To do this, interface the GPS to a DB9 connector as per Page 9 of the <a href="../voter/assets/GPS_18x_Tech_Specs.pdf"> manual</a> (remembering to ONLY use 5V as the power source <em>facepalm</em>). </p>
<p>Once done, download, extract and open <a href="http://www8.garmin.com/support/download_details.jsp?id=4053">http://www8.garmin.com/support/download_details.jsp?id=4053</a> SNSRXCFG (<a href="../voter/assets/SNSRXCFG_350.exe">local copy</a>) and run.</p>
<ol>
<li>Select your GPS (in most cases GPS 18x PC/LVC). Press F10 to switch to NMEA mode (Config &gt; Switch to NMEA Mode)</li>
<li>Select Config &gt; Setup and choose the COM port your GPS is connected too. Leave baud rate as auto for now, OK</li>
<li>Select Comm &gt; Connect to connect to the GPS</li>
<li>Go to Config &gt; Get Configuration from GPS to download it's current configuration</li>
<li>Click File &gt; Save to save the current configuration</li>
<li>In Config &gt; Sensor Configuration change the Baud Rate to 9600. You can also check to make sure 1PPS is enabled here too. Click OK</li>
<li>Hitting F7 when in the main window of the software also brings up the GPS sentences to output if that is of interest</li>
<li>File &gt; Save to a different file than Step 5</li>
<li>Press F9 or Config &gt; Send Configuration to GPS. This will then send all the changes you made to the GPS unit (including baud rate so a reconnect may be needed)</li>
</ol>
<h3 id="voter-voter-gps-ublox-gps">uBlox GPS</h3>
<p>You can use uBlox GPS modules with the VOTER/RTCM. The ones readily available usually have a 5 pin header on them (5V, GND, TXD, RXD, PPS), as well as an integrated patch antenna, and a SMA connector for an external antenna.</p>
<p>As noted above, beware of desense. You may have variable success using a mag-mount patch antenna. You may want to use a commercial-grade GPS external antenna to benefit from better filtering of the GPS signal.</p>
<p>Data is TTL, so make sure to set the jumpers inside the RTCM for TTL data. Baud rate is 9600 by default, and uses NMEA. Set those accordingly in the configuration menu.</p>
<p>The RTCM and VOTER require different settings for data and PPS polarity. The VOTER wants <strong>inverted</strong> for both, and the RTCM wants <strong>non-inverted</strong> for both.</p>
<p>Make sure to save (<code>99</code>) and reboot (<code>r</code>) your VOTER/RTCM after making changes for them to be effective.</p>
<h2 id="voter-voter-gps-gps-debug">GPS Debug</h2>
<p>To turn on GPS Debugging, set the <code>Debug Option Level</code> in the VOTER/RTCM to <code>32</code>.</p>
<p>See <a href="#voter-voter-hardware-debug-options">Debug levels</a> for more information on how this works.</p>
<h2 id="voter-voter-gps-trimble-debug-status-decoding">Trimble Debug Status Decoding</h2>
<p>The VOTER/RTCM when in TSIP mode (Trimble), assumes it is a Trimble Thunderbolt and is looking for two packets:</p>
<div class="highlight"><pre><span></span><code>0x8F-AB - Primary Timing Packet
0x8F-AC - Supplemental Timing Packet
</code></pre></div>
<p>Grab a copy of the <a href="../voter/assets/Thunderbolt-2012-02.pdf">Thunderbolt User Guide</a>.</p>
<p>Pages 78-83 are the important ones.</p>
<p>Packet 0x8F-AB is what grabs the timing information, and packet 0x8F-AC is what is used for everything else (including debug). Not all bytes are used by all TSIP devices.</p>
<p>Presently, the debug strings that the VOTER/RTCM reports are:</p>
<div class="highlight"><pre><span></span><code>printf(&quot;GPS-DEBUG: gps_epoch_time: %ld, ctime: %s, gps_week: %d\n&quot;,gps_time,ctime((time_t *)&amp;gps_time),gpsweek);

printf(&quot;GPS-DEBUG: TSIP: ok %d, 2,3,9 - 14: %02x %02x %02x %02x %02x %02x %02x %02x\n&quot;,
happy,gps_buf[2],gps_buf[3],gps_buf[9],gps_buf[10],gps_buf[11],gps_buf[12],gps_buf[13],gps_buf[14]);
</code></pre></div>
<p>In real life, this is output like:</p>
<div class="highlight"><pre><span></span><code>Example Unhappy Message:

GPS-DEBUG: gps_epoch_time: 1643742941, ctime: Tue Feb  1 19:15:41 2022
, gps_week: 2195
GPS-DEBUG: TSIP: ok 0, 2,3,9 - 14: 07 00 00 00 00 08 08 00
</code></pre></div>
<p>The <code>gps_epoch_time</code> is GPS time, in seconds since epoch, plus any corrections added (GPS Time Offset, "Fix 1 Second Off" debug code). It <em>should</em> be corrected for any leap seconds (it should be UTC time).</p>
<p>The <code>ctime</code> is conversion of <code>gps_epoch_time</code> into <code>calendar time</code>. It is the human-readable conversion of the <code>gps_epoch_time</code>. </p>
<p>The flag after <code>TSIP: ok</code> is the <code>happy</code> GPS flag. The GPS is flagged as <strong>NOT HAPPY</strong> in TSIP mode if <strong>ANY</strong> of the following are TRUE:</p>
<ul>
<li>If GPS Decoding Status (Byte 12) is anything other than "Doing Fixes"</li>
<li>If Disciplining Activity is not Phase Locking or Recovery Mode</li>
<li>Any Critical Alarms</li>
<li>Any Minor Alarms</li>
</ul>
<p>The other 5 bytes are GPS buffer bytes 2, 3, and 9-14 (in hex). That translates to 0x8F-AC message bytes 1, 2, and 8-13.</p>
<p>Inspecting the rest of the debug string to look at the 0x8F-AC bytes:</p>
<div class="highlight"><pre><span></span><code>Msg:  07   00   00   00   00   08   08   00
Byte: 1    2    8    9    10   11   12   13
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 1 - Receiver Mode
0     Automatic (2D/3D)
1     Single Satellite (Time)
3     Horizontal (2D)
4     Full Position (3D)
5     DGPR Reference
6     Clock Hold (2D)
7     Overdetermined Clock
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 2 - Disciplining Mode
0     Normal (Locked to GPS)
1     Power Up
2     Auto Holdover
3     Manual Holdover
4     Recovery
5     Not Used
6     Disciplining Disabled
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 8/9 - Critical Alarms (MSB/LSB) Bit Masked
0   0   0   0     0   0   0  0     0  0  0  0     0   0   0   0
15  14  13  12    11  10  9  8     7  6  5  4     3   2   1   0 

Bit 4 = DAC at Rail

Therefore, bytes 8/9 will either be 00 00 (all good) or 00 10 (DAC at Rail).
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 10/11 - Minor Alarms (MSB/LSB) Bit Masked
0   0   0   0     0   0   0  0     0  0  0  0     0   0   0   0
15  14  13  12    11  10  9  8     7  6  5  4     3   2   1   0 

Bit 0  = DAC Near Rail
Bit 1  = Antenna Open
Bit 2  = Antenna Shorted
Bit 3  = Not Tracking Satellites
Bit 4  = Not Disciplining Oscillator
Bit 5  = Survey In-progress
Bit 6  = No Stored Position
Bit 7  = Leap Second Pending
Bit 8  = In Test Mode
Bit 9  = Position is Questionable
Bit 10 = Not Used
Bit 11 = Almanac Not Available
Bit 12 = PPS Not Generated
Bit 13-15 = Not Defined

Therefore, 00 08 would be Bit 3 set, which would be Not Tracking Satellites.
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 12 - GPS Decoding Status (result is in hex)
0x00  Doing Fixes
0x01  Don&#39;t Have GPS Time
0x03  PDOP is Too High
0x08  No Usable Sats
0x09  Only 1 Usable Sat
0x0A  Only 2 Usable Sats
0x0B  Only 3 Usable Sats
0x0C  The Chosen Sat is Unusable
0x10  TRAIM Rejected the Fix

To get &quot;happy&quot;, we need 00. Anything else will cause loss of GPS lock. So, a 08 would be No Usable Sats. 
</code></pre></div>
<div class="highlight"><pre><span></span><code>Byte 13 - Disciplining Activity (result is in decimal)
0     Phase Locking
1     Oscillator Warm-up
2     Frequency Locking
3     Placing PPS
4     Initializing Loop Filter
5     Compensating OCXO (Holdover)
6     Inactive
7     Not Used
8     Recovery Mode
9     Calibration/Control Voltage     
</code></pre></div>
<p>Former versions of firmware reported less information: </p>
<div class="highlight"><pre><span></span><code>    printf(&quot;GPS-DEBUG: TSIP: ok %d, 9 - 14: %02x %02x %02x %02x %02x %02x\n&quot;,
                    happy,gps_buf[9],gps_buf[10],gps_buf[11],gps_buf[12],gps_buf[13],gps_buf[14]);
</code></pre></div>
<p>Those reported 0x8F-AC bytes 8-13. See above for a breakdown.</p>
<p>Sample messages:</p>
<div class="highlight"><pre><span></span><code>GPS-DEBUG: TSIP: ok 1, 9 - 14: 00 00 00 00 00 00 - everything is good in the &#39;hood, Doing Fixes, Phase Locking

GPS-DEBUG: TSIP: ok 0, 9 - 14: 00 00 00 18 08 06 - not happy, Not Tracking Satellites, Not Disciplining Oscillator (0x18 --&gt; 0b000000011000), No Usable Sats, Inactive

GPS-DEBUG: TSIP: ok 0, 9 - 14: 00 00 00 08 08 05 - not happy, Not Tracking Satellites, No Useable Sats, Compensating OXCO (holdover)

GPS-DEBUG: TSIP: ok 0, 9 - 14: 00 00 00 00 00 05 - not happy, Compensating OXCO (holdover)

GPS-DEBUG: TSIP: ok 1, 9 - 14: 00 00 00 00 00 08 - happy, Recovery Mode

GPS-DEBUG: TSIP: ok 0, 9 - 14: 00 00 00 00 00 04 - not happy, Initializing Loop Filter
</code></pre></div></section><section class="print-page" id="voter-voter-menus"><h1 id="voter-voter-menus-voterrtcm-hardware-menu-system">VOTER/RTCM Hardware Menu System</h1>
<p>Both the VOTER and the RTCM run the same (similar) firmware. The menus are consistent between them both.</p>
<p>This page <em>should</em> be consistent with the current options available in the current firmware.</p>
<p><strong>BE AWARE</strong> there are some settings that take effect <em>immediately</em>, and others that require you to save settings to EEPROM (99) and reboot (r) for them to take effect. If you are not getting the expected results, this may be the cause. Try a <code>99</code> and <code>r</code> to see if that fixes your situation.</p>
<h2 id="voter-voter-menus-console-access">Console Access</h2>
<p>Serial Console access is provided by an RS-232 serial port at 57600 baud, 8 bits, No parity, 1 Stop Bit. It is also made available remotely (off-board) via TELNET. When TELNET-ing the default user is <code>admin</code> and the password is <code>radios</code>. </p>
<div class="highlight"><pre><span></span><code>VOTER System Serial # 1234 Remote Console Access

Login: admin
Password: radios

Logged in successfully, now joining console session...
</code></pre></div>
<p>When done with the console session, please use the <code>q</code> command to disconnect. The local serial port and the TELNET (remote) user share the same (and only) console session.</p>
<h2 id="voter-voter-menus-main-menu">Main Menu</h2>
<div class="highlight"><pre><span></span><code>Select the following values to View/Modify:

1  - Serial # (1694) (which is MAC ADDR 00:04:A3:00:04:D2)
2  - VOTER Server Address (FQDN) (n0call.dyndns.net)
3  - VOTER Server Port (1667),  4  - Local Port (Override) (0)
5  - Client Password (madcow1),  6  - Host Password (BLAH)
7  - Tx Buffer Length (640)
8  - GPS Data Protocol (0=NMEA, 1=TSIP) (1)
81 - GPS Type (0=Normal TSIP, 1=Trimble Thunderbolt) (0)
82 - GPS Time Offset (seconds to add for correction) (0)
9  - GPS Serial Polarity (0=Non-Inverted, 1=Inverted) (0)
10 - GPS PPS Polarity (0=Non-Inverted, 1=Inverted, 2=NONE) (1)
11 - GPS Baud Rate (9600)
12 - External CTCSS (0=Ignore, 1=Non-Inverted, 2=Inverted) (0)
13 - COR Type (0=Normal, 1=IGNORE COR, 2=No Receiver) (0)
14 - Debug Level (16)
15  - Alt. VOTER Server Address (FQDN) ()
16  - Alt. VOTER Server Port (Override) (0)
17  - DSP/BEW Mode NOT SUPPORTED
18 - &quot;Duplex Mode 3&quot; (0=DISABLED, 1-255 Hang Time) (1/10 secs) (0)
19 - Simulcast Launch Delay (0) (approx 200 ns, 5 = 1us, &gt; 0 to ENA SC)
97 - RX Level,  98 - Status,  99 - Save Values to EEPROM
i - IP Parameters menu, o - Offline Mode Parameters menu, s - Squelch menu
q - Disconnect Remote Console Session, r - reboot system, d - diagnostics

Enter Selection (1-19,81-82,97-99,i,o,s,r,q,d) :
</code></pre></div>
<h3 id="voter-voter-menus-main-menu-options">Main Menu Options</h3>
<ul>
<li><code>1 - Serial #</code>, is an unsigned 16 bit number (0-65535) which defines the last 2 bytes of the MAC address of the ethernet interface. <strong>Be sure that the MAC address of the device is unique on the LAN to which it is connected</strong> (if you have more than one VOTER on the LAN, they <strong>must</strong> each have a different serial number/MAC address)</li>
<li><code>2 - VOTER Server Address (FQDN)</code> is the fully-qualified domain name (FQDN) DNS address, <strong>or</strong> the IP, of the VOTER (AllStarLink) server you want to connect to. If you use the FQDN here, you <strong>must</strong> set at least one DNS server on the IP Parameters menu</li>
<li><code>3 - VOTER Server Port</code> is the UDP port that the VOTER Server is listening on. Remember to add a forwarding rule in your firewall, if you are connecting from outside your LAN (ie. over the Internet). ASL2 used port 667, ASL3 uses 1667 by default</li>
<li><code>4 - Local Port (Override)</code> normally should be <code>0</code>. This allows the specification of a UDP port number for the device to use locally (incoming traffic). If specified as <code>0</code>, it uses the same port as the <code>Voter Server Port</code>. <strong>Not tested</strong>. Presumably, this should allow <em>incoming</em> traffic <strong>to</strong> the VOTER to be on a different port than the standard <code>VOTER Server Port</code>, but it is unclear how the server would be configured to do that</li>
<li><code>5  - Client Password</code> is the <code>password</code> option in <a href="#config-voter_conf"><code>voter.conf</code></a> that is associated with the <code>DISPLAY_NAME</code> for this VOTER. When this VOTER connects to the host, and the host matches the <code>Client Password</code> to a configured <code>DISPLAY_NAME</code>, that device will be connected to <code>chan_voter</code>.</li>
<li><code>6  - Host Password</code> is the password of the Asterisk host, and must match the <code>password</code> setting in the <code>[General]</code> context in <a href="#config-voter_conf"><code>voter.conf</code></a></li>
<li><code>7  - Tx Buffer Length</code> sets the transmit buffer length in <strong>samples</strong> (8000 samples per second, so 8 samples = 1 millisecond), plus overhead, of the Transmit Delay buffer. This should be set to the maximum expected network latency plus a little padding (800 samples is a good amount of padding, so setting the parameter to 3000 is probably a good place to start until you do buffer tuning) between the host and all the clients on the <strong>transmit</strong> side. It must be set long enough to allow for worst-case delay and jitter in the Internet path between the client and the host. Minimum setting is 800, maximum setting is 6400</li>
<li><code>8  - GPS Data Protocol</code> determines whether your GPS speaks NMEA, or Trimble TSIP. The VOTER is looking for NMEA $GPGGA, $GPGSV, and $GPRMC sentences</li>
<li><code>81 - GPS Type</code> is normally set to <code>0</code>, if you are using a Trimble GPS <strong>other than</strong> a Thunderbolt. Option <code>1</code> selects specific firmware hacks to accommodate Thunderbolt quirks</li>
<li><code>82 - GPS Time Offset (seconds to add for correction)</code> if you have some oddball situation where you need to add a fixed number of seconds to GPS time, this is where you would specify that. <strong>You should not normally need this option</strong> </li>
<li><code>9  - GPS Serial Polarity</code> depending on if your GPS is TTL or RS-232, you will need to adjust this setting accordingly to get lock. <code>GPS Lock</code> in the <code>98 - Status</code> menu should be a <strong>1</strong> when this is correct and the GPS is locked</li>
<li><code>10 - GPS PPS Polarity</code> depending on if your GPS PPS signal is TTL or RS-232, you will need to adjust this setting accordingly. Option <code>2</code> is used if you are using "General-purpose" mode, and not using a GPS. Check the <code>PPS BAD or Wrong Polarity</code> on the <code>98 - Status</code> menu. If it is a <strong>1</strong>, try toggling this setting, because the VOTER can't lock to PPS</li>
<li><code>11 - GPS Baud Rate</code> is set according to your GPS. Typically this would be <code>4800</code> for most NMEA GPS, and <code>9600</code> for most TSIP applications</li>
<li><code>12 - External CTCSS</code> is set depending on if you are feeding an external CTCSS logic signal from your repeater in to the VOTER. If you are using carrier squelch, leave this as <code>0</code>. If your receiver is decoding CTCSS, and you are feeding a logic signal in to the radio connector, set the proper polarity for your application. The VOTER is normally expecting the External CTCSS to be pulled to ground</li>
<li><code>13 - COR Type</code> is normally set to <code>0</code> (it <strong>must</strong> be set to <code>0</code> for voting/simulcast applications). COR is determined in software (Squelch Calibration procedure). If you have External CTCSS configured, this would be the equivalent of <strong>AND</strong> squelch when set to <code>0</code>, needing CTCSS <strong>AND</strong> COR to qualify the receiver. If set to <code>1</code>, then you <strong>must</strong> be feeding an External COR/CTCSS signal in to the External CTCSS input (and have that option correctly optioned) to qualify the receiver COR; in this application you can feed processed audio (non-discriminator) to the audio input, this would be used with "General-purpose" mode. Option <code>2</code> applications are un-tested/not known</li>
<li><code>14 - Debug Level</code> sets various debug settings in the firmware</li>
<li><code>15  - Alt. VOTER Server Address</code> is the alternate VOTER Server Address, when a redundant host system is configured. Not normally used</li>
<li><code>16  - Alt. VOTER Server Port (Override)</code> is the UDP port of the redundant host, if it is different than the standard port configured in setting 3. Not normally used</li>
<li><code>17  - DSP/BEW Mode</code> will show <code>NOT SUPPORTED</code> for firmware built without DSP/BEW mode. Will allow DSP/BEW to be optionally enabled in firmware built with this option (-BEW firmware files)</li>
<li><code>18 - "Duplex Mode 3"</code> setting to anything other than <code>0</code> enables this function. <code>Duplex Mode 3</code> in <code>app_rpt</code> allows for "in-cabinet repeat" (where the <strong>radio hardware</strong> provides repeat audio) and <code>app_rpt</code> adds the hang time, courtesy tones, linking - all the things <code>apt_rpt</code> does, except repeat audio. Therefore no repeat audio delay. Cool, eh? This duplex mode has been in the <code>app_rpt</code> for a while. The problem has been how to implement it in the VOTER environment. <code>Duplex Mode 3</code> support in the VOTER provides in-cabinet repeat functionality. Repeat audio loops through the VOTER, and has almost zero delay because it does not have to traverse the network. The delay is not quite zero but it's plenty short enough to eliminate all of the above mentioned annoyances. Of course, <code>Duplex Mode 3</code> support can't be used with voting or simulcast. You also lose DTMF muting, time out timer, and repeater disable functions because the repeat path is not through <code>app_rpt</code></li>
<li><code>19 - Simulcast Launch Delay</code> set to anything other than <code>0</code> to enable. Adds a "launch delay" to transmit audio in simulcast applications. A setting of <code>1</code> is approximately 200nS, 5 = 1uS</li>
<li><code>97 - RX Level</code> enters the RX Level tuning display  </li>
<li><code>98 - Status</code> displays the current status of various parameters  </li>
<li><code>99 - Save Values to EEPROM</code> saves all current changes to EEPROM</li>
<li><code>i - IP Parameters menu</code> enters the IP configuration menu</li>
<li><code>o - Offline Mode Parameters menu</code> enters the <code>Offline Mode</code> configuration menu, used to "soft-fail" to a basic repeater if the connection to the host is lost </li>
<li><code>s - Squelch menu</code> enters the squelch tuning menu</li>
<li><code>q - Disconnect Remote Console Session</code> quits the current TELNET connection, and releases the console back to serial </li>
<li><code>r - reboot system</code> should be pretty obvious... </li>
<li><code>d - diagnostics</code> enters the diagnostics menu</li>
</ul>
<h3 id="voter-voter-menus-97-rx-level-display">97 RX Level Display</h3>
<div class="highlight"><pre><span></span><code>RX VOICE DISPLAY:
                                  v -- 3KHz        v -- 5KHz
|&gt;           
</code></pre></div>
<p>This displays the Receive Audio Level in "real-time" when setting the Receive Level.</p>
<p>Modulate the receiver with a 1kHz at 3kHz deviation signal, and set the Receive Level potentiometer until the bar graph displays:</p>
<div class="highlight"><pre><span></span><code>RX VOICE DISPLAY:
                                  v -- 3KHz        v -- 5KHz
|=================================&gt;           
</code></pre></div>
<p>Press any key to exit this display.</p>
<h3 id="voter-voter-menus-98-status-display">98 Status Display</h3>
<div class="highlight"><pre><span></span><code>S/W Version: 3.00 3/24/2021
System Uptime: 850819.2 Secs
IP Address: 192.168.1.124
Netmask: 255.255.255.0
Gateway: 192.168.1.254
Primary DNS: 192.168.1.254
Secondary DNS: 0.0.0.0
DHCP: 0
VOTER Server IP: 192.168.1.100
VOTER Server UDP Port: 667
OUR UDP Port: 667
GPS Lock: 0
PPS BAD or Wrong Polarity: 0
Connected: 0
COR: 0
EXT CTCSS IN: 1
PTT: 0
RSSI: 3
Current Samples / Sec.: 8000
Current Peak Audio Level: 49776
Squelch Noise Gain Value: 13, Diode Cal. Value: 57, SQL Level 400, Hysteresis 24
Current Time: Sun  Jan 30, 2022  03:11:40.860
Last Ntwk Rx Pkt System time: &lt;System Time Not Set&gt;, diff: -1462339168 msec
Last Ntwk Rx Pkt Timestamp time: &lt;System Time Not Set&gt;, diff: 0 msec
Last Ntwk Rx Pkt index: 0, inbounds: 0

Press The Any Key (Enter) To Continue
</code></pre></div>
<h4 id="voter-voter-menus-status-display-values">Status Display Values</h4>
<ul>
<li><code>S/W Version</code> displays the current firmware version and build date</li>
<li><code>System Uptime</code> shows how long this device has been running, in seconds</li>
<li><code>IP Address</code> is the current static IP, or the IP address received using DHCP</li>
<li><code>Netmask</code> is the current configured netmask, or the netmask received using DHCP</li>
<li><code>Gateway</code> is the current configured gateway, or the gateway received using DHCP</li>
<li><code>Primary DNS</code> is the current configured primary DNS server, or the DNS server received using DHCP</li>
<li><code>Secondary DNS</code> is the current configured primary DNS server, or the DNS server received using DHCP</li>
<li><code>DHCP</code> reports <code>1</code> if DHCP is enabled, or <code>0</code> if using static IP configuration</li>
<li><code>VOTER Server IP</code> is the IP address that the <code>VOTER Server Address</code> resolves to</li>
<li><code>VOTER Server UDP Port</code> is the current <code>VOTER Server UDP</code> port</li>
<li><code>OUR UDP Port</code> is the current incoming UDP port. This would change if <code>Local Port (Override)</code> is set</li>
<li><code>GPS Lock</code> reports <code>1</code> if the GPS is locked and time is good. Reports <code>0</code> if the GPS is unlocked (or GPS polarity is incorrect and the VOTER can't decode any GPS data)</li>
<li><code>PPS BAD or Wrong Polarity</code> reports <code>1</code> if the PPS signal is <strong>bad</strong> (check polarity). Reports <code>0</code> if the PPS signal is <strong>good</strong></li>
<li><code>Connected</code> reports <code>1</code> if the VOTER is has established a connection to it's host. Reports <code>0</code> if there is currently no host connection</li>
<li><code>COR</code> reports <code>1</code> if the squelch is currently open. Reports <code>0</code> if the squelch is closed</li>
<li><code>EXT CTCSS IN</code> reports the status of the <code>External CTCSS</code> pin. It is normally pulled up, so will report <code>1</code>. It will report <code>0</code> if it is grounded. Logic would depend on your application</li>
<li><code>PTT'</code> reports <code>1</code> if the transmitter is presently keyed. Reports <code>0</code> if the transmitter is un-keyed</li>
<li><code>RSSI</code> reports the currently sampled/decoded RSSI level when the receiver is active</li>
<li><code>Current Samples / Sec.</code> displays the current encoding rate (will always be <code>8000</code> or <code>8001</code>)</li>
<li><code>Current Peak Audio Level</code> reports the current audio level (ADC level)</li>
<li><code>Squelch Noise Gain Value</code> displays the EEPROM setting written during the "Squelch Calibration" procedure. The optimal (valid) range is <code>8-127</code>. Below <code>8</code>, and there is <strong>too much</strong> signal, and Squelch Calibration will fail with a level too high. Above <code>127</code> and Squelch Calibration will fail with a level too low  </li>
<li><code>Diode Cal. Value</code> displays the EEPROM setting written during the "Diode Calibration" procedure</li>
<li><code>SQL Level</code> displays the current squelch level (relative value from <code>0-1023</code>). If configured for <code>squelch pot</code>, this is the value set by the squelch potentiometer. If set for <code>software squelch</code>, this is the value programmed in to the EEPROM. See the <a href="#voter-voter-menus-s-squelch-parameters-menu">Squelch Parameters Menu</a> for more details</li>
<li><code>Hysteresis</code> displays the current squelch hysteresis setting (configured on the <a href="#voter-voter-menus-s-squelch-parameters-menu">Squelch Parameters Menu</a>)</li>
<li><code>Current Time</code> if the GPS is <strong>locked</strong>, the current time will be displayed</li>
<li><code>Last Ntwk Rx Pkt System time</code> and <code>diff</code> <em>is only applicable in sites where transmit is enabled.</em> This displays the timestamp of the last transmit audio packet received from the network (from the host), and the <strong>diff</strong>erence between when that packet was received, and the current time (how long ago did we last transmit an audio packet?). On a satellite receiver site this will display <code>&lt;System Time Not Set&gt;</code> and a wild number for the <strong>diff</strong>erence</li>
<li><code>Last Ntwk Rx Pkt Timestamp time</code> and <code>diff</code> <em>is only applicable in sites where transmit is enabled.</em> This displays the timestamp of the last transmit audio packet received from the network (from the host), and the <strong>diff</strong>erence between when the time stamp of that packet and the VOTER's time. On a satellite receiver site this will display <code>&lt;System Time Not Set&gt;, diff: 0 msec</code></li>
<li><code>Last Ntwk Rx Pkt index</code> and <code>inbounds</code> <em>is only applicable in sites where transmit is enabled.</em> This displays the index of the transmitted audio packet in the transmit buffer that was last transmitted, and a flag if the packet was inbounds (should be <code>1</code>). On a satellite receiver site, both will be <code>0</code>.</li>
</ul>
<h3 id="voter-voter-menus-99-save-values-to-eeprom">99 Save Values to EEPROM</h3>
<p>Saves current settings to non-volatile EEPROM. </p>
<h2 id="voter-voter-menus-i-ip-parameters-menu">i IP Parameters Menu</h2>
<div class="highlight"><pre><span></span><code>IP Parameters Menu

Select the following values to View/Modify:

1  - (Static) IP Address (192.168.1.124)
2  - (Static) Netmask (255.255.255.0)
3  - (Static) Gateway (192.168.1.254)
4  - (Static) Primary DNS Server (192.168.1.254)
5  - (Static) Secondary DNS Server (0.0.0.0)
6  - DHCP Enable (0)
7  - Telnet Port (23)
8  - Telnet Username (admin)
9  - Telnet Password (radios)
10 - DynDNS Enable (0)
11 - DynDNS Username (wb6nil)
12 - DynDNS Password (radios42)
13 - DynDNS Host (voter-test.dyndns.org)
14 - BootLoader IP Address (192.168.1.11) (OK)
15 - Ethernet Duplex (0=Half, 1=Full) (1)
99 - Save Values to EEPROM
x  - Exit IP Parameters Menu (back to main menu)
q  - Disconnect Remote Console Session, r - reboot system

Enter Selection (1-14,99,c,x,q,r) :
</code></pre></div>
<h3 id="voter-voter-menus-ip-parameters-options">IP Parameters Options</h3>
<ul>
<li><code>1  - (Static) IP Address</code> if you are setting a static IP, configure it here. Does not apply for DHCP</li>
<li><code>2  - (Static) Netmask</code> if you are configuring a static IP, you will need to specify the netmask. Does not apply for DHCP</li>
<li><code>3  - (Static) Gateway</code> if you are configuring a static IP, you will need to specify the default gateway. Does not apply for DHCP</li>
<li><code>4  - (Static) Primary DNS Server</code> if you are configuring a static IP, you will need to specify the primary DNS server. Does not apply for DHCP</li>
<li><code>5  - (Static) Secondary DNS Server</code> if you are configuring a static IP, you can (optionally) specify a secondary DNS server. Does not apply for DHCP</li>
<li><code>6  - DHCP Enable</code> is set to <code>0</code> to use the static IP settings (above), or set to <code>1</code> to use DHCP to configure the IP settings</li>
<li><code>7  - Telnet Port</code> is normally the standard TCP port <code>23</code>, however, you can change it, if desired</li>
<li><code>8  - Telnet Username</code> is the username required for TELNET access (serial console doesn't require a username or password)</li>
<li><code>9  - Telnet Password</code> is the password required for TELNET access (serial console doesn't require a username or password)</li>
<li><code>10 - DynDNS Enable</code> the VOTER supports the DynDNS service (and only DynDNS). Whether this feature still works is unknown, as that part of the code has not been actively maintained. Set to <code>1</code> to enable or set to <code>0</code> to disable. This will (in theory) update your DynDNS account with the Hostname (specified below) so that you could configure remote access to the VOTER using a known hostname on a dynamic IP internet service. <strong>The AllStarLink host does not care what the hostname is of the VOTER</strong> as it is not required for communication. The VOTER establishes the outbound connection to the host, and communication then flows back and forth over that session</li>
<li><code>11 - DynDNS Username</code> is the username of your DynDNS account </li>
<li><code>12 - DynDNS Password</code> is the password of your DynDNS account</li>
<li><code>13 - DynDNS Host</code> is the hostname in your DynDNS account that you want to update when this VOTER gets a new IP address from DHCP</li>
<li><code>14 - BootLoader IP Address</code> configures the bootloader IP address used for loading new firmware. Initially, the default bootloader on a new VOTER (with only bootloader code installed) will be <code>192.168.1.11</code>. Once you get this firmware running on it, you can override the bootloader IP address here to something more appropriate (if desired)</li>
<li><code>15 - Ethernet Duplex</code> selects <code>Half (0)</code> or <code>Full (1)</code> duplex. Remember, the Ethernet is only 10mb/s. Pay attention to your switch configuration, if you need to manually set it to 10mb/s. The VOTER will not auto-negotiate full or half duplex. The ENC28J60 does not support duplex auto-negotiation, and it will be detected as a half-duplex device. To use full duplex you <strong>MUST</strong> configure both ends manually, otherwise, you are likely to get a lot of errors (which will often manifest as choppy audio or missing syllables)</li>
<li><code>99 - Save Values to EEPROM</code> will save all the settings to non-volatile EEPROM</li>
<li><code>x  - Exit IP Parameters Menu (back to main menu)</code> will, obviously, exit this menu and return back to the Main Menu</li>
<li><code>q  - Disconnect Remote Console Session</code> quits the current TELNET connection, and releases the console back to serial</li>
<li><code>r - reboot system</code> should be pretty obvious...</li>
</ul>
<h2 id="voter-voter-menus-o-offline-mode-parameters-menu">o OffLine Mode Parameters Menu</h2>
<p>OffLine Mode is (optionally) enabled when the connection to the host is lost. It is only applicable at a site with a receiver <strong>and</strong> transmitter (on the same VOTER). It allows a repeater to maintain basic functions (repeats audio and identifies) if the internet connection to the host is lost, or Asterisk crashes.</p>
<p>When the connection to the host is lost, it will send the <code>CW "Offline"</code> ID string. It will then periodically (<code>ID Period Time</code>) send the ID string out the transmitter on an ongoing basis.</p>
<p>When the connection to the host is restored, it will send the <code>CW "Online"</code> string.</p>
<p>On satellite receiver sites (no co-located transmitter), leave the mode set to <code>0 (NONE)</code>.</p>
<div class="highlight"><pre><span></span><code>OffLine Mode Parameters Menu

Select the following values to View/Modify:

1  - Offline Mode (0=NONE, 1=Simplex, 2=Simplex w/Trigger, 3=Repeater) (3)
2  - CW Speed (400) (1/8000 secs)
3  - Pre-CW Delay (4000) (1/8000 secs)
4  - Post-CW Delay (4000) (1/8000 secs)
5  - CW &quot;Offline&quot; (ID) String (N0CALL/R)
6  - CW &quot;Online&quot; String (OK)
7  - &quot;Offline&quot; (CW ID) Period Time (18000) (1/10 secs)
8  - Offline Repeat Hang Time (15) (1/10 secs)
9  - Offline CTCSS Tone (136.5) Hz
10 - Offline CTCSS Level (0-32767) (1500)
11 - Offline De-Emphasis Override (0=NORMAL, 1=OVERRIDE) (1)
99 - Save Values to EEPROM
x  - Exit OffLine Mode Parameter Menu (back to main menu)
q  - Disconnect Remote Console Session, r - reboot system

Enter Selection (1-9,99,c,x,q,r) :
</code></pre></div>
<h3 id="voter-voter-menus-offline-mode-parameters-options">Offline Mode Parameters Options</h3>
<ul>
<li><code>1  - Offline Mode</code> set to <code>0</code> to disable (or for receiver sites). Set to <code>1</code> to send the <code>CW Offline String</code> when host connection is lost, and then periodically thereafter. Set to <code>2</code> to send the <code>CW Offline String</code> when host connection is lost, and then be quiet until there is a receiver event to trigger sending the <code>CW Offline String</code> again. Set to <code>3</code> for full-duplex repeat (dumb repeater with ID)</li>
<li><code>2  - CW Speed</code> sets the CW speed, <em>in multiples of 125uS</em></li>
<li><code>3  - Pre-CW Delay</code> sets the delay before sending CW, <em>in multiples of 125uS</em> (4000 = 500mS)</li>
<li><code>4  - Post-CW Delay</code> sets the hangt ime of the transmitter, after sending CW, <em>in multiples of 125uS</em> (4000 = 500mS)</li>
<li><code>5  - CW "Offline" (ID) String</code> is the CW string to send when the host connection is lost, and also the repeater ID to periodically send</li>
<li><code>6  - CW "Online" String</code> is the CW string to send when the host connection is restored. You wouldn't typically want this to be the repeater ID, as you would want to know when the connection is restored by it being something different</li>
<li><code>7  - "Offline" (CW ID) Period Time</code> is the timer for sending the CW ID when in OffLine mode, <em>in multiples of 0.1sec</em> (18000 = 1800sec = 30min)</li>
<li><code>8  - Offline Repeat Hang Time</code> is the hang timer for the transmitter when in OffLine mode, <em>in multiples of 0.1sec</em> (15 = 1.5sec)</li>
<li><code>9  - Offline CTCSS Tone</code> configures the (optional) CTCSS tone to use on the <strong>transmitter</strong>. See the <a href="#voter-voter-hardware-transmit-level-calibration">Transmit Level Calibration</a> procedure</li>
<li><code>10 - Offline CTCSS Level</code> configures the output level of the CTCSS tone to the transmitter. Valid range is 0-32767. See the <a href="#voter-voter-hardware-transmit-level-calibration">Transmit Level Calibration</a> procedure</li>
<li><code>11 - Offline De-Emphasis Override</code> allows manual selection of whether the de-emphasis is used in OffLine mode. It is dependent on how you have audio to your <strong>transmitter</strong> connected. In <code>normal (0)</code> mode, receive audio <strong>will</strong> be de-emphasized, as the VOTER is expecting the <strong>transmit</strong> audio to be connected to the microphone input. In <code>override (1)</code> mode, receive audio will <strong>not</strong> be de-emphasized, as the VOTER is expecting that the <strong>transmit</strong> audio is connected directly to the modulator (with no pre-emphasis); as such, the receiver audio would already be pre-emphasized (from the user's radio), and just needs to be sent to the transmitter (avoiding "double pre-emphasis"). If you are going to generate CTCSS in the VOTER (or via <a href="#config-voter_conf"><code>voter.conf</code></a>), you will need to connect your transmit audio directly to the modulator... so for OffLine mode, you're probably going to want to set this to <code>override (1)</code>.</li>
<li><code>99 - Save Values to EEPROM</code> will save all the settings to non-volatile EEPROM</li>
<li><code>x  - Exit IP Parameters Menu (back to main menu)</code> will, obviously, exit this menu and return back to the Main Menu</li>
<li><code>q  - Disconnect Remote Console Session</code> quits the current TELNET connection, and releases the console back to serial</li>
<li><code>r - reboot system</code> should be pretty obvious...</li>
</ul>
<h2 id="voter-voter-menus-s-squelch-parameters-menu">s Squelch Parameters Menu</h2>
<p>In firmware version &gt;3.00, this menu was added to allow for remote squelch and hysteresis adjustments.</p>
<p>Normal squelch uses a potentiometer to set a voltage on a dsPIC ADC pin. The reference voltage used for the potentiometer is slightly temperature compensated. The calculated RSSI is compared with the Squelch ADC value. When the calculated RSSI rises above the squelch threshold, squelch is opened. </p>
<p>This menu lets you use the squelch potentiometer (hardware) for squelch adjustment, or it lets you specify the squelch setting directly (software squelch). For initial configuration, you normally would want to use the hardware potentiometer for setting the squelch. This will give you the ballpark value for your receiver when you look at the <a href="#voter-voter-menus-98-status-display"># 98 Status Display</a>. Once you have that baseline established, you can then switch to using software squelch (and program the initial value determined with your hardware pot). That then allows you to remotely adjust the squelch on the receiver from the comfort of your sofa... so you don't have to drive to the repeater site every time you want to tweak it.</p>
<p>There is hysteresis around the squelch setting, set by the Hysteresis value (obviously). A smaller value is a "tighter" squelch, a larger value is a "looser" squelch. </p>
<div class="highlight"><pre><span></span><code>Squelch Parameters Menu

Select the following values to View/Modify:

1  - Squelch Pot (0=Hardware, 1=Software) (1)
2  - Squelch Setting (1-1023) (675)
3  - Hysteresis (1-100) (10)
99 - Save Values to EEPROM
x  - Exit Squelch Parameter Menu (back to main menu)
q  - Disconnect Remote Console Session, r - reboot system

Enter Selection (1-3,99,x,q,r) :
</code></pre></div>
<h3 id="voter-voter-menus-squelch-parameters-options">Squelch Parameters Options</h3>
<ul>
<li><code>1  - Squelch Pot</code> set to <code>0</code> to use the hardware potentiometer. Set to <code>1</code> to use the software squelch setting below</li>
<li><code>2  - Squelch Setting</code> set to the desired squelch level setting. Valid range is <code>1-1023</code>. Set this to the initial value found on the <a href="#voter-voter-menus-98-status-display"># 98 Status Display</a> when using the hardware potentiometer. <strong>Set this level before switching to software squelch</strong></li>
<li><code>3  - Hysteresis</code> set to the desired squelch "tightness". Valid range is <code>1-100</code>. A smaller number is a "tighter" squelch. A larger number is a "looser" squelch. The default in previous firmware versions is <code>24</code>. <strong>Ensure this level is set, otherwise it defaults to <code>2</code> and your squelch will be very choppy (tight)</strong> </li>
<li><code>99 - Save Values to EEPROM</code> will save all the settings to non-volatile EEPROM</li>
<li><code>x  - Exit IP Parameters Menu (back to main menu)</code> will, obviously, exit this menu and return back to the Main Menu</li>
<li><code>q  - Disconnect Remote Console Session</code> quits the current TELNET connection, and releases the console back to serial</li>
</ul>
<h2 id="voter-voter-menus-d-diagnostics-menu">d Diagnostics Menu</h2>
<div class="admonition warning">
<p class="admonition-title">Service Interruption</p>
<p>Entering the diagnostic menu will kill a connection to the host (it interrupts the PPS). Not recommended for running on a production system.</p>
</div>
<div class="admonition note">
<p class="admonition-title">May be Discontinued</p>
<p>This menu/function may be removed in future firmware, as it's use is limited and code space is at a premium.</p>
</div>
<div class="highlight"><pre><span></span><code>Select the following Diagnostic functions:

1  - Set Initial Tone Level (and assert PTT)
2  - Display Value of DIP Switches
3  - Flash LED&#39;s in sequence
4  - Run entire diag suite
x -  Exit Diagnostic Menu (back to main menu)
q - Disconnect Remote Console Session, r - reboot system

Enter Selection (1-4,x,q,r) :
</code></pre></div>
<h3 id="voter-voter-menus-diagnostic-menu-options">Diagnostic Menu Options</h3>
<ul>
<li><code>1  - Set Initial Tone Level (and assert PTT)</code> connect the oscilloscope to the lead on the radio connector (see the Diagnostic Cable below), and follow the instructions</li>
<li><code>2  - Display Value of DIP Switches</code> will show the current value of all the DIP switches (RTCM) or Jumpers (VOTER)</li>
<li><code>3  - Flash LED's in sequence</code> will flash all the LEDs</li>
<li><code>4  - Run entire diag suite</code> will run all the diagnostics. Follow the on screen instructions</li>
<li><code>x  - Exit IP Parameters Menu (back to main menu)</code> will, obviously, exit this menu and return back to the Main Menu</li>
<li><code>q  - Disconnect Remote Console Session</code> quits the current TELNET connection, and releases the console back to serial</li>
</ul>
<h3 id="voter-voter-menus-diagnostic-cable-connector-pinout">Diagnostic Cable Connector Pinout</h3>
<p>In order to run the diagnostic suite, you will need to build the following test cables/connectors. Note that these instructions are for the RTCM, the connections will be different for the VOTER.</p>
<div class="highlight"><pre><span></span><code>DB9(f) 9 Pin D-Shell Connector (Radio Connector):
1 - VIN (+12V or so)
2 (TX Audio Out) - connects to - 3 (RX Audio In) and also is output to &#39;scope for tone measurement
4 (External CTCSS In) - connects to - 7 (/PTT Out)
5 - Gnd
</code></pre></div>
<div class="highlight"><pre><span></span><code>15 Pin D-Shell Connector (GPS/Console Connector):
2 - to Console DB9(f) Pin 2
3 - to Console DB9(f) Pin 3
5 - to Console DB9(f) Pin 5
6 (GPS RX) - connects to - 14 (GPS TX)
</code></pre></div>
<p>Console is a 9 Pin D-shell connector that connects to serial console device.</p>
<h2 id="voter-voter-menus-hidden-menus">Hidden Menus</h2>
<p>There may be up to two hidden menus available in the firmware.</p>
<h3 id="voter-voter-menus-96-enc-registers">96 ENC Registers</h3>
<p>If the firmware is compiled with <code>DUMPENCREGS</code> enabled, then a Menu <code>96</code> would be available that would dump the registers from the Ethernet chip. Normally, this option is not compiled in to the standard releases, you would have to compile a custom firmware image and enable the <code>DUMPENCREGS</code> flag to build that option.</p>
<h3 id="voter-voter-menus-111-special-configs">111 Special Configs</h3>
<p>Menu <code>111</code> allows access to some special configurations that Jim included for special applications. Normally, these options should all be <code>0</code>.</p>
<div class="highlight"><pre><span></span><code>Elkes (11780): 0, Glasers (1103): 0, Sawyer (1170): 0

Press The Any Key (Enter) To Continue
</code></pre></div>
<h4 id="voter-voter-menus-elkes-mode">Elkes Mode</h4>
<p>See the <a href="https://wiki.allstarlink.org/wiki/Elke_Link">Elke Link page</a> for more information.</p>
<h4 id="voter-voter-menus-glasers-mode">Glasers Mode</h4>
<p>Unknown. It sets a "Glaser Timer" value, no idea what it does.</p>
<h4 id="voter-voter-menus-sawyer-mode">Sawyer Mode</h4>
<p>Developed for Tim Sawyer use on a Yaesu VXR5000 repeater. It modifies the hardware CTCSS Filter behavior when on/off line.</p>
<p>If the hardware CTCSS Filter is ON, and Option <code>1170=1</code>, and Offline Mode is enabled, then loss of the Host Connection (which reverts to Offline mode) causes the CTCSS Filter to turn OFF. Re-establishing the Host Connection turns the CTCSS Filter back ON.</p>
<p>Normally (Option <code>1170=0</code>), the CTCSS Filter always stays in its configured state (<code>ON</code> or <code>OFF</code>), as set with options in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p></section><section class="print-page" id="voter-voter-audio"><h1 id="voter-voter-audio-voter-audio">VOTER Audio</h1>
<p>Audio is critical component of proper VOTER/RTCM operation, as well as node operation in general. This is an extensive topic, with lots of caveats. So, we will lay it all out here.</p>
<p>Before we get in to the different ways audio is routed, there is an important consideration you need to make if you are using the RTCM/VOTER for voting. </p>
<p>The way the voting process works, it needs <strong>discriminator audio</strong> to determine the signal to noise level from each satellite receiver. As such, you will <strong>need</strong> to be feeding discriminator audio into the RX audio pin, so that the hardware/software can vote properly. That means you also <strong>need</strong> to let the hardware/software (VOTER/RTCM) do the squelch action.</p>
<p>If you <strong>need</strong> RX CTCSS, you'll <strong>need</strong> to feed logic from an external CTCSS decoder (ie an output from your radio) into the External CTCSS input pin.</p>
<p>Also, <strong>don't disable COR in the RTCM/VOTER</strong>... <em>it will cause it to disable the squelch and it will report an RSSI of 255 (full quieting) for all received signals</em>. Setting COR to Ignore is only used in "General-purpose" mode, and allows you to feed processed audio in (instead of discriminator audio), as long as you are also sending COR (and/or) CTCSS in to the External CTCSS input to control the squelch (externally).</p>
<p>The RTCM/VOTER is <strong>totally flexible</strong> regarding emphasis. Although the way it is set is <strong>completely obscure</strong>. It tries to automatically do the right thing for you, which is great, most of the time. But when it’s not, it's hard to know what is going on. </p>
<p>If you are changing the COR Type settings, or using <code>nodeemp</code> in <a href="#config-voter_conf"><code>voter.conf</code></a>, make sure you save/reboot the RTCM/VOTER <strong>every</strong> time you make a change... changes are <strong>not</strong> effective until the RTCM/VOTER reboots!</p>
<h2 id="voter-voter-audio-chuck-squelch">Chuck Squelch</h2>
<p>Early versions of firmware had flavors that included "Chuck Squelch". That is no longer a option, as "Chuck Squelch" is now the standard. </p>
<p>"Chuck Squelch" relates to firmware changes made by Chuck Henderson, WB9UUS.</p>
<p>One of the changes fixes an issue with weak signals producing RSSI readings all over the place. It is caused by a 16 bit value that was overflowing (it is the RSSI change in the firmware). It results in rock-solid RSSI values being reported, even on barely or non-readable signals. </p>
<p>The other firmware change changes how the squelch responds (it looks at the noise in the last two audio samples) and makes the two-stage "Micor squelch" action work better.</p>
<p>Since the original squelch code was buggy, it has been removed (and "Chuck Squelch" is now used in its place).</p>
<h2 id="voter-voter-audio-dspbew-firmware-version">DSP/BEW Firmware Version</h2>
<p>If you look in the <a href="https://github.com/AllStarLink/Voter/tree/master/VOTER_RTCM-firmware/firmware-images">AllStarLink GitHub Repository</a>, you will see there are <em>BEW</em> versions of the firmware.</p>
<p>DSP BEW Firmware is mutually exclusive with the diagnostic menu. There is not enough space for both, if you load the DSP/BEW firmware, you will <strong>NOT</strong> have a diag menu.</p>
<p>BEW stands for <strong>B</strong>aseband <strong>E</strong>xamination <strong>W</strong>indow.</p>
<p>Typically, the discriminator of an FM communications receiver produces results containing audio spectrum from the "sub-audible" range (typically &lt; 100 Hz) to well above frequencies able to be produced by modulating audio. These higher frequencies can be utilized to determine signal quality, since they can only contain noise (or no noise, if a sufficiently strong signal is present).</p>
<p>As is done in the VOTER, if you filter and rectify this broadband noise, you get a DC voltage. A noisy signal will produce a large DC voltage, a full-quieting signal will produce a small DC voltage. </p>
<p>For receivers (such as the Motorola Quantar, etc.) that do not provide sufficient spectral content at these "noise" frequencies (for various reasons), the "DSP/BEW" feature of the firmware may be utilized. </p>
<p>These receivers are perfectly capable of providing valid "noise" signal with <strong>no modulation</strong> on the input of the receiver, but with <strong>strong modulation</strong> (high frequency audio and high deviation, ie. voice), it <strong>severely interferes</strong> with proper analysis of signal strength.</p>
<p>This feature provides a means by which a "window" of baseband (normal audio range) signal is examined by a DSP, and a determination of whether or not sufficient audio is present to cause interference of proper signal strength is made. During the VERY brief periods of time when it is determined that sufficient audio is present to cause interference, the signal strength value is "held" (the last valid value previous to the time of interference) until such time that the interfering audio is no longer present.  </p>
<p>The DSP/BEW feature is selectable, and <strong>should not</strong> normally be used for a receiver that does not need it (squelch will perform better on a <em>normal</em> receiver that has lots of frequency response).</p>
<p>A note on the Motorola SLR5700 per VE7FET. DSP/BEW definitely makes a difference on what Allmon reports for the signal strength of received signals. It is less reactive when DSP/BEW = 1 than with it set to 0, which is expected. The SLR5700 can be generally categorized with the Quantar in how it processes audio.</p>
<h2 id="voter-voter-audio-receiver-de-emphasis">Receiver De-emphasis</h2>
<p>On the receive audio side, the <code>COR Type</code> setting in the RTCM/VOTER determines whether the de-emphasis filter is used for receive audio. </p>
<p><code>COR Type 0=Normal</code> means the RTCM/VOTER squelch circuit <em>is</em> in use and it is expecting discriminator audio on the receive audio pin (to be able to do the squelch action), and therefore it <strong>will</strong> provide de-emphasis (audio is routed THROUGH the de-emphasis RC filter circuit) to the receiver audio. </p>
<p><code>COR Type 1=IGNORE COR</code> uses the CTCSS input pin for COR or CTCSS <em>logic</em> and it then expects de-emphasized receive (line, speaker, processed, etc.) audio on the receive audio pin, and therefore will <strong>not</strong> provide de-emphasis to the received audio (the RC filter is switched <strong>out</strong> and audio passes straight through). This <strong>cannot</strong> be used in voting/simulcast applications, and is only usable in "General-purpose" applications.</p>
<p>Most of the time, you do <strong>not</strong> need to override the automatic filter selection. However, if you do, and you are sure you have a good reason to, you <em>can</em> switch the de-emphasis filter <strong>out</strong> of the circuit so that audio passes straight through to the encoder. You would do this by setting the <code>nodeemp=1</code> option in <a href="#config-voter_conf"><code>voter.conf</code></a>. When you set <code>nodeemp=1</code>, the <a href="#voter-voter-protocol">VOTER Protocol</a> tells the RTCM/VOTER to switch the filter <strong>out</strong>, so audio is passed straight through.</p>
<h2 id="voter-voter-audio-transmitter-pre-emphasis">Transmitter Pre-emphasis</h2>
<p>On the transmit audio side, the RTCM/VOTER normally expects to connect to the transmitter's <strong>external audio</strong> or <strong>microphone audio</strong> input. In other words, the <strong>transmitter</strong> is providing the pre-emphasis, limiting, and splatter filtering, not the RTCM/VOTER (you are <strong>not</strong> directly modulating the transmitter). The <strong>transmitter</strong> would also be responsible for generating any CTCSS that is required.</p>
<p>If, on the other hand, you do need to connect directly to the modulator (auxiliary modulation input, 9600 baud transmit input, flat audio input, etc.), that can be accomplished, see the next section about CTCSS.</p>
<p>If a CTCSS tone <strong>and</strong> level are defined in <a href="#config-voter_conf"><code>voter.conf</code></a>, the RTCM/VOTER <strong>will</strong> provide pre-emphasis to the audio, and expects that you will be connecting to your repeater's flat audio input (direct modulation).</p>
<div class="admonition warning">
<p class="admonition-title">Transmitter Audio Processing</p>
<p>In this state, even though the VOTER/RTCM is providing the pre-emphasis, typically you may still have bypassed the limiter and splatter filter by injecting audio direct to the modulator. You need to <strong>FULLY</strong> understand how audio is processed in your radio if you go this route, or you WILL cause adjacent channel interference!</p>
</div>
<p>If you don’t want a TX CTCSS tone but <strong>do</strong> need pre-emphasis, set an arbitrary (any) CTCSS tone in <a href="#config-voter_conf"><code>voter.conf</code></a>, and set the level to <strong>0</strong>. This will force the RTCM/VOTER to pre-emphasize the audio it generates on the TX pin, but it won't actually mix in a CTCSS tone.</p>
<h2 id="voter-voter-audio-transmit-ctcss">Transmit CTCSS</h2>
<p>If transmit CTCSS is desired or you have a need to connect directly to your modulator anyways, the <code>txctcss</code> and <code>txctcsslevel</code> (and optionally the <code>txtoctype</code>) parameters <strong>must</strong> be specified in your <a href="#config-voter_conf"><code>voter.conf</code></a>. In order to facilitate generation and transmission of CTCSS along with the normal system audio, the VOTER/RTCM client (and host) generate “flat” (pre-emphasized/limited) audio, which is intended to directly modulate a transmitter (to be applied at a direct modulation point, <strong>not</strong> a line level or microphone input, as in most VOTER/RTCM applications). </p>
<p>The <code>txctcss</code> parameter specifies the transmit CTCSS frequency in Hertz. The <code>txctcsslevel</code> specifies the arbitrary level of the CTCSS tone (0-250). Optionally, the <code>txtoctype</code> parameter may be specified, which determines the “turn-off” (when transmitter un-keys) style for the CTCSS. Setting this parameter to:</p>
<ul>
<li><code>none</code> (default) - means that the transmitter immediately stops transmitting when the system “un-keys”</li>
<li><code>phase</code> - means that the CTCSS tone will briefly be transmitted 120 degrees out of phase when the system “un-keys” (also known as “reverse-burst”, etc)</li>
<li><code>notone</code> - means the transmitter will continue transmitting for a brief period with no CTCSS after the system “un-keys” (also known as “chicken-burst”).</li>
</ul>
<p>If transmit CTCSS is not desired, <strong>DO NOT specify ANY</strong> of the <code>txctcss</code> ,<code>txctcsslevel</code> or <code>txtoctype</code> parameters. The audio that is produced by the VOTER/RTCM hardware (and the host) will therefore be <em>normal line-level</em> (intended for an external audio or microphone input) and will <strong>not</strong> be pre-emphasized (as this would be done in the <strong>RADIO</strong>). </p>
<div class="admonition note">
<p class="admonition-title">Transmit Audio Processing</p>
<p>MAKE SURE YOU UNDERSTAND THIS BECAUSE IT AFFECTS HOW YOU HOOK UP TRANSMIT AUDIO TO YOUR TRANSMITTER!</p>
</div>
<div class="admonition note">
<p class="admonition-title">No Tone</p>
<p>It <em>is</em> a valid configuration to hook up the VOTER/RTCM hardware directly to your transmitter modulator and specify a <code>txctcss=&lt;some tone&gt;</code> and <code>txctcsslevel=0</code> (or some other very small value). This will have the effect of NOT actually transmitting a CTCSS tone, but leaving you the option to do so down the road, without having to change the wiring to the radio and re-align the levels. In this application, pre-emphasis is done by the VOTER system (in software), as noted above. You MAY want to consider this if you are using the "offline repeat" function of the VOTER/RTCM hardware to keep your repeater on the air, in the event of a loss of connection between the VOTER client connected to the transmitter (with associated receiver, of course) and the Asterisk VOTER host.</p>
</div>
<h2 id="voter-voter-audio-level-setting">Level Setting</h2>
<p>There are multiple requirements for setting up audio levels, depending on your application.</p>
<h3 id="voter-voter-audio-asterisk">Asterisk</h3>
<p>In all applications, you will need to set levels through Asterisk... that's why you're using this solution, right?</p>
<p>Ensure you have a connection to your Asterisk host properly configured (proper configuration in <a href="#config-rpt_conf"><code>rpt.conf</code></a> and <a href="#config-voter_conf"><code>voter.conf</code></a>). Remember, if you make changes to these files while making adjustments, you will need to <strong><em>restart Asterisk</em></strong> or do a <code>voter reload</code> from the Asterisk Command Line Interface.</p>
<p>Connect your service monitor to generate a signal in to the receiver, and measure the deviation of the transmitter.</p>
<h4 id="voter-voter-audio-no-ctcss-generated-by-asterisk">No CTCSS Generated By Asterisk</h4>
<p>To set the audio levels:</p>
<ul>
<li>Send a 1kHz@3kHz on-channel, full-quieting, signal into the repeater's receiver</li>
<li>Use <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a> on the RTCM/VOTER to display the receive level.</li>
<li>Adjust the RX Input Level potentiometer until the bar graph reaches (matches) 3kHz</li>
<li>Now set the TX Level potentiometer to get 3kHz out of the transmitter (ensure any CTCSS in your transmitter is turned off)</li>
</ul>
<p>As a final check, change the modulation from 1kHz tone to 800Hz followed by 1.8kHz and verify that the deviation level doesn't change as the tone frequency changes. <strong>Changing levels indicates a pre/de-emphasis issue.</strong> You will want to read the above sections on how audio is handled, and figure out where your issue is.</p>
<p>If you are transmitting CTCSS with your transmitter you have to account for that deviation, unless you filter it out with your service monitor.</p>
<h4 id="voter-voter-audio-ctcss-generated-by-asterisk">CTCSS Generated by Asterisk</h4>
<p>The requisite settings in your <a href="#config-voter_conf"><code>voter.conf</code></a> file are:</p>
<div class="highlight"><pre><span></span><code>txctcss = 136.5                 ; set to your desired tone frequency in Hz
txctcsslevel = 47               ; ***this is a calibrated value, DO NOT CHANGE once set***
txtoctype = phase               ; configure for your turn-off style
</code></pre></div>
<p>To set the audio levels:</p>
<ul>
<li>Start with <code>txctcsslevel</code> in <a href="#config-voter_conf"><code>voter.conf</code></a> set to 0</li>
<li>Set the <code>txctcss</code> and <code>txtoctype</code> options in <a href="#config-voter_conf"><code>voter.conf</code></a> as necessary for your application</li>
<li>Send a 1kHz@3kHz on-channel, full-quieting, signal in to the repeater's receiver</li>
<li>Use <a href="#voter-voter-menus-97-rx-level-display">Menu 97</a> on the RTCM/VOTER to display the receive level</li>
<li>Adjust the RX Input Level potentiometer until the bar graph reaches (matches) 3kHz</li>
<li>Set the TX Level potentiometer to get 3kHz out of the transmitter</li>
<li>Turn off the modulation (1kHz tone) that you are sending in to the receiver, so that you are just sending carrier</li>
<li>Now, go change the <code>txctcsslevel</code> in <a href="#config-voter_conf"><code>voter.conf</code></a> to some arbitrary number (and remember to restart Asterisk)</li>
<li>Measure the deviation of the CTCSS tone being transmitted (turn on your 300Hz LPF in your service monitor, if applicable)</li>
<li>Keep adjusting the level in <a href="#config-voter_conf"><code>voter.conf</code></a>, until you get about 500Hz of deviation of the CTCSS tone</li>
</ul>
<p>As a final check, turn the 1kHz tone back on, and change the modulation from 1kHz tone to 800Hz followed by 1.8kHz and verify that the deviation level doesn't change as the tone frequency changes. <strong>Changing levels indicates a pre/de-emphasis issue.</strong> You will want to read the above sections on how audio is handled, and figure out where your issue is.</p>
<h3 id="voter-voter-audio-offline-repeat">Offline Repeat</h3>
<p>Optionally, if you are using the built-in "offline repeat" functions, fail the connection to the host Asterisk server (pull the LAN cable), and make sure your repeat audio performs the same as above.</p>
<div class="highlight"><pre><span></span><code>OffLine Mode Parameters Menu

Select the following values to View/Modify:

1  - Offline Mode (0=NONE, 1=Simplex, 2=Simplex w/Trigger, 3=Repeater) (3)
2  - CW Speed (400) (1/8000 secs)
3  - Pre-CW Delay (4000) (1/8000 secs)
4  - Post-CW Delay (4000) (1/8000 secs)
5  - CW &quot;Offline&quot; (ID) String (N0CALL/R)
6  - CW &quot;Online&quot; String (OK)
7  - &quot;Offline&quot; (CW ID) Period Time (18000) (1/10 secs)
8  - Offline Repeat Hang Time (15) (1/10 secs)
9  - Offline CTCSS Tone (136.5) Hz
10 - Offline CTCSS Level (0-32767) (0)
11 - Offline De-Emphasis Override (0=NORMAL, 1=OVERRIDE) (1)
99 - Save Values to EEPROM
x  - Exit OffLine Mode Parameter Menu (back to main menu)
q  - Disconnect Remote Console Session, r - reboot system

Enter Selection (1-9,99,c,x,q,r) :
</code></pre></div>
<ul>
<li>Ensure that the <code>Offline Mode</code> is set to <code>3</code></li>
<li><code>Offline CTCSS Tone</code> should be set to any valid tone (doesn't really matter) but <code>Offline CTCSS Level</code> <strong>must</strong> be set to <code>0</code></li>
<li><code>Offline De-Emphasis Override</code> will depend on how you have your <strong>transmit audio</strong> coupled to your transmitter<ul>
<li>If you are using microphone audio input (so that the audio gets pre-emphasized and splatter filtered), this would be set to <code>0</code></li>
<li>If however, you are using an auxiliary modulation input that goes direct to the modulator (because you may want the VOTER/RTCM to generate CTCSS), then this would be set to <code>1</code>. In <em>normal</em> (0) mode, receive audio <strong>will</strong> be de-emphasized, as the VOTER/RTCM is expecting the <strong>transmit</strong> audio to be connected to the microphone input. In <em>override</em> (1) mode, receive audio will <strong>not</strong> be de-emphasized, as the VOTER/RTCM is expecting that the <strong>transmit</strong> audio is connected directly to the modulator (with no pre-emphasis); as such, the receiver audio would already be pre-emphasized (from the user's radio), and just needs to be sent to the transmitter (avoiding "double pre-emphasis")</li>
</ul>
</li>
<li>If you are going to generate CTCSS in the VOTER/RTCM (or <code>chan_voter</code> via <a href="#config-voter_conf"><code>voter.conf</code></a>), you will need to connect your transmit audio directly to the modulator... so for OffLine mode, you're probably going to want to set this to <code>1=Override (1)</code></li>
<li>With the Ethernet cable removed (so there is no connection to the host), applying a 1kHz tone at 3kHz deviation should cause the VOTER/RTCM to key the transmitter (in offline mode)</li>
<li>Adjust the Transmit Level potentiometer to set the transmitter deviation to 3kHz (3kHz in, 3kHz out)</li>
<li>Now change the modulation from 1kHz tone to 800Hz followed by 1.8kHz and verify that the deviation level doesn't change as the tone frequency changes. <strong>Changing levels indicates a pre/de-emphasis issue.</strong> You will want to read the above sections on how audio is handled, and figure out where your issue is (maybe you need to toggle the <code>Offline De-emphasis Override</code>).</li>
</ul>
<p>If you are going to set the CTCSS Level, remove the modulating tone from your signal generator and, if applicable, set your service monitor filters to 300Hz LPF.</p>
<ul>
<li>Adjust the <code>Offline CTCSS Level</code> to get about 500Hz of deviation of your desired CTCSS tone</li>
<li>Remember to <code>save (99)</code> and probably <code>reboot (r)</code>, to make sure all the changes are effective</li>
<li>Remove the receiver signal when you are complete.</li>
</ul>
<p>At this point, if you have a properly configured AllStarLink host (including settings in <a href="#config-voter_conf"><code>voter.conf</code></a>), re-connecting the Ethernet cable to the VOTER should restore the connection to the host and exit Offline mode. Ensure that the connection to the host is established. Now, when you send your 1kHz at 3kHz deviation in to the receiver, it should come out the transmitter at 3kHz deviation as well.</p>
<h2 id="voter-voter-audio-troubleshooting">Troubleshooting</h2>
<h3 id="voter-voter-audio-sensitive-transmit-audio-adjustment">"Sensitive" Transmit Audio Adjustment</h3>
<p>With some combinations of VOTER/RTCM boards and radios, getting a good enough resolution with R61 when setting levels is a problem. You move a small amount on the pot and it jumps several hundred Hertz of deviation. Inserting a 4:1 voltage divider between the VOTER board and transmitter helps with this. Something such as a 1K and 330 ohm resistor will work. This allows for much finer adjustment on the transmit audio (R61).</p>
<h3 id="voter-voter-audio-crappy-transmit-audio">"Crappy" Transmit Audio</h3>
<p>Does your repeated audio sounded really bassy, muffled, and not very understandable? </p>
<p>There was a situation where, compared to a typical simplex radio-to-radio transmission, the audio through the repeater (VOTER/RTCM and Asterisk) was unacceptable. What was discovered was that the VOTER/RTCM's internal pre-emphasis function was disabled. </p>
<p>The user had intentionally disabled <code>txctcss</code> and <code>txctcsslevel</code> in <a href="#config-voter_conf"><code>voter.conf</code></a> because he didn't want the VOTER/RTCM transmitting CTCSS (the Quantar was doing that already). He ultimately found a post on the mail list explaining the settings above that said enabling <code>txctcss = &lt;some valid tone&gt;</code> (114.8 in his case) and setting <code>txctcsslevel = 0</code> would turn on the pre-emphasis function in the VOTER/RTCM without transmitting CTCSS tones. Yup.</p>
<p>He did, and it worked like a charm! Audio now had more treble and was less bassy/muffled (because the audio was now being properly pre-emphasized).</p>
<p>Hence the note above in audio level setting about changing the modulating tone, and seeing if the deviation changes.</p>
<h3 id="voter-voter-audio-pulse-noise-on-transmit-audio">Pulse Noise on Transmit Audio</h3>
<p>It has been noticed sometimes on built VOTER boards that it has low level DAC noise which sometimes is apparent as a pulsing noise on the audio output. Adding a 4:1 voltage divider inline between the transmitter and VOTER board helps reduce or eliminate this as described above.</p>
<h3 id="voter-voter-audio-squelch-issues">Squelch Issues</h3>
<p>Troubleshooting squelch issues:</p>
<ul>
<li>If anyone is off frequency a little bit, that will make the voice talk off worse. Double check that the repeater and the users are all on frequency</li>
<li>Don't use narrow bandwidth on the repeater receiver</li>
<li>Make sure that the discriminator audio is not rolled off even a little bit at the high end. There should not be any resistors in series or capacitors to ground between the discriminator chip output pin and the VOTER/RTCM board input, for best results. If your audio does not have enough "high-end" noise, you may need to try using the DSP/BEW firmware option.</li>
</ul></section><section class="print-page" id="voter-voter-buffers"><h1 id="voter-voter-buffers-voter-buffer-tuning">VOTER Buffer Tuning</h1>
<p>There are two types of buffers involved in the VOTER/RTCM. </p>
<p>In both the receive and transmit cases, the buffer length is a fixed value. This will <strong>hard-set</strong> the delay time between actual reception and presentation time to the Asterisk channel (in the case of receive), and presentation from the Asterisk channel and actual transmission (in the case of transmit).</p>
<p>Since the overall system time delay (the amount of time between reception and re-transmission of the signal) is determined as the sum of the receiver buffer length, the (very minimal) latency within <code>Asterisk/app_rpt</code> and the Transmit buffer length, it is <strong>very necessary</strong> to keep these settings to a <em>reasonable</em> minimum (without sacrificing packet consistency/integrity by making it too short based upon network latency/jitter). </p>
<p>In other words, if you listen to yourself on the output of your repeater (through headphones, on another radio) as you transmit in to the receiver, your audio will be delayed by the amount configured in the buffer settings (as summarized above). So, the larger you make the buffers, the longer the repeat delay will be. Hence, keeping the buffers tuned to a reasonably low level will reduce the repeat delay.</p>
<h2 id="voter-voter-buffers-transmit-buffer">Transmit Buffer</h2>
<p>This buffer is the <a href="#voter-voter-menus-main-menu-options">TX Buffer Length</a> parameter located on <strong>each</strong> VOTER/RTCM.</p>
<p>This buffer stores audio <strong>from</strong> the host <strong>to</strong> each <strong>transmitter</strong>, queuing it before sending it out over the air. </p>
<div class="admonition note">
<p class="admonition-title">Simulcast Launch Delay</p>
<p>The <code>Simulcast Launch Delay</code> is additionally added to the <code>TX Buffer Length</code> to allow fine-tuning of each transmitters launch delay.</p>
</div>
<p>This buffer has a value (length) of <strong>samples</strong>. It is <strong>not</strong> a time value! So, with 8000 samples per second, 8 <em>samples</em> = 1 millisecond. Each sample is 125uSec.</p>
<h2 id="voter-voter-buffers-receive-buffer">Receive Buffer</h2>
<p>This buffer is the <code>buflen</code> parameter in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>This buffer is a <strong>common</strong> buffer for <em>all</em> clients. It determines how much audio to buffer <strong>from</strong> the clients <strong>to</strong> Asterisk. It must be larger than the longest <em>network</em> delay from the <em>worst</em> client, plus padding (40-100mS is a good start), to ensure that audio will arrive at the host from all clients to be voted on.</p>
<p>This buffer has a value (length) of <strong>milliseconds</strong>. The default is 500 milliseconds, and that is what the value will be set to, if it is not specified in <a href="#config-voter_conf"><code>voter.conf</code></a>. That should cover <em>all</em> worse-case scenarios... and is going to typically be <strong>way</strong> to big. <strong>You should tune this!</strong></p>
<h2 id="voter-voter-buffers-setting-voter-buffers">Setting Voter Buffers</h2>
<p>In order to properly set the buffers, you need to quantify the latency between your host (master) site, and all the clients. That is why it is desirable to keep as much of the network between the host and the clients in your control as possible, so that you can control the latency. If you have your buffers tuned "on the edge", and the latency between some of your clients increases unexpectedly, that is going to impact your system performance.</p>
<p><code>voter ping</code> is useful for end-to-end network evaluation when ICMP ping is turned off and/or the VOTER/RTCM is behind a firewall and is not ICMP reachable. It can also help with finding the correct VOTER/RTCM and <a href="#config-voter_conf"><code>voter.conf</code></a> buffer settings. <code>voter ping</code> is an Asterisk console command, so you will need to be logged in to your host.</p>
<h3 id="voter-voter-buffers-voter-ping-usage">Voter Ping Usage</h3>
<p>The <code>voter ping</code> asterisk CLI syntax is:</p>
<div class="highlight"><pre><span></span><code>*CLI&gt;voter ping nameOfClient [packetCount]
</code></pre></div>
<p>If <code>packetCount</code> is not specified, 8 pings will be sent. Use a <code>packetCount</code> of <code>0</code> to stop an in progress voter ping. Set <code>packetCount</code> to at least <code>100</code> when evaluating link quality.</p>
<p>The result will be similar to:</p>
<div class="highlight"><pre><span></span><code>...
PING (nameOfClient): Packets tx: 100, rx: 100, oos: 0, Avg.: 26.710 ms
PING (nameOfClient):  Worst: 38 ms, Best: 22 ms, 100.0% Packets successfully received (0.0% loss)
</code></pre></div>
<p>The output above is self evident except for <code>oos</code> which is a count of out of sequence packets. <code>voter ping</code> requires VOTER/RTCM firmware 1.23 or newer and <code>chan_voter</code> 2013-08-04 or newer.</p>
<h3 id="voter-voter-buffers-rx-buffer-size">RX Buffer Size</h3>
<p>Ping all the receiver sites and look for the worst response of the worst client. As a rough rule of thumb the <code>buflen</code> setting in <a href="#config-voter_conf"><code>voter.conf</code></a> should be set to <strong>the worst response + 40ms</strong> or <strong>120</strong>, whichever is greater. Using the above case, the <code>buflen</code> should be set to <code>120</code> (38 + 40 = 78 which is less than the minimum of 120, so use 120mS).</p>
<p>The 40mS is padding to account for buffer ingress/egress.</p>
<h3 id="voter-voter-buffers-tx-buffer-size">TX Buffer Size</h3>
<p>Ping all the transmitter sites and look for the worst response of the worst client. The VOTER/RTCM <code>TX Buffer Length</code> should be set to <strong>(worst response + 40ms) * 8</strong> or <strong>480</strong> whichever is greater. Using the above case, the VOTER/RTCM <code>TX Buffer Length</code> should be set to <code>624</code> ((38 + 40) * 8).</p>
<p>The 40mS is padding to account for buffer ingress/egress.</p>
<h2 id="voter-voter-buffers-assumptions">Assumptions</h2>
<ul>
<li>The minimum <code>TX Buffer Length</code> is 480 (60mS) and the minimum RX buffer (<code>buflen</code>) is 120mS. These were derived by testing on a LAN segment with <code>chan_voter</code> 2013-08-04 and VOTER/RTCM 1.26.</li>
<li>The ping times are in fact round trip times. Therefore the worst response could (should?) be divided by 2. ie. RX buffer (<code>buflen</code>) = (38/2)+40 = 59 and <code>TX Buffer Length</code> = ((38/2) + 40) * 8 = 472. Minimums still apply, however.</li>
<li>The internet path to and from the VOTER/RTCM under test is symmetrical.</li>
<li>The added 40mS pad is an estimate of buffer ingress and egress.</li>
</ul>
<p>As always, your mileage may vary. Some trial and error may be required to find the optimum settings.</p></section><section class="print-page" id="voter-voter-simulcasting"><h1 id="voter-voter-simulcasting-voter-simulcasting">VOTER Simulcasting</h1>
<p>Simulcasting is a means by where you operate multiple <strong>transmitters</strong> on the same frequency, at the same time, in diverse geographic locations, sending the same data/information.</p>
<p>In doing so, you realize a number of advantages:</p>
<ul>
<li>Improved coverage area</li>
<li>Improved signal strength/field strength at the subscriber receivers</li>
<li>Better spectrum utilization</li>
<li>Increased (transmitter) redundancy</li>
</ul>
<p>While the above are all great achievements, building a properly functioning simulcast system is <strong>very</strong> difficult to do in practice.</p>
<p>If the transmitters aren't <em>precisely</em> on frequency (or tightly controlled), they will <em>beat</em> with each other, causing holes/nulls in the coverage area where there is poor signal/distortion.</p>
<p>Audio (and/or data) has to be sent from the master/host site to all participating transmitters. The delay in getting to each transmitter site will be different (latency) and may not be consistent (may have jitter). So, you have to compensate for these delays and by inserting a <em>launch delay</em> that is equivalent to the delay to get from the host to the furthest site in all the <em>other</em> sites, so that the audio/data actually gets sent out over the air at the same time from all transmitters.</p>
<p>The audio (and/or data) being sent over the air has to be <em>phase coherent</em> (all in-phase). Otherwise, as the signals mix in the air, you will again end up with holes and other artifacts in the received signal.</p>
<p>These are just a few of the many issues faced in building a simulcast system. Not for the weak of heart, but it is a lot of fun when it is working! Theoretically, (if you could get it coordinated and get enough sites) you could have a networked repeater system on the <em>same frequency</em> all over a state, with seamless coverage.</p>
<p>The VOTER/RTCM boards do support simulcasting, however, there are a bunch of quirks that one needs to be aware of.</p>
<h2 id="voter-voter-simulcasting-radio-hardware">Radio Hardware</h2>
<p>For best results, you should use all identical RF equipment between your voting RX sites and simulcast TX sites. </p>
<p>If you don't, you can end up with strange audio artifacts when different receivers are used, and other strange audio issues when different transmitters are used. The most important thing when setting your levels is that <strong>ALL</strong> the RX and TX levels <strong>match</strong> from radio to radio. </p>
<p>The best way this is achieved is using a "master" radio and reference from that - all radios might be identical models, but may not have identical audio characteristics so check those levels! Also check CTCSS and audio levels separately to make sure they all match.</p>
<h2 id="voter-voter-simulcasting-96mhz-oscillator">9.6MHz Oscillator</h2>
<p>If you want reliable simulcast with an acceptable level of overlap warble, you MUST inject a GPS-disciplined or OCXO 9.6MHz signal to the clock of the VOTER/RTCM, in lieu of their stock internal crystal. </p>
<p>Otherwise, the inherent internal clock jitter of the VOTER/RTCM will cause CTCSS warble, etc. in areas where your transmitters overlap. The 1 PPS feed that you normally feed the VOTER/RTCM is acceptable for voting, but naturally, a typical crystal-driven clock will slightly drift in between the pulses every second due to inherent jitter, etc., and that isn't good for situations like simulcast which demand sample-accurate performance.</p>
<p>Here are some comments from Joe, KC2IRV, on the subject. He has also created his own wiki, specific to simulcast issues, you can find it at: <a href="http://rtcmsimulcast.wikifoundry.com/">http://rtcmsimulcast.wikifoundry.com/</a>. </p>
<blockquote>
<p>I felt I needed to let those on this mailing list know my findings with simulcasting with the RTCM units since I have received a great deal of help and information from people on this list.</p>
<p>For the past week I have had a two (2) site simulcast system up and running on UHF using the RTCM units. I have done a great deal of testing and proving on the bench and it is so far working beautifully. </p>
<p>The one issue that was made apparent to me early on was that in order for the RTCM's to be suitable for simulcast, the processor inside it needed to be clocked to a more accurate source. This source is supposed to be the Programmable Clock Generator Module in order to produce a GPS locked 9.6 MHz reference for the processor. Unfortunately this unit is not currently available.</p>
<p>Knowing this, I started to go down the road of possibly designing my own, but stumbled upon a cheap, plentiful supply of Symmetricom 9.6 MHz sinewave OCXO's. I took a chance and ordered a few to experiment with to see if the RTCM would be able to use this in place of the supplied crystal for a clock. I found they did, with that I decided to modify the RTCM with an SMA connector just above the audio adjustment pots and use this OCXO. I trimmed the frequency on the units to match each other and used them to produce the processor clock.</p>
<p>After a week of testing, I have found the results in the overlap areas to be exactly as I would expect them on a public safety/commercial simulcast system. While in an overlap region where both transmitters are within 3dB of one another, to the ear you hear no audio phase wandering. Of course, this has only been a week of testing so I wouldn't call it case closed yet.</p>
<p>I will say that if this system remains this way after testing for 6 months to a year than using a 9.6 MHz OCXO is a viable alternative to achieve the needed precision and accuracy needed for the processor clock to make it suitable for simulcast.</p>
</blockquote>
<p>Comments from Jim Dixon on the issue:</p>
<blockquote>
<p>You have to use <strong>something</strong> that will take the precise 10MHz (or whatever it is) from the GPSDO and PLL (phase-locked) convert it to 9.6MHz (square wave at 3.3V for the CPU clock).</p>
<p>We had to use 9.6MHz mainly because of the DAC in the dsPIC instead of 10MHz. The options for various divide/clock radios in the part are RATHER limited. As I recall, there wasn't even a way of getting the necessary 16kb/s sample rate on the ADC from 10MHZ, either.</p>
</blockquote>
<h2 id="voter-voter-simulcasting-micro-node-rtcm-clock-issue">Micro-Node RTCM Clock Issue</h2>
<p>James, KI0KN, had some strange-ness with some of his RTCM's when used for voting. As soon as he changed menu item 10 on the RTCM to either a (1) or a (0) instead of (2), he <strong>instantly</strong> got this on the RTCM console:</p>
<div class="highlight"><pre><span></span><code>04/05/2016 18:44:13.660  Lost GPS Time synchronization
04/05/2016 18:44:13.660  Host Connection Lost (Pri) (10.16.1.240)
</code></pre></div>
<p>And it sits there forever and never re-establishes connection to the host. The issue was finally traced to a bad batch of 9.6MHz crystals that affected a small run of the RTCM's. The issue was eventually resolved by Micro-Node, but we'll document it here just for record keeping.</p>
<p>James comments to the mail list:</p>
<blockquote>
<p>Well, after many of you offered your time and thoughts on my voter problem, Jim, WB6NIL, graciously donated a couple of hours of his time to remotely help me and he uncovered the problem.</p>
<p>All 5 of my RTCMs were purchased within the last 6 months, and I suspect all 5 have the same problem (will verify that today). The problem is that the microprocessor crystal is running too fast! There is 9.6Mhz crystal that drives the MPU, on the particular unit that Jim helped me diagnose, it's running 2.5khz too fast.  </p>
<p>There is a sanity check in the firmware that makes sure the correct number of samples were taken in the last second (it's supposed to be 8000) and fails if the sample is incorrectly sized (mine is taking 8003 samples).  Jim helped adjust the code to be more tolerant of the sampling error and my whole system instantly worked.</p>
<p>I have since tested it with ALL my GPSs (they all work great!). So I now have everything working, including the voting.</p>
<p>I haven't contact Micro-Node about it yet. Jim told me that voting should work fine but this clock error would probably not be acceptable for Simulcast (something we have no plans on doing as of now). Since mine are deployed at mountain top sites, I'll probably pursue a crystal that is running at the correct frequency and use "standard" firmware so that if the decision is ever made to play with simulcast, I won't be right back in this same boat.</p>
<p>Thanks to all that helped out, and a HUGE thanks to Jim for taking the time to troubleshoot this.</p>
<p>BTW- This clock error will NOT effect the RTCM in mix client mode, it only affects it in voting or simulcast mode!</p>
<p>In voter.c, the stock line is:</p>
<div class="highlight"><pre><span></span><code>if ((samplecnt &gt;= 7999) &amp;&amp; (samplecnt &lt;= 8001))

it needs to be changed to something like:

if ((samplecnt &gt;= 7999) &amp;&amp; (samplecnt &lt;= 8003 ))
</code></pre></div>
<p>That was just enough to make my first RTCM work. I've had a chance now to check a few more of my RTCMs on the bench this morning and the crystal frequencies are kind of all over. The next one I had on the bench was 5.2Khz fast. The above code was still not enough to fix it (as would be expected) so it looks like the quality control on whatever manufacturer that crystal is, isn't very good (or a low tolerance crystal is being used). I am going to pursue crystal replacement to get a highly accurate, stable, on-frequency crystal in there as my first choice. Changing the firmware 5 different times doesn't seem like the right answer.</p>
<p>Jim put that sanity check in there for a reason. Working around it '''may''' allow the device to work, but to me, it seems getting the hardware operating the way it was supposed to originally is the better answer. I will follow up with Micro-node and let you all know how it goes.</p>
</blockquote>
<p>After following up with Micro-Node:</p>
<blockquote>
<p>They were all off, some were off a LOT. I talked to Mark @ Micronode. He told me there were 25 units that made it out the door with a crystal from an unapproved source and that was quite likely the reason for the problem. He gladly sent me 5 new crystals to replace (he offered to replace them himself if I sent the units in, but I am comfortable doing it myself to save the time and postage). </p>
<p>I haven't received them in the mail yet to show that the problem is fixed, but I will post here when that happens. He was great to work with and had no issue getting things set straight. If you are having the same issue and your RTCMs were bought about the same time, I'd suggest you contact him and have him help you resolve the issue!</p>
</blockquote></section><section class="print-page" id="voter-voter-audioanalysis"><h1 id="voter-voter-audioanalysis-voter-audio-analysis">VOTER Audio Analysis</h1>
<p>This page shows the results of analyzing the audio response through an original through-hole VOTER board. As most of the background engineering on the design was lost with Jim's passing, some reverse engineering is required to dig deeper in to the design.</p>
<p>The data presented here analyzes the audio response between different sections of the various circuits in both the audio path, and the squelch/RSSI path.</p>
<h2 id="voter-voter-audioanalysis-audio-select-lines">Audio Select Lines</h2>
<p>If you refer to the <a href="https://github.com/AllStarLink/Voter/blob/master/VOTER-pcb/KiCAD-schematic/VOTER_2022-01-22.pdf">schematic</a>, you will note that there are two Audio Select lines (ASEL1/ASEL2) connected to the 74HC4053, which determine how audio is routed through the VOTER board. </p>
<p>ASEL1 determines the state of the hardware CTCSS Filter. When this line is Low, the CTCSS Filter is bypassed. When this line is High, the CTCSS Filter is inserted in the audio path (default).</p>
<p>ASEL2 determines the state of the hardware De-emphasis Filter. When this line is Low, the de-emphasis filter is inserted in the audio path. When this line is High, the de-emphasis filter is bypassed.</p>
<p>On initial boot (during the bootloader phase), ASEL1 and ASEL2 are Low. With the firmware running, default options, no host connection, and no GPS, ASEL1 = H and ASEL2 = L, which means that by default the CTCSS Filter is ENABLED and the De-emphasis Filter is ENABLED.</p>
<p>The state of the ASEL lines can be manually overridden by the <code>noplfilter</code> and <code>nodeemp</code> options in <a href="#config-voter_conf"><code>voter.conf</code></a>. They, obviously, will cause their respective filters to be disabled on the VOTER client they are configured for. </p>
<div class="admonition note">
<p class="admonition-title">Valid Host Connection Required</p>
<p>This is only true if there is a valid host connection.</p>
</div>
<p>In addition, Menu Item 11 (<code>Offline De-emphasis Override</code>) on the <a href="#voter-voter-menus-o-offline-mode-parameters-menu"><code>Offline Menu</code></a> directly affects the state of ASEL2 (de-emphasis). <strong><em>This is true, regardless of whether <code>Offline Mode</code> is enabled, or not!!</em></strong> When Menu Item 11 is <code>NORM</code>, the de-emphasis filter is enabled (or at its default condition). When Menu Item 11 is set to <code>OVERRIDE</code>, the de-emphasis filter is bypassed. </p>
<p>Note however, the effect of this setting is also directly tied to the setting of Main Menu Item 13 (<code>COR TYPE</code>). If <code>COR TYPE</code> is set to <code>NORMAL</code>, you can toggle the de-emphasis filter with Menu Item 11 on the Offline Menu. If the <code>COR TYPE</code> is set to <code>IGNORE COR</code>, the de-emphasis filter is bypassed immediately, and Menu Item 11 on the Offline Menu has no effect.</p>
<h2 id="voter-voter-audioanalysis-test-configuration">Test Configuration</h2>
<p>The data was captured using <a href="https://www.roomeqwizard.com/">Room Eq Wizard</a> software (version 5.20.5) on a Dell E6510, using the built-in sound card. The sound card response was calibrated out (calibration file created and applied).</p>
<p>The VOTER being used was built by VE7FET, and was running Firmware V3.00.</p>
<p>In most cases, "zero" is actually about -15.8dBm, so through measurements would be relative to that. Sorry, I didn't feel like figuring out how to reference the measurement sweeps to zero out that correction. </p>
<p>This is the baseline measurement, with the calibration applied, with the output of the sound card connected to the input, using a 10uF capacitor on the microphone input (DC blocking).</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_0.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 0" src="../voter/img/VOTER_Test_0.png" /></a></p>
<p>The sweeps presented below should be used as a general representation of the audio characteristics of the path. This is definitely not a scientific, lab-grade experiment. I was more interested in what the relative responses were of various parts of the circuit, as well as the effect and operation of various option settings in the config file (and menus).</p>
<h2 id="voter-voter-audioanalysis-audio-circuitry-sweeps">Audio Circuitry Sweeps</h2>
<h3 id="voter-voter-audioanalysis-input-amplifier-response">Input Amplifier Response</h3>
<p>Sweeping from Radio DB9 Pin 3 to U4 Pin7. 10uF cap on Mic input of sound card. No host connection. </p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 1" src="../voter/img/VOTER_Test_1.png" /></a></p>
<p>Inserting JP2 (20dB Pad):</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 2" src="../voter/img/VOTER_Test_2.png" /></a></p>
<p>If we do some circuit analysis, this is a first-order active LPF. The corner frequency (3dB point) is set by C29 and R34 (and R33 when the pad is enabled). With C29/R34, the corner frequency works out to be 1/(2*pi*R34*C29) = 7.234KHz. That actually explains why we see a roll off on the upper end in the first sweep (even though the measured 3dB point on that graph is around 5.8kHz, that can likely be explained by C29 tolerance). This is well above the pass band of the audio we are interested in (300Hz to 3kHz), so it is fairly irrelevant.</p>
<p>The roll-off at the bottom end of the sweep is likely due to C30.</p>
<p>Being an inverting amp, the gain is set by the ratio of R34/R36. So with JP2 out, the gain is 10, or 20log10 = 20dBv. If we insert JP2, R33 and R34 are now in parallel, for a combined resistance of 99.099k. Now our gain is 99.099/100 = 0.99, or 20log0.99 = -0.08dBv (effectively 0dBv gain). Hence, JP2 is indeed a 20dB pad.</p>
<p>Note that with JP2 in, the corner frequency of the filter is theoretically shifted to 73kHz... which is why the second sweep shows a flat response at higher frequencies (and the low-end roll off from C30 is still present).</p>
<h3 id="voter-voter-audioanalysis-ctcss-filter-response">CTCSS Filter Response</h3>
<p>Sweeping from Radio DB9 Pin 3 to U14 Pin 1 to characterize the response of the high-pass CTCSS Filter. 10uF cap on Mic input of sound card. No host connection. JP2 is OUT.</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 3" src="../voter/img/VOTER_Test_3.png" /></a></p>
<p>Sweeping from U14 Pin 2 to U14 Pin 1, just the CTCSS filter by itself:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 4" src="../voter/img/VOTER_Test_4.png" /></a></p>
<p>Again, the effects can be seen when sweeping through the Input Amp (a slight roll off at the higher end frequencies). Response is flat when sweeping through the CTCSS Filter directly.</p>
<p>The 3dB point of the filter is about 200Hz.</p>
<p>Some reverse-engineering of this filter seems to fit with it being a 6th-order Sallen-Key Butterworth filter. The filter coefficients seem to pretty closely match the resistors being used, when using Fc of 200Hz.</p>
<p>Reference <a href="https://web.mit.edu/6.101/www/reference/op_amps_everyone.pdf">Op Amps for Everyone</a> Pages 308, 309, 341. A 6th-order filter is 3 cascaded 2nd-order stages.</p>
<h3 id="voter-voter-audioanalysis-anti-alias-low-pass-filter-response">Anti-alias Low-pass Filter Response</h3>
<p>Sweeping from Radio DB9 Pin 3 to U4 Pin 1 to characterize the response of the Anti-alias LPF. 10uF cap on Mic input of sound card. Host connection established (mix mode/no GPS), <code>nodeemp</code> and <code>noplfilter</code> options set on client config to bypass hardware CTCSS and De-emphasis Filters (ASEL1=L, ASEL2=H).</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 5" src="../voter/img/VOTER_Test_5.png" /></a></p>
<p>The Anti-alias LPF 3db point is about 3.22kHz. Fairly flat response through the audio pass band (up to 3kHz).</p>
<p>Sweeping from U14 Pin 4 to U4 Pin 1. Just the Anti-alias Filter directly:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_6.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 6" src="../voter/img/VOTER_Test_6.png" /></a></p>
<p>There appears to be some impedance mismatch with the test setup, as there is higher loss observed... but the response is about the same.</p>
<h3 id="voter-voter-audioanalysis-de-emphasis-filter-response">De-emphasis Filter Response</h3>
<p>Sweeping from Radio DB9 Pin 3 to U14 Pin 5 to characterize the response of the De-emphasis Filter. 10uF cap on Mic input of sound card. Host connection established (mix mode/no GPS), <code>noplfilter</code> option set in client config to bypass CTCSS Filter (ASEL1=L), don't care about ASEL2.</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_7.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 7" src="../voter/img/VOTER_Test_7.png" /></a></p>
<p>Not the greatest response here.</p>
<p>There seems to be some gain here (note the peak response is about -6.2dBV, not the -15.8dBv we've seen on the other sweeps). The response is also not flat, that is probably some interaction with the input buffer stage.</p>
<p>The expected de-emphasis curve for LMR should have an Fc=212Hz (for 750uS de-emphasis), and roll off at 6dB/octave. We see Fc is around 370Hz, and the roll-off isn't very flat. We have 6dB/octave from 1kHz to 2kHz, but 4dB/octave from 2kHz to 3kHz, and 3dB/octave from 3kHz to 4kHz. </p>
<p>Tried sweeping the de-emphasis filter directly (U14 Pin 3 to U14 Pin 5), but there was too much loading, and not enough signal was recoverable (probably an interaction with the test setup).</p>
<p>If we do a little circuit analysis here, we can see this is probably a design issue.</p>
<p>The gain is coming from the relationship of R37/R38. In an inverting amplifier, this is going to give us a gain of 100/33=3.3, or 20log3.3=10.37dBv. That is pretty darn close to the about 9.6dBv (15.8-6.2) that was measured.</p>
<p>If we solve for Fc using R37/C31 (1/(2*pi*R*C)), we get 339Hz. Again, that is pretty close to the about 370Hz actually measured (that's within 10%, which is easily accounted for in the C31 tolerance, and the cheezy test setup). We would normally want Fc to be 212Hz for LMR applications.</p>
<p>Of note, solving for the time constant of R37/C31, we get 470uS... one would have expected that to have been 750uS.</p>
<p>So, I would say this is an unfortunate design oversight. The problem is, correcting it in the future would mean incompatibility with all the existing VOTER/RTCM's out there. So, perhaps, there will need to be some thought in adding some options for compatibility with existing hardware, versus deployment on new systems.</p>
<h3 id="voter-voter-audioanalysis-overall-rx-audio-chain-responses">Overall RX Audio Chain Responses</h3>
<p>Here are the responses for the RX Audio chain, measuring from Radio DB9 Pin 3 to U4 Pin 1. 10uF capacitor on Mic input of sound card. Host connection established (mix mode/no GPS). <code>noplfilter</code> and <code>nodeemp</code> options set as needed.</p>
<p>You will note the effect of the Anti-alias LPF in the responses at the upper end of the frequency range.</p>
<h4 id="voter-voter-audioanalysis-no-ctcss-filter-no-de-emphasis-filter">No CTCSS Filter, No De-emphasis Filter</h4>
<p>ASEL1=L, ASEL2=H</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 8" src="../voter/img/VOTER_Test_8.png" /></a></p>
<h4 id="voter-voter-audioanalysis-with-ctcss-filter-no-de-emphasis-filter">With CTCSS Filter, No De-emphasis Filter</h4>
<p>ASEL1=H, ASEL2=H</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_9.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 9" src="../voter/img/VOTER_Test_9.png" /></a></p>
<h4 id="voter-voter-audioanalysis-no-ctcss-filter-with-de-emphasis-filter">No CTCSS Filter, With De-emphasis Filter</h4>
<p>ASEL1=L, ASEL2=L</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 10" src="../voter/img/VOTER_Test_10.png" /></a></p>
<div class="admonition note">
<p class="admonition-title">Increased Audio Level</p>
<p>This test reveals a 9dB increase in audio level. That is odd. It is pointing to a design issue with the de-emphasis filter, as it is similar to what we saw when sweeping the de-emphasis filter directly.</p>
</div>
<h4 id="voter-voter-audioanalysis-with-ctcss-filter-with-de-emphasis-filter">With CTCSS Filter, With De-emphasis Filter</h4>
<p>ASEL1=H, ASEL2=L</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_11.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 11" src="../voter/img/VOTER_Test_11.png" /></a></p>
<div class="admonition note">
<p class="admonition-title">Increased Audio Level</p>
<p>This test reveals a 7dB increase in audio level. Likely caused by the de-emphasis filter response, again. However, on the positive side, we are seeing 7dB/octave de-emphasis from 300-900Hz (which is pretty close to the desired 6dB/octave), 5.8dB/octave from 1kHz to 2kHz, and 4.3dB/octave from 2kHz to 3kHz.</p>
</div>
<h3 id="voter-voter-audioanalysis-output-amplifier-response">Output Amplifier Response</h3>
<p>The Output Amplifier (U11) was not swept, as it was not easy to break in to the input for it to inject a signal.</p>
<p>However, we can do some circuit analysis and see that it is another first-order LPF. R59/C60 give it a corner frequency of 10.261kHz. R59/R62 give it a gain of 33, but it is also driven by the TX Level Pot to control the output level. There is likely some low-end roll off from C64.</p>
<h3 id="voter-voter-audioanalysis-summary">Summary</h3>
<p>So, some interesting observations were revealed in these sweeps.</p>
<p>We see that the CTCSS filter has a pretty good response. The anti-alias filter too seems to have a pretty good response.</p>
<p>The de-emphasis filter is a bit of an odd ball. It appears to have a decent amount of gain (unexpected), and the low-pass response is not very consistent with the desired Fc=212Hz and roll off at 6dB/octave. However, when both the CTCSS filter and the de-emphasis filter are both in-circuit, the de-emphasis response is better, but we still have unexpected gain.</p>
<p>As a result of these observations one should be very careful when aligning their audio levels, and do not change options "on-the-fly" once they are set, as it will have a direct effect on the audio response in to Asterisk.</p>
<h2 id="voter-voter-audioanalysis-squelchrssi-circuitry-sweeps">Squelch/RSSI Circuitry Sweeps</h2>
<h3 id="voter-voter-audioanalysis-input-pad-response">Input Pad Response</h3>
<p>Sweeping from Radio DB9 Pin 3 to U1 Pin 5. 10uF cap on Mic input of sound card. Checking response of JP1. With JP1 IN:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_12.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 12" src="../voter/img/VOTER_Test_12.png" /></a></p>
<p>Removing JP1 provides about 33dB of additional loss (padding). The high-pass response is a function of C10 (0.1uF).</p>
<h3 id="voter-voter-audioanalysis-noise-filter-response">Noise Filter Response</h3>
<p>Sweeping from U1 Pin 5 (TP2) to U2 Pin 14 (TP1), shorting U1 Pin 5 to 6 because U1 is in-initialized and at max R. 10uF cap on Mic input to sound card.</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_13.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 13" src="../voter/img/VOTER_Test_13.png" /></a></p>
<p>Fc appears to be around 9kHz of the high-pass filter. </p>
<h3 id="voter-voter-audioanalysis-summary_1">Summary</h3>
<p>As noted in the VOTER System Documentation, this is a high-pass filter used to measure high-frequency noise from the discriminator, in order to determine how quiet (strong) the signal is. The stronger the signal is, the less high-frequency audio components there will be (since the signal will be "quieter"). When this audio is rectified by U2A (and its associated components), a DC RSSI is generated to quantify the signal strength. A DC voltage closer to 0V would be a stronger signal.</p>
<p>That is why it is very important to have a radio with discriminator audio that has good high-frequency response, and why radios like the Motorola Quantar and SLR present issues (as their "discriminator audio" really isn't, it is processed, and doesn't have the necessary high frequency response).</p>
<h2 id="voter-voter-audioanalysis-audio-response-through-asterisk">Audio Response THROUGH Asterisk</h2>
<h3 id="voter-voter-audioanalysis-calibration">Calibration</h3>
<p>In order to sweep audio through <code>Asterisk/app_rpt</code>, we're going to need to calibrate the VOTER. Of course, this is going to be a little tricky, since we aren't actually using a radio with discriminator audio. However, we to have a "white noise" generator we can use to our advantage to simulate that.</p>
<p>Using the REW output at -12.06dBv gives us about 300mVpp at the Radio DB9 Pin 3 (measured with a scope).</p>
<p>Use the white noise generator, and put the VOTER in to Squelch and Diode calibration mode with the appropriate jumpers (with JP1 IN). The board calibrates with a noise value around 61, and about 125mVpp is measured at U2 Pin 5.</p>
<p>During calibration, 1 flash of the COS LED every about 4 seconds means the calibration is in progress. One flash every 1 second means the audio is too low. One flash every 0.5 seconds means the audio level is too high.</p>
<p>Normalize all jumpers settings, reboot the VOTER, restart Asterisk (as a side note, put <code>noplfilter</code> and <code>nodeemp</code> in the client config in <a href="#config-voter_conf"><code>voter.conf</code></a> to get a flat response through the VOTER).</p>
<p>The Squelch Pot can now be adjusted (with the white noise generator still on), until the COS LED goes out. Note that turning OFF the white noise generator makes the VOTER assume there is a "full-quieting" signal on the receiver, and will open the squelch. Read that last part again.</p>
<p>Use the REW signal generator to generate a 1kHz tone (at the nominal -12.06dBv level). Use the RX Level (Main Menu Item 97) display and the RX Level pot to adjust to the 3kHz mark. Measure the level on the Radio DB9 Pin 3 with a scope.</p>
<p>Audio should be repeating through Asterisk, so move the scope to Radio DB9 Pin 2 (TX Audio Output), and adjust the TX Level Pot for the same level measured on the DB9 pin 3. </p>
<p>Switch back to the white noise generator to close the squelch.</p>
<p>You should now have a "calibrated" VOTER/Asterisk system, like you normally would when connected to a repeater. There should be a 1:1 level from input to output (through <code>app_rpt</code>) of the VOTER. Now we can proceed with measuring frequency response.</p>
<h3 id="voter-voter-audioanalysis-baseline-measurement-through-asterisk">Baseline Measurement Through Asterisk</h3>
<p>For this measurement, we want <code>noplfilfer</code> and <code>nodeemp</code> set in <a href="#config-voter_conf"><code>voter.conf</code></a>. This switches OUT both the hardware CTCSS and De-emphasis Filters. This should be a baseline response through <code>app_rpt</code>:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_14.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 14" src="../voter/img/VOTER_Test_14.png" /></a></p>
<p>Note that our new baseline relative level is about -20dBv.</p>
<p>Audio pass band response from 300Hz-3kHz is pretty flat. There is some roll off below 100Hz, and it looks like the "brick wall" above 3kHz is probably an effect of the CODEC.</p>
<h3 id="voter-voter-audioanalysis-no-ctcss-filterwith-de-emphasis">No CTCSS Filter/With De-emphasis</h3>
<p>This is the response with the <code>noplfilter</code> option only for the client in <a href="#config-voter_conf"><code>voter.conf</code></a>. Therefore, de-emphasis is ENABLED:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_15.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 15" src="../voter/img/VOTER_Test_15.png" /></a></p>
<p>We see the (unfortunate) effect of gain in the de-emphasis filter. The de-emphasis is about 4dB/octave.</p>
<h3 id="voter-voter-audioanalysis-with-ctcss-filterno-de-emphasis">With CTCSS Filter/No De-emphasis</h3>
<p>This is the response with the <code>nodeemp</code> option only for the client in <a href="#config-voter_conf"><code>voter.conf</code></a>. Therefore, the CTCSS filter is ENABLED:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 16" src="../voter/img/VOTER_Test_16.png" /></a></p>
<p>There are a few artifacts in the measurement, but it effectively matches what the sweep of the hardware filter was.</p>
<h3 id="voter-voter-audioanalysis-with-ctcss-filterwith-de-emphasis">With CTCSS Filter/With De-emphasis</h3>
<p>This is the response with no options on the client in <a href="#config-voter_conf"><code>voter.conf</code></a>, effectively the default configuration. Both the hardware CTCSS Filter and De-emphasis Filter are ENABLED:</p>
<p><a class="glightbox" href="../voter/img/VOTER_Test_17.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Test 17" src="../voter/img/VOTER_Test_17.png" /></a></p>
<h3 id="voter-voter-audioanalysis-summary_2">Summary</h3>
<p>The audio response sweeping through <code>Asterisk/app_rpt</code> is pretty much as expected, reflecting the response seen when sweeping the VOTER hardware directly. The only real difference seen is the "brick wall" above 3kHz, which is likely due to the characteristics of the CODEC being used for the audio transport.</p>
<h2 id="voter-voter-audioanalysis-other-options">Other Options</h2>
<h3 id="voter-voter-audioanalysis-plfilter-and-hostdeemp"><code>plfilter</code> and <code>hostdeemp</code></h3>
<p>What about the <code>plfilter</code> and <code>hostdeemp</code> options in <a href="#config-voter_conf"><code>Voter.conf</code></a> you ask?</p>
<p>Well, those options don't actually affect the audio THROUGH Asterisk (from the associated receiver to the transmitter), they affect the audio that would be going to the channel driver and to connected nodes.</p>
<p>These options are designed to be used with <a href="#voter-voter-chan_voter-duplex-mode-3hostdeemp">"Duplex Mode 3"</a>. In that mode, the actual repeat audio for the repeater attached to the VOTER is done "in-cabinet", that is, audio is routed on the VOTER directly from receive to transmit, without going to the Asterisk host first. Asterisk sends telemetry tones and linked audio to the VOTER to mix in to the transmitter, but the repeat audio doesn't transit the host.</p>
<p>As such, Duplex Mode 3 is designed to use discriminator audio. That audio typically needs to be de-emphasized (and optionally CTCSS filtered), before Asterisk can do stuff with it (repeat it to linked nodes, DTMF decode, etc.). That is where these options, <code>hostdeemp</code> and <code>plfilter</code> come in. When those options are set, they apply software filters to the incoming discriminator audio (from the VOTER), before presenting it to the <code>app_rpt</code> channel driver.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be forewarned, do NOT mess with the <code>hostdeemp</code> option, if you are not using Duplex Mode 3!! Unpredictable (unwanted) results happen when you have a mismatch between Duplex Mode 3 set in the VOTER, <code>hostdeemp</code> enabled in <a href="#config-voter_conf"><code>voter.conf</code></a>, and <code>duplex=3</code> in <a href="#config-rpt_conf"><code>rpt.conf</code></a>. Having those settings not matched (either all on, or all off) will cause the hardware de-emphasis filter in the VOTER to toggle on and off when either the VOTER restarts or Asterisk restarts. This is definitely <strong>NOT</strong> what you want!</p>
</div>
<p>Note that these options seem that they are supported on a <em>per-client</em> basis, but they are apparently not (tested and confirmed that <code>hostdeemp</code> on a client config does not change the hardware de-emphasis filter setting). They appear to be supported on a <em>per-instance</em> basis only.</p>
<h3 id="voter-voter-audioanalysis-gtxgain"><code>gtxgain</code></h3>
<p>This is another obscure per-instance option in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>This option allows positive and negative floating values (ie 6.0 or -6.5), measured in dB. It will adjust the audio level sent from Asterisk to the transmitter(s) by the desired amount. This was measured and confirmed to be relatively accurate.</p>
<h3 id="voter-voter-audioanalysis-sawyer-mode">Sawyer Mode</h3>
<p>The operation of <a href="#voter-voter-menus-sawyer-mode">Sawyer Mode</a> was also confirmed in these tests.</p>
<p>Sawyer Mode controls the operation of the hardware CTCSS Filter on the VOTER when Offline Mode is used. </p>
<p>If the hardware CTCSS Filter is enabled, Option 1170=1, and Offline Mode is enabled, the loss of connection to the Host causes the hardware CTCSS Filter to turn OFF. When the connection to the Host is restored, the CTCSS Filter turns back ON.</p>
<p>This is contrast to normal operation where entering Offline Mode has no effect on the hardware CTCSS Filter.</p></section><section class="print-page" id="voter-voter-quantar"><h1 id="voter-voter-quantar-voter-and-the-quantar">VOTER and the Quantar</h1>
<p>This page discusses interfacing the Motorola Quantar to the VOTER/RTCM interface, for use with AllStarLink.</p>
<p>This page should get you up and running with how to connect a VOTER/RTCM to a Motorola Quantar (Quantro should be similar). These are just the basic configuration steps, based on the following scenario:</p>
<ul>
<li>Analog repeater</li>
<li>Receive Carrier Squelch (with AllStarLink generating a TX-only PL)</li>
<li>Main repeater in a voting system</li>
<li>Supporting "offline" repeater mode</li>
</ul>
<p>Some things to consider:</p>
<ul>
<li>Install JP1 on the Quantar's VOTER/RTCM. The squelch should calibrate at around 4 blinks rather than the 12 blinks or so without JP1</li>
<li>Be sure you've done the diode and squelch calibration with the actual attached radio (no antenna)</li>
<li>The Quantar firmware should be 20.14.48 as later versions have better noise output</li>
<li>Each VOTER/RTCM should have the squelch 3 to 5 turns past threshold to prevent the squelch form being too loose. Somewhere around the 350 level seems about right</li>
<li>Don't "and" CTCSS with squelch. That may override the VOTER/RTCM's squelch detection. Compare with CTCSS on and off to see effect, if any</li>
<li>You may (probably) want to install the <a href="#voter-voter-audio-dspbew-firmware-version">DSP/BEW</a> firmware in the VOTER/RTCM</li>
</ul>
<h2 id="voter-voter-quantar-supporting-documentation">Supporting Documentation</h2>
<p>The following links are useful for reference:</p>
<ul>
<li><a href="https://wiki.w9cr.net/index.php/Quantar">W9CR Quantar Site</a>, Bryan has a LOT of useful and relevant info on his page including manuals and firmware</li>
<li><a href="http://www.repeater-builder.com/motorola/quantar/quantar-index.html">Repeater Builder Quantar Site</a>, go here for additional documentation</li>
<li><a href="#voter-rtcm-hardware">RTCM Hardware Client</a> page on this site</li>
<li><a href="#voter-voter-hardware">VOTER Hardware Client</a> page on this site</li>
<li><a href="../voter/assets/QUANTAR-RTCM_INTERFACE_CABLE.pdf">Quantar/RTCM Interface Cable</a> or <a href="../voter/assets/RTCM_2_Quantar.pdf">this alternate</a></li>
</ul>
<h2 id="voter-voter-quantar-firmware">Firmware</h2>
<h3 id="voter-voter-quantar-quantar-firmware">Quantar Firmware</h3>
<p>You will want to have newer (ie R020.014.048) firmware in the Station Control Module (SCM). Head on over to <a href="https://wiki.w9cr.net/index.php/Quantar">Bryan's Site</a> to download the firmware files. You will also want to get the RSS manual and Service Manual when you are there. </p>
<p>Upgrade the firmware in your SCM and Wireline module, using the instructions in your RSS manual. You should end up with something like this when you go look at the versions screen in the RSS:</p>
<div class="highlight"><pre><span></span><code>Station Control Firmware    R020.14.048
Station Wireline Firmware   R020.14.003
Station Exciter Firmware    R020.09.018
Station Boot2 Firmware      R020.14.015
Station Boot1 Firmware      R020.09.011
Codeplug Version        14
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will want to update your codeplug too, that is under the Tools --&gt; Codeplug Upgrade menu.</p>
</div>
<p>The firmware in the Exciter is not automatically upgraded. You will need to do that by burning a 27C512 EPROM, popping the cover off the exciter, and swapping the chip out. You <strong>DO</strong> want to do this, as there are a number of fixes in later firmware (apparently), especially if you plan on running P25 mixed mode at some point later.</p>
<h3 id="voter-voter-quantar-voterrtcm-firmware">VOTER/RTCM Firmware</h3>
<p>The Quantar is special in that the "discriminator" audio isn't really conventional analog discriminator audio as you would normally find in any other radio. The true discriminator audio is filtered through a 6kHz LPF filter, digitized, and then moved around the backplane buss to different cards.</p>
<p>The VOTER/RTCM traditionally uses high frequency (above the passband) discriminator audio to do it's RSSI calculations. Since the audio response is limited to &lt;6kHz on the Quantar, this presents a challenge. To combat this, additional code was added to the VOTER/RTCM firmware called the "DSP/BEW" option. Read about it more on the <a href="#voter-voter-audio-dspbew-firmware-version">VOTER Audio</a> page.</p>
<p>Regardless, you will need to upgrade the firmware in your VOTER/RTCM (it likely comes with vanilla V1.50 firmware), to use one of the versions with DSP/BEW. Note that due to space constraints, the DSP/BEW firmware is mutually exclusive with the Diagnostics Mode in the VOTER/RTCM (there's not enough room for both).</p>
<p>You will also likely want to install a newer version with the <a href="#voter-voter-audio-chuck-squelch">"Chuck" squelch</a> fix... this is really a buffer overflow fix that makes the squelch reporting behave a bit better.</p>
<p>The RTCM needs the "smt" version files, the VOTER uses the non-smt version files.</p>
<p>Firmware is available on the <a href="https://github.com/AllStarLink/voter/tree/master/board-firmware">AllStarLink GitHub Repository</a>. Instructions and the other utilities needed are all listed on the <a href="#voter-voter-firmware">VOTER Firmware</a> page.</p>
<h3 id="voter-voter-quantar-wiringconnections">Wiring/Connections</h3>
<p>A good primer on the connections available on the backplane can be found over on <a href="http://www.repeater-builder.com/motorola/quantar/q-interfacing/quantar-interfacing.html">Repeater Builder</a> Repeater Builder, or dig through the various manuals.</p>
<p>It is best to use the "Telco" connector, J17, to make the interface cable. This requires a 50-pin MALE Amphenol connector and 90 degree hood. Carefully solder the connections if you have to, or find your local communications installer buddy with an Amphenol "butterfly" tool to crimp one for you. </p>
<p>A good cable to use is this one:
<a href="../voter/assets/QUANTAR-RTCM_INTERFACE_CABLE.pdf">Quantar/RTCM Interface Cable</a></p>
<p>There are a couple minor notes when using this cable. The connection to Pins 26/27 are not required (those are Line 1- and Line 2-, which aren't used), instead, connect Pin 43 (RDSTAT-) to Pin 32 (GND).</p>
<p>In reality, if you are using the VOTER/RTCM to do squelch (which you should be), then the RDSTAT connection isn't even necessary.</p>
<p>For the RTCM, build the necessary breakout cable for the DB15 to split out the serial console, and the connections to your GPS. Note that you will need to configure JP4 and JP5 inside the RTCM for TTL/RS-232, as required. <strong>Beware</strong> the label on the RTCM is misleading, you want to use the GTX Pin (14) for data <strong>from</strong> your GPS <strong>to</strong> the RTCM. The GRX (data <strong>from</strong> the RTCM <strong>to</strong> the GPS is not required, as it is not used).</p>
<p>For the VOTER, build your appropriate interface cable.</p>
<h2 id="voter-voter-quantar-quantar-audio">Quantar Audio</h2>
<p>The biggest headache in the Quantar is audio.</p>
<p>As mentioned above, you don't get "true" discriminator audio out of the shelf, but you do get a reasonable facsimile.</p>
<p>If you go dig DEEP in the Quantar Digital-Capable Station Instruction manual, p/n 6881095E05, (on <a href="http://www.repeater-builder.com/motorola/quantar/quantar-index.html">Repeater Builder</a>), and dive in to <a href="http://www.repeater-builder.com/motorola/quantar/qim/part-14-station-configuration.pdf">Part 14 - Station Configuration</a>, you will find a section called "Fast Keyup Feature".</p>
<p>This is where it talks about using Pins 5 and 30 on J17 to get audio in and out of the station, using the "Splatter Filter Connection Configuration". It also talks about using Pin 23 on the MRTI connector for PTT, but ignore that, we'll use the EXT PTT input on J17 instead.</p>
<p>Note that the actual "Fast Keyup" feature only shows up in the RSS if you enable WildCard=Enhanced, then it shows up on the RF Configuration screen.</p>
<p>The audio that shows up on J17 30, J14 7, and J14 22 is all the same. They are also all gated audio. You can't get un-squelched (ie open discriminator) audio unless you either configure the station for Un-squelched Audio on the Channel Information screen, or program the WildCard. Also know that if the WildCard is not programmed, you will not get ANY audio out on the back, unless you turn on the Phone Patch option.</p>
<p>We are going to do all the pre-emphasis and de-emphasis in the VOTER/RTCM and AllStarLink, so we want to make sure to disable any audio filtering on the channel inside the Quantar. If you don't your audio is going to sound like garbage.</p>
<h3 id="voter-voter-quantar-important-audio-rss-settings">Important Audio RSS Settings</h3>
<p>The following settings are needed to make the audio behave the way we want:</p>
<p><strong>Hardware Configuration Screen</strong></p>
<ul>
<li>Wireline: 8-wire</li>
<li>WildCard: Enhanced</li>
<li>Phone Patch Interface: Disabled</li>
</ul>
<p><strong>Channel Information Basic</strong></p>
<ul>
<li>Analog RX Activation: S=Carrier Sql.</li>
<li>Analog Rptr Activation: OFF</li>
<li>Analog Rptr Hold-In: OFF</li>
<li>Analog Rptr Access: NONE</li>
</ul>
<p><strong>Channel Information Advanced</strong></p>
<ul>
<li>Pre-emphasis: DISABLED</li>
<li>De-emphasis: DISABLED</li>
<li>High-Pass Filter: DISABLED</li>
</ul>
<p><strong>RF Configuration</strong></p>
<ul>
<li>Repeater Operation: BASE</li>
</ul>
<h3 id="voter-voter-quantar-wildcard-programming">WildCard Programming</h3>
<p>This is how you actually get the audio and logic to work. Without this, you can get audio out of the shelf using other configurations, but you can't key or or get modulation in.</p>
<p>The WildCard Input and Output screens should be fine at defaults. Just make sure that Aux Input 9 is set for LO (this is our PTT).</p>
<p>The important configuration is in the WildCard Tables.</p>
<p>Delete any existing WildCard Tables, you are going to create two new ones. Configure them as shown below:</p>
<p>This is the important one to actually turn on the discriminator audio output on the backplane when the station boots/reboots:</p>
<div class="highlight"><pre><span></span><code>Description: DISC AUDIO ON
State: COLD RESET Cond: OR State: WARM RESET
Action: RXDSC-AUXRX-ON
Inaction: NULL
</code></pre></div>
<p>This is how we allow external PTT, and gate the AUX TX audio from Pin 5 to the Exciter:</p>
<div class="highlight"><pre><span></span><code>Description: TX AUDIO
State: INPUT 9
Action: DEKEY FROM WL; AUXTX-TX OFF
Inaction: KEY FROM WL; AUXTX-TX ON
</code></pre></div>
<h2 id="voter-voter-quantar-allstarlink-asterisk-configuration">AllStarLink (Asterisk) Configuration</h2>
<p>The VOTER/RTCM connect to AllStarLink (Asterisk) using the <code>chan_voter</code> channel driver. Make sure you have that set up in <a href="#config-rpt_conf"><code>rpt.conf</code></a>, something like:</p>
<div class="highlight"><pre><span></span><code>rxchannel=voter/&lt;nodenumber&gt;
</code></pre></div>
<p>The rest of the configuration is done in <a href="#config-voter_conf"><code>voter.conf</code></a>. We won't go in to all the details on the options here, but will go through some basic settings to get on the air and levels lined up.</p>
<p>You are going to want to start with something basic in <a href="#config-voter_conf"><code>voter.conf</code></a> like:</p>
<div class="highlight"><pre><span></span><code>[general]
port = 667
buflen = 500
password = mypass                      ; This is the HOST PASSWORD in the RTCM
utos = y                               ; Turns on TOS packet marking from AllStar TOWARDS the RTCM

[1999]                                 ; your node number, referenced by the channel driver in rpt.conf
MAIN_SITE = clientpass,transmit,master ; clientpass is the CLIENT PASSWORD in the RTCM

plfilter = 0                           ; leave off for now
txctcss = 100.0                        ; set to your desired TRANSMIT PL tone, MUST set it to SOMETHING
txctcsslevel = 0                       ; set to 0 for now, until audio alignment is done later
txtoctype = phase                      ; the type of &quot;reverse burst&quot; to send when de-keying
</code></pre></div>
<p>That takes care of the basic settings required Asterisk. During the audio alignment, the <code>txctcsslevel</code> will be adjusted for the correct deviation.</p>
<h2 id="voter-voter-quantar-voterrtcm-configuration">VOTER/RTCM Configuration</h2>
<p>There is lots of stuff to configure in the VOTER/RTCM too. You will want to establish a serial console connection (through the DB9/DB15), using 57600/8N1.</p>
<div class="admonition note">
<p class="admonition-title">Save and Reboot</p>
<p>Remember to Save Values to EEPROM (<code>99</code>) and Reboot (<code>r</code>) when you make changes, or you will have unpredictable results. Some changes are immediate, but many are not, and will confuse you when things you expect to happen, don't.</p>
</div>
<p>Start with the <code>IP Parameters Menu</code>. This should be all straight forward. This will get your VOTER/RTCM on the network.</p>
<p>Back on the <code>Main Menu</code>, you will want to make sure your <code>VOTER Server Address</code>, <code>Port</code>, and <code>Passwords</code> are set. See the <a href="#voter-voter-menus">notes</a> about which password is which. You will also need to configure your GPS settings. Make sure to set the jumpers inside the RTCM for RS-232 or TTL, as needed. You may need to play with the <code>GPS Serial Polarity</code> and <code>GPS PPS Polarity</code> until you get data flowing. </p>
<p>If you set the <code>Debug Level</code> to <code>32</code>, you will know right away if you are getting GPS data into the VOTER/RTCM, as this setting will print the NMEA or TSIP strings being received. This is an immediate setting, no need to save and reboot.</p>
<p>We want <code>External CTCSS</code> set to <code>Ignore</code> (this is where the RDSTAT would be connected, but we are not using that).</p>
<p>We want <code>COR Type</code> set to <code>Normal</code>. This is an important setting, as it also determines whether de-emphasis takes place, or not. See the <a href="#voter-voter-audio">VOTER Audio</a> page for an explanation of how that works.</p>
<p>We want <code>DSP/BEW Mode</code> set to <code>1</code> to enable it. </p>
<p>Finally, we will configure the <code>Offline Mode Parameters</code> menu. </p>
<p>We want to fail over to repeater mode, if we lose connection to the host, so set <code>Offline Mode</code> to <code>3</code>.</p>
<p>The <code>CW "Offline"</code> setting is what the VOTER/RTCM will send when it goes in to offline mode, the repeater callsign should go here.</p>
<p>The <code>"Offline" (CW ID) Period Time</code> is how often the repeater will ID in offline mode, set to <code>18000</code> to ID every 30 minutes.</p>
<p>Set the <code>Offline CTCSS Tone</code> for <code>100.0Hz</code> (or your desired TX PL tone). You will want this to be the same as you set in <a href="#config-voter_conf"><code>voter.conf</code></a>.</p>
<p>Leave the <code>Offline CTCSS Level</code>, for now, it will be adjusted later.</p>
<p>Set the <code>Offline De-Emphasis Override</code> to <code>1 (OVERRIDE)</code>. <code>1</code> is the correct setting for this application.</p>
<p>That should be it for software configuration, remember to save and reboot the VOTER/RTCM.</p>
<p>For hardware settings, in the VOTER/RTCM you will want to make sure that JP1 is IN and JP2 is OUT. When you do the squelch calibration, the VOTER/RTCM should calibrate in about 4-6 blinks, instead of around 12. The <code>Squelch Noise Gain Value</code> should be around <code>43</code> (versus <code>93</code>). JP3 can remain at 1-2, as there is plenty of audio drive by default.</p>
<h2 id="voter-voter-quantar-alignment">Alignment</h2>
<p>This section is based on using an HP8920 (HP8921) for alignment. Other test sets will differ. You <strong>must</strong> use a test set to properly tune the system... no "doing it by ear".</p>
<h3 id="voter-voter-quantar-prerequisites">Prerequisites</h3>
<p>With the configuration above, you should have GPS lock, and the VOTER/RTCM should be connected to the AllStarLink host.</p>
<p>You should have already tuned the pre-selector on the receiver in the station. If not, follow the instructions in the manuals. Pro tip, with the station powered on, look into the receive port with your return loss bridge, and tune for a null (best match).</p>
<p>Do the squelch and diode calibration on the VOTER/RTCM: </p>
<ul>
<li>Ensure the station receive cable is disconnected</li>
<li>Install JP9/JP10 (VOTER) or turn ON (down) DIP SW2-2 and SW2-3 (RTCM)</li>
<li>Reset the VOTER/RTCM</li>
<li>Observe the RX LED blink slowly 4-6 times before going solid</li>
<li>Remove JP9/10 (VOTER) or turn OFF DIP SW2-2 and SW2-3. The VOTE/RRTCM should reset. Confirm on the status screen (<code>98</code>) that the <code>Squelch Noise Gain Value</code> is around <code>43</code>, and the <code>Diode Cal. Value</code> is around <code>39</code>.</li>
</ul>
<p>Set up your test set for Duplex Test.</p>
<p>Connect the RF IN/OUT to the Exciter output. Connect the Duplex Out to the Receiver input.</p>
<p>Duplex Screen Settings:</p>
<div class="highlight"><pre><span></span><code>Tune Mode: Manual
Tune Freq: repeater TX frequency
Input Port: RF In
RF Gen Freq: repeater RX frequency
Amplitude: -80dBm (off)
Output Port: Dupl
AFGen1 Freq: 1kHz
AFGen1 To: FM 3.00kHz
AF Anl In: FM Demod
Filter 1: 50Hz HPF
Filter 2: 15kHz LPF
De-emphasis: 750uS
Detector: Pk+-Max
SINAD meter changed to AF Freq meter
</code></pre></div>
<p>Confirm that when you turn on the RF Gen, the station keys, and you should get audio demodulating on the test set as audio goes through the Asterisk host and back out. If not, troubleshoot your Asterisk configuration, check your RSS settings, wiring, etc.</p>
<h3 id="voter-voter-quantar-allstar-asterisk-alignment">AllStar (Asterisk) Alignment</h3>
<p>As mentioned above, we are starting by sending audio through the Asterisk host. </p>
<ul>
<li>Send 1kHz @ 3kHz on-channel in to the receiver</li>
<li>TX should key and audio should come back</li>
<li>Use Menu <code>97</code> in the VOTER/RTCM to display audio level. Adjust the RX pot on the VOTER/RTCM until the bar graph hits the 3kHz mark</li>
<li>Adjust the TX pot on the VOTER RTCM for 3kHz measured transmitter deviation on the test set</li>
</ul>
<p>Sweep the AFGen1 Freq up and down from 1kHz, leaving the deviation at 3kHz, and observe that the transmitter deviation remains around 3kHz between 400-3kHz. The Quantar has pretty sharp filters, so you will see the deviation drop off below 400Hz (very sharply below 300Hz), and it will start to roll off slowly around 1.9kHz (measures around 2.7kHz deviation), but will drop sharply at 3kHz. If the deviation rolls off wildly, you have a setting wrong somewhere, either in the Channel Information in the RSS, or you didn't set the CTCSS tone and a level of <code>0</code> in <a href="#config-voter_conf"><code>voter.conf</code></a>. </p>
<p>De-key the station (turn off the RF Gen), and disconnect the GPS to force the VOTER/RTCM in to offline mode. Temporarily set the CTCSS tone to 0.0Hz, save and reboot.</p>
<ul>
<li>Turn on the RF Gen</li>
<li>Send 1kHz at 3kHz deviation in to the receiver</li>
<li>Confirm TX Deviation is still about 3kHz, tweak the TX pot if needed (or just leave it, it should be close)</li>
<li>Sweep the AFGen1 Freq up and down as above, and confirm relatively flat deviation of the TX from 400Hz-3kHz, as noted above</li>
<li>Turn off AFGen1 modulation (set AFGen1 To to OFF)</li>
<li>Set Filter 1 to &lt;20Hz HPF and Filter 2 to 300Hz LPF to filter on CTCSS only</li>
<li>Set CTCSS tone in VOTER/RTCM to desired TX CTCSS tone, save and reboot if necessary</li>
<li>Adjust Offline CTCSS Level as needed to measure around 0.5kHz TX deviation on the test set</li>
<li>De-key the station, save and reboot the VOTER/RTCM with the final setting</li>
</ul>
<p>Lastly, we will set the PL deviation from the Asterisk host. Restore the GPS connection to the VOTER/RTCM, and ensure it locks and connects back to the host. The test set should still have the 1kHz modulation turned off, and filters set up to measure PL deviation.</p>
<ul>
<li>Key the station</li>
<li>Set the txctcsslevel to around <code>55</code> (should have started at <code>0</code>). Reload Asterisk to pick up the change</li>
<li>Measure TX deviation of the PL tone</li>
<li>Adjust <code>txctcsslevel</code> (and reload Asterisk) until around 0.5kHz TX deviation is measured on the test set</li>
<li>De-key the station</li>
<li>Turn on the <code>plfilter</code> option in <a href="#config-voter_conf"><code>voter.conf</code></a> (if desired), to filter out user's PL tones, if they are transmitting one</li>
</ul>
<p>Finally, with nothing connected to the receiver (or probably better, with the station antenna connected to pick up all the site noise), turn the SQL pot on the VOTER/RTCM CCW until the squelch opens. Then, turn the pot about 5 turns CW to tighten the squelch. Adjust as desired from there, you can note the squelch level setting in the Status Menu (<code>98</code>).</p>
<h2 id="voter-voter-quantar-conclusion">Conclusion</h2>
<p>That should be it, you should now have a fully functioning VOTER/RTCM AllStarLink interface. Your audio should sound great, and you can customize from here.</p>
<p>If you happen to be lucky enough to have Quantar Satellite Receivers, the process is pretty much the same, except you won't need to do any of the transmitter settings, nor the associated wiring. You really only need power and Aux RX Audio out of J17 to the VOTER/RTCM.</p>
<p>Once you get everything installed, the final thing you will need to do is configure all the buffer settings. See the <a href="#voter-voter-buffers">VOTER Buffers</a> page for the process to do that.</p></section><h1 class='nav-section-title-end'>Ended: VOTER/RTCM</h1>
                        <h1 class='nav-section-title' id='section-developer-guide'>
                            Developer Guide <a class='headerlink' href='#section-developer-guide' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="developers"><h1 id="developers-developer-guide">Developer Guide</h1>
<p>The pages in this section are geared towards ASL3 developers. </p>
<p>It contains information on how packages/releases are built and managed from the <a href="https://github.com/AllStarLink">GitHub Repository</a>, as well as information on building ASL3 from source.</p></section><section class="print-page" id="developers-package-builds"><h1 id="developers-package-builds-building-asl3-asterisk">Building ASL3-Asterisk</h1>
<h2 id="developers-package-builds-building-deb-files">Building .deb Files</h2>
<p>These directions outline how to create the <code>.deb</code> files via GitHub using the Action workflows and the ASL custom runner AMIs in AWS.</p>
<p>Kicking off the build processes requires knowledge of all of the topics below before starting it.</p>
<h2 id="developers-package-builds-package-version-format">Package version format</h2>
<p>All packages created by this repo have the following version format based on <code>deb-version(7)</code> manpage explanation.</p>
<div class="highlight"><pre><span></span><code> ${EPOCH}:${ASTERISK_VERSION}+asl3-${RPT_VERSION}-${PACKAGE_VERSION}

|----+---|--------+--------------------------X-----+--------X
     |            |                                |
     |            +-- &quot;upstream-version&quot;           |
     |                                             |
     +-- &quot;epoch&quot;               &quot;debian-revision&quot; --+
</code></pre></div>
<p>The values are defined as follows:</p>
<ul>
<li>
<p><code>EPOCH</code> - By Debian Asterisk convention this is hardcoded as "2"</p>
</li>
<li>
<p><code>ASTERISK_VERSION</code> - The Asterisk LTS version to use for these packages - e.g. 20.8.1</p>
</li>
<li>
<p><code>RPT_VERSION</code> - The <code>app_rpt</code> version to use for these packages. This should be based on the tag of the release of app_rpt applied to that repository that is driven  by the major, minor, and patch versions listed in <code>app_rpt.h</code></p>
</li>
<li>
<p><code>PACKAGE_VERSION</code> - The ASL3 project release version of the package build. Usually "1" unless there was a problem specifically with package building that caused a new .deb publication needed. In general, this is only incremented if <code>ASTERISK_VERSION</code> and <code>RPT_VERSION</code> aren't changing but something needed to be changed in the <code>debian/</code> build directory</p>
</li>
</ul>
<p>A file generated from this repo using the versioning format above will be named, for example <code>asl3-asterisk-20.8.1+asl3-3.0.0-1</code>. Note that the <em>epoch</em> does not appear in the filename by Debian convention.</p>
<h2 id="developers-package-builds-determining-asterisk-version">Determining Asterisk Version</h2>
<p>Currently, this is structured to be built against Asterisk 20 Long Term Servicing (LTS). Do not use any version of Asterisk that is not the latest version of Asterisk 20 LTS.</p>
<p>The version is listed at <a href="https://www.asterisk.org/downloads/">Download Asterisk</a>. The version of Asterisk entered in the Actions launcher will cause the proper version of Asterisk 20 LTS to be downloaded and folded into the builder.</p>
<h2 id="developers-package-builds-locking-in-and-determining-the-app_rpt-version">Locking In and Determining the app_rpt Version</h2>
<p>When a build of <code>.deb</code> files is initiated, the <code>app_rpt</code> repo must be tagged prior to initiating the build process. The tag version should be in the format <code>MAJOR.MINOR.PATCH</code> as found in <code>app_rpt.h</code>.</p>
<h2 id="developers-package-builds-determining-the-package-version">Determining the Package Version</h2>
<p>This should be a monotonically increasing integer starting with "1", reflecting a change in Asterisk Version + <code>app_rpt</code>. For example, if building Asterisk 20.8.1 with <code>app_rpt v3.0.0</code>, then the first build of a package should be "1", the second "2", and so on.</p>
<p>However, if from the above example, <code>app_rpt</code> is now v3.1.0 or Asterisk becomes 20.9.0 then the package version should reset back to "1" and start over.</p>
<h2 id="developers-package-builds-create-a-github-release">Create a GitHub Release</h2>
<p>Create a <a href="https://github.com/AllStarLink/asl3-asterisk/releases">Release</a> to store the <code>.deb</code> files in. The name of the release should follow the format:</p>
<div class="highlight"><pre><span></span><code>ASTERISK_VERSION_asl3-RPT_VERSION-PACKAGE_VERSION
</code></pre></div>
<p>For the above example of Asterisk "20.7.0", <code>app_rpt</code> "1.2", and package version "1" the release tag and name would be:</p>
<div class="highlight"><pre><span></span><code>20.7.0_asl3-1.2-1
</code></pre></div>
<p><strong>NOTE:</strong> GitHub acts oddly about + signs in the tags and release names so it's converted to an underscore.</p>
<h2 id="developers-package-builds-executing-the-github-action-to-build-packages">Executing the GitHub Action to Build Packages</h2>
<p>The following steps build the Debian packages:</p>
<ul>
<li>
<p>Navigate to the <a href="https://github.com/AllStarLink/asl3-asterisk/actions">GitHub repository Actions tab</a></p>
</li>
<li>
<p>Under <em>All workflows</em> -&gt; <em>Workflows</em> click on <code>Make and Publish Pkgs</code></p>
</li>
<li>
<p>To the right of the label <em>This workflow has a workflow_dispatch event trigger</em> click on <strong>Run workflow</strong></p>
</li>
<li>
<p>In the dropdown, enter the following information:</p>
<ul>
<li>
<p><em>Asterisk LTS Version Base</em> - This is the Asterisk version determined above</p>
</li>
<li>
<p><em><code>app_rpt</code> Version Tag</em> - This is the <code>app_rpt</code> version determined above</p>
</li>
<li>
<p><em>Package Revision</em> - This is the Package Version determined above</p>
</li>
<li>
<p><em>Platform Architecture</em> - Choose <code>amd64</code> or <code>arm64</code> as appropriate</p>
</li>
<li>
<p><em>Debian Release Version</em> - Choose the Debian release version to build. Note that currently the releases in GitHub do not support multiple Debian releases in the same GitHub release. This is a ToDo item (#17)</p>
</li>
<li>
<p><em>Github Release Tag</em> - This is tag release created above in Create a GitHub Release</p>
</li>
<li>
<p>For now, leave <em>Aptly Repository Stream</em> and <em>Commit Versioning</em> at their default values</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Run Workflow</strong></p>
</li>
<li>
<p>After a moment, a new running workflow will appear (yellow circle with a darker circling swoosh). This can be monitored for process. If the process succeeds with a green checkbox, the <code>.deb</code> files should appear in the Release. If not, there are problems that need to be diagnosed and resolved.</p>
</li>
</ul>
<p><strong>NOTE:</strong> As noted above, you will choose the platform architecture when starting a workflow. All workflows will create the architecture specific packages. The <code>amd64</code> workflow also creates the architecture independent (<code>all</code>) packages.  What does this mean?  If you only want <code>amd64</code> packages then you would only need to run the single workflow. But, if you want packages for an alternate architecture (e.g. <code>arm64</code>) then will need to run a workflow for that architecture AND one for the <code>amd64</code> architecture.</p></section><section class="print-page" id="developers-source-code"><h1 id="developers-source-code-source-code">Source Code</h1>
<h2 id="developers-source-code-asl3-source-code-repositories">ASL3 Source Code Repositories</h2>
<p>All of the source code for ASL3 is available on <a href="https://github.com/AllStarLink">GitHub</a>.</p>
<p>The main repositories include :</p>
<h3 id="developers-source-code-asl3">ASL3</h3>
<ul>
<li>The <strong>ASL3</strong> <a href="https://github.com/AllStarLink/ASL3">repository</a> sits at the top of the hierarchy.</li>
<li>From a packaging point of view, this is the source of the <code>asl3</code> package.</li>
<li>The repository / package also provides some of the "glue" needed to make everything work (OS services, OS configuration, scripts, etc).</li>
<li>The <code>asl3</code> package is installed with the <code>apt install asl3</code> command.</li>
<li>The package will, in turn, pull down the key dependencies.</li>
</ul>
<h3 id="developers-source-code-app_rpt">app_rpt</h3>
<ul>
<li>The <strong>app_rpt</strong> <a href="https://github.com/AllStarLink/app_rpt">repository</a> contains the source for the AllStarLink code that is added to (and works with) Asterisk. This includes the <code>app_rpt</code> module, the channel driver modules (SimpleUSB, USBRadio, etc.), a few utilities (<code>simpleusb-tune-menu</code>, <code>radio-tune-menu</code>), and the initial set of "ASL" configuration files.</li>
</ul>
<h3 id="developers-source-code-asl3-asterisk">asl3-asterisk</h3>
<ul>
<li>The <strong>asl3-asterisk</strong> <a href="https://github.com/AllStarLink/asl3-asterisk">repository</a> is what we use to pull the <code>Asterisk</code> and <code>app_rpt</code> source code together, compile all of the executables, and create the .deb packages.</li>
<li>From a packaging point of view, this is the source of the <code>asl3-asterisk</code>, <code>asl3-asterisk-config</code>, <code>asl3-asterisk-modules</code>, and debugging packages.</li>
</ul>
<h3 id="developers-source-code-asl3-menu">ASL3 Menu</h3>
<ul>
<li>The <strong>ASL3 Menu</strong> <a href="https://github.com/AllStarLink/asl3-menu">repository</a> contains the ASL Menu system (<code>asl-menu</code>, <code>node-setup</code>, etc.).</li>
<li>From a packaging point of view, this is the source of the <code>asl3-menu</code> package.</li>
</ul>
<h3 id="developers-source-code-asl3-manual">ASL3 Manual</h3>
<ul>
<li>The <strong>ASL3 Manual</strong> <a href="https://github.com/AllStarLink/ASL3-Manual">repository</a> contains the source code for the our online documentation available at <a href="https://allstarlink.github.io">allstarlink.github.io</a>.</li>
</ul>
<h3 id="developers-source-code-allmon3">Allmon3</h3>
<ul>
<li>The <strong>Allmon3</strong> <a href="https://github.com/AllStarLink/Allmon3">repository</a> contains the source code for <code>Allmon3</code>, the web-based monitoring and management application.</li>
<li>From a packaging point of view, this is the source of the <code>allmon3</code> package.</li>
</ul>
<h2 id="developers-source-code-asterisk">Asterisk</h2>
<ul>
<li>The ASL3 project leverages the source code from the <a href="https://asterisk.org">Asterisk</a> project. When building ASL3, we snapshot one of the most recent LTS releases from the <strong>Asterisk</strong> <a href="https://github.com/asterisk/asterisk">repository</a>.</li>
</ul></section><section class="print-page" id="developers-source-install"><h1 id="developers-source-install-source-based-installation">Source-Based Installation</h1>
<p>Software developers or users who want to make changes to ASL3 or those who want/need to install ASL3 on unsupported hardware or operating systems will need to install ASL3 from the source code.</p>
<p>Doing so will require you to download, compile, and install multiple projects.</p>
<p>You will also need to be very comfortable using various development tools and the Linux CLI.</p>
<h2 id="developers-source-install-where-to-get-the-asl3-source-code">Where to get the ASL3 source code</h2>
<p>All of the source code for ASL3 can be found in the GitHub <a href="https://github.com/AllStarLink">AllStarLink</a> repositories. The repositories include (but are not limited to):</p>
<table>
<thead>
<tr>
<th>Repository</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASL3</td>
<td>Top-level</td>
</tr>
<tr>
<td>app_rpt</td>
<td>AllStarLink additions to Asterisk</td>
</tr>
<tr>
<td>asl3-asterisk</td>
<td>Build environment for the .deb packages of Asterisk LTS + ASL3/app_rpt</td>
</tr>
<tr>
<td>asl3-menu</td>
<td>The ASL3 menu system (asl-menu, node-setup, etc)</td>
</tr>
<tr>
<td>Allmon3</td>
<td>Web-based monitoring and management for the AllStarLink application</td>
</tr>
</tbody>
</table>
<h2 id="developers-source-install-asterisk-app_rpt">Asterisk + <code>app_rpt</code></h2>
<p>Details on building Asterisk + <code>app_rpt</code> can be found in the "docs" directory of the GitHub <a href="https://github.com/AllStarLink/asl3-asterisk">asl3-asterisk</a> repository.</p>
<p>Please note that the instructions are ONLY for building Asterisk with ASL's <code>app_rpt</code>.</p>
<p>The instructions does not include any helpers, <code>Allmon3</code>, <code>asl3-menu</code>, <code>asl3-nodelist</code>, etc.</p>
<p>The "docs" directory has two sets of instructions:</p>
<ul>
<li>The "build-asl3" instructions focus is on building Asterisk + <code>ASL3/app_rpt</code> and creating our Debian packages</li>
<li>The "build-phreaknet" instructions (and the <code>phreaknet.sh</code> script) targets those more interested in Asterisk installations with <code>app_rpt</code></li>
</ul></section><section class="print-page" id="developers-aptly"><h1 id="developers-aptly-allstarlink-apt-repos">AllStarLink Apt Repos</h1>
<p>AllStarLink's primary installation method is through the use of Debian packages and the Apt deployment system.</p>
<h2 id="developers-aptly-repository-structure">Repository Structure</h2>
<p>The repository is located at <code>https://repo.allstarlink.org/public</code> and is managed using <a href="https://www.aptly.info/">Aptly</a>. The Aptly structure is a multi-local-repo system that is coalesced into a single public repository with multiple components per distribution.</p>
<p>There are three main local repositories:</p>
<ul>
<li>
<p><strong>asl3-prod</strong> - Packages for production-quality use</p>
</li>
<li>
<p><strong>asl3-beta</strong> - Packages that are ready for general testing and are expected to be promoted to asl3-prod</p>
</li>
<li>
<p><strong>asl3-devel</strong> - Development quality packages that are for development testing only. While these packages are available to the general user, use of this component in extremely
discouraged without a developer's guidance</p>
</li>
</ul>
<p>Each repository contains one or more distributions. Currently the only distribution supported is <code>bookworm</code> for Debian 12.</p>
<p>Each repository has a default component name that, when published together, form the basis of the labeling scheme of promotion of packages from devel -&gt; beta -&gt; prod. The component mapping is:</p>
<ul>
<li>asl3-prod = main</li>
<li>asl3-beta = beta</li>
<li>asl3-devel = devel</li>
</ul>
<p>All local repositories are merged and published into a single public-facing repository. This is usable by one of the following <code>.list</code> configurations in<code>/etc/apt/sources.list.d</code>:</p>
<div class="highlight"><pre><span></span><code># Primary AllStarLink Repo for Production Packages
deb [signed-by=/etc/apt/keyrings/allstarlink.gpg] https://repo.allstarlink.org/public bookworm main

# Include Beta Component for Testing
deb [signed-by=/etc/apt/keyrings/allstarlink.gpg]  https://repo.allstarlink.org/public bookworm main beta

# Include Beta and Devel component for Development
deb [signed-by=/etc/apt/keyrings/allstarlink.gpg]  https://repo.allstarlink.org/public bookworm main beta devel
</code></pre></div>
<p>All packages in the repository are signed by GPG and the key is provided with repository installation <code>.deb</code> file.</p>
<h2 id="developers-aptly-aptly-github-runner-integrations">Aptly + GitHub Runner Integrations</h2>
<p>ASL3-related GitHub repositories are integrated with the Aptly repository and running the "Make and Publish Pkgs" Action from each project will result in .deb files being compiled and stored in Aptly. Currently, it's possible to build files directly into the <code>devel</code> and <code>beta</code> components but not <code>prod</code>. Moving packages into <code>prod</code> currently
requires administrator intervention. This will be changed at some future date.</p>
<h2 id="developers-aptly-aptly-cli">Aptly CLI</h2>
<p>It is possible to run Aptly commands from the shell on <code>repo.allstarlink.org</code> in addition to using the web-based API.</p>
<h3 id="developers-aptly-setup">Setup</h3>
<p>All commands to Aptly must be run as the <code>aptly</code> user. To do this, each account on the repository server should be member of the <code>sudo</code> and <code>aptly</code> UNIX groups.</p>
<p>Before issuing any Aptly commands run the following:</p>
<div class="highlight"><pre><span></span><code>alias aptly=&quot;sudo -u aptly -- aptly&quot;
</code></pre></div>
<p>to ensure that all commands are run as the <code>aptly</code> user.</p>
<h3 id="developers-aptly-adding-a-file-to-a-local-repo">Adding a File to a Local Repo</h3>
<p>Adding a file to the local repo is straight-forward:</p>
<div class="highlight"><pre><span></span><code>aptly repo add REPO FILE-or-DIR
</code></pre></div>
<p>For example, to add the latest Allmon3 to the production repository:</p>
<div class="highlight"><pre><span></span><code>$ aptly repo add asl3-prod allmon3_1.2.1-2_all.deb
Loading packages...
[+] allmon3_1.2.1-2_all added
</code></pre></div>
<h3 id="developers-aptly-publishing-repositories">Publishing Repositories</h3>
<p>Coalescing and publishing the public repository with all components is:</p>
<div class="highlight"><pre><span></span><code>aptly publish update bookworm
</code></pre></div>
<p>When other distributions are supported, replace <code>bookworm</code> with the appropriate distribution. Upon execution, a prompt will appear for the GPG signing key for the repository. Provide it.</p>
<p>And example, successful publication looks like:</p>
<div class="highlight"><pre><span></span><code>$ aptly publish update bookworm
Loading packages...
Generating metadata files and linking package files...
Finalizing metadata files...
Signing file &#39;Release&#39; with gpg, please enter your passphrase when prompted:
Clearsigning file &#39;Release&#39; with gpg, please enter your passphrase when prompted:
Cleaning up prefix &quot;.&quot; components beta, devel, main...

Publish for local repo ./bookworm [all, amd64, arm64, armhf] publishes {beta: [asl3-beta]}, {devel: [asl3-devel]}, {main: [asl3-prod]} has been successfully updated.
</code></pre></div>
<h3 id="developers-aptly-searching-for-packages">Searching for Packages</h3>
<p>Listing and searching for packages inside of a local repo is done with the <code>aptly repo search</code> command and uses the
<a href="https://www.aptly.info/doc/feature/query/">Aptly Package Query Language</a> to filter/select packages.</p>
<p>A simple <code>aptly repo search REPO</code> will show all packages. For example:</p>
<div class="highlight"><pre><span></span><code>$ aptly repo search asl3-prod
allmon3_1.2.1-2_all
asl-apt-repos_1.3-1.deb12_all
asl3_3.0.0-1.deb_all
[...]
</code></pre></div>
<h4 id="developers-aptly-search-by-name">Search by name</h4>
<div class="highlight"><pre><span></span><code>$ aptly repo search asl3-prod &#39;Name (asl3)&#39;
asl3_3.0.0-1.deb_all
</code></pre></div>
<h4 id="developers-aptly-search-by-name-glob-version">Search by name glob + version</h4>
<div class="highlight"><pre><span></span><code>$ aptly repo search asl3-prod &#39;Name (~ asl3-asterisk*), Version (2:20.7.0+asl3-1.0-5.deb12)&#39;
asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
</code></pre></div>
<h4 id="developers-aptly-search-by-name-glob-version-range">Search by name glob + version range</h4>
<div class="highlight"><pre><span></span><code>$ aptly repo search asl3-prod &#39;Name (~ asl3-asterisk*), Version (&gt;= 1.0)&#39;
asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
</code></pre></div>
<h3 id="developers-aptly-promoting-packages-to-prod">Promoting Packages to Prod</h3>
<p>Using the hypothetical example of promoting asl3-asterisk packages from beta to production.</p>
<ol>
<li>
<p>Test package selection using <code>aptly repo search</code></p>
<div class="highlight"><pre><span></span><code>$ $ aptly repo search asl3-beta &#39;Name (~ asl3-asterisk*), Version (2:20.7.0+asl3-1.0-5.deb12)&#39;
asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_arm64
asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64
asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_arm64
asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64
asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_arm64
asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64
asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64
</code></pre></div>
</li>
<li>
<p>Move the packages into the production repository using <code>aptly repo move</code></p>
<div class="highlight"><pre><span></span><code>$ aptly repo move asl3-beta asl3-prod &#39;Name (~ asl3-asterisk*), Version (2:20.7.0+asl3-1.0-5.deb12)&#39;
Loading packages...
[o] asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all moved
[o] asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
[o] asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
[o] asl3-asterisk-tests_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
[o] asl3-asterisk-modules_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
[o] asl3-asterisk-dbgsym_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
[o] asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all moved
[o] asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk-modules-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all moved
[o] asl3-asterisk-tests-dbgsym_2:20.7.0+asl3-1.0-5.deb12_arm64 moved
[o] asl3-asterisk_2:20.7.0+asl3-1.0-5.deb12_amd64 moved
</code></pre></div>
</li>
<li>
<p>Update the repository publication</p>
<div class="highlight"><pre><span></span><code>$ aptly publish update bookworm
Loading packages...
Generating metadata files and linking package files...
Finalizing metadata files...
Signing file &#39;Release&#39; with gpg, please enter your passphrase when prompted:
Clearsigning file &#39;Release&#39; with gpg, please enter your passphrase when prompted:
Cleaning up prefix &quot;.&quot; components beta, devel, main...

Publish for local repo ./bookworm [all, amd64, arm64, armhf] publishes {beta: [asl3-beta]}, {devel: [asl3-devel]}, {main: [asl3-prod]} has been successfully updated.
</code></pre></div>
</li>
</ol>
<h2 id="developers-aptly-note-on-all-architecture-packages">Note on 'all' Architecture Packages</h2>
<p>The architecture <code>all</code> denotes that the package contains no binary compiled code and runs on any architecture. This is meaningful when handling asl3-asterisk packages for multiple architectures. <strong>Within the same version and release</strong> only one copy of the <code>all</code> packages needs to and CAN exist in the repository. The GitHub Runner builder will delete the <code>all</code> packages for the <code>arm64</code> build since the <code>arm64</code> and <code>amd64</code> builds should occur simultaneously.</p>
<p>To delete an extra set of <code>all</code> packages that may have ended up in the repository:</p>
<div class="highlight"><pre><span></span><code>$ aptly repo search asl3-beta &#39;Name (~ asl3-asterisk*), Version (2:20.7.0+asl3-1.0-5.deb12), Architecture (all)&#39;
asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all
asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all

$ aptly repo remove asl3-beta &#39;Name (~ asl3-asterisk*), Version (2:20.7.0+asl3-1.0-5.deb12), Architecture (all)&#39;
Loading packages...
[-] asl3-asterisk-config_2:20.7.0+asl3-1.0-5.deb12_all removed
[-] asl3-asterisk-doc_2:20.7.0+asl3-1.0-5.deb12_all removed
[-] asl3-asterisk-dev_2:20.7.0+asl3-1.0-5.deb12_all removed
</code></pre></div></section><h1 class='nav-section-title-end'>Ended: Developer Guide</h1>
                        <h1 class='nav-section-title' id='section-man-pages'>
                            Man Pages <a class='headerlink' href='#section-man-pages' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="mans"><h1 id="mans-man-pages">Man Pages</h1>
<p>This section of the manual contains the Manual Pages with detailed information for the utilities included with with ASL3.</p>
<p>The Manual Pages for each utility describe what the utility does, the available options it supports, and sample usage.</p>
<p>Manual Pages are also installed on your Linux system when the utility is installed. You can view the built-in Linux <code>man</code> pages facility to get help on these utilities from the Linux CLI.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>man asl-find-sound
</code></pre></div></section><section class="print-page" id="mans-allmon3-passwd"><h1 id="mans-allmon3-passwd-allmon3-passwd">allmon3-passwd</h1>
<h2 id="mans-allmon3-passwd-name">NAME</h2>
<p><code>allmon3-passwd</code> - Manage the <code>Allmon3</code> password file</p>
<h1 id="mans-allmon3-passwd-synopsis">SYNOPSIS</h1>
<p>usage: <code>allmon3-passwd [-h|--help] [--delete] [--debug] [--file FILE] [--version] &lt;user&gt;</code></p>
<p>Positional arguments:</p>
<p><strong>&lt;user&gt;</strong>: username to create/modify</p>
<p>Optional arguments:</p>
<p><strong>-h, --help</strong>: show help message and exit</p>
<p><strong>--delete</strong>: delete the user specified by <code>&lt;user&gt;</code></p>
<p><strong>--debug</strong>: enable debug-level logging output</p>
<p><strong>--file FILE</strong>: alternate file to edit; default <code>/etc/allmon3/users</code></p>
<p><strong>--version</strong>: print the the version of the software</p>
<h1 id="mans-allmon3-passwd-description">DESCRIPTION</h1>
<p>Allmon3's user database is managed by <code>allmon3-passwd</code>. Adding a new user or editing an existing user is the same command. If the user does not exist, it will be added. If the user does exist, the password will be updated.</p>
<p>To add or edit a user's password:</p>
<div class="highlight"><pre><span></span><code>allmon3-passwd allmon3
 Enter the password for allmon3: password
 Confirm the password for allmon3: password
</code></pre></div>
<p>The <code>/etc/allmon3/users</code> file is readable to see that the Argon2 hash has changed for the user.</p>
<p>To delete a user, add the <code>--delete</code> flag to the command:</p>
<div class="highlight"><pre><span></span><code>allmon3-passwd --delete allmon3
</code></pre></div>
<h1 id="mans-allmon3-passwd-bugs">BUGS</h1>
<p>Report bugs to https://github.com/AllStarLink/Allmon3/issues</p>
<h1 id="mans-allmon3-passwd-copyright">COPYRIGHT</h1>
<p>Copyright (C) 2025 Jason McCormick and AllStarLink under the terms of the AGPL v3.</p></section><section class="print-page" id="mans-asl-find-sound"><h1 id="mans-asl-find-sound-asl-find-sound">asl-find-sound</h1>
<h2 id="mans-asl-find-sound-name">NAME</h2>
<p><code>asl-find-sound</code> - Display <code>app_rpt</code>-compatible sound devices</p>
<h2 id="mans-asl-find-sound-synopsis">SYNOPSIS</h2>
<p>usage: <code>asl-find-sound</code></p>
<h2 id="mans-asl-find-sound-description">DESCRIPTION</h2>
<p>asl-find-sound - Display <code>app_rpt</code>-compatible sound devices</p>
<h2 id="mans-asl-find-sound-bugs">BUGS</h2>
<p>Report bugs to https://github.com/AllStarLink/ASL3/issues</p>
<h2 id="mans-asl-find-sound-copyright">COPYRIGHT</h2>
<p>Copyright (C) 2025 Jason McCormick and AllStarLink under the terms of the AGPL v3.</p></section><section class="print-page" id="mans-asl-node-lookup"><h1 id="mans-asl-node-lookup-asl-node-lookup">asl-node-lookup</h1>
<h2 id="mans-asl-node-lookup-name">NAME</h2>
<p><code>asl-node-lookup</code> - Display AllStarLink node information</p>
<h2 id="mans-asl-node-lookup-synopsis">SYNOPSIS</h2>
<p>usage: <code>asl-node-lookup [--help] [--verbose] [--ns &lt;name-server&gt;] &lt;node#&gt;</code></p>
<p>Required arguments:</p>
<p><strong>&lt;node#&gt;</strong>: ASL node number to query</p>
<p>Optional arguments:</p>
<p><strong>--help</strong>: show help</p>
<p><strong>--verbose</strong>: report additional information including the DNS "SOA" and "NS" records</p>
<p><strong>--ns</strong>: issue DNS queries to the specified name server</p>
<p><strong>NOTE:</strong> This command will also report <code>Asterisk/rpt</code> node lookup results if executed as <code>root</code> (or <code>asterisk</code>).</p>
<h2 id="mans-asl-node-lookup-description">DESCRIPTION</h2>
<p>asl-node-lookup - Display AllStarLink node information</p>
<h2 id="mans-asl-node-lookup-bugs">BUGS</h2>
<p>Report bugs to https://github.com/AllStarLink/ASL3/issues</p>
<h2 id="mans-asl-node-lookup-copyright">COPYRIGHT</h2>
<p>Copyright (C) 2025 Allan Nathanson and AllStarLink under the terms of the AGPL v3.</p></section><section class="print-page" id="mans-asl-play-arn"><h1 id="mans-asl-play-arn-asl-play-arn">asl-play-arn</h1>
<h2 id="mans-asl-play-arn-name">NAME</h2>
<p><code>asl-play-arn</code> - Play Amateur Radio Newsline</p>
<h2 id="mans-asl-play-arn-synopsis">SYNOPSIS</h2>
<p>usage: <code>asl-play-arn [-h] --node [ --when WHEN ] [ --debug ]</code></p>
<p>Optional arguments:</p>
<p><strong>-h, --help</strong>: show this help message and exit</p>
<p><strong>--node NODE</strong>: Allstar Node # to play audio</p>
<p><strong>--when WHEN</strong>: when to play in 24 hour format NNNN - not specifying <code>--when</code> will result in the audio playing immediately</p>
<p><strong>--debug</strong>: enable debug-level logging in <code>syslog</code></p>
<h2 id="mans-asl-play-arn-description">DESCRIPTION</h2>
<p>Basic use is either immediately from the command line:</p>
<div class="highlight"><pre><span></span><code>allstar-play-arn --node 1999
</code></pre></div>
<p>Depending on the processing speed of the device and Internet connectivity, the start of playback may take a significant time. If the desire is for precision on the start time, use the <code>--when</code> command and execute <code>allstar-play-arn</code> a few minutes before the desired start time.</p>
<p>The script is silent except on errors like all good Unix utilities. Some useful troubleshooting may be done with the <code>--debug</code> option if an error is not revealing.</p>
<h2 id="mans-asl-play-arn-sceheduling-the-playback">Sceheduling the Playback</h2>
<p>The best way to schedule the playback is as follows as the root user.</p>
<ol>
<li>
<p><code>cp /usr/share/asl3/asl-play-arn.* /etc/systemd/system</code></p>
</li>
<li>
<p>Edit the <code>OnCalendar=</code> entry of <code>/etc/systemd/system/asl-play-arn.timer</code> for the timing of the playback desired</p>
</li>
<li>
<p>Edit the value for "NODE" in <code>/etc/systemd/system/asl-play-arn.service</code> for the node to execute the playback upon</p>
</li>
<li>
<p>Enable the timer unit:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>systemctl daemon-reload
systemctl enable asl-play-arn.timer
</code></pre></div>
<h2 id="mans-asl-play-arn-asteriskapp_rpt-configuration"><code>Asterisk/app_rpt</code> Configuration</h2>
<p>Usually the timeout timer in <code>app_rpt</code> will be too short to accommodate the playing of the full news file. The following commands can be added to <code>/etc/asterisk/rpt.conf</code> to enable and disable the TOT:</p>
<div class="highlight"><pre><span></span><code>907=cop,7    ; Time out timer enable
908=cop,8    ; Time out timer disable
</code></pre></div>
<p>These appear as commented-out options in the stock <code>rpt.conf</code>.</p>
<h2 id="mans-asl-play-arn-bugs">BUGS</h2>
<p>Report bugs to https://github.com/AllStarLink/ASL3/issues</p>
<h2 id="mans-asl-play-arn-copyright">COPYRIGHT</h2>
<p>Copyright (C) 2025 Jason McCormick and AllStarLink under the terms of the AGPL v3.</p></section><section class="print-page" id="mans-asl-say"><h1 id="mans-asl-say-asl-say">asl-say</h1>
<h2 id="mans-asl-say-name">NAME</h2>
<p><code>asl-say</code> - Cause Asterisk to speak</p>
<h2 id="mans-asl-say-synopsis">SYNOPSIS</h2>
<p>usage: <code>asl-say -n NODE -w ( time | time24 | ip4 | ip6 )</code></p>
<h2 id="mans-asl-say-description">DESCRIPTION</h2>
<p><code>asl-say</code> will speak the one of the following things on the node specified with <code>-n</code> as directed by <code>-w</code></p>
<p>Required arguments:</p>
<p><strong>-n NODE</strong>: node number</p>
<p><strong>-w</strong>: speak what from the list of options</p>
<p><strong>time</strong>: the current time</p>
<p><strong>time24</strong>: the current time in 24-hour format</p>
<p><strong>ip4</strong>: the first IPv4 address of the system</p>
<p><strong>ip6</strong>: the first global-scope IPv6 of the system</p>
<h2 id="mans-asl-say-example">EXAMPLE</h2>
<p><code>asl-say -n 1999 -w time</code> will speak the current time on node 1999.</p>
<h2 id="mans-asl-say-bugs">BUGS</h2>
<p>Report bugs to https://github.com/AllStarLink/ASL3/issues</p>
<h2 id="mans-asl-say-copyright">COPYRIGHT</h2>
<p>Copyright (C) 2025 Jason McCormick and AllStarLink under the terms of the AGPL v3.</p></section><section class="print-page" id="mans-asl-setup-dkms-mok"><h1 id="mans-asl-setup-dkms-mok-asl-setup-dkms-mok">asl-setup-dkms-mok</h1>
<h2 id="mans-asl-setup-dkms-mok-name">NAME</h2>
<p><code>asl-setup-dkms-mok</code> - Configure the Machine Owner Key (MOK) for signing kernel packages, notably dahdi for ASL.</p>
<h2 id="mans-asl-setup-dkms-mok-synopsis">SYNOPSIS</h2>
<p>usage: <code>asl-setup-dkms-mok</code></p>
<h2 id="mans-asl-setup-dkms-mok-description">DESCRIPTION</h2>
<p>This script is a walkthrough script for generating a UEFI Machine Owner Key (MOK). A MOK is needed on systems with UEFI SecureBoot to properly authenticate the DAHDI-related kernel modules which are rebuilt on kernel upgrades with DKMS. See the AllStarLink manual for more information or https://wiki.debian.org/SecureBoot.</p>
<h2 id="mans-asl-setup-dkms-mok-bugs">BUGS</h2>
<p>Report bugs to https://github.com/AllStarLink/ASL3/issues</p>
<h2 id="mans-asl-setup-dkms-mok-copyright">COPYRIGHT</h2>
<p>Copyright (C) 2025 Jason McCormick and AllStarLink under the terms of the AGPL v3.</p></section><h1 class='nav-section-title-end'>Ended: Man Pages</h1>
                        <h1 class='nav-section-title' id='section-config-files'>
                            Config Files <a class='headerlink' href='#section-config-files' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="config"><h1 id="config-config-files">Config Files</h1>
<p>This section of the manual provides in in-depth look at all the configuration files related to ASL3.</p>
<p>Information provided includes how the file is structured, the available/supported options, a description of the supported options, and what the default values of each option is (if applicable).</p></section><section class="print-page" id="config-config-structure"><h1 id="config-config-structure-structure-of-config-files">Structure of Config Files</h1>
<p>Configuration files have a simple structure consisting of stanzas, <code>key=value</code> pairs and comments. A stanza is a block of text within a configuration file. It starts with a name (or number) surrounded by square brackets on a line by itself. Configuration files will have one or more stanzas. Each stanza continues until the next stanza or end of file. </p>
<div class="highlight"><pre><span></span><code>[this is a stanza]
...

[this is another stanza]
...
</code></pre></div>
<p>Stanzas contain one or more <code>key=value</code> pairs. <code>Key=value</code> pairs set various values within each stanza.</p>
<div class="highlight"><pre><span></span><code>myname=timothy ; There are some who call me Tim?
</code></pre></div>
<p>Config file comments are preceded with a semicolon. In this example of two nodes the stanza is the node number and the <code>key=value</code> pairs set the CW ID and the ID timer:</p>
<div class="highlight"><pre><span></span><code>[1998]
idrecording = |iW1ABC
idtime = 540000          ; 9 minutes

[1999]
idrecording = |iW1XYZ
idtime = 540000 
</code></pre></div>
<h2 id="config-config-structure-settings-to-name-other-stanzas">Settings to name other Stanzas</h2>
<p>Within the <a href="#config-rpt_conf-node-number-stanza"><code>[node]</code></a> stanza in <code>rpt.conf</code>, some <code>key=value</code> pairs point to other stanzas. This allows nodes on the same <code>Asterisk/app_rpt</code> server to have the same settings (without duplicate entries) or different settings in some cases. For example, the phone patch command may be *6 on one node, yet *61 on another.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>[1000]
functions=functionsVHF

[1001]
functions=functionsVHF   ;same functions as node 1000

[1002]
functions=functionsUHF

[functionsVHF]
; Two meter Autopatch up is *6
6=autopatchup,noct=1,farenddisconnect=1,dialtime=20000 
0=autopatchdn       ; Autopatch down

[functionsUHF]
; 440 Autopatch up is *61
61=autopatchup,noct=1,farenddisconnect=1,dialtime=20000  ; Autopatch up
0=autopatchdn       ; Autopatch down
</code></pre></div>
<h2 id="config-config-structure-named-stanzas-in-rptconf">Named Stanzas in rpt.conf</h2>
<p>The <code>key=value</code> pairs that redirect to other named stanzas in <code>rpt.conf</code> are:</p>
<ul>
<li>controlstates=</li>
<li>events=</li>
<li>functions=</li>
<li>link_functions=</li>
<li>macro=</li>
<li>morse=</li>
<li>nodes=</li>
<li>phone_functions=</li>
<li>scheduler=</li>
<li>telemetry=</li>
<li>tonemacro=</li>
<li>wait_times=</li>
</ul>
<p><strong>Note:</strong> A stanza is also called a context in Asterisk PBX terminology, particularly related to the dialplan.</p></section><section class="print-page" id="config-rpt_conf"><h1 id="config-rpt_conf-rptconf">rpt.conf</h1>
<p>Rpt.conf (<code>/etc/asterisk/rpt.conf</code>) is where the majority of user-facing features, such as the node's CW and voice ID, DTMF commands and timers are set. There is a lot of capability here which can be difficult to grasp. Fortunately the default <code>rpt.conf</code> is well commented and will work fine for most node admins.</p>
<p>See also <a href="#adv-topics-conftmpl-asterisk-templates">config file templating</a>.</p>
<h2 id="config-rpt_conf-dtmf-commands">DTMF Commands</h2>
<p>DTMF commands are placed in any one of <strong>three</strong> <em>named stanzas</em>. These stanzas control access to DTMF commands that a user can issue from various 
control points.</p>
<ul>
<li>The <a href="#config-rpt_conf-functions-stanza">Fuctions</a> Stanza - to decode DTMF from the node's local receiver.</li>
<li>The <a href="#config-rpt_conf-link-functions-stanza">Link Functions</a> Stanza - to decode DTMF from linked nodes.</li>
<li>The <a href="#config-rpt_conf-phone-functions-stanza">Phone Functions</a> Stanza - to decode DTMF from telephone connects.</li>
</ul>
<p>A DTMF <code>key=value</code> pair has the following format:</p>
<p><code>dtmfcommand=functionclass,[functionmethod],[parameters]</code></p>
<p>Where:</p>
<ul>
<li><code>dtmfcommand</code> is a DTMF digit sequence <strong>minus</strong> the <a href="#config-rpt_conf-funcchar">start character</a> (usually *, so a <code>dtmfcommand</code> of 81 would actually be *81 when entered via radio)</li>
<li><code>functionclass</code> is a string which defines the class of command; <code>link</code>, <code>status</code>, or <code>COP</code></li>
<li><code>functionmethod</code> defines the optional method number to use in the function class</li>
<li><code>parameters</code> are one or more optional comma separated parameters that further define a command.</li>
</ul>
<h3 id="config-rpt_conf-status-commands">Status Commands</h3>
<p>Commands using the <code>status</code> function class are used to provide general information about the local node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>712 = status,12   ; Give Time of Day (local only)
</code></pre></div>
<table>
<thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Force ID (global)</td>
</tr>
<tr>
<td>2</td>
<td>Give Time of Day (global)</td>
</tr>
<tr>
<td>3</td>
<td>Give software Version (global)</td>
</tr>
<tr>
<td>4</td>
<td>Give GPS location info</td>
</tr>
<tr>
<td>5</td>
<td>Speak the last (dtmf) user</td>
</tr>
<tr>
<td>11</td>
<td>Force ID (local only)</td>
</tr>
<tr>
<td>12</td>
<td>Give Time of Day (local only)</td>
</tr>
</tbody>
</table>
<h3 id="config-rpt_conf-link-commands">Link Commands</h3>
<p>Commands using the <code>link</code> function class affect connecting to, disconnecting from, monitoring (RX only) other nodes, and providing linking status. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>3 = ilink,3   ; Connect specified link -- transceive
</code></pre></div>
<p><strong>NOTE:</strong> The above example creates the following DTMF command: *3&lt;nodenumber&gt;, which will use <code>ilink,3</code> to connect in transceive mode to the specified node number entered as part of the DTMF command.</p>
<p>See the table below for the available link commands, and whether they take a node number as a (required) parameter when being entered:</p>
<table>
<thead>
<tr>
<th>ilink</th>
<th>Description</th>
<th>Node Number Required</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Disconnect specified link</td>
<td>Yes</td>
</tr>
<tr>
<td>2</td>
<td>Connect specified link -- monitor only</td>
<td>Yes</td>
</tr>
<tr>
<td>3</td>
<td>Connect specified link -- tranceive</td>
<td>Yes</td>
</tr>
<tr>
<td>4</td>
<td>Enter command mode on specified link</td>
<td>Yes</td>
</tr>
<tr>
<td>5</td>
<td>System status</td>
<td>No</td>
</tr>
<tr>
<td>6</td>
<td>Disconnect all links</td>
<td>No</td>
</tr>
<tr>
<td>7</td>
<td>Last Node to Key Up</td>
<td>No</td>
</tr>
<tr>
<td>8</td>
<td>Connect specified link -- local monitor only</td>
<td>Yes</td>
</tr>
<tr>
<td>9</td>
<td>Send Text Message (9,&lt;destnodeno or 0 (for all)&gt;,Message Text, etc.)</td>
<td>No</td>
</tr>
<tr>
<td>10</td>
<td>Disconnect all RANGER links (except permalinks)</td>
<td>No</td>
</tr>
<tr>
<td>11</td>
<td>Disconnect a previously permanently connected link</td>
<td>Yes</td>
</tr>
<tr>
<td>12</td>
<td>Permanently connect specified link -- monitor only</td>
<td>Yes</td>
</tr>
<tr>
<td>13</td>
<td>Permanently connect specified link -- tranceive</td>
<td>Yes</td>
</tr>
<tr>
<td>15</td>
<td>Full system status (all nodes)</td>
<td>No</td>
</tr>
<tr>
<td>16</td>
<td>Reconnect links disconnected with "disconnect all links"</td>
<td>No</td>
</tr>
<tr>
<td>17</td>
<td>MDC test (for diag purposes)</td>
<td>No</td>
</tr>
<tr>
<td>18</td>
<td>Permanently Connect specified link -- local monitor only</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>The commands to permanently connect a link will have <code>app_rpt</code> try to maintain those connections across network disruptions.</p>
<h3 id="config-rpt_conf-cop-commands">COP Commands</h3>
<p>Commands using the <code>cop</code> (Control OPerator) function class are privileged commands. Node admins may provide some of these to their user community based on personal preference. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>99 = cop,7   ; enable timeout timer
</code></pre></div>
<p>Some COP commands can take multiple parameters. For example this COP 48 would send #3#607 on command:</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>900 = cop,48,#,3,#,6,0,7 
</code></pre></div>
<table>
<thead>
<tr>
<th>COP</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>System warm boot</td>
</tr>
<tr>
<td>2</td>
<td>System enable</td>
</tr>
<tr>
<td>3</td>
<td>System disable</td>
</tr>
<tr>
<td>4</td>
<td>Test Tone On/Off</td>
</tr>
<tr>
<td>5</td>
<td>Dump System Variables on Console (debug)</td>
</tr>
<tr>
<td>6</td>
<td>PTT (phone mode only)</td>
</tr>
<tr>
<td>7</td>
<td>Time out timer enable</td>
</tr>
<tr>
<td>8</td>
<td>Time out timer disable</td>
</tr>
<tr>
<td>9</td>
<td>Autopatch enable</td>
</tr>
<tr>
<td>10</td>
<td>Autopatch disable</td>
</tr>
<tr>
<td>11</td>
<td>Link enable</td>
</tr>
<tr>
<td>12</td>
<td>Link disable</td>
</tr>
<tr>
<td>13</td>
<td>Query System State</td>
</tr>
<tr>
<td>14</td>
<td>Change System State</td>
</tr>
<tr>
<td>15</td>
<td>Scheduler Enable</td>
</tr>
<tr>
<td>16</td>
<td>Scheduler Disable</td>
</tr>
<tr>
<td>17</td>
<td>User functions (time, id, etc) enable</td>
</tr>
<tr>
<td>18</td>
<td>User functions (time, id, etc) disable</td>
</tr>
<tr>
<td>19</td>
<td>Select alternate hang timer</td>
</tr>
<tr>
<td>20</td>
<td>Select standard hang timer</td>
</tr>
<tr>
<td>21</td>
<td>Enable Parrot Mode</td>
</tr>
<tr>
<td>22</td>
<td>Disable Parrot Mode</td>
</tr>
<tr>
<td>23</td>
<td>Birdbath (Current Parrot Cleanup/Flush)</td>
</tr>
<tr>
<td>24</td>
<td>Flush all telemetry</td>
</tr>
<tr>
<td>25</td>
<td>Query last node un-keyed</td>
</tr>
<tr>
<td>26</td>
<td>Query all nodes keyed/unkeyed</td>
</tr>
<tr>
<td>27</td>
<td>Reset DAQ minimum on a pin</td>
</tr>
<tr>
<td>28</td>
<td>Reset DAQ maximum on a pin</td>
</tr>
<tr>
<td>30</td>
<td>Recall Memory Setting in Attached Xcvr</td>
</tr>
<tr>
<td>31</td>
<td>Channel Selector for Parallel Programmed Xcvr</td>
</tr>
<tr>
<td>32</td>
<td>Touchtone pad test: command + Digit string + # to playback all digits pressed</td>
</tr>
<tr>
<td>33</td>
<td>Local Telemetry Output Enable</td>
</tr>
<tr>
<td>34</td>
<td>Local Telemetry Output Disable</td>
</tr>
<tr>
<td>35</td>
<td>Local Telemetry Output on Demand</td>
</tr>
<tr>
<td>36</td>
<td>Foreign Link Local Output Path Enable</td>
</tr>
<tr>
<td>37</td>
<td>Foreign Link Local Output Path Disable</td>
</tr>
<tr>
<td>38</td>
<td>Foreign Link Local Output Path Follows Local Telemetry</td>
</tr>
<tr>
<td>39</td>
<td>Foreign Link Local Output Path on Demand</td>
</tr>
<tr>
<td>42</td>
<td>Echolink announce node # only</td>
</tr>
<tr>
<td>43</td>
<td>Echolink announce node Callsign only</td>
</tr>
<tr>
<td>44</td>
<td>Echolink announce node # and Callsign</td>
</tr>
<tr>
<td>45</td>
<td>Link Activity timer enable</td>
</tr>
<tr>
<td>46</td>
<td>Link Activity timer disable</td>
</tr>
<tr>
<td>47</td>
<td>Reset "Link Config Changed" Flag</td>
</tr>
<tr>
<td>48</td>
<td>Send Page Tone (Tone specs separated by parenthesis)</td>
</tr>
<tr>
<td>49</td>
<td>Disable incoming connections (control state noice)</td>
</tr>
<tr>
<td>50</td>
<td>Enable incoming connections (control state noicd)</td>
</tr>
<tr>
<td>51</td>
<td>Enable sleep mode</td>
</tr>
<tr>
<td>52</td>
<td>Disable sleep mode</td>
</tr>
<tr>
<td>53</td>
<td>Wake up from sleep</td>
</tr>
<tr>
<td>54</td>
<td>Go to sleep</td>
</tr>
<tr>
<td>55</td>
<td>Parrot Once if parrot mode is disabled</td>
</tr>
<tr>
<td>56</td>
<td>Rx CTCSS Enable</td>
</tr>
<tr>
<td>57</td>
<td>Rx CTCSS Disable</td>
</tr>
<tr>
<td>58</td>
<td>Tx CTCSS On Input only Enable</td>
</tr>
<tr>
<td>59</td>
<td>Tx CTCSS On Input only Disable</td>
</tr>
<tr>
<td>60</td>
<td>Send MDC-1200 Burst (cop,60,type,UnitID[,DestID,SubCode]) Type is 'I' for PttID, 'E' for Emergency, and 'C' for Call (SelCall or Alert), or 'SX' for STS (status), where X is 0-F. DestID and subcode are only specified for  the 'C' type message. UnitID is the local systems UnitID. DestID is the MDC1200 ID of the radio being called, and the subcodes are as follows: Subcode '8205' is Voice Selective Call for Spectra ('Call') Subcode '8015' is Voice Selective Call for Maxtrac ('SC') or Astro-Saber('Call') Subcode '810D' is Call Alert (like Maxtrac 'CA')</td>
</tr>
<tr>
<td>61</td>
<td>Send Message to USB to control GPIO pins (cop,61,GPIO1=0[,GPIO4=1]...)</td>
</tr>
<tr>
<td>62</td>
<td>Send Message to USB to control GPIO pins, quietly (cop,62,GPIO1=0[,GPIO4=1]...)</td>
</tr>
<tr>
<td>63</td>
<td>Send pre-configred APRSTT notification (cop,63,CALL[,OVERLAYCHR])</td>
</tr>
<tr>
<td>64</td>
<td>Send pre-configred APRSTT notification, quietly (cop,64,CALL[,OVERLAYCHR])</td>
</tr>
<tr>
<td>65</td>
<td>Send POCSAG page (equipped channel types only)</td>
</tr>
</tbody>
</table>
<h2 id="config-rpt_conf-general-stanza">General Stanza</h2>
<p>ASL3 introduces a new stanza in <code>rpt.conf</code>, the <code>[general]</code> stanza.</p>
<p>Presently, this stanza just contains <code>key=value</code> pairs that specify how node lookups are handled:</p>
<div class="highlight"><pre><span></span><code>[general]
node_lookup_method = both           ; method used to lookup nodes
                                    ; both = dns lookup first, followed by external file (default)
                                    ; dns = dns lookup only
                                    ; file = external file lookup only

; The domain name used for DNS lookups when the node lookup method is &quot;dns&quot; or
; &quot;both&quot;.  The default domain is &quot;nodes.allstarlink.org&quot; and does not need to
; be defined here.  Only set &quot;dns_node_domain&quot; if a) You really know what you&#39;re
; doing and b) you need to use an alternate DNS domain for node resolution.
;dns_node_domain = nodes.allstarlink.org

; When using DNS, &quot;app_rpt&quot; must know the length of the longest node number.
; The current maximum is 6 digits and does not need to be defined here. The
; &quot;max_dns_node_length&quot; variable can be used to limit queries to shorter (or
; longer) node numbers.
;max_dns_node_length = 6
</code></pre></div>
<p>See <a href="#adv-topics-noderesolution">Node Resolution</a> for how this new node lookup method is handled.</p>
<h2 id="config-rpt_conf-node-number-stanza">Node Number Stanza</h2>
<p>The node number stanza is a critical stanza in <code>rpt.conf</code>. </p>
<div class="highlight"><pre><span></span><code>[1999]    ; Replace with your assigned or private node number
</code></pre></div>
<p>The node number stanza is set to the <strong>assigned node number</strong> <em>or</em> a <strong>private node number</strong> (if a private node is being configured). It will normally be configured by <a href="#user-guide"><code>asl-menu</code></a>.</p>
<p>The node number stanza contains all the configurable options for that specific node using a <code>key=value</code> pair syntax. The following configurable options are available to use:</p>
<h3 id="config-rpt_conf-accountcode">accountcode=</h3>
<p>This option is optional, it sets the <code>ACCOUNTCODE</code> variable to be passed back to other Asterisk applications, namely for call detail records (CDR).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>accountcode=RADIO   ; set the accountcode variable to RADIO
</code></pre></div>
<h3 id="config-rpt_conf-althangtime">althangtime=</h3>
<p>This setting controls the length of the repeater hang time when the alternate hang timer is selected with a control operator function. It is specified in milliseconds. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>althangtime=4000   ; 4 seconds
</code></pre></div>
<h3 id="config-rpt_conf-aprstt">aprstt=</h3>
<p>This option enables APRStt. Set the <code>aprstt=</code> option to a matching context in <code>/etc/asterisk/gps.conf</code> to enable. You also need to have the <code>app_gps.so</code> module loaded in <code>/etc/asterisk/modules.conf</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>aprstt = general             ;  Point to the [general] context in gps.conf
</code></pre></div>
<p>See the comments in <code>gps.conf</code> for more details on configuring.</p>
<h3 id="config-rpt_conf-archivedir">archivedir=</h3>
<p>This option is used to enable a simple log and audio recorder of the activity on a node. When enabled, a series of recordings, one for each active COR on the node, is generated. The file(s) will be named with the date and time down to the second (this may change to provide more granularity in the future). This logging can be useful in debugging, policing, or other creative things.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>archivedir = /var/spool/asterisk/monitor ; top-level recording directory
</code></pre></div>
<p>The <a href="#config-rpt_conf-archivedir"><code>archivedir=</code></a> and <a href="#config-rpt_conf-archiveformat"><code>archiveformat=</code></a> options can be implemented in the <code>[node-main](!)</code> stanza to apply to all nodes on the server, or in the per-node stanza for recording individual nodes. See <a href="#adv-topics-conftmpl-asterisk-templates">config file templating</a> for more information.</p>
<p><strong>NOTE:</strong> Enabling this function can adversely impact the CPU utilization on the device, and consume large amounts of the available storage. You would be wise to implement a script or look at a utility such as <code>logrotate</code> to periodically flush old recordings and logs.</p>
<h3 id="config-rpt_conf-archiveformat">archiveformat=</h3>
<p>This option specifies the format of the audio recordings in <a href="#config-rpt_conf-archivedir"><code>archivedir=</code></a>. By default, the format will be "wav49" (GSM in a .WAV file). Other options you may consider include "wav" (SLIN in a .wav file) and "gsm" (GSM in straight gsm format).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>archiveformat = wav49                    ; audio format (default = wav49)
</code></pre></div>
<h3 id="config-rpt_conf-archivedatefmt">archivedatefmt=</h3>
<p>This option specifies the filename format used for the audio recordings in <a href="#config-rpt_conf-archivedir"><code>archivedir=</code></a>.  By default, the files will use a "%Y%m%d%H%M%S" date format that maps to YYYYMMDDHHMMSS.  If desired, you can specify any date format supported by the C function strftime(3) API.  For more precision, you can also include the '%[n]q' format to add fractions of a second, with leading zeros.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>archivedatefmt = %Y%m%d%H%M%S%2q         ; date/time (time to 1/100th secs)
</code></pre></div>
<h3 id="config-rpt_conf-archiveaudio">archiveaudio=</h3>
<p>This option specifies whether the both the simple activity log AND audio recordings are included in <a href="#config-rpt_conf-archivedir"><code>archivedir=</code></a>.  If set to "no" then only the activity log will be created (the audio recordings will not be saved).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>archiveaudio = yes                       ; enable/disable audio recordings (default = yes)
</code></pre></div>
<h3 id="config-rpt_conf-beaconing">beaconing=</h3>
<p>This option, when set to <code>1</code> will send the repeater ID at the <a href="#config-rpt_conf-idtime"><code>idtime</code></a> interval, regardless of whether there was repeater activity or not. This feature appears to be required in the UK, but is probably illegal in the US.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>beaconing=1   ;Set to 1 to beacon. Defaults to 0
</code></pre></div>
<p>See <a href="#adv-topics-eurorptr">European Repeater Operation</a> for more information on the application of this option.</p>
<h3 id="config-rpt_conf-callerid">callerid=</h3>
<p>This option allows the autopatch on the node to be identified with a specific caller ID. The default setting is as follows</p>
<div class="highlight"><pre><span></span><code>callerid=&quot;Repeater&quot; &lt;0000000000&gt;
</code></pre></div>
<p><strong>Note</strong>: The value in quotes is the name of the autopatch caller, and the numbers in angle brackets are the originating telephone number to use.</p>
<h3 id="config-rpt_conf-connpgm-and-discpgm">connpgm= and discpgm=</h3>
<p>These options run user defined scripts.</p>
<p><code>connpgm</code> executes a program you specify on connect. It passes 2 command line arguments to your program:</p>
<ol>
<li>node number in this stanza (us)</li>
<li>node number being connected to us (them)</li>
</ol>
<p><code>discpgm</code> executes a program you specify on disconnect. It passes 2 command line arguments to your program:</p>
<ol>
<li>node number in this stanza (us)</li>
<li>node number being connected to us (them)                         </li>
</ol>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code># Place these lines in rpt.conf for each node:
#     connpgm=/etc/asterisk/custom/myscript 1
#     discpgm=/etc/asterisk/custom/myscript 0
</code></pre></div>
<h3 id="config-rpt_conf-context">context=</h3>
<p>This setting directs the autopatch for the node to use a specific context in <code>extensions.conf</code> for outgoing autopatch calls. The default is to specify a context name of radio.</p>
<div class="highlight"><pre><span></span><code>context=radio
</code></pre></div>
<h3 id="config-rpt_conf-controlstates">controlstates=</h3>
<p>This setting allows you to override the stanza name used for the <a href="#config-rpt_conf-control-states-stanza"><code>[Control States]</code></a> in <code>rpt.conf</code>. Control states are an optional feature which allows groups of control operator commands to be executed all at once. To use control states, define an entry in your node stanzas to point to a dedicated control states stanza like this:</p>
<div class="highlight"><pre><span></span><code>controlstates = controlstates   ; points to control state stanza

[controlstates]
0 = rptena,lnkena,apena,totena,ufena,noicd  ; Normal operation                                  
1 = rptena,lnkena,apdis,totdis,ufena,noice  ; Net and news operation                                             
2 = rptena,lnkdis,apdis,totena,ufdis,noice  ; Repeater only operation
</code></pre></div>
<p>The default is to have <code>controlstates=</code> point to a stanza called <code>controlstates</code>. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>The <a href="#config-rpt_conf-control-states-stanza">Control States Stanza</a> describes these mnemonics in detail.</p>
<h3 id="config-rpt_conf-duplex">duplex=</h3>
<p>This setting sets the duplex mode for desired radio operation. Duplex mode 2 is the default if nonthing specified.</p>
<table>
<thead>
<tr>
<th>Duplex</th>
<th>Mode Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Half duplex with no telemetry tones or hang time. Special Case: Full duplex if linktolink is set to yes. This mode is preferred when interfacing with an external multiport repeater controller. Comment out idrecording and idtalkover to suppress IDs.</td>
</tr>
<tr>
<td>1</td>
<td>Half duplex with telemetry tones and hang time. Does not repeat audio. This mode is preferred when interfacing a simplex node.</td>
</tr>
<tr>
<td>2</td>
<td>Full Duplex with telemetry tones and hang time. This mode is preferred when interfacing a repeater.</td>
</tr>
<tr>
<td>3</td>
<td>Full Duplex with telemetry tones and hang time, but no repeated audio.</td>
</tr>
<tr>
<td>4</td>
<td>Full Duplex with telemetry tones and hang time. Repeated audio only when the autopatch is down.</td>
</tr>
</tbody>
</table>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>duplex = 0     ; 0 = Half duplex with no telemetry tones or hang time.
</code></pre></div>
<h3 id="config-rpt_conf-eannmode">eannmode=</h3>
<p>This option sets the Echolink node announcement type, when a node connects:</p>
<ul>
<li>1 = Say only node number (default)</li>
<li>2 = Say phonetic call sign only on Echolink connects</li>
<li>3 = Say phonetic call sign and node number on Echolink connects</li>
</ul>
<h3 id="config-rpt_conf-echolinkdefault">echolinkdefault=</h3>
<p>This option sets the Echolink telemetry option:</p>
<ul>
<li>0 = telemetry output off</li>
<li>1 = telemetry output on</li>
<li>2 = timed telemetry output on command execution and for a short time thereafter</li>
<li>3 = follow local telemetry mode</li>
</ul>
<h3 id="config-rpt_conf-echolinkdynamic">echolinkdynamic=</h3>
<p>This option enables/disables the Echolink telemetry COP command.</p>
<ul>
<li>0 = disallow users to change current Echolink telemetry setting with a COP command</li>
<li>1 = allow users to change the setting with a COP command</li>
</ul>
<h3 id="config-rpt_conf-endchar">endchar=</h3>
<p>This setting allows the end character used by some control functions to be changed. By default this is a <code>#</code>. The <code>endchar</code> value must not be the same as the <a href="#config-rpt_conf-funcchar"><code>funcchar</code></a> default (<code>*</code>) or its overridden value.</p>
<h3 id="config-rpt_conf-erxgain">erxgain=</h3>
<p>This option adjusts the Echolink receive gain in +/- dbV. It is used to balance Echolink recieve audio levels on an <code>app_rpt</code> node. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>erxgain = -3
</code></pre></div>
<p>See the Echolink How-to for more information.</p>
<h3 id="config-rpt_conf-etxgain">etxgain=</h3>
<p>This option adjusts the Echolink transmit gain in +/- dbV. It is used to balance Echolink transmit audio on an <code>app_rpt</code> node. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>etxgain = 3
</code></pre></div>
<p>See the Echolink How-to for more information.</p>
<h3 id="config-rpt_conf-events">events=</h3>
<p>This option allows you to override the name used for the <code>[events]</code> stanza in <code>rpt.conf</code>. You can create events to specify that actions be taken when certain events occur such as transitions in receive and transmit keying, the presence and modes of links, and external inputs such as GPIO pins on the URI (or similar USB devices).</p>
<p>To use events, define an entry in your node stanzas to point to a dedicated events stanza like this:</p>
<div class="highlight"><pre><span></span><code>events = events   ; points to the events stanza

[events]
;;;;; Events Management ;;;;;
status,2 = c|f|RPT_NUMLINKS      ; Say time of day when all links disconnect.
</code></pre></div>
<p>The default is to have <code>events=</code> point to a stanza called <code>events</code>. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See <a href="https://wiki.allstarlink.org/wiki/Event_Management">Event Management</a> for a more detailed look on how to configure events.</p>
<h3 id="config-rpt_conf-extnodefile">extnodefile=</h3>
<p>This option allows you to set the name of the external node lookup file. The default value is <code>/var/lib/asterisk/rpt_extnodes</code>. This file is used to look up node information when linking to other nodes.  It is also used to validate nodes that are connecting to your node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>extnodefile=/var/lib/asterisk/rpt_extnodes
</code></pre></div>
<p>The default file is automatically updated using the node update script or the <code>asl3-update-nodelist</code> service.</p>
<p>The <code>extnodefile=</code> option supports multiple file names. In some cases, you may want the default file, along with a static locally maintained node file.  Multiple file names can be entered by separating them with a comma. A maximum of 100 external files can be specified.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>extnodefile=/var/lib/asterisk/rpt_extnodes,/var/lib/asterisk/myrpt_extnodes
</code></pre></div>
<p>If a custom <code>extnodefile=</code> is used, it must have the section header <code>[extnodes]</code> or a custom header as described in <a href="#config-rpt_conf-extnodes">extnodes</a>.</p>
<p>Also see <a href="#adv-topics-noderesolution">Node Resolutuion</a> for information on how to configure node lookups. </p>
<p><strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-extnodes">extnodes=</h3>
<p>This option allows you to set the section name used for <code>[extnodes]</code> in the <code>rpt_extnodes</code> file.  The default value is <code>extnodes</code>. This translates to <code>[extnodes]</code> section header. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>extnodes=myextnodes
</code></pre></div>
<p>In this example, you would need to configure the section <code>[myextnodes]</code> in your custom <code>rpt_extnodes</code> file.  <code>app_rpt</code> will no longer look for an <code>[extnodes]</code> section header for this node, it will look for <code>[myextnodes]</code> instead.</p>
<p>See the <a href="#config-rpt_conf-extnodefile">extnodefile</a> for more information on how the <code>extnodes</code> section is used.</p>
<p><strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-funcchar">funcchar=</h3>
<p>This setting can be used to change the default function starting character of <code>*</code> to something else. Please note that the new value chosen must not be the same as the default (<code>#</code>) or overridden value for <a href="#config-rpt_conf-endchar"><code>endchar=</code></a>.</p>
<h3 id="config-rpt_conf-functions">functions=</h3>
<p>The <code>functions</code> option allows you to override the stanza name used for the <code>functions</code> stanza in <code>rpt.conf</code>. Functions are used to decode DTMF commands when accessing the node from its receiver. To use functions, define an entry in your node stanzas to point to a dedicated function stanza like this:</p>
<p>Sample:</p>
<p><div class="highlight"><pre><span></span><code>functions = functions   ; pointer to functions stanza
</code></pre></div>
The default is to have <code>functions=</code> point to a stanza called <code>functions</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-functions-stanza">Functions Stanza</a> for more detail on defining functions.</p>
<h3 id="config-rpt_conf-hangtime">hangtime=</h3>
<p>This option controls the length of the repeater (squelch tail) hang time. It is specified in milliseconds. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>hangtime = 1000   ;Set hang time for 1 second
</code></pre></div>
<p>The default is 5000(ms), or 5sec.</p>
<h3 id="config-rpt_conf-holdofftelem">holdofftelem=</h3>
<p>This option forces all telemetry to be held off until a local user on the receiver or a remote user over a link unkeys. There is one exception to this behavior, and that is when an ID needs to be sent and there is activity coming from a linked node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>holdofftelem = 0   ;Set to 1 to hold off. Default is 0
</code></pre></div>
<h3 id="config-rpt_conf-idrecording">idrecording=</h3>
<p>The identifier message is stored in the node stanza using the <code>idrecording=</code> setting. It can be changed to a different call sign by changing the value to something different. The value can be either a morse code identification string (when prefixed with <code>|i</code>), or the name of a sound file containing a voice identification message. When using a sound file, the default path for the sound file is <code>/var/lib/asterisk/sounds</code>. Example usages are as follows:</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>idrecording = |iWB6NIL   ; Morse Code ID
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>idrecording = /var/lib/asterisk/sounds/myid   ; Voice ID
</code></pre></div>
<p><strong>Note:</strong> ID recording files must have extension gsm, ulaw, pcm, or wav. The extension is <strong>left off</strong> when it is defined as the example shows above. File extensions are used by Asterisk to determine how to decode the file. All ID recording files should be sampled at 8KHz. See Recording Audio Files for more information (link pending).</p>
<h3 id="config-rpt_conf-idtalkover">idtalkover=</h3>
<p>The ID talkover message is stored in the node stanza using the <code>idtalkover=</code> setting. The purpose of <code>idtalkover</code> is to specify an <em>alternate</em> ID to use when the ID must be sent <strong>over the top</strong> of a user transmission. This can be a shorter voice ID or an ID in morse code. The value can be either a morse code identification string (when prefixed with <code>|i</code>), or the name of a sound file containing a voice identification message. When using a sound file, the default path for the sound file is <code>/var/lib/asterisk/sounds</code>. Example usages are as follows:</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>idtalkover = |iwa6zft/r   ; Morse Code ID
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>idtalkover = /var/lib/asterisk/sounds/myid   ; Voice ID
</code></pre></div>
<p><strong>Note:</strong> ID recording files must have extension gsm,ulaw,pcm, or wav. The extension is left off when it is defined as the example shows above. File extensions are used by Asterisk to determine how to decode the file. All ID recording files should be sampled at 8KHz. See Recording Audio Files for more information (link pending).</p>
<h3 id="config-rpt_conf-idtime">idtime=</h3>
<p>This option sets the ID interval time, in mS. It is optional.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>idtime = 540000                     ; id interval time (in ms) (optional)
</code></pre></div>
<p>The default is 5 minutes (300000mS).</p>
<h3 id="config-rpt_conf-inxlat">inxlat=</h3>
<p>The input translate option allows complete remapping of the <a href="#config-rpt_conf-funcchar"><code>funcchar</code></a> and <a href="#config-rpt_conf-endchar"><code>endchar</code></a> digits to different digits or digit sequences.</p>
<p><code>inxlat</code> acts on the digits received by the radio receiver on the node.</p>
<p>Format: <code>inxlat = funcchars,endchars,passchars[,dialtone]</code></p>
<p>where:</p>
<ul>
<li><code>funcchars</code> is the digit or digit sequence to replace <code>funcchar</code></li>
<li><code>endchars</code> is the digit or digit sequence to replace <code>endchar</code></li>
<li><code>passchars</code> are the digits to pass through (can be used to block certain digits)</li>
<li><code>dialtone</code> set to <code>y</code> to optionally play dialtone on a function.</li>
</ul>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>inxlat = #456,#457,0123456789ABCD ; string xlat from radio port to sys
</code></pre></div>
<p>In the above example, on inbound DTMF, translate #456 as <code>funcchar</code> (normally <code>*</code>), #457 as <code>endchar</code> (normally <code>#</code>), and pass all other digits listed in <code>passchars</code> normally.</p>
<h3 id="config-rpt_conf-link_functions">link_functions=</h3>
<p>This option allows you to override the stanza name used for the <code>link_functions</code> stanza in <code>rpt.conf</code>. The <code>link_functions=</code> setting directs the node to use a particular function stanza for functions dialed by users accessing the node <strong>via a link from another node</strong>. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>link_functions = functions ; pointer to the function stanza
</code></pre></div>
<p>The default is to have <code>link_functions=</code> point to a stanza called <code>functions</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-functions-stanza">Functions Stanza</a> for more detail on defining functions.</p>
<h3 id="config-rpt_conf-lnkactenable">lnkactenable=</h3>
<p>Set this option to enable the link activity timer. This applies to standard nodes only. </p>
<p>Sample:
<div class="highlight"><pre><span></span><code>lnkactenable = 0                   ; Set to 1 to enable the link activity timer.
</code></pre></div></p>
<p>The default is <code>0</code> (disabled).</p>
<h3 id="config-rpt_conf-lnkacttime">lnkacttime=</h3>
<p>Set the optional link activity timer (<code>lnkactenable</code> must be enabled for this to have any effect). The value is in seconds.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>lnkacttime = 1800                  ; Link activity timer time in seconds.
</code></pre></div>
<h3 id="config-rpt_conf-lnkactmacro">lnkactmacro=</h3>
<p>Play the defined macro when the link activity timer expires.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>lnkactmacro = *52                  ; Function to execute when link activity timer expires.
</code></pre></div>
<h3 id="config-rpt_conf-lnkacttimerwarn">lnkacttimerwarn=</h3>
<p>Set this to the voice file to play when the link activity timer has 30 seconds remaining.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>lnkacttimerwarn = 30seconds        ; Message to play when the link activity timer has 30 seconds left.
</code></pre></div>
<h3 id="config-rpt_conf-linkmongain">linkmongain=</h3>
<p>This option adjusts the audio level of monitored nodes when a signal from another node or the local receiver is received. If <code>linkmongain</code> is set to a negative number the monitored audio will decrease by the set amount in dB. If <code>linkmongain</code> set to a positive number monitored audio will increase by the set amount in dB. The value of <code>linkmongain</code> is in dB. The default value is 0dB.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>linkmongain = -20   ; reduce link volume 20dB
</code></pre></div>
<h3 id="config-rpt_conf-linktolink">linktolink=</h3>
<p>When operating in <a href="#config-rpt_conf-duplex">duplex mode 0</a>, this forces the radio interface to operate in full duplex mode, but keeps all the other "duplex mode 0" semantics. </p>
<p>This is used when a radio interface is connected to a multiport analog repeater controller. The <code>linktolink=</code> option can take two values: <code>yes</code>/<code>1</code> or <code>no</code>/<code>0</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>linktolink = no   ; set to yes to enable. Default is no.
</code></pre></div>
<h3 id="config-rpt_conf-linkunkeyct">linkunkeyct=</h3>
<p>This option selects the courtesy tone to send when a connected remote node unkeys. The default is no courtesy tone when a remote node unkeys.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>linkunkeyct = ct8  ; use courtesy tone 8
</code></pre></div>
<h3 id="config-rpt_conf-litzchar">litzchar=</h3>
<p>This option sets the DTMF character used to initiate the Long Tone Zero (LiTZ) feature. LiTZ is an optional feature that users can initiate to indicate they require immediate assistance. When the LiTZ DTMF character is sent for longer than the LiTZ time, the LiTZ command will be triggered. This could dial 911 on the autopatch, play a message, connect to another node, etc.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>litzchar = 0       ; 0 is the default DTMF access character for the LiTZ feature
</code></pre></div>
<h3 id="config-rpt_conf-litzcmd">litzcmd=</h3>
<p>This option defines the command to run when the LiTZ feature is initiated. Leave blank to disable LiTZ (default).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>litzcmd = *6911     ; dial 911 on the autopatch when LiTZ is activated
</code></pre></div>
<h3 id="config-rpt_conf-litztime">litztime=</h3>
<p>This option defines how long <code>litzchar</code> needs to be sent for, to be considered valid. If <code>litzchar</code> is received for this minimum period, <code>litzcmd</code> will be executed when the user unkeys. The default is 3000mS (3 seconds).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>litztime = 3000     ; default 3000mS (3 seconds)
</code></pre></div>
<h3 id="config-rpt_conf-macro">macro=</h3>
<p>This option allows you to override the stanza name used for the <code>[macro]</code> stanza in <code>rpt.conf</code>. The macro stanza directs the node to use a particular stanza for macros dialed by users accessing the node. Macros are DTMF shortcuts, and are a special type of function. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>macro=macro   ; use stanza named macro

[macro]
1 = *32000 *32001#                  ; connect to nodes 2000 and 2001
</code></pre></div>
<p>The default is to have <code>macro=</code> point to a stanza called <code>macro</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-macro-stanza">Macro Stanza</a> for more detail on defining macros.</p>
<h3 id="config-rpt_conf-morse">morse=</h3>
<p>This option allows you to override the stanza name used for the <code>morse</code> stanza in <code>rpt.conf</code>. The morse stanza directs the node to use a particular stanza for morse code parameters for the node. Morse code parameters can be defined on a per-node basis.  </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>morse=morse   ; use stanza named morse

[morse]
speed = 20                          ; Approximate speed in WPM
frequency = 400                     ; Morse Telemetry Frequency
amplitude = 4096                    ; Morse Telemetry Amplitude
idfrequency = 400                   ; Morse ID Frequency
idamplitude = 1024                  ; Morse ID Amplitude
</code></pre></div>
<p>The default is to have <code>morse=</code> point to a stanza called <code>morse</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-morse-stanza">Morse Stanza</a> for more detail on defining morse parameters.</p>
<h3 id="config-rpt_conf-nodenames">nodenames=</h3>
<p>This option lets you override the default location to look for custom nodename files to play back when a node connects/disconnects.</p>
<p>The default location is <code>/var/lib/asterisk/sounds/rpt/nodenames</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>nodenames = /var/lib/asterisk/sounds/rpt/nodenames.callsign  ; Point to alternate nodename sound directory
</code></pre></div>
<p>When a node connects/disconnects, Asterisk will look in this directory for a filename that matches the calling node number. If it finds such a file, it will play it as the connect/disconnect message.</p>
<h3 id="config-rpt_conf-nodes">nodes=</h3>
<p>This option allows you to override the section name used for the '[nodes]' stanza in <code>rpt.conf</code>. The default value is <code>nodes</code>. The <code>[nodes]</code> stanza operates like a "hosts" file in an OS, and is the first place <code>app_rpt</code> looks to resolve how to reach a particular node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>nodes=mynodes
</code></pre></div>
<p>In this example, you would need to configure the section <code>[mynodes]</code> in <code>rpt.conf</code>.  <code>app_rpt</code> will no longer look for a <code>[nodes]</code> section header for this node, it will look for <code>[mynodes]</code> instead.</p>
<p>See the <a href="#config-rpt_conf-nodes-stanza">Nodes Stanza</a> for more information on how the nodes section is used.</p>
<p><strong>This option does not appear in the default <code>rpt.conf</code>, and as such, app_rpt uses the default stanza of <code>[nodes]</code></strong></p>
<h3 id="config-rpt_conf-nolocallinkct">nolocallinkct=</h3>
<p>Set this option to send <code>unlinkedct</code> instead, if another local node is connected to this node (hosted on the same PC).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>nolocallinkct = 0     ; default is 0, set to 1 to enable 
</code></pre></div>
<h3 id="config-rpt_conf-nounkeyct">nounkeyct=</h3>
<p>This option completely disables the courtesy tone. This is useful for eliminating TX tail time in applications using simplex uplinks to repeaters on the repeater pair itself.  This practice is <strong>strongly</strong> discouraged. The <code>nounkeyct=</code> option can take two values: <code>yes</code>/<code>1</code> or <code>no</code>/<code>0</code>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>nounkeyct = no  ; Set to yes to disable :(. Default is no.
</code></pre></div>
<h3 id="config-rpt_conf-outstreamcmd">outstreamcmd=</h3>
<p>This option is used to configure the utilities to run on th system to support streaming the node's audio to a streaming server.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>outstreamcmd = /bin/sh,-c,/usr/bin/lame --preset cbr 16 -r -m m -s 8 --bitwidth 16 - - | /usr/bin/ezstream -qvc /etc/ezstream.xml
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code>outstreamcmd = /usr/local/bin/nptee,broadcastify,otherstreamserver     ; Use the available nptee utility to stream to multiple servers at once
</code></pre></div>
<p>See <a href="#adv-topics-broadcastify">Streaming a Node to Broadcastify</a> for further information and details on how to configure audio streaming of the node.</p>
<h3 id="config-rpt_conf-outxlat">outxlat=</h3>
<p>The output translate option allows complete remapping of the <a href="#config-rpt_conf-funcchar"><code>funcchar</code></a> and <a href="#config-rpt_conf-endchar"><code>endchar</code></a> digits to different digits or digit sequences.</p>
<p><code>outxlat</code> acts on the digits sent by the node to a link.</p>
<p>Format: <code>outxlat = funcchars,endchars,passchars</code></p>
<p>where:</p>
<ul>
<li><code>funcchars</code> is the digit or digit sequence to replace <code>funcchar</code></li>
<li><code>endchars</code> is the digit or digit sequence to replace <code>endchar</code></li>
<li><code>passchars</code> are the digits to pass through (can be used to block certain digits).</li>
</ul>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>outxlat = *7,*0,0123456789ABCD ; string xlat from sys to radio port
</code></pre></div>
<p>In the above example, on outbound DTMF, <em>7 generates a <code>funcchar</code> (normally <code>*</code>), </em>0 generates an <code>endchar</code> (normally <code>#</code>), and pass all other digits listed in <code>passchars</code> normally.</p>
<p><strong>NOTE:</strong> This option is not well documented in the code, your mileage may vary.</p>
<h3 id="config-rpt_conf-parrot">parrot=</h3>
<p>The "parrot" repeats everything it hears. Use this option to create an "echo reflector node", where everything you transmit to the node will be played back when you unkey.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>parrot = 0                          ; 0 = Parrot mode off or enabled with COP commands (default = 0)
</code></pre></div>
<p>The available options are:</p>
<ul>
<li>0 = Parrot mode off or enabled with COP commands (default = 0)</li>
<li>1 = Parrot mode always on</li>
</ul>
<p>See <a href="#adv-topics-parrotmode">Parrot Mode</a> for more information on what this mode does, and how it works.</p>
<h3 id="config-rpt_conf-parrottime">parrottime=</h3>
<p>This option sets the amount of time in mS to delay before playing back the audio buffer.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>parrottime = 1000                   ; Wait 1s (1000mS) before playback
</code></pre></div>
<p>This timer is related to <a href="#adv-topics-parrotmode">Parrot Mode</a>.</p>
<h3 id="config-rpt_conf-phone_functions">phone_functions=</h3>
<p>This option allows you to override the stanza name used for the <code>phone_functions</code> stanza in <code>rpt.conf</code>. Phone functions are a specific group of commands that are available when the node is accessed via phone.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>phone_functions = functions   ; name phone_functions to functions
</code></pre></div>
<p>The default is to have <code>phone_functions=</code> point to a stanza called <code>functions</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See <a href="#config-rpt_conf-phone-functions-stanza">Phone Functions Stanza</a> for more information on the functions that can be configured.</p>
<h3 id="config-rpt_conf-phonelinkdefault">phonelinkdefault=</h3>
<p>This option sets whether telemetry is sent down phone links.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>phonelinkdefault = 1 
</code></pre></div>
<p>The available options are:</p>
<ul>
<li>0 = telemetry output off</li>
<li>1 = telemetry output on </li>
<li>2 = timed telemetry output on command execution and for a short time thereafter </li>
<li>3 = follow local telemetry mode</li>
<li>Default is 1</li>
</ul>
<h3 id="config-rpt_conf-phonelinkdynamic">phonelinkdynamic=</h3>
<p>This option sets whether telemetry down phone links can be enabled/disabled by users using a COP command.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>phonelinkdynamic = 1
</code></pre></div>
<p>The available options are:</p>
<ul>
<li>0 = disallow users to change phone telemetry setting with a COP command</li>
<li>1 = Allow users to change the setting with a COP command</li>
<li>Default is 1</li>
</ul>
<h3 id="config-rpt_conf-politeid">politeid=</h3>
<p>This option specifies the number of milliseconds prior to the end of the ID cycle where the controller will attempt to play the ID in the tail when a user unkeys. If the controller does not get a chance to send the ID in the tail, the ID will be played over the top of the next user transmission. Optional, default is 30000mS.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>politeid = 30000   ; 30 seconds
</code></pre></div>
<h3 id="config-rpt_conf-propagate_dtmf">propagate_dtmf=</h3>
<p>This option takes either <code>yes</code>/<code>1</code> or <code>no</code>/<code>0</code>. When set to <code>yes</code>, DTMF <strong>will</strong> be regenerated from out-of-band signalling or from from the receiver DTMF decoder whenever a function start character is NOT detected, and command decoding has not begun. When set to <code>no</code>, no tones will be regenerated. The default for this setting is <code>no</code>.</p>
<p>This setting is meant to be used in conjunction with <a href="#config-rpt_conf-linktolink"><code>linktolink</code></a>, <a href="#config-rpt_conf-inxlat"><code>inxlat</code></a>, and <a href="#config-rpt_conf-outxlat"><code>outxlat</code></a> when interfacing a radio port to a multiport analog repeater controller on an RF-linked system.</p>
<p>Sample:</p>
<p><div class="highlight"><pre><span></span><code>propagate_dtmf = no
</code></pre></div>
<strong>Note:</strong> There is a separate setting <code>propagate_phonedtmf</code> for use by dial-in (phone and dphone) users.</p>
<h3 id="config-rpt_conf-remotect">remotect=</h3>
<p>This option allows the selection of the remote linked courtesy tone so that the users can tell there is a <a href="#adv-topics-remotebase-remote-base-nodes">Remote Base</a> connected locally.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remotect = ct3   ; use courtesy tone 3
</code></pre></div>
<h3 id="config-rpt_conf-remote_inact_timeout">remote_inact_timeout=</h3>
<p>This option specifies the amount of time without keying from the link, before the link is determined to be inactive. Set to <code>0</code> to disable timeout.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_inact_timeout = 0   ; do not time out
</code></pre></div>
<p>This is a <a href="#adv-topics-remotebase-remote-base-nodes">Remote Base</a> option. See that section of the manual for more information.</p>
<h3 id="config-rpt_conf-remote_timeout">remote_timeout=</h3>
<p>This option specifies the session time out for the remote base. Set to <code>0</code> to disable. This option does not appear to be implemented in code.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>remote_timeout = 0   ; do not timeout
</code></pre></div>
<p>Default is 3600 (seconds?).</p>
<p>This is a <a href="#adv-topics-remotebase-remote-base-nodes">Remote Base</a> option. See that section of the manual for more information.</p>
<h3 id="config-rpt_conf-remote_timeout_warning">remote_timeout_warning=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 180 (seconds?).</p>
<p>This is a <a href="#adv-topics-remotebase-remote-base-nodes">Remote Base</a> option. See that section of the manual for more information.</p>
<h3 id="config-rpt_conf-remote_timeout_warning_freq">remote_timeout_warning_freq=</h3>
<p>This option does not appear to be implemented in code.</p>
<p>Default is 30 (seconds?).</p>
<p>This is a <a href="#adv-topics-remotebase-remote-base-nodes">Remote Base</a> option. See that section of the manual for more information.</p>
<h3 id="config-rpt_conf-rxburstfreq">rxburstfreq=</h3>
<p>This option determines the frequency of tone that the node receiver listens for, to enable access (RX Toneburst Access, common in Europe). If RX Toneburst operation is desired, specify the frequency in Hertz of the desired tone burst. Setting to <code>0</code> (or not specifying) indicates no tone burst operation.</p>
<p>Sample:</p>
<p><div class="highlight"><pre><span></span><code>rxburstfreq = 1000
</code></pre></div>
<strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-rxburstthreshold">rxburstthreshold=</h3>
<p>Fot RX Toneburst mode, this option specifies the minimum signal to noise ratio in dB that qualifies a valid tone.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxburstthreshold= 16
</code></pre></div>
<p>Defaults to 16 (dB).</p>
<p><strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-rxbursttime">rxbursttime=</h3>
<p>For RX Toneburst operation, specifies minimum amount of time that tone needs to be valid for recognition (in milliseconds). Defaults to 250.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxbursttime= 250
</code></pre></div>
<p><strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-rxchannel">rxchannel=</h3>
<p>This setting selects the type of radio interface used by the node. There must be <strong>one</strong> (and only one) <code>rxchannel</code> per node definition stanza. The selections for <code>rxchannel</code> are: </p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>dahdi/pseudo</td>
<td>No radio, used for hubs</td>
</tr>
<tr>
<td>SimpleUSB/1999</td>
<td>SimpleUSB Channel Driver (limited DSP), specify associated node number found in simpleusb.conf</td>
</tr>
<tr>
<td>Radio/1999</td>
<td>Usbradio Channel Driver (full DSP), specify associated node number found in usbradio.conf</td>
</tr>
<tr>
<td>voter/1990</td>
<td>VOTER (RTCM) Channel Driver, specify associated node number found in voter.conf</td>
</tr>
<tr>
<td>USRP/127.0.0.1:34001:32001</td>
<td>GNU Radio interface USRP</td>
</tr>
<tr>
<td>tlb/tlb0</td>
<td>TheLinkBox Channel Driver, pointing to the specified (tlb0) channel context in tlb.conf</td>
</tr>
</tbody>
</table>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxchannel = dahdi/pseudo     ; No radio (hub)
</code></pre></div>
<p><strong>NOTE:</strong> This is selecting what is known (in Asterisk terminology) the <em>channel driver</em>.</p>
<p><strong>NOTE:</strong> Be sure that any channel driver you use also has it's corresponding module being loaded in <code>/etc/asterisk/modules.conf</code>.</p>
<h3 id="config-rpt_conf-rxnotch">rxnotch=</h3>
<p>In order to use this option, <code>app_rpt</code> must have been compiled with the <code>notch</code> option. This option will notch a particular center frequency (in Hz) for a specified bandwidth (in Hz).</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>rxnotch=1065,40                    ; Notch 1065Hz for +/-20Hz
</code></pre></div>
<p><strong>NOTE:</strong> IF this option is available, it requires a great deal of CPU to perform and would probably be detrimental to use on the small boards. It isn't recommended for use.</p>
<h3 id="config-rpt_conf-scheduler">scheduler=</h3>
<p>This option allows you to override the stanza name used for the <code>schedule</code> stanza in <code>rpt.conf</code>. The scheduler is used to execute commands at a particular time.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>scheduler = schedule   ; name scheduler to &#39;schedule&#39;

[schedule]
...
</code></pre></div>
<p>The default is to have <code>scheduler=</code> point to a stanza called <code>schedule</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-schedule-stanza">Schedule Stanza</a> for more information on the scheduler.</p>
<h3 id="config-rpt_conf-sleeptime">sleeptime=</h3>
<p>This option sets the inactivity period in <em>seconds</em> of no signal on the node's receiver before the system goes to sleep. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>sleeptime = 300   ; go to sleep after 5 mins of no activity
</code></pre></div>
<p>See <a href="#adv-topics-sleepmode">Sleep Mode</a> for more information on what this timer does, and how it works.</p>
<h3 id="config-rpt_conf-startup_macro">startup_macro=</h3>
<p>The <code>startup_macro</code> is executed once on system startup. Each node can have <strong>one</strong> startup macro defined in its node stanza.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>startup_macro = *31000 *31001 *31002   ; Connect to nodes 1000, 1001 and 1002 at startup
</code></pre></div>
<p>One string of one or multiple commands, executed in order. </p>
<p><strong>NOTE:</strong> This string of commands does NOT terminate with a # like a normal macro. You can call any number of regular macros with it.</p>
<h3 id="config-rpt_conf-startup_macro_delay">startup_macro_delay=</h3>
<p>This option causes the system to wait a specified number of seconds upon startup, before executing the <a href="#config-rpt_conf-startup_macro"><code>startup_marco</code></a>.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>startup_macro_delay = 5                    ; wait 5s before running the startup_macro
</code></pre></div>
<h3 id="config-rpt_conf-statpost_program">statpost_program=</h3>
<p>This option sets the commands to run on the server to process usage statistics of the node. <strong>This option is generally no longer required, but is included for documentation purposes.</strong></p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>;statpost_program=/usr/bin/wget,-q,--timeout=15,--tries=1,--output-document=/dev/null
</code></pre></div>
<h3 id="config-rpt_conf-statpost_url">statpost_url=</h3>
<p>Uncomment this option to enable status and statistics reporting of your node to <a href="https://stats.allstarlink.org">https://stats.allstarlink.org</a></p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>;statpost_url = http://stats.allstarlink.org/uhandler ; Status updates
</code></pre></div>
<p>The <code>statspost_url=</code> option can be implemented in the <code>[node-main](!)</code> stanza to apply to all nodes on the server, or in the per-node stanza for limiting statistics posting to an individual nodes. See <a href="#adv-topics-conftmpl-asterisk-templates">config file templating</a> for more information.</p>
<h3 id="config-rpt_conf-tailmessagelist">tailmessagelist=</h3>
<p>This option allows a comma-separated list of audio files to be specified for the tail message function. The tail messages will rotate from one to the next until the end of the list is reached, at which point the first message in the list will be selected. If no absolute path name is specified, the directory <code>var/lib/asterisk/sounds</code> will be searched for the sound file. The file extension should be omitted.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>tailmessagelist = welcome,clubmeeting,wx   ; rotate 3 tail messages
</code></pre></div>
<p>Tail messages can be "squashed" if a user keys up over them.</p>
<p><strong>Note:</strong> ID recording files must have extension gsm,ulaw,pcm, or wav. The extension is left off when it is defined as the example shows above. File extensions are used by Asterisk to determine how to decode the file. All ID recording files should be sampled at 8KHz. See Recording Audio Files for more information.</p>
<h3 id="config-rpt_conf-tailmessagetime">tailmessagetime=</h3>
<p>This option sets the amount of time in milliseconds between tail messages. Tail Messages are played when a user unkeys on the node input at the point where the hang timer expires, and after the courtesy tone is sent.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>tailmessagetime = 900000   ; 15 minutes between tail messages
</code></pre></div>
<p>The maximum value is 200000000mS, 55.5555hours.</p>
<h3 id="config-rpt_conf-tailsquashedtime">tailsquashedtime=</h3>
<p>If a tail message is "squashed" by a user keying up over the top of it, a separate time value can be loaded to make the tail message be retried at a shorter time interval than the standard <code>tailmessagetime=</code> option. The <code>tailsquashedtime=</code> option takes a value in milliseconds.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>tailsquashedtime = 300000   ; 5 minutes
</code></pre></div>
<h3 id="config-rpt_conf-telemetry">telemetry=</h3>
<p>This option allows you to override the stanza name used for the <code>telemetry</code> stanza in <code>rpt.conf</code>. Telemetry definitions define courtesy tone parameters, and tones sent when certain actions take place on the node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>telemetry = telemetry   ; name telemetry to &#39;telemetry&#39;

[telemetry]
...
</code></pre></div>
<p>The default is to have <code>telemetry=</code> point to a stanza called <code>telemetry</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-telemetry-stanza">Telemetry Stanza</a> for more information on the options that can be configured.</p>
<h3 id="config-rpt_conf-telemdefault">telemdefault=</h3>
<p>This option sets whether telemetry is turned on or off by default.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>telemdefault = 1 
</code></pre></div>
<p>The available options are:</p>
<ul>
<li>0 = telemetry output off</li>
<li>1 = telemetry output on (default)</li>
<li>2 = timed telemetry output on command execution and for a short time thereafter</li>
<li>Default is 1</li>
</ul>
<h3 id="config-rpt_conf-telemduckdb">telemduckdb=</h3>
<p>This option allows adjustment of the telemetry level in dB when a local or voice transmission is in progress. Specify the level to lower the telemetry level in negative dB.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>telemduckdb = -15                   ; Reduce telemetry by -15dB
</code></pre></div>
<h3 id="config-rpt_conf-telemdynamic">telemdynamic=</h3>
<p>This option sets whether telemetry can be enabled/disabled by users using a COP command.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>telemdynamic = 1
</code></pre></div>
<p>The available options are:</p>
<ul>
<li>0 = disallow users to change the local telemetry setting with a COP command</li>
<li>1 = Allow users to change the setting with a COP command</li>
<li>Default is 1</li>
</ul>
<h3 id="config-rpt_conf-telemnomdb">telemnomdb=</h3>
<p>This option is used to fine tune the telemetry level, relative to standard node audio. The level is in dB. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>telemnomdb = -3                     ; Decrease nominal telemetry by -3dB
</code></pre></div>
<h3 id="config-rpt_conf-tonemacro">tonemacro=</h3>
<p>This option allows you to override the stanza name used for the <code>tonemacro</code> stanza in <code>rpt.conf</code>. The tone macro stanza directs the node to use a particular stanza for PL tone tiggered macros from users accessing the node. Macros are DTMF shortcuts, and are a special type of function. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>tonemacro = tonemacro   ; use stanza named tonemacro

[tonemacro]
100.0 = *81#     ; play the time if a 100.0Hz PL tone is received
</code></pre></div>
<p>The default is to have <code>tonemacro=</code> point to a stanza called <code>tonemacro</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See the <a href="#config-rpt_conf-tonemacro-stanza">Tonemacro Stanza</a> for more detail on defining tone macros.</p>
<p><strong>This option does not appear in the default <code>rpt.conf</code>.</strong></p>
<h3 id="config-rpt_conf-totime">totime=</h3>
<p>This option defines the time out timer interval for the node. The value is in milliseconds. If the node transmitter remains keyed beyond the <code>totime</code> timer length, the transmitter will be unkeyed until the receiver activity resets. </p>
<p>Sample:</p>
<p><div class="highlight"><pre><span></span><code>totime = 180000   ; Repeater timeout 3 minutes 
</code></pre></div>
The default value is 180000(mS), or 3 minutes. </p>
<p><strong>NOTE:</strong> This setting can cause issues when linked to active hub nodes that may have long transmissions. If the local node transmitter appears to "drop out" when connected to nodes/hubs with long winded operators or broadcasts, review this setting, and increase as necessary.</p>
<p>Related: <a href="#config-rpt_conf-cop-commands">COP Commands 7 and 8</a> and <a href="#config-rpt_conf-controlstates"><code>controlstates</code></a>, and <a href="#config-rpt_conf-control-states-stanza">Control States Stanza</a>.</p>
<h3 id="config-rpt_conf-unlinkedct">unlinkedct=</h3>
<p>This option selects the courtesy tone to be used when the system has no remote nodes connected and is operating as a standalone repeater.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>unlinkedct = ct2   ; use courtesy tone 2
</code></pre></div>
<h3 id="config-rpt_conf-wait-times">wait-times=</h3>
<p>This option allows you to override the stanza name used for the <code>wait-times</code> stanza in <code>rpt.conf</code>. Wait times are a specific group of timers for the node.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>wait-times = wait-times   ; name wait-times to wait-times
</code></pre></div>
<p>The default is to have <code>wait-times=</code> point to a stanza called <code>wait-times</code>, and have a common set of commands for all nodes. However, you can have it point to another named stanza, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.</p>
<p>See <a href="#config-rpt_conf-wait-times-stanza">Wait Times Stanza</a> for more information on the timers that can be configured.</p>
<h2 id="config-rpt_conf-control-states-stanza">Control States Stanza</h2>
<p>There are several predefined mnemonics (keywords) used in the <code>[controlstates]</code> stanza to enable and disable the various features of the controller. These mnemonics correspond to the control operator command (COP) to be executed and most of these are the same groups of letters announced on air when a single control operator command is executed on the controller.</p>
<table>
<thead>
<tr>
<th>Mnemonic</th>
<th>Description</th>
<th>COP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>rptena</td>
<td>Repeater Enable</td>
<td>2</td>
</tr>
<tr>
<td>rptdis</td>
<td>Repeater Disable</td>
<td>3</td>
</tr>
<tr>
<td>totena</td>
<td>Timeout Timer Enable</td>
<td>7</td>
</tr>
<tr>
<td>totdis</td>
<td>Timeout Timer Disable</td>
<td>8</td>
</tr>
<tr>
<td>apena</td>
<td>Autopatch Enable</td>
<td>9</td>
</tr>
<tr>
<td>apdis</td>
<td>Autopatch Disable</td>
<td>10</td>
</tr>
<tr>
<td>lnkena</td>
<td>Link Enable</td>
<td>11</td>
</tr>
<tr>
<td>lnkdis</td>
<td>Link Disable</td>
<td>12</td>
</tr>
<tr>
<td>skena</td>
<td>Scheduler Enable</td>
<td>15</td>
</tr>
<tr>
<td>skdis</td>
<td>Scheduler Disable</td>
<td>16</td>
</tr>
<tr>
<td>ufena</td>
<td>User Functions Enable</td>
<td>17</td>
</tr>
<tr>
<td>ufdis</td>
<td>User Functions Disable</td>
<td>18</td>
</tr>
<tr>
<td>atena</td>
<td>Alternate Hangtime Enable</td>
<td>19</td>
</tr>
<tr>
<td>atdis</td>
<td>Alternate Hangtime Disable</td>
<td>20</td>
</tr>
<tr>
<td>noice</td>
<td>No Incoming Connections Enable</td>
<td>49</td>
</tr>
<tr>
<td>noicd</td>
<td>No Incoming Connections Disable</td>
<td>50</td>
</tr>
<tr>
<td>slpen</td>
<td>Sleep Mode Enable</td>
<td>51</td>
</tr>
<tr>
<td>slpds</td>
<td>Sleep Mode Disable</td>
<td>52</td>
</tr>
</tbody>
</table>
<h2 id="config-rpt_conf-functions-stanza">Functions Stanza</h2>
<p>The <code>[functions]</code> stanza is a named stanza pointed to by the <a href="#config-rpt_conf-functions"><code>functions=</code></a> option. Functions within this stanza are used to decode DTMF commands when accessing the node from its <strong>receiver</strong>. This stanza is typically named <code>[functions]</code>. The name can be overridden, on a per-node basis, see <a href="#config-config-structure-settings-to-name-other-stanzas">Settings to Name Other Stanzas</a> for more information.  </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>functions = functions   ; name the functions stanza functions

[functions]
...
</code></pre></div>
<p>See <a href="#config-rpt_conf-dtmf-commands">DTMF Commands</a> for the list of functions available.</p>
<h3 id="config-rpt_conf-function-classes">Function Classes</h3>
<p>Function classes are names for categories of functions. There are several function classes defined. They are described in the table below:</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cop</td>
<td>Control operator commands</td>
</tr>
<tr>
<td>ilink</td>
<td>Internet linking commands</td>
</tr>
<tr>
<td>status</td>
<td>User status commands</td>
</tr>
<tr>
<td>autopatchup</td>
<td>Autopatch up commands</td>
</tr>
<tr>
<td>autopatchdn</td>
<td>Autopatch down commands</td>
</tr>
<tr>
<td>remote</td>
<td>Remote base commands</td>
</tr>
<tr>
<td>macro</td>
<td>Command macros</td>
</tr>
</tbody>
</table>
<p>Most of the above command classes require a <a href="#config-rpt_conf-function-methods"><code>function method</code></a> and possibly one or more additional <a href="#config-rpt_conf-function-options"><code>function option</code></a> parameters. Function methods are discussed next.</p>
<h3 id="config-rpt_conf-function-methods">Function Methods</h3>
<p>Function methods are numbers which identify a specific function to execute within a <code>function class</code>. Function methods may be optional and in some cases should be omitted (such as with the autopatchup method). A complete and up-to-date description of all <code>function methods</code> can be found in the <a href="https://github.com/AllStarLink/app_rpt/blob/master/apps/app_rpt.c"><code>app_rpt.c</code></a>  source file. Some <code>function methods</code> are shown below as an example below:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Force ID (global)</td>
</tr>
<tr>
<td>2</td>
<td>Give Time of Day (global)</td>
</tr>
<tr>
<td>3</td>
<td>Give software Version (global)</td>
</tr>
<tr>
<td>4</td>
<td>Give GPS location info</td>
</tr>
<tr>
<td>5</td>
<td>Speak the last (dtmf) user</td>
</tr>
<tr>
<td>11</td>
<td>Force ID (local only)</td>
</tr>
<tr>
<td>12</td>
<td>Give Time of Day (local only)</td>
</tr>
</tbody>
</table>
<h3 id="config-rpt_conf-function-options">Function Options</h3>
<p>Some <code>function methods</code> can take <code>function options</code>. These are specified after the <code>function method</code>, separated with commas. Not all commands require or take <code>function options</code>. An example of a method which can accept <code>function options</code> is the <code>autopatchup</code> method.</p>
<h3 id="config-rpt_conf-putting-it-all-together">Putting it all Together</h3>
<p>A small excerpt from the function stanza of <code>rpt.conf</code> is shown below.</p>
<div class="highlight"><pre><span></span><code> [functions]
 1=ilink,1                                               ; Specific link disconnect
 6=autopatchup,noct=1,farenddisconnect=1,dialtime=2000   ; Autopatch up
</code></pre></div>
<p>The above example contains DTMF functions with all of the parameters discussed on previously.</p>
<p>In the above example:</p>
<ul>
<li>*1 followed by a node number disconnects a specific link, recall that * is the default <a href="#config-rpt_conf-funcchar"><code>funcchar</code></a>. The <code>function class</code> is <code>ilink</code> and the <code>function method</code> is <code>1</code></li>
<li>*6 followed by a phone number brings up the autopatch with the <code>function options</code> specified. Note that there is no <code>function method</code> defined, but there are <code>function options</code> present.</li>
</ul>
<h2 id="config-rpt_conf-link-functions-stanza">Link Functions Stanza</h2>
<p>The <code>[my_link_functions]</code> stanza, if defined (see below), is a named stanza pointed to by the <a href="#config-rpt_conf-link_functions"><code>link_functions</code></a> option. Functions within this stanza are used decode DTMF commands when accessing the node <strong>via a link from another node</strong>. </p>
<p>The traditional usage is to point the <code>link_functions=</code> option to the same stanza as named by <a href="#config-rpt_conf-functions"><code>functions=</code></a>, thereby having functions from a linked node and from the local node be the same.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>functions = functions        ; name the functions stanza functions
link_functions = functions   ; use the same stanza 

[functions]
...
</code></pre></div>
<p>If a different set of either limited or more capable functions is desired:</p>
<div class="highlight"><pre><span></span><code>functions = functions                ; name the functions stanza functions
link_functions = my_link_functions   ; use a different stanza

[functions]
...

[my_link_functions]
...
</code></pre></div>
<p>See <a href="#config-rpt_conf-dtmf-commands">DTMF Commands</a> for the list of functions available.</p>
<h2 id="config-rpt_conf-macro-stanza">Macro Stanza</h2>
<p>The <code>[macro]</code> stanza is a named stanza pointed to by the <a href="#config-rpt_conf-macro"><code>macro=</code></a> option. Macros are DTMF shortcuts. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>macro=macro   ; use stanza named macros

[macro]
1 = *32000*32001     ; connect to nodes 2000 and 2001
</code></pre></div>
<p>See the <a href="#adv-topics-macros">Macro</a> page for more information on macros.</p>
<h2 id="config-rpt_conf-morse-stanza">Morse Stanza</h2>
<p>The <code>[morse]</code> stanza is a named stanza pointed to by the <a href="#config-rpt_conf-morse">`morse=</a> option.</p>
<p>Sample:</p>
<p><div class="highlight"><pre><span></span><code>[morse]
speed = 20            ; Approximate speed in WPM
frequency = 900       ; Morse Telemetry Frequency in Hz
amplitude = 4096      ; Morse Telemetry Amplitude (relative level)
idfrequency = 746     ; Morse ID Frequency in Hz
idamplitude = 768     ; Morse ID Amplitude (relative level)
</code></pre></div>
Note that <code>frequency</code> and <code>amplitude</code> would set the parameters for telemetry messages, whereas <code>idfrequency</code> and <code>idamplitude</code> would set the parameters specifically for identification (and they do not need to be the same).</p>
<h2 id="config-rpt_conf-nodes-stanza">Nodes Stanza</h2>
<p>The <code>[nodes]</code> stanza is a list of nodes, their IP addresses, port and "NONE" or "NO" for non-remote base (normal) nodes. The nodes stanza is used to identify which node is mapped to which Internet call and to determine the destination to send the call to. </p>
<p>If you are using automatic update for AllStarLink (public) nodes, no Allstar link nodes should be defined here. Only place a definition for your local nodes (on your local LAN behind the same NAT router), private (off of AllStarLink) nodes, and remote base nodes here.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[nodes]
1000 = radio@127.0.0.1/1000,NONE               ; Private hub on this server 
1001 = radio@host.domain.com/1001,NONE         ; Private node on another server
2501 = radio@127.0.0.1/2501,NONE               ; Public node on this server
2502 = radio@127.0.0.1/2502,NONE               ; Another public node on this server
2503 = radio@192.168.1.20:4570/2503,NONE       ; Public node behind the same NAT router
1998 = radio@127.0.0.1/1999,Y                  ; Remote base node on this server
</code></pre></div>
<p>For remote base nodes, replace the "NONE" with "Y" or "YES". Once designated as a remote base, that node will only allow <strong>one connection</strong> (link) for use, command, and control.</p>
<p>The <code>[nodes]</code> stanza performs a function similar to an OS hosts file. When looking up node information, <code>app_rpt</code> looks in the <code>[nodes]</code> stanza first then searches (what could be called the Allstar DNS) the <code>/var/lib/asterisk/rpt_extnodes</code> file.</p>
<h2 id="config-rpt_conf-phone-functions-stanza">Phone Functions Stanza</h2>
<p>The <code>[my_phone_functions]</code> stanza is a named stanza pointed to by the <a href="#config-rpt_conf-phone-functions-stanza"><code>phone_functions=</code></a> option. Functions within this stanza are used decode DTMF commands when <strong>accessing the node from a telephone</strong>. </p>
<p>The traditional usage is to point <code>phone_functions=</code> to the same stanza as named by <a href="#config-rpt_conf-functions"><code>functions=</code></a>, thereby having functions from a phone and from the local node be the same. </p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>functions = functions         ; name the functions stanza functions
phone_functions = functions   ; use the same stanza 

[functions]
...
</code></pre></div>
<p>If a different set of either limited or more capable functions is desired:</p>
<div class="highlight"><pre><span></span><code>functions = functions                  ; name the functions stanza functions
phone_functions = my_phone_functions   ; use a different stanza

[functions]
...

[my_phone_functions]
...
</code></pre></div>
<p>See <a href="#config-rpt_conf-dtmf-commands">DTMF Commands</a> for the list of functions available.</p>
<h2 id="config-rpt_conf-schedule-stanza">Schedule Stanza</h2>
<p>This stanza is named by the <a href="#config-rpt_conf-scheduler"><code>scheduler=</code></a> option. The scheduler can execute <strong>macros</strong> at certain times. For example for a net on Tuesday nights at 8 PM.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>scheduler=schedule   ; name the stanza &#39;schedule&#39;

[schedule]                                                                      
;dtmf_function =  m h dom mon dow  ; ala cron, star is implied                                                  
2 = 00 00 * * *   ; at midnight every day, execute macro 2.
</code></pre></div>
<p>See <a href="https://wiki.allstarlink.org/wiki/Scheduler_(ASL_System)">https://wiki.allstarlink.org/wiki/Scheduler_(ASL_System)</a> for more details.</p>
<h2 id="config-rpt_conf-telemetry-stanza">Telemetry Stanza</h2>
<p>This stanza is named by the [<code>telemetry=</code>] option. Telemetry entries can be shared across all nodes on the <code>Asterisk/app_rpt</code> server, or defined for each node. They can be a tone sequence, morse string, or a file as follows:</p>
<ul>
<li>|t - Tone escape sequence:</li>
<li>Tone sequences consist of 1 or more 4-tuple entries (freq1, freq2, duration, amplitude). Single frequencies are created by setting freq1 or freq2 to zero.</li>
<li>|m - Morse escape sequence:</li>
<li>Sends Morse code at the <strong>telemetry amplitude and telemetry frequency</strong> as defined in the <code>[morse]</code> section. Follow with an alphanumeric string.</li>
<li>|i - Morse ID escape sequence:</li>
<li>Sends Morse code at the <strong>ID amplitude and ID frequency</strong> as defined in the <code>[morse]</code> section. Follow with an alphanumeric string.</li>
<li>Path to sound file:</li>
<li>Specify the path to a sound file on the server. Do not include file extension.</li>
</ul>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>[telemetry]
ct1=|t(350,0,100,2048)(500,0,100,2048)(660,0,100,2048)
ct2=|t(660,880,150,2048)  
ct3=|t(440,0,150,4096) 
ct4=|t(550,0,150,2048)
ct4=|t(2475,0,250,768)
ct5=|t(660,0,150,2048)
ct6=|t(880,0,150,2048)
ct7=|t(660,440,150,2048)
ct8=|t(700,1100,150,2048)
ct9=filename-without-extension

;remotetx=|t(1633,0,50,3000)(0,0,80,0)(1209,0,50,3000)
remotetx=|t(880,0,150,2048) 
remotemon=|t(1209,0,50,2048) 
cmdmode=|t(900,903,200,2048)
functcomplete=|t(1000,0,100,2048)(0,0,100,0)(1000,0,100,2048)
patchup=rpt/callproceeding
patchdown=rpt/callterminated

What the numbers mean,
 (000,000,010,000)
   |   |   |   |-------amplitude
   |   |   |-------------duration
   |   |-------------------Tone 2
   |-------------------------Tone 1
</code></pre></div>
<h2 id="config-rpt_conf-tonemacro-stanza">Tonemacro Stanza</h2>
<p>The <code>[tonemacro]</code> stanza is a named stanza pointed to by the <a href="#config-rpt_conf-tonemacro"><code>tonemacro=</code></a> option. Tonemacros are macros that are executed upon receipt of a specific PL tone.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>tonemacro = tonemacro;     user stanza named tonemacro

[tonemacro]

100.0=*671
</code></pre></div>
<p>Format: <code>PL Tone = macro to execute</code>.</p>
<p>See [Full Tonemacro Use and Format] (https://wiki.allstarlink.org/wiki/Tonemacro_use_and_format) for more information on tone macros.</p>
<h2 id="config-rpt_conf-wait-times-stanza">Wait Times Stanza</h2>
<p>This stanza is named by the <a href="#config-rpt_conf-wait-times"><code>wait-times=</code></a> option. The wait time stanza is used to set delay time between various node actions and their response. Values are in milliseconds.</p>
<p>Sample:</p>
<div class="highlight"><pre><span></span><code>wait-times = wait-times   ; name the stanza wait-times

[wait-times]                                                                                                 
telemwait = 600                    ; Time to wait before sending most
idwait = 600                       ; Time to wait before starting ID
unkeywait = 800                    ; Time to wait after unkey before sending CT&#39;s and link telemetry
calltermwait = 2000                ; Time to wait before announcing &quot;call terminated&quot;
</code></pre></div></section><section class="print-page" id="config-tlb_conf"><h1 id="config-tlb_conf-tlbconf">tlb.conf</h1>
<p><code>tlb.conf</code> (<code>/etc/asterisk/tlb.conf</code>) is used to configure TheLinkBox channel driver, <code>chan_tlb</code>, for use with interfacing to <a href="https://github.com/skiphansen/thelinkbox">TheLinkBox</a> stations.</p>
<p>The format of the file is:</p>
<div class="highlight"><pre><span></span><code>[tlb0]
call = WB6NIL-R                     ; Callsign of the app_rpt station
port = 44966                        ; Start of UDP port range (this port, port + 1)
ipaddr = 44.128.252.1               ; Optional IP address to bind to
astnode = 63001                     ; app_rpt node associated with this instance (for incoming connections)
context = radio-secure              ; Asterisk context for incoming connections
codec = ULAW                        ; Default CODEC to be used


[nodes]
1001 = W6ABC,44.128.252.3,44966     ; This one is for W6ABC at ip 44.128.252.3:44966 default CODEC
1002 = W1XYZ,44.128.252.4,1234,G726 ; This one is for W1XYZ at ip 44.128.252.4:1234 with G726 CODEC
</code></pre></div>
<h2 id="config-tlb_conf-channel-definition-stanza">Channel Definition Stanza</h2>
<p>Define at least one channel stanza with the format <code>[tlbx]</code>, where <code>x</code> is a numeric digit.</p>
<p>You can have multiple instances defined (such as <code>[tlb1]</code>, etc.), as long as they are on different UDP port pairs.</p>
<p>The name of this context must match the reference for <code>rxchannel</code> in <a href="#config-rpt_conf"><code>rpt.conf</code></a>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>In rpt.conf:

rxchannel = tlb/tlb0

In tlb.conf:
[tlb0]
...
</code></pre></div>
<h3 id="config-tlb_conf-call">call=</h3>
<p>This is the callsign of the local AllStarLink node.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>call = WB6NIL-R                     ; Our callsign
</code></pre></div>
<h3 id="config-tlb_conf-port">port=</h3>
<p>This defines the <strong>starting</strong> port of the UDP port pair used for communication with TheLinkBox station. If not specified, the default ports used will be <code>44966/UDP</code> and <code>44967/UDP</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>port = 44966                        ; Start of UDP port range (this port, port + 1)
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">UDP Port Numbering</p>
<p>The UDP port pair must start with an <strong>even</strong> port number. The even port is for the RTP (audio) and the odd port is for the RTCP (control/supervisory).</p>
</div>
<h3 id="config-tlb_conf-ipaddr">ipaddr=</h3>
<p>This optionally sets the local IP address to bind to. If not specified, it defaults to <code>0.0.0.0</code>, which will bind to any interface.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>ipaddr = 44.128.252.1               ; Bind to the interface with the IP Address 44.128.252.1
</code></pre></div>
<h3 id="config-tlb_conf-astnode">astnode=</h3>
<p>This is the node number of the local AllStarLink node to associate to. It could be a public or private node, as setup in <a href="#config-rpt_conf"><code>rpt.conf</code></a>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>astnode = 2008                      ; app_rpt node associated with this instance (for incoming connections)
</code></pre></div>
<h3 id="config-tlb_conf-context">context=</h3>
<p>This is the context in <code>etc/asterisk/extensions.conf</code> to associate incoming connections to. Typically, this would be the <code>[radio-secure]</code> context.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>context = radio-secure              ; Asterisk context for incoming connections
</code></pre></div>
<h3 id="config-tlb_conf-codec">codec=</h3>
<p>This defines the default codec to use when connecting to TheLinkBox stations.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>codec = ULAW                        ; Default CODEC to be used
</code></pre></div>
<p>Valid codecs are: <code>ULAW</code>, <code>G726</code> and <code>GSM</code>.</p>
<h2 id="config-tlb_conf-tlb-nodes-stanza">TLB Nodes Stanza</h2>
<p>The <code>[nodes]</code> stanza defines a local private node number to associate with a specific TheLinkBox station.</p>
<p>The format is:</p>
<div class="highlight"><pre><span></span><code>&lt;privatenode&gt; = &lt;TLB CALL&gt;,&lt;IP ADDRESS&gt;,&lt;UDP PORT&gt;,[CODEC]
</code></pre></div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;privatenode&gt;</td>
<td>The private (local) node number to associate with the remote TheLinkBox station</td>
</tr>
<tr>
<td>&lt;TLB CALL&gt;</td>
<td>The callsign of the remote TheLinkBox station</td>
</tr>
<tr>
<td>&lt;IP ADDRESS&gt;</td>
<td>The static IP address of the remote TheLinkBox station</td>
</tr>
<tr>
<td>&lt;UDP PORT&gt;</td>
<td>The <strong>starting</strong> UDP port of the remote TheLinkBox station</td>
</tr>
<tr>
<td>[CODEC]</td>
<td>Optionally, use a specific codec, other than the default to connect to the remote TheLinkBox station</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>[nodes]
1001 = W6ABC,44.128.252.3,44966     ; This one is for W6ABC at ip 44.128.252.3:44966 default CODEC
1002 = W1XYZ,44.128.252.4,1234,G726 ; This one is for W1XYZ at ip 44.128.252.4:1234 with G726 CODEC
</code></pre></div>
<p>In the above example, private node <code>1001</code> is defined to connect to TheLinkBox station with the callsign W6ABC, which is at IP 44.128.252.3:44966, using the default codec. Node <code>1002</code> would connect to W1XYZ, at 44.128.252.4 on UDP port 1234, and use the G726 codec.</p></section><section class="print-page" id="config-voter_conf"><h1 id="config-voter_conf-voterconf">voter.conf</h1>
<p>The <code>voter.conf</code> file is generally going to be located with the rest of the Asterisk configuration files, in <code>/etc/asterisk</code>.</p>
<p>This file sets up the <code>chan_voter</code> channel driver to interface with <code>app_rpt</code>.</p>
<p>Remember, in <code>rpt.conf</code>, you will need a directive to use the <code>chan_voter</code> channel driver:</p>
<div class="highlight"><pre><span></span><code>rxchannel = Voter/1999
</code></pre></div>
<p>The <code>1999</code> should match the corresponding instance stanza defined in <code>voter.conf</code> that holds all the definitions for your clients.</p>
<p>The VOTER/RTCM may be used in any of 3 modes:</p>
<ul>
<li>non-voting client mode</li>
<li>voting mode</li>
<li>voting and simulcast mode</li>
</ul>
<p>There <strong>must</strong> be a <code>[general]</code> stanza that contains directives that are common to all the <code>chan_voter</code> instances. Some directives may be allowed in the <code>[general]</code> stanza and/or be defined on a per-client basis with the client definition directive.</p>
<p>In addition, there must be at least one <strong>instance</strong> stanza defined. An instance is a group of clients that are all related to each other. In a typical voting repeater scenario, the instance would typically be the node number, and all the clients would be the transmitter client and all the voting receiver clients associated with that repeater.</p>
<p>It <em>is</em> a valid configuration to only have one client defined in an instance. You might have this if you are just using the VOTER/RTCM as a RoIP adapter to connect a remotely located repeater back to a host over Ethernet.</p>
<p>Each client directive has a number of optional <strong>attributes</strong> associated with it that may, or may not, be required depending on your system configuration.</p>
<p>You <em>may</em> have more than one client defined as a transmitter, as in the case of a simulcast system. Any client with a transmitter attribute defined will be sent transmit audio packets associated to that instance.</p>
<p>There are also configuration directives that apply to an entire instance (and all the defined clients within it).</p>
<h2 id="config-voter_conf-voterconf-file-structure"><code>voter.conf</code> File Structure</h2>
<p>The <code>voter.conf</code> file is structured as shown below (as in all other Asterisk configuration files, lines preceded with a semi-colon ";" are treated as a comment):</p>
<div class="highlight"><pre><span></span><code>[general]
;bindaddr = 10.10.10.1      ; specify a particular IP address to bind to (not generally used, defaults to bind to all interfaces)
port = 1667                 ; specifies the UDP port to use for incoming connections (formerly 667 is ASL2)
buflen = 480                ; specifies the receive buffer length in milliseconds.
                            ; This parameter should be set to the maximum expected network latency,
                            ; plus a little padding (100 milliseconds of padding is a good amount).
                            ; The default is 480 milliseconds, the minimum is 320 milliseconds.
                            ; Buffer length may be specified on a per-stanza and per-client basis, see below.

password = secret_password  ; password common to all clients (Main Menu Item 6 - Host Password, on RTCM/VOTER)
utos = y                    ; Turn on IP TOS for Ubiquiti (ToS is enable by default on the RTCM/VOTER) from the host TO the clients

;sanity = 0                 ; disable sanity checking of clients (debug use only) defaults to 1 if not specifically set to 0
;puckit = 1                 ; KLUDGE to try and fix random Garmin LVC-18 pucks that may or may not be 1 second off (defaults to 0 if not specified)

[1999]                      ; define the 1999 instance stanza
Main = secret,transmit,master   ; master,transmit,adpcm,nulaw,nodeemp,noplfilter,buflen=value,gpsid[=value],prio=value
                            ; 
                            ; master - this client is the Master Timing source (the RTCM client that is on the same LAN as the Asterisk server.)
                            ; There can only be 1 Master Timing source per ENTIRE Asterisk server.
                            ; 
                            ; secret - password unique to this client
                            ; transmit - this client is intended to have transmit audio sent to it and will have a transmitter connected to it.
                            ; adpcm - this client is to be sent audio in 8000 samples/sec, 4-bit, IMA ADPCM format, rather than default G.711 Mulaw (aka ulaw).
                            ; nulaw - this client is to be sent audio in 4000 samples/second Mulaw (Nulaw, as we call it), rather than the standard 8000 samples/second.
                            ; nodeemp - this client is not to perform de-emphasis of the receiver audio  (This is only to be used with non-voting clients). Switches 
                            ; the hardware de-emphasis filter OUT on the client
                            ; noplfilter - this client is to not to perform hardware pl filtering of the audio. Switches the hardware PL filter OUT on the client.
                            ; buflen=value - receive buffer length override for this client only.
                            ; gpsid[=value] - This specifies a gps identity to associate with the specified client (as referred in the /etc/asterisk/gps.conf file).
                            ; prio=value - define a specific priority for this client when voting. Lower numbers are higher priority. Default is 0 if nothing specified.

plfilter = y                ; use DSP IIR 6 pole High pass filter, 300 Hz corner with 0.5 db ripple (note clients filter PL by default already)
txctcss = 100.0             ; Transmit CTCSS frequency
txctcsslevel = 62           ; Transmit CTCSS level (default of 62 if txctcss is supplied, but txctcsslevel is not set)
txtoctype = phase           ; Transmit tone control type: none,phase,notone
                            ; none - CTCSS tone encoding with no hang time (default)
                            ; phase - encode CTCSS and reverse phase (AKA &quot;reverse burst&quot;) before un-keying TX
                            ; notone - encode CTCSS and stop sending tone before un-keying TX (AKA &quot;chicken burst&quot;)

;gtxgain = 3.0              ; adjust the audio gain to all transmitters (in db voltage gain)
;hostdeemp = 1              ; force the use of the DSP FIR Integrator providing de-emphasis at 8000 samples/sec. Used with Duplex Mode 3 setting in RTCM/VOTER

thresholds = 255,110=5      ;
; linger=6                  ; linger default is 6 if no other value specified
; streams = 67.215.233.178:1667 ; location to send voter data stream for this instance (used only with votemond Java program, which is deprecated)

; isprimary = y             ; used in redundant server applications only. must be set on the primary server only
; primary = 10.20.20.1:667,mypaswd  ; used in redundant server applications only. must be ONLY set on the secondary server to point to the primary

[1998]                      ; define another voting instance on this server (for another node). Three simulcast transmitters and four receivers.
                            ; NOTE: there is NO &quot;master&quot; in this instance, since we already have a master timing source on this server defined above 

NORTH = password_1,transmit ; transmit/receive site
SOUTH = Password_2,transmit ; transmit/receive site
EAST = password_3,nodeemp   ; receive-only site, bypass de-emphasis filter in RTCM
WEST = Password_4,transmit,noplfilter   ; transmit/receive site, bypass CTCSS filter in RTCM
</code></pre></div>
<p>Of course, the above denotes all the possible options that you can define in <code>voter.conf</code>. A typical "bare minimum" to get on the air would be more along the lines of:</p>
<div class="highlight"><pre><span></span><code>[general]
port = 1667                 ; specifies the UDP port to use for incoming connections
buflen = 480                ; specifies the receive buffer length in milliseconds.
                            ; This parameter should be set to the maximum expected network latency,
                            ; plus a little padding (100 milliseconds of padding is a good amount).
                            ; The default is 480 milliseconds, the minimum is 320 milliseconds.
                            ; Buffer length may be specified on a per-stanza and per-client basis, see below.

password = secret_password  ; password common to all clients (Main Menu Item 6 - Host Password, on RTCM/VOTER)
utos = y                    ; Turn on IP TOS for Ubiquiti (ToS is enable by default on the RTCM/VOTER) from the host TO the clients


[1999]                      ; define the 1999 instance stanza

Main = secret,transmit,master   ; master - this client is the Master Timing source (the RTCM client that is on the same LAN as the Asterisk server.)
                            ; There can only be 1 Master Timing source per ENTIRE Asterisk server.
                            ; secret - password unique to this client
                            ; transmit - this client is intended to have transmit audio sent to it and will have a transmitter connected to it.

Remote = secret2            ; satellite receiver site only 
</code></pre></div>
<h2 id="config-voter_conf-general-stanza"><code>[general]</code> Stanza</h2>
<p>The <code>[general]</code> stanza defines all the configuration directives that apply to <code>chan_voter</code>, and all instances in the <code>voter.conf</code> file.</p>
<div class="highlight"><pre><span></span><code>[general]
;bindaddr = 10.10.10.1      ; specify a particular IP address to bind to (not generally used, defaults to bind to all interfaces)
port = 1667                 ; specifies the UDP port to use for incoming connections
buflen = 480                ; specifies the receive buffer length in milliseconds.
                            ; This parameter should be set to the maximum expected network latency,
                            ; plus a little padding (100 milliseconds of padding is a good amount).
                            ; The default is 480 milliseconds, the minimum is 320 milliseconds.
                            ; Buffer length may be specified on a per-stanza and per-client basis, see below.

password = secret_password  ; password common to all clients (Main Menu Item 6 - Host Password, on RTCM/VOTER)
utos = y                    ; Turn on IP TOS for Ubiquiti (ToS is enable by default on the RTCM/VOTER) from the host TO the clients

;sanity = 0                 ; disable sanity checking of clients (debug use only) defaults to 1 if not specifically set to 0
;puckit = 1                 ; KLUDGE to try and fix random Garmin LVC-18 pucks that may or may not be 1 second off (defaults to 0 if not specified or set to 1)
</code></pre></div>
<h3 id="config-voter_conf-bindaddr">bindaddr</h3>
<p>Typically, <code>bindaddr</code> is not specified (it defaults to "INADDR_ANY"). It is supported, however, should you need to bind your VOTER clients to a specific IP interface on the server.</p>
<h3 id="config-voter_conf-port">port</h3>
<p>The <code>port</code> directive specifies the listening UDP port that <code>chan_voter</code> is listening on for incoming connections from clients. When clients power on, they attempt to contact the <code>VOTER Server Address</code> at the <code>VOTER Server Port</code>, defined in their on-board configuration settings. See the Menu Structure and Definitions page for further explanation of those configuration settings. This is the <strong>incoming</strong> port you may need to let through your firewall.</p>
<p><strong>NOTE:</strong> In ASL2, the default port used was <code>667/UDP</code>, and is now <code>1667/UDP</code>. See <a href="#basics-incompatibles-voterrtcm-default-port">VOTER/RTCM Default Port</a> for more details on this change.</p>
<p>If running the AllStarLink Pi Appliance (or another system with a firewall), inbound to port <code>1667/UDP</code> must be permitted. For directions on how to do this with the Pi Appliance see <a href="#pi-cockpit-firewall">Managing the Firewall</a>. <strong>Don't forget to also allow this port through any firewall that may part of your internet connection.</strong></p>
<h3 id="config-voter_conf-password">password</h3>
<p>The password directive specifies the matching <code>Host Password</code> that needs to be configured in the VOTER client. This is the password for the server as a whole for all the clients to authenticate with.</p>
<h3 id="config-voter_conf-utos">utos</h3>
<p>Short for "Ubiquity Type of Service". When set, it will mark outbound packets (from the host to the client) with the ToS header flag of <code>0xC0</code>. This is ToS precedence Level 6 or "Internetwork Control".</p>
<p>It is used in traffic shaping. If your network is that congested that you need to shape traffic... you might have bigger issues. However, it doesn't hurt to flag the traffic when transiting the Internet to remote sites.</p>
<p><strong>NOTE:</strong> As of VOTER/RTCM firmware &gt;v2.00, the clients will automatically mark their outbound traffic (to the host) with the same flag. That can now be <strong>disabled</strong> by setting the appropriate <code>Debug Option</code>. Older versions of firmware (&lt;2.00) did not flag the traffic by default, and required it to be <strong>enabled</strong> with the <code>Debug Option</code>.</p>
<h3 id="config-voter_conf-sanity">sanity</h3>
<p>This directive is only used for debugging.</p>
<p><code>sanity</code> tells <code>chan_voter</code> to disable all sanity checks for clients. You would <strong>never</strong> want to do that in production.</p>
<h3 id="config-voter_conf-puckit">puckit</h3>
<p>This directive is only used for debugging.</p>
<p><code>puckit</code> attempts to fix a problem with Garmin GPS pucks. Use at your own risk. Per Jim's notes in the source:</p>
<div class="highlight"><pre><span></span><code>/* This is just a horrendous KLUDGE!! Some Garmin LVC-18 GPS &quot;pucks&quot;
 *sometimes* get EXACTLY 1 second off!! Some don&#39;t do it at all.
 Some do it constantly. Some just do it once in a while. In an attempt
 to be at least somewhat tolerant of such swine poo-poo, the &quot;puckit&quot;
 configuration flag may be set, which makes an attempt to deal with
 this problem by keeping a &quot;time differential&quot; for each client (compared
 with the &quot;master&quot;) and applying it to time information within the protocol.
 Obviously, this SHOULD NEVER HAVE TO BE DONE. */
</code></pre></div>
<h2 id="config-voter_conf-voter-instances">VOTER Instances</h2>
<p>Within <code>voter.conf</code>, there <em>may</em> exist more than one <strong>instance</strong>. An instance is defined by a stanza that is <strong>not</strong> named <code>[general]</code>, and is typically named for the node number it is associated with in <code>rpt.conf</code>.</p>
<p>This <strong>must</strong> match the name of the channel driver that is referenced from <code>rpt.conf</code> in the node definition there:</p>
<div class="highlight"><pre><span></span><code>rxchannel = Voter/1999
</code></pre></div>
<p>It is <strong>not</strong> recommended to use anything other than numerical digits for the instance definition. Unpredictable results will happen (read, doesn't work).</p>
<p>This instance holds one or more <strong>client definitions</strong> that are <em>associated with each other</em> (ie. all operating on the same transmit/receive frequencies as part of the same repeater system).</p>
<div class="highlight"><pre><span></span><code>[1999]                          ; define the 1999 instance stanza

Main = secret,transmit,master   ; master - this client is the Master Timing source (the RTCM client that is on the same LAN as the Asterisk server.)
                                ; There can only be 1 Master Timing source per ENTIRE Asterisk server.
                                ; secret - password unique to this client
                                ; transmit - this client is intended to have transmit audio sent to it and will have a transmitter connected to it.

Remote = secret2                ; satellite receiver site only 
</code></pre></div>
<p>The example above defines an instance named <code>1999</code>, and has two clients defined, which are named <code>Main</code> and <code>Remote</code>.</p>
<h2 id="config-voter_conf-client-definition">Client Definition</h2>
<p>A <code>client</code> is a particular VOTER/RTCM hardware device that is located somewhere, connected to Etherent and a radio, and is feeding receive audio to (and optionally receiving transmit audio from) the Asterisk host and the configured channel in <code>rpt.conf</code> through <code>app_rpt</code>. Each <code>client</code> in an instance is defined using the format:</p>
<div class="highlight"><pre><span></span><code>DISPLAY_NAME = secret[,options]
</code></pre></div>
<p>The <code>DISPLAY_NAME</code> can be any alpha-numeric, non-breaking string, up to 50 characters in length. You probably want to keep it short, since you may need to type it on the Asterisk Console for debugging. You can use "_" in the name. This is the name that will be displayed on the Allmon/Supermon screens when looking at voting clients, and the <strong>client name</strong> in the Asterisk console.</p>
<p>The <code>secret</code> is a <strong>unique</strong> value for <em>each client</em> that <strong>must</strong> match the <code>Client Password</code> that is programmed into a particular VOTER/RTCM hardware device. This is how <code>chan_voter</code> determines which hardware client to associate with which client definition in the <code>voter.conf</code> file. The password may be up to 50 characters in length.</p>
<p>The <code>options</code> are any one or more of the following shown below, separated by a comma on each client definition line.</p>
<h2 id="config-voter_conf-client-options">Client Options</h2>
<p>In addition to the above, there are a number of <strong>options</strong> that can be associated with any client.</p>
<p>If no <code>options</code> are specified for a client, then <strong>none</strong> of the options specified below are enabled for the particular client, and it will be treated as a standard (non-master), receive-only, Mu law audio client.</p>
<h3 id="config-voter_conf-master">master</h3>
<p>There must be <strong>one and only one client</strong> in the whole <code>voter.conf</code> file that has the <code>master</code> option set, regardless of how many instances are defined. This <strong>must</strong> be a VOTER/RTCM hardware device that is located <em>on the same physical LAN</em> (ie. same switch) that the Asterisk server resides on. This VOTER/RTCM does not necessarily need a radio attached to it (but that is common), but it <strong>does</strong> need a GPS. It does not need to be a transmitter, it can just be a receiver site, if desired. This is the client that <code>chan_voter</code> uses for master timing of all operations, and will be the reference timing source that all clients will be compared with. A <code>master</code> is not required in "General-purpose" or "Mixed Mode" client applications, where GPS is not required at all.</p>
<h3 id="config-voter_conf-transmit">transmit</h3>
<p>This client will have transmit audio sent to it by the channel driver. More than one client may have transmit audio sent to them, as in a simulcast application.</p>
<h3 id="config-voter_conf-adpcmnulaw">adpcm/nulaw</h3>
<p>By default, audio is sent between the client and the host in G.711 Mulaw (aka ulaw) format. This is the default, if neither adpcm or nulaw options are associated with a client.</p>
<p><code>adpcm</code> will configure this client to exchange audio in 8000 samples/sec, 4-bit, IMA ADPCM format.</p>
<p><code>nulaw</code> will configure this client to exchange audio in 4000 samples/second Mulaw (Nulaw, as we call it), rather than the standard 8000 samples/second.</p>
<h3 id="config-voter_conf-nodeemp">nodeemp</h3>
<p><code>nodeemp</code> tells this client not to perform de-emphasis of the receiver audio using the on-board hardware de-emphasis filter. This option manually switches the hardware de-emphasis <strong>OUT</strong> on the client. This is only to be used with non-voting clients.</p>
<h3 id="config-voter_conf-noplfilter">noplfilter</h3>
<p><code>noplfilter</code> tells this client not to pass the receive audio through the on-board hardware CTCSS filter. Normally, audio is filtered to remove any CTCSS tones on the VOTER/RTCM hardware client before being sent to the host. This option manually switches the hardware CTCSS filter <strong>OUT</strong> on the client.</p>
<h3 id="config-voter_conf-buflenvalue">buflen=value</h3>
<p><code>buflen=value</code> sets a specific receiver buffer length value for this client. This option is used in special applications only.</p>
<h3 id="config-voter_conf-gpsidvalue">gpsid=value</h3>
<p><code>gpsid[=value]</code> specifies a gps identity to associate with the specified client (as referred in the <code>/etc/asterisk/gps.conf</code> file). It is also used as the filename to create "GPS Work and Data Files" associated to the client. If no value is specified, default filenames are used. If a <code>value</code> is specified, it appends the supplied <code>value</code> to the filename with a "_".</p>
<p>This appears to be associated with <code>app_gps</code>, which can be used for reporting AllStarLink's position to APRS. Presumably, since you already have a GPS connected for the VOTER, this allows you to share its position data with <code>app_gps</code>, instead of having to use a separate GPS? Sorry, better documentation is required on how to configure this option and how it works. Feel free to contribute!</p>
<h3 id="config-voter_conf-priovalue">prio=value</h3>
<p><code>prio=value</code> will define a specific priority for this client when voting. Lower numbers are higher priority. Default is 0 if nothing specified. This is normally not specified, and voting will take place based on the best RSSI from all clients. This option is used in special applications only.</p>
<h2 id="config-voter_conf-instance-options">Instance Options</h2>
<p>The following options affect all clients registered under a instance.</p>
<div class="highlight"><pre><span></span><code>plfilter = y            ; use DSP IIR 6 pole High pass filter, 300 Hz corner with 0.5 db ripple (note clients filter PL by default already)
txctcss = 100.0         ; Transmit CTCSS frequency
txctcsslevel = 62       ; Transmit CTCSS level (default of 62 if txctcss is supplied, but txctcsslevel is not set)
txtoctype = phase       ; Transmit tone control type: none,phase,notone
                ; none - CTCSS tone encoding with no hang time (default)
                ; phase - encode CTCSS and reverse phase (AKA &quot;reverse burst&quot;) before unkeying TX
                ; notone - encode CTCSS and stop sending tone before unkeying TX (AKA &quot;chicken burst&quot;)

;gtxgain = 3.0          ; adjust the audio gain to all transmitters (in db voltage gain)
;hostdeemp = 1          ; force the use of the DSP FIR Integrator providing de-emphasis at 8000 samples/sec. Used with Duplex Mode 3 setting in RTCM/VOTER

thresholds = 255,110=5      ;
; linger=6          ; linger default is 6 if no other value specified
; streams = 67.215.233.178:1667 ; location to send voter data stream for this instance (used only with votemond Java program, which is deprecated)

; isprimary = y         ; used in redundant server applications only. must be set on the primary server only
; primary = 10.20.20.1:667,mypaswd  ; used in redundant server applications only. must be ONLY set on the secondary server to point to the primary
</code></pre></div>
<h3 id="config-voter_conf-plfilter">plfilter</h3>
<p>Enabling this option uses the internal software DSP IIR 6-pole high-pass filter that has a 300Hz corner and 0.5dB ripple on the host. Note that all VOTER/RTCM clients already employ a hardware CTCSS filter that is enabled by default. So, if you are going to use this option, you probably want to use the <code>noplfilter</code> in the client options.</p>
<p>If this option is not specified, it will default to disabled.</p>
<h3 id="config-voter_conf-txctcss">txctcss</h3>
<p>This option controls the generation of transmit CTCSS. Refer to the VOTER Audio page for further details on the different applications and required radio connections (direct modulator).</p>
<p><code>txctcss</code> is any valid CTCSS tone.</p>
<h3 id="config-voter_conf-txctcsslevel">txctcsslevel</h3>
<p>This option controls the generation of transmit CTCSS. Refer to the VOTER Audio page for further details on the different applications and required radio connections (direct modulator).</p>
<p><code>txctcsslevel</code> is the level of the CTCSS tone to generate. If no level is specified, then it will default to a level of 62.</p>
<h3 id="config-voter_conf-txtoctype">txtoctype</h3>
<p>This option controls the generation of transmit CTCSS. Refer to the VOTER Audio page for further details on the different applications and required radio connections (direct modulator).</p>
<p><code>txtoctype</code> is the type of CTCSS turn-off to use when the transmitter un-keys. It defaults to <code>none</code>, where the tone ends at the same time as the PTT un-keys. This usually isn't handled well by many radios, and results in squelch crashes in their receivers. The <code>phase</code> option (also known as "Reverse-burst") reverses the phase of the CTCSS tone, just before unkeying the transmitter. This is how Motorola turns off CTCSS tones, and was originally designed to force CTCSS reeds to stop vibrating by applying opposite polarity to them. The <code>notone</code> option (also known as "Chicken-burst") is similar to the <code>none</code> option, except here the CTCSS tone is stopped just prior to the transmitter unkeying. The theory behind that being, it gives time for the user's radio to detect the loss of CTCSS tone and squelch, before the transmitter drops, preventing the squelch from crashing.</p>
<p>Beware using this option, as it affects whether pre-emphasis is applied to your audio, or not. That means it affects how you have the RTCM/VOTER connected to your radio's transmitter. Using this option means you <strong>must</strong> be using a direct modulator connection, and not the mic audio input. Note that it is a valid configuration to use a direct modulation connection, and specify the <code>txctcsslevel</code> as <code>0</code> to correctly modulate the transmitter, but not send a CTCSS tone.</p>
<h3 id="config-voter_conf-gtxgain">gtxgain</h3>
<p>This is a bit of an obscure option that is not widely known/used. It can be used to adjust the audio gain sent to all transmitters. The value is a floating number (versus an integer), and is in dB.</p>
<p>The equation used in the source code is:</p>
<div class="highlight"><pre><span></span><code>p-&gt;gtxgain = pow(10.0,atof(val) / 20.0);
</code></pre></div>
<p>The default, if nothing is specified, is 0.0. Positive and negative values are supported.</p>
<p>The value is <strong>voltage gain</strong>, so 3dB would increase the transmitter audio level by 1.41, 6dB would double the amplitude.</p>
<h3 id="config-voter_conf-hostdeemp">hostdeemp</h3>
<p>Note that this option only works on a per-instance level.</p>
<p>This option is used with the <code>Duplex Mode 3</code> setting in the RTCM/VOTER.</p>
<p>This option forces receive audio from all clients to be sent through the host's DSP FIR Integrator providing de-emphasis at 8000 samples/sec. (normally, de-emphasis is done on the VOTER/RTCM hardware client before being sent to the host). This option is used in special applications only.</p>
<p><strong>NOTE:</strong> The de-emphasis only takes place between the receiver (received audio) and the channel driver in Asterisk. Recall that Duplex Mode 3 does "in-cabinet repeat", so the receiver audio is sent to the transmitter without any processing (ie de-emphasis).</p>
<h3 id="config-voter_conf-thresholdslinger">thresholds/linger</h3>
<p>The <code>thresholds</code> and <code>linger</code> options determine how the voting algorithm works. You can find a thorough explanation on how to set these parameters on <a href="#voter-about-voter">this page</a>.</p>
<h3 id="config-voter_conf-isprimaryprimary">isprimary/primary</h3>
<p>These options configure hosts configured in redundant host applications. You can find a thorough explanation of how this works in the <strong><em>FIXME</em></strong> Redundant Proxy Mode explanation.</p>
<p>Suffice to say, on the "primary" server, you would use the <code>isprimary</code> option (set to <code>y</code>). On the "secondary" (backup) server, you would use the <code>primary</code> option to point to the <code>IP address</code> of the primary server. <strong>NOTE:</strong> that the primary option also needs the <code>port</code> and the <code>host password</code> of the primary server, in order for it to properly authenticate.</p>
<h3 id="config-voter_conf-streams">streams</h3>
<p><code>streams</code>, which specifies a list of <code>IP_ADDR:UDP_PORT</code> values indicating where to send the <code>votmond</code> (deprecated) redistribution stream associated with the specified system</p></section><h1 class='nav-section-title-end'>Ended: Config Files</h1></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 AllStarLink Inc.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.allstarlink.org/" target="_blank" rel="noopener" title="AllStarLink Home" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6 31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5 50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5l112.2-112.3c31.5-31.5 82.5-31.5 114 0 27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/AllStarLink" target="_blank" rel="noopener" title="AllStarLink on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            





  

<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" checked>
<div class="md-consent__settings">
  <ul class="task-list">
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "/", "features": ["content.code.copy", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>